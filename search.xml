<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ç½‘ç»œç»æµŽä¸Žä¼ä¸šç®¡ç†(ä¸€)]]></title>
    <url>%2F2020%2F03%2F01%2Fzikao%2F%E7%BD%91%E7%BB%9C%E7%BB%8F%E6%B5%8E%E4%B8%8E%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[ç½‘ç»œç»æµŽä¸Žä¼ä¸šç®¡ç†(ä¸€) ä¼ä¸šåŠå…¶å½¢å¼ ä¼ä¸šæ˜¯ä»¥å¸‚åœº ä¸ºå¯¼å‘ä»Žäº‹å•†å“ç”Ÿäº§å’Œæµé€šçš„ç»æµŽç»„ç»‡; ä¼ä¸šæ˜¯ä»¥ä»·å€¼å¢žå€¼ä½œä¸ºå…¶ç»æµŽæ´»åŠ¨çš„ç›®çš„; ä¼ä¸šè¿›è¡Œè‡ªä¸»ç»è¥ è‡ªè´Ÿç›ˆäºå’Œç‹¬ç«‹æ ¸ç®—ã€‚ç‹¬ç«‹æ ¸ç®— é€‰æ‹©é¢˜ å·¥åŽ‚åˆ¶åº¦çš„å»ºç«‹ï¼Œæ ‡å¿—ç€ä¼ä¸šçš„çœŸæ­£å½¢æˆã€‚ å¤šé€‰ï¼ŒçŽ°ä»£ä¼ä¸šç”Ÿäº§æ—¶æœŸçš„ç‰¹å¾ æ‹¥æœ‰çŽ°ä»£æŠ€æœ¯ æ‹¥æœ‰çŽ°ä»£åŒ–ç®¡ç† æ‰€æœ‰è€…ä¸Žç»è¥è€…ç›¸åˆ†ç¦» ç®¡ç†æ–¹é¢ æ‹¥æœ‰çŽ°ä»£åŒ–ç®¡ç† æ‰€æœ‰è€…ä¸Žç»è¥è€…ç›¸åˆ†ç¦» ç”Ÿäº§æŠ€æœ¯ æ‹¥æœ‰çŽ°ä»£æŠ€æœ¯ ç”Ÿäº§è§„æ¨¡ç©ºå‰æ‰©å¤§ï¼Œäº§ç”Ÿäº†åž„æ–­ç»„ç»‡ åŠ³åŠ¨åˆ†å·¥è¶Šæ¥æˆªæ­¢ç²¾ç»†ï¼Œåä½œå…³ç³»å¤æ‚ã€ä¸¥å¯† ç«žäº‰ ä¼ä¸šä¹‹é—´çš„ç«žäº‰æ¿€çƒˆ ç¤¾ä¼šè´£ä»» ä¼ä¸šçš„ç¤¾ä¼šè´£ä»»æ”¹å˜ ä¼ä¸šç±»åž‹æ ¹æ®ä¼ä¸šæ‰€å±žçš„ç»æµŽéƒ¨(å†œä¸šä¼ä¸šã€å·¥ä¸šä¼ä¸šã€é‡‘èžä¼ä¸šã€å•†ä¸šä¼ä¸š)æ ¹æ®ç”Ÿäº§åŠ›è¦ç´ æ¯”é‡(åŠ³åŠ¨å¯†é›†åž‹ä¼ä¸šã€æŠ€æœ¯å¯†é›†åž‹ä¼ä¸šã€çŸ¥è¯†å¯†é›†åž‹ä¼ä¸šã€èµ„æºå¯†é›†åž‹ä¼ä¸š)æ ¹æ®ä¼ä¸šç»è¥è§„æ¨¡(å¤§åž‹ä¼ä¸šï¼Œä¸­åž‹ä¼ä¸šï¼Œå°åž‹ä¼ä¸š)æ ¹æ®ä¼ä¸šè´¢äº§æž„æˆå’Œæ‰€è´Ÿæ³•å¾‹è´£ä»»:1ã€ä¸ªä½“ä¼ä¸šåˆå«ç‹¬èµ„ä¼ä¸šï¼Œæ˜¯ç”±ä¸šä¸»ä¸ªäººå‡ºèµ„å…´åŠžï¼Œç”±ä¸šä¸»è‡ªå·±ç»è¥ã€‚åœ¨å›½å¤–ï¼Œè®¸å¤šé›¶å”®å•†ä¸šã€æ‰‹å·¥ä¸šã€å®¶åº­å·¥ä¸šã€å†œä¸šç­‰å¤šé‡‡ç”¨ä¸ªä½“ä¼ä¸šã€‚2ã€ åˆä¼™ä¼ä¸šç”±ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ä¸ªäººå…±åŒå‡ºèµ„ï¼Œé€šè¿‡ç­¾è®¢åè®®è”åˆç»è¥ã€‚3ã€å…¬å¸åˆ¶ä¼ä¸š(å¦‚æœ‰é™è´£ä»»å…¬å¸å’Œè‚¡ä»½æœ‰é™å…¬å¸)ç”±ä¸¤ä¸ªä»¥ä¸Šçš„å‡ºèµ„è€…å…±åŒå‡ºèµ„ã€ä¾æ³•ç»„å»ºï¼Œä»¥ç›ˆåˆ©ä¸ºç›®çš„çš„ä¼ä¸šæ³•äººï¼Œæ˜¯è”åˆç»è¥çš„ä¼ä¸šç»„ç»‡å½¢å¼ã€‚ å…¬å¸åˆ¶ä¼ä¸šçš„ç‰¹ç‚¹å…¬å¸åˆ¶ä¼ä¸šæ˜¯æ³•äººã€‚å…¬å¸åˆ¶ä¼ä¸šå®žè¡Œæœ‰é™è´£ä»»åˆ¶åº¦ã€‚å…¬å¸åˆ¶ä¼ä¸šçš„æ‰€æœ‰æƒå’Œç»è¥æƒç›¸åˆ†ç¦»ã€‚ çœŸé¢˜1ã€ä¼ä¸šä¸ºäº†æ»¡è¶³ç¤¾ä¼š ç®¡ç†1ã€ç®¡ç†æ˜¯ä¸€ä¸ªåŠ¨æ€è¿‡ç¨‹;2ã€ç®¡ç†çš„çŽ¯æŠ±æ˜¯è¾¾åˆ°ç»„ç»‡çš„é¢„å®šç›®æ ‡;3ã€ç®¡ç†çš„è½½ä½“æ˜¯ç»„ç»‡;4ã€ç®¡ç†çš„æ ¸å¿ƒæ˜¯å¯¹èµ„æºçš„åˆç†é…ç½®å’Œæœ‰æ•ˆæ•´åˆã€‚ ç®¡ç†æ´»åŠ¨æ‰€å…·å¤‡çš„æ¡ä»¶ç®¡ç†çš„ä¸»ä½“(è°æ¥ç®¡) ã€ ç®¡ç†çš„å®¢ä½“(ç®¡ç†è°)ã€ ç®¡ç†çš„ç›®çš„(ä¸ºå•¥ç®¡) äº”èŒèƒ½è®ºæ³•çº¦å°”è®¤ä¸ºï¼Œä¼ä¸šçš„ç®¡ç†æ´»åŠ¨å°±æ˜¯ç”±è®¡åˆ’ã€ç»„ç»‡ã€æŒ‡æŒ¥ã€åè°ƒã€æŽ§åˆ¶ è¿™äº”ç§èŒèƒ½çº§æˆçš„ã€‚ è®¡åˆ’ æ˜¯ç®¡ç†èŒèƒ½ä¸­çš„é¦–è¦èŒèƒ½ â€“&gt; ç®¡ç† çš„è®¡åˆ’èŒèƒ½è®¡åˆ’ã€ç»„ç»‡ã€é¢†å¯¼ã€æŽ§åˆ¶ æ˜¯ç®¡ç†å­¦æ´¾æ™®é€šçš„å…¬è®¤çš„èŒèƒ½ã€‚ é¦–è¦çš„èŒèƒ½è®¡åˆ’èŒèƒ½ æ˜¯å¯¹å³å®šçš„ç›®æ ‡è¿›è¡Œå…·ä½“å®‰æŽ’ï¼Œä½œä¸ºå…¨ä½“å‘˜å·¥åœ¨ä¸€å®šæ—¶æœŸçš„è¡ŒåŠ¨çº²é¢†ï¼Œå¹¶è§„å®šå®žçŽ°ç›®æ ‡çš„é€”å¾„ã€æ–¹æ³•çš„ç®¡ç†æ´»æ´»åŠ¨ã€‚1 å¹´ä»¥å†…æ˜¯çŸ­æœŸè®¡åˆ’ï¼Œ 1-5 æ˜¯ä¸­æœŸè®¡åˆ’ ï¼Œ5å¹´åŽæ˜¯é•¿æœŸè®¡åˆ’ ç»„ç»‡å·¥ä½œçš„åŸºæœ¬åŽŸåˆ™(ç®€ç­”)æœ‰æ•ˆæ€§åŽŸåˆ™: èƒ½é«˜æ•ˆåœ°å®Œæˆå·¥ä½œï¼›æœºæž„è®¾ç½®å’Œäººå‘˜é…å¤‡åˆ°ç²¾ç®€ã€‚ç²¾ç®€äººå‘˜å®žçŽ°ä»»åŠ¡å’Œè´£ä»»åˆ°äººï¼Œæœ‰æ•ˆåœ°é¿å…äº†æŽ¨è¯¿å’Œæ‰¯çš®çŽ°è±¡ã€‚ç»Ÿä¸€æŒ‡æŒ¥åŽŸåˆ™: åœ¨æŒ‡æŒ¥å’Œå‘½ä»¤ï¼Œä¸¥æ ¼æ‰§è¡Œâ€ä¸€å…ƒåŒ–â€ç®¡ç†ã€‚è´£æƒåˆ©ç›¸ä¸€è‡´åˆ™:ä¸ºæ¯ä¸€ä¸ªå±‚æ¬¡å’ŒçŽ¯èŠ‚éƒ½è§„å®šè´£ï¼ŒåŒæ—¶èµ‹äºˆæ‰€å¿…é¡»çš„èŒæƒã€‚é›†æƒå’Œåˆ†æƒç›¸ç»“åˆåŽŸåˆ™: å¯¹é‡å¤§å†³ç­–å’Œå…¨å±€æ€§ç®¡ç†å®žè¡Œé›†æƒï¼Œå¯¹æ—¥å¸¸ç®¡ç†å®žè¡Œåˆ†æƒã€‚å¼¹æ€§åŽŸåˆ™: è®¾è®¡ç»„ç»‡ç»“æž„æ—¶è¦ç•™æœ‰ä½™åœ°ï¼Œåˆ¶å®šä¸€äº›å¸¦æœ‰ä¼¸ç¼©æ€§çš„ç»„ç»‡è§„åˆ™ã€‚åè°ƒåŽŸåˆ™: ç»„ç»‡çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯ â€œæ•´ä½“åŠŸèƒ½å¤§äºŽéƒ¨åˆ†åŠŸèƒ½ä¹‹å’Œâ€ é¢†å¯¼çš„æ´»åŠ¨å†…å®¹1ã€æƒåŠ›çš„å½¢æˆå’Œè¿ç”¨2ã€æŒ‡å¯¼3ã€æ¿€åŠ±4ã€æ²Ÿé€š5ã€åè°ƒ6ã€è¥é€ ç»„ç»‡æ°”æ°›ï¼Œå»ºè®¾ç»„ç»‡æ–‡åŒ– æŽ§åˆ¶çš„æ–¹å¼(é€‰æ‹©)é¢„å…ˆæŽ§åˆ¶:æ˜¯é¢å‘æœªæ¥çš„æŽ§åˆ¶ï¼Œåˆç§°å‰é¦ˆæŽ§åˆ¶ã€‚çŽ°åœºæŽ§åˆ¶:æŒ‡åœ¨å®žæ–½è®¡åˆ’è¿‡ç¨‹ä¸­ï¼Œå……åˆ†ä½“ç®¡ç†æŽ§åˆ¶çš„é‚£ä¸€éƒ¨åˆ†å·¥ä½œï¼Œåˆç§°é€‚æ—¶æŽ§åˆ¶ï¼Œæ˜¯æœ€åŸºæœ¬çš„æŽ§åˆ¶æ–¹å¼åé¦ˆæŽ§åˆ¶: ä¹Ÿç§°è¿‡åŽè¡Œä¸ºæŽ§åˆ¶æˆ–äº‹åŽæŽ§åˆ¶ ä¼ä¸šæ˜¯ä»¥ä»·å€¼å¢žå€¼ä½œä¸ºå…¶ç»æµŽæ´»åŠ¨çš„ç›®çš„ä¼ä¸šç®¡ç†çš„ç›®æ ‡æ˜¯å®žçŽ°ä¼ä¸šä»·å€¼çš„æœ€å¤§åŒ– çœŸé¢˜å½¢æˆä¸€é¡¹ç®¡ç†æ´»åŠ¨å¿…é¡»å…·å¤‡çš„æ¡ä»¶ï¼ŒåŒ…æ‹¬ æœ‰æ•ˆç®¡ç†çš„ä¸»ä½“ ï¼Œæœ‰æ•ˆç®¡ç†çš„å®¢ä½“ ï¼Œæœ‰æ•ˆç®¡ç†çš„ç›®çš„ ç®¡ç†çš„é¦–è¦èŒèƒ½æ˜¯è®¡åˆ’ ä¸­æœŸè®¡åˆ’çš„æ—¶é—´ä¸€èˆ¬æ˜¯ä¸€åˆ°äº”å¹´ä»¥å†… è¿ç­¹å¸·å¹„ä¹‹ä¸­ï¼Œå†³èƒœåƒé‡Œä¹‹å¤–ï¼Œè¿™é‡Œè¿ç­¹å¸·å¹„ååº”äº†ç®¡ç†çš„å“ªä¸€ä¸ªèŒèƒ½ è®¡åˆ’èŒèƒ½ æ³•çº¦å°”çš„ä¼ä¸šç®¡ç†æ´»åŠ¨â€œäº”èŒèƒ½è®ºâ€ åŒ…æ‹¬è®¡åˆ’ã€ç»„ç»‡ã€æŒ‡æŒ¥åŠè°ƒåä¸ŽæŽ§åˆ¶ ç²¾ç®€äººå‘˜å®žçŽ°ä»»åŠ¡å’Œè´£ä»»åˆ°äººï¼Œæœ‰æ•ˆåœ°é¿å…äº†æŽ¨è¯¿å’Œæ‰¯çš®çš„çŽ°è±¡ï¼Œè¿™ä½“çŽ°äº†ç»„ç»‡å·¥ä½œçš„å“ªé¡¹åŽŸåˆ™ æœ‰æ•ˆæ€§åŽŸåˆ™ æŒ‰ç…§æŽ§åˆ¶æ–¹å¼çš„ä¸åŒï¼Œä¸€èˆ¬æŠŠæŽ§åˆ¶åˆ†ä¸º é¢„å…ˆæŽ§åˆ¶ï¼ŒçŽ°åœºæŽ§åˆ¶ï¼Œåé¦ˆæŽ§åˆ¶ çŽ°åœºæŽ§åˆ¶ï¼Œåˆç§°é€‚æ—¶æŽ§åˆ¶ å¯¹æ—¢å®šçš„ç›®æ ‡è¿›è¡Œå…·ä½“å®‰æŽ’ï¼Œä½œä¸ºå…¨ä½“å‘˜å·¥åœ¨ä¸€æ—¶æ—¶æœŸå†…çš„è¡ŒåŠ¨çº²é¢†ï¼Œå¹¶è§„å®šå®žçŽ°ç›®æ ‡çš„é€”å¾„ï¼Œæ–¹æ³•çš„ç®¡ç†çš„ è®¡åˆ’èŒèƒ½ ä¼ä¸šç®¡ç†çš„ç›®æ ‡åˆ©ç›Šç›¸å…³ç€(èµ„æœ¬æ‰€æœ‰è€…ã€å€ºæƒäººã€å®¢æˆ·ã€ä¾›åº”å•†ã€æ”¿åºœå’Œç¤¾ä¼š) ä¼ä¸šç®¡ç†ç†è®ºä¸Žå®žè·µçš„äº§ç”Ÿä¸Žå‘å±•æ³°ç½— ã€Šç§‘å­¦ç®¡ç†åŽŸç†ã€‹ è¢«ç§°ä¸ºç§‘å­¦ç®¡ç†ä¹‹çˆ¶æ³•çº¦å°”ã€Šå·¥ä¸šç®¡ç†å’Œä¸€èˆ¬ç®¡ç†ã€‹ ç®¡ç†è¿‡ç¨‹ç†è®ºä¹‹çˆ¶éŸ¦ä¼¯ã€Šç¤¾ä¼šå’Œç»æµŽç†è®ºã€‹ è¢«ç§°ä¸ºç»„ç»‡ç®¡ç†ä¹‹çˆ¶ è¡Œä¸ºç§‘å­¦ç†è®ºï¼Œ20ä¸–çºªåˆ°30å¹´ä»£åˆ°60å¹´ä»£ å§“å ç†è®º é©¬æ–¯æ´› éœ€æ±‚å±‚æ¬¡ç†è®º èµ«èŒ¨ä¼¯æ ¼ åŒå› ç´ ç†è®º éº¦å…‹åˆ©å…° æ¿€åŠ±éœ€æ±‚ç†è®º éº¦æ ¼é›·æˆˆ Xç†è®º-Yç†è®º ç®¡ç†ç†è®ºä¸›æž— å§“å å­¦æ´¾ å·´çº³å¾· ç¤¾ä¼šç³»ç»Ÿå­¦æ´¾ è¥¿è’™ å†³ç­–å­¦æ´¾ å¾·é²å…‹ ç»éªŒ(æ¡ˆä¾‹) å­¦æ´¾ æˆ˜ç•¥ç®¡ç†ä¸Žå®žè·µçš„äº§ç”Ÿå’Œå‘å±•20 ä¸–çºª60å¹´ä»£ä¸­åŽæœŸåˆ°80å¹´ä»£åˆï¼Œä¼ä¸šç®¡ç†å­¦ç•Œå¼€å§‹é‡ç‚¹ç ”ç©¶æˆ˜ç•¥ç®¡ç†ç†è®º20 ä¸–çºªå…­ä¸ƒåå¹´ä»£ï¼Œæ—¥æœ¬å¼•è¿›ç¾Žå›½è´¨é‡ç®¡ç†ä¸“å®¶æˆ´æ˜Žå’Œæœ±å…°çš„å…¨é¢è´¨é‡ç®¡ç†çš„æ€æƒ³ä¼ä¸šæ–‡åŒ–æˆä¸º80å¹´ä¼ä¸šç®¡ç†ç ”ç©¶çš„é‡ç‚¹ æ—¶é—´ ä»£è¡¨äººç‰© ç†è®º 20ä¸–çºª80å¹´ä»£åŽæœŸ å“ˆé»˜&amp;é’±çš® ä¼ä¸šå†é€ ç†è®º 20ä¸–çºª90å¹´ä»£åŽæœŸ å½¼å¾·&amp;åœ£å‰ ç¬¬5é¡¹ä¿®ç‚¼-ä¼ä¸šå”¯ä¸€æŒä¹…çš„ç«žäº‰ä¼˜åŠ¿æºäºŽæ¯”ç«žäº‰å¯¹æ‰‹å­¦å¾—æ›´å¿«ã€æ›´å¥½çš„èƒ½åŠ› çœŸé¢˜ ç®€è¿°å¤å…¸ç®¡ç†ç†è®ºä¸‰ä½ä¸»è¦ä»£è¡¨ä»£äººç‰©åŠå…¶è´¡çŒ®aã€æ³°ç½—çš„ç§‘å­¦ç®¡ç†ç†è®ºï¼Œé‡ç‚¹ç ”ç©¶äº†åœ¨å·¥åŽ‚ç®¡ç†ä¸­å¦‚ä½•æé«˜æ•ˆçŽ‡ï¼Œå€¡å¯¼è¦ç”¨ç§‘å­¦æ€æƒ³ï¼Œç§‘å­¦æ–¹æ³•å¤„ç†å’Œè§£å†³ä¼ä¸šç®¡ç†é—®é¢˜ã€‚bã€æ³•çº¦å°”çš„ç®¡ç†è¿‡ç¨‹ç†è®ºï¼Œå¯¹ç»„ç»‡ç®¡ç†è¿›è¡Œäº†ç³»ç»Ÿçš„ã€ç‹¬åˆ›çš„ç ”ç©¶ï¼Œæå‡ºäº†ç®¡ç†å…·æœ‰è®¡åˆ’ã€ç»„ç»‡ã€æŒ‡æŒ¥ã€åè°ƒå’ŒæŽ§åˆ¶5å¤§èŒèƒ½å’Œ14æ¡ç®¡ç†åŽŸåˆ™ã€‚cã€é©¬å…‹æ–¯.éŸ¦ä¼¯çš„ç®¡ç†ç»„ç»‡ç†è®ºï¼Œæå‡ºäº†ç†æƒ³è¡Œæ”¿ç»„ç»‡ä½“ç³»ç†è®ºã€‚ è¢«ç§°ä¸ºâ€ç§‘å­¦ç®¡ç†ä¹‹çˆ¶â€çš„æ˜¯æ³°ç½— é©¬æ–¯æ´›çš„ä»£è¡¨æ€§ç†è®ºæˆæžœæ˜¯éœ€æ±‚å±‚æ¬¡ç†è®º ç»éªŒ(æ¡ˆä¾‹)å­¦æ´¾çš„äººç‰©æ˜¯å·´çº³å¾· 20ä¸–çºª60-70å¹´ä»£æ—¥æœ¬å¼•å…¥äº†ç¾Žå›½è´¨é‡ç®¡ç†ä¸“å®¶æˆ´æ˜Žå’Œæœ±å…°çš„å…¨é¢è´¨é‡ç®¡ç†æ€æƒ³ æ³•çº¦å°”è®¤ä¸ºï¼Œä¼ä¸šç®¡ç†ç†æ´»åŠ¨çš„èŒèƒ½åŒ…æ‹¬è®¡åˆ’ã€ç»„ç»‡å’Œ æŒ‡æŒ¥ã€åè°ƒå’ŒæŽ§åˆ¶ è¢«èª‰ä¸ºâ€ç»„ç»‡ç®¡ç†ä¹‹çˆ¶â€çš„æ˜¯ éŸ¦ä¼¯ è¢«èª‰ä¸ºâ€ç®¡ç†è¿‡ç¨‹ç†è®ºä¹‹çˆ¶â€æ˜¯ æ³•çº¦å°” èµ«èŒ¨ä¼¯æ ¼æå‡ºäº†è‘—åçš„åŒå› ç´ ç†è®º 9.éº¦æ ¼é›·æˆˆæå‡ºäº†è‘—åçš„ Xç†è®º-Yç†è®º ä¼ä¸šå”¯ä¸€æŒä¹…çš„ç«žäº‰ä¼˜åŠ¿æºäºŽæ¯”ç«žäº‰å¯¹æ‰‹å­¦å¾—æ›´å¿«ã€æ›´å¥½çš„èƒ½åŠ›ï¼Œæ˜¯å“ªä½ç®¡ç†å­¦è€…çš„è§‚ç‚¹ å½¼å¾·.åœ£å‰ ç½‘ç»œæ—¶ä»£çš„ä¼ä¸šçŽ¯å¢ƒç½‘ç»œæ—¶ä»£ä¼ä¸šé¢å¯¹çš„æœºé‡ ä¼ä¸šå¯ä»¥æ›´å¥½åœ°æ»¡è¶³é¡¾å®¢çš„ä¸ªæ€§åŒ–éœ€æ±‚ï¼› ä¼ä¸šå¯ä»¥é™ä½Žäº¤æ˜“æˆæœ¬; ä¼ä¸šå¯ä»¥å‡å°‘åº“å­˜; ä¼ä¸šå¯ä»¥ä½¿åˆä½œç«žäº‰æˆ˜ç•¥æ›´ä¾¿åˆ©åœ°å®žæ–½; æé«˜èŽ·å–çŸ¥è¯†ã€åº”ç”¨çŸ¥è¯†çš„èƒ½åŠ›ã€‚ ç½‘ç»œæ—¶ä»£ä¼ä¸šé¢å¯¹çš„æŒ‘æˆ˜ ä¼ä¸šé¢ä¸´æ—¥ç›Šæ¿€çƒˆçš„ç«žäº‰ï¼› é¡¾å®¢çš„æƒåŠ›å¤§å¢žåŠ ; ä¼ä¸šçš„æ•´ä½“ç›ˆåˆ©æ°´å¹³å°†ä¼šé™ä½Ž; ä¼ä¸šå…³é”®çš„æˆåŠŸå› ç´ å°†ä¼šæ”¹å˜; ä¼ä¸šèµ„æºé…ç½®çš„æ–¹å¼å’Œç•Œé™å°†ä¼šå‘ç”Ÿé‡å¤§å˜åŒ–ã€‚ ç½‘ç»œæ—¶ä»£ä¼ä¸šç®¡ç†çš„å˜é©ä¼ä¸šç®¡ç†æ‹“å±•çš„èŒƒå›´æœ‰å“ªäº›ç½‘ç»œä¼ä¸šä¸Žå®žä½“ä¼ä¸šç›¸æ¯”æœ‰å¦‚ä¸‹ç‰¹ç‚¹:aã€ç½‘ç»œä¼ä¸šæ‰€å çš„å®žçŽ°ç©ºé—´éžå¸¸æœ‰é™ï¼Œä¸åƒç”Ÿäº§ä¼ä¸šå’Œé”€å”®ä¼ä¸šé‚£æ ·å æœ‰å¤§é¢ç§¯çš„å®žçŽ°ç©ºé—´è¿›è¡Œäº§å“ç”Ÿäº§å’Œäº§å“å­˜å‚¨;bã€ç½‘ç»œä¼ä¸šæ˜¯è®¡ç®—æœºåŒ–å’Œç½‘ç»œåŒ–çš„ä¼ä¸š;cã€ç½‘ç»œä¼ä¸šæ˜¯å…¨å¤©å€™è¿è¥çš„ä¼ä¸š;dã€ç½‘ç»œä¼ä¸šæ˜¯ä¿¡æ¯æŠ€æœ¯å’Œä¿¡æ¯äº§å“åº”ç”¨åž‹çš„ä¼ä¸š;eã€ç½‘ç»œä¼ä¸šæ˜¯é«˜çŸ¥è¯†å¼€åž‹çš„æ¾æ•£ä¼ä¸šã€‚ ä¼ä¸šç®¡ç†æ‹“å±•çš„èŒƒå›´æœ‰å“ªäº›aã€ç½‘ç»œä¼ä¸šç®¡ç†;bã€ä¼ä¸šçš„ç½‘ç»œåŒ–ç®¡ç†;cã€æ›´åŠ é‡è§†ä»¥çŸ¥è¯†èµ„æœ¬ä¸ºæ ¸å¿ƒçš„æ— å½¢èµ„æœ¬çš„ç®¡ç†ï¼›dã€ä¼ä¸šç®¡ç†çš„èŒƒå›´æ‹“å±•åˆ°æ•´ä¸ªä¾›åº”é“¾ã€‚ ä¼ä¸šç®¡ç†åˆ›æ–°çš„å†…å®¹æœ‰å“ªäº› ä¼ä¸šæˆ˜ç•¥ç®¡ç†çš„åˆ›æ–°; ä¼ä¸šç»„ç»‡ç®¡ç†çš„åˆ›æ–°; ç½‘ç»œè¥é”€æˆä¸ºè¥é”€ç®¡ç†çš„é‡è¦å†…å®¹; æ•æ·åˆ¶é€ æˆä¸ºä¼ä¸šç”Ÿäº§è¿ä½œç®¡ç†æœ€é‡è¦çš„æ–¹å¼; ä¼ä¸šç®¡ç†å°†å‘æˆ˜ç•¥åž‹ï¼Œé›†æˆåŒ–æ–¹å‘å‘å±•; å›žå½’äººæœ¬ç®¡ç†ï¼Œé‡è§†äººåŠ›èµ„æºç®¡ç†; çŸ¥è¯†ç®¡ç†æˆä¸ºä¼ä¸šç®¡ç†çš„é‡è¦å†…å®¹; æ›´åŠ é‡è§†æ–‡åŒ–ç®¡ç†ã€‚ ä¼ä¸šæˆ˜ç•¥ç®¡ç†çš„å˜é©å¼€å‘å’ŒåŸ¹è‚²æ ¸å¿ƒèƒ½åŠ›æˆä¸ºä¼ä¸šæˆ˜ç•¥ç®¡ç†é‡ç‚¹ã€‚ ä¼ä¸šç»„ç»‡ç»“æž„å˜é©çš„æ–¹å‘å››ä¸ªçŽ°ä»£åŒ–(æ‰å¹³åŒ–â€“&gt; è™šæ‹ŸåŒ– â€“&gt; æŸ”æ€§åŒ– â€“&gt; ç½‘ç»œåŒ–) ä¼ä¸šç®¡ç†æ–¹æ³•å’Œæ‰‹æ®µçš„åˆ›æ–° å‡†æ—¶åˆ¶ JIT Just In Time åœ¨éœ€è¦çš„æ—¶å€™ï¼ŒæŒ‰éœ€è¦çš„é‡ï¼Œç”Ÿäº§æ‰€éœ€çš„äº§å“: é›¶åºŸå“ï¼Œé›¶åº“å­˜ï¼Œé›¶å‡†å¤‡æ—¶é—´ åˆ¶é€ èµ„æºè®¡åˆ’ MRP Manufacturing Resources Planning ç¡®ä¿ä¼ä¸šè¿žç»­ã€å‡è¡¡åœ°ç”Ÿäº§ï¼Œå®žçŽ°ä¿¡æ¯æµã€ç‰©æµä¸Žèµ„é‡‘æµçš„æœ‰æœºé›†æˆï¼Œä»¥è®¡åˆ’çš„ä¸ŽæŽ§åˆ¶ä¸ºä¸»çº¿ ä¼ä¸šèµ„æºè®¡åˆ’ ERP Enterprise Resources Planning ä»¥å®¢æˆ·éœ€æ±‚ä¸ºå¯¼å‘ï¼Œå®žè¡Œä¼ä¸šå†…å¤–èµ„æºä¼˜åŒ–é…ç½®ï¼Œæ¶ˆé™¤ç”Ÿäº§ç»è¥è¿‡ç¨‹ä¸­ä¸€åˆ‡æ— æ•ˆçš„åŠ³åŠ¨å’Œèµ„æº ç”µå­æ•°æ®äº¤æ¢ EDI Electronic Data Interchange å¹¶è¡Œå·¥ç¨‹ CE Concurrent Engineering éœ€è¦äº§å“å¼€å‘äººå‘˜ä»Žè®¾è®¡å¼€å§‹è®¾è®¡å°±è€ƒè™‘äº§å“æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„æ‰€æœ‰å› ç´  è®¡ç®—æœºé›†æˆåˆ¶é€ ç³»ç»Ÿ CIMS Computer Intergrated Manufacturing System åˆ†é”€èµ„æºè®¡åˆ’ DRP Distribution Resource Planning ä½¿ä¼ä¸šå…·æœ‰å¯¹å®šå•å’Œä¾›è´§å…·æœ‰å¿«é€Ÿååº”å’ŒæŒç»­è¡¥å……åº“å­˜çš„èƒ½åŠ› ä¼ä¸šå†…éƒ¨ç½‘å’Œäº’è”ç½‘ Intranetï¼Œ Internet çœŸé¢˜ è¯·é˜è¿°ä¼ä¸šåœ¨ç½‘ç»œæ—¶ä»£ä¼šé¢å¯¹å“ªäº›æœºé‡å’ŒæŒ‘æˆ˜ï¼Ÿ ç½‘ç»œæ—¶ä»£ä¼ä¸šé¢å¯¹çš„æœºé‡ ç½‘ç»œæ—¶ä»£ä¼ä¸šé¢å¯¹çš„æŒ‘æˆ˜ ä¼ä¸šå¯ä»¥æ›´å¥½åœ°æ»¡è¶³é¡¾å®¢çš„ä¸ªæ€§åŒ–éœ€æ±‚ é¡¾å®¢çš„æƒåŠ›å¤§å¤§å¢žåŠ  ä¼ä¸šå¯ä»¥é™åº•äº¤æ˜“æˆæœ¬ ä¼ä¸šçš„æ•´ä½“ç›ˆåŠ›æ°´å¹³å°†ä¼šä»¥é™ä½Ž ä¼ä¸šå¯ä»¥å‡å°‘åº“å­˜ ä¼ä¸šèµ„æºçš„é…ç½®æ–¹å¼å’Œç•Œé™å°†ä¼šå‘ç”Ÿé‡å¤§å˜åŒ– ä¼ä¸šå¯ä»¥ä½¿ç«žäº‰æˆ˜ç•¥æ›´åˆ©åœ°å®žæ–½ ä¼ä¸šé¢ä¸´æ—¥ç›Šæ¿€çƒˆçš„ç«žäº‰ æé«˜èŽ·å–çŸ¥è¯†ï¼Œåº”ç”¨çŸ¥è¯†çš„èƒ½åŠ› ä¼ä¸šå…³é”®çš„æˆåŠŸå› ç´ å°†ä¼šæ”¹å˜ ä¼ä¸šæˆ˜ç•¥ç®¡ç†çš„é‡ç‚¹æ˜¯å¼€å‘å’ŒåŸ¹è‚²æ ¸å¿ƒèƒ½åŠ› ä½œä¸ºåº”å¯¹ç½‘ç»œç»æµŽçš„æŒ‘æˆ˜ï¼Œä¼ä¸šç»„ç»‡ç»“æž„å˜é©çš„æ–¹å‘æœ‰æŸ”æ€§åŒ–ã€è™šæ‹ŸåŒ–ã€ç½‘ç»œåŒ–ã€æ‰å¹³åŒ– å“ªç§ç®¡ç†æ–¹æ³•çš„ç›®æ ‡æ˜¯é€šè¿‡ç®¡ç†ï¼Œå°½å¯èƒ½åšåˆ°â€é›¶åºŸå“â€ã€â€é›¶åº“å­˜â€å’Œâ€é›¶å‡†å¤‡æ—¶é—´â€ JIT ä½“çŽ°äº†ä»¥å®¢æˆ·éœ€æ±‚ä¸ºå¯¼å‘ï¼Œæ¶ˆé™¤ç”Ÿäº§ç»è¥è¿‡ç¨‹ä¸­ä¸€åˆ‡æ— æ•ˆçš„åŠ³åŠ¨å’Œèµ„æºçš„ç®¡ç†æ€æƒ³æ˜¯ERP ä¼ä¸šèµ„æºè®¡åˆ’ç®€ç§°ERP ä¼ä¸šåˆ¶é€ èµ„æºè®¡åˆ’æ˜¯æŒ‡ MRP å‡†æ—¶åˆ¶ç®€ç§° JIT ç½‘ç»œç»æµŽæ—¶ä»£ï¼Œä¼ä¸šç»è¥æˆ˜ç•¥å°†å›´ç»•ä¸‹åˆ—å“ªä¸€é¡¹æ¥åˆ¶è®¢ä¼ä¸šæ ¸å¿ƒä¸šåŠ¡å’Œæ ¸å¿ƒç«žäº‰åŠ›]]></content>
      <tags>
        <tag>zikao</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F02%2F14%2Fdocs%2F15816516152862%2F</url>
    <content type="text"><![CDATA[#]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F02%2F12%2F%E9%AB%98%E5%8F%AF%E7%94%A8gitlab%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[é«˜å¯ç”¨gitlabæœåŠ¡å™¨æ­å»ºçŽ¯å¢ƒå‡†å¤‡,å•èŠ‚ç‚¹éƒ¨ç½² CentOS7.4 64C 192G CentOS7.4 64C 192G æœåŠ¡å™¨æ—¶é—´åŒæ­¥1~]# ntpdate ntp.aliyun.com ç¡®ä¿SELinux æ˜¯å…³é—­çš„12~]# getenforce Disabled é…ç½®postfix1234~]# yum -y install postfix~]# sed -i &apos;s/inet_interfaces = localhost/inet_interfaces = all/g&apos; /etc/postfix/main.cf~]# systemctl start postfix~]# systemctl restart postfix é…ç½®gitlab-ce yumæºå¹¶å®‰è£…123456~]# vim /etc/yum.repos.d/gitlab-ce.repo[gitlab-ce]name=Gitlab CE Repositorybaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/gpgcheck=0enabled=1 123~]# yum clean all~]# yum makecache ~]# yum -y install gitlab-ce gitlab é…ç½®12~]# cd /etc/gitlab/~]# cp gitlab.rb&#123;,.bak&#125; gitlab é…ç½®æ–‡ä»¶12# åœ°å€é…ç½®external_url 'https://gitdb.novogene.com' 1234567891011121314151617# ldap ADåŸŸé…ç½®gitlab_rails['ldap_enabled'] = truegitlab_rails['ldap_servers'] = YAML.load &lt;&lt;-'EOS' main: label: 'è¯ºç¦¾AD' host: 'xx.xxx.xx.xxx' port: 3xx uid: 'sAMAccountName' method: 'plain' bind_dn: 'CN=xxx,OU=xxx,DC=xxx,DC=xxx' password: 'xxxxxxxx' active_directory: true allow_username_or_email_login: ture block_auto_created_users: false base: 'OU=xxx,DC=xxx,DC=xxx' user_filter: ''EOS 12345678910111213141516# gitlab é‚®ä»¶é…ç½®gitlab_rails['smtp_enable'] = true;gitlab_rails['smtp_address'] = 'smtp.exmail.qq.com';gitlab_rails['smtp_port'] = 465;gitlab_rails['smtp_user_name'] = "xx@xxxxx.com"gitlab_rails['smtp_password'] = "xxxxxxx"gitlab_rails['smtp_domain'] = 'smtp.exmail.qq.com';gitlab_rails['smtp_authentication'] = "login"gitlab_rails['smtp_enable_starttls_auto'] = truegitlab_rails['smtp_tls'] = truegitlab_rails['gitlab_email_from'] = 'xxx@xxxxxx.com'nginx['redirect_http_to_https'] = truenginx['ssl_certificate'] = "/etc/gitlab/ssl/gitdb.pem"nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/gitdb.key"nginx['redirect_http_to_https_port'] = 80nginx['listen_port'] = 443 gitlabæœåŠ¡å¯åŠ¨1~]# gitlab-ctl start lsyncd ä¸»ä»ŽåŒæ­¥é…ç½®1234567~]# /etc/lsyncd.conf settings &#123; logfile ="/var/log/lsyncd/lsyncd.log", statusFile ="/var/log/lsyncd/lsyncd.status", inotifyMode = "Modify", maxProcesses = 20, &#125; 12345678910111213141516sync &#123; default.rsync, source = "/var/opt/gitlab", target = "root@172.30.1.17:/var/opt/gitlab/", exclude = &#123; "backups", "gitlab-ci", "sockets","gitlab.yml","redis","postmaster.pid "&#125;, maxDelays = 5, delay = 30, -- init = true, rsync = &#123; binary = "/usr/bin/rsync", archive = true, compress = true, bwlimit = 2000 -- rsh = "/usr/bin/ssh -p 22 -o StrictHostKeyChecking=no" &#125; &#125; 123456789101112131415sync &#123; default.rsync, source = "/etc/gitlab/", target = "root@172.30.1.17:/etc/gitlab/", maxDelays = 5, delay = 30, -- init = true, rsync = &#123; binary = "/usr/bin/rsync", archive = true, compress = true, bwlimit = 2000 -- rsh = "/usr/bin/ssh -p 22 -o StrictHostKeyChecking=no" &#125; &#125; 123456789101112131415! Configuration File for keepalivedglobal_defs &#123; notification_email &#123; root@localhost &#125; notification_email_from Alexandre.Cassen@firewall.loc smtp_server 127.0.0.1 smtp_connect_timeout 30 router_id node1 &#125;vrrp_script chk_gitlab &#123; script "/bin/bash /usr/local/keepalived/etc/keepalived/check_gitlab.sh" interval 5 weight -20&#125; 12345678910111213141516171819202122232425vrrp_instance VI_1 &#123; state BACKUP interface em1 virtual_router_id 55 priority 100 nopreempt advert_int 1 notify_master "/usr/local/keepalived/etc/keepalived/message.sh master" notify_backup "/usr/local/keepalived/etc/keepalived/message.sh backup" notify_fault "/usr/local/keepalived/etc/keepalived/message.sh fault" unicast_src_ip 172.30.1.16 unicast_peer &#123; 172.30.1.17 &#125; track_script &#123; chk_gitlab &#125; authentication &#123; auth_type PASS auth_pass xxxxxxxx &#125; virtual_ipaddress &#123; 172.30.1.20 &#125;&#125; keepalived æ£€æµ‹è„šæœ¬123456789101112131415161718192021222324252627282930313233#!/bin/bashpackage() &#123; rpm -qf /usr/bin/curl &amp;&gt; /dev/null || yum -y install curl &amp;&gt; /dev/null&#125;packagegitlab_state () &#123; /usr/bin/curl -s https://gitdb.novogene.com/users/sign_in | grep "Username" &amp;&gt; /dev/null&#125;gitlab_state ; gitlab_state_num=$? ; echo $gitlab_state_numgitlab_state2 () &#123; /usr/bin/curl -s https://gitdb.novogene.com/users/sign_in | grep "Password" &amp;&gt; /dev/null&#125;kill_keepalived () &#123; kill -9 `cat /var/run/keepalived.pid`&#125;if [ $gitlab_state_num -ne 0 ] ; then echo "`date +"%Y-%m-%d-%H-%M-%S"` gitlab_status_one_check problem " &gt;&gt; /var/log/keepalived/check_gitlab.log gitlab_state2 ; gitlab_state2_num=$? ; echo $gitlab_state2_num if [ $gitlab_state2_num -ne 0 ] ; then echo "`date +"%Y-%m-%d-%H-%M-%S"` gitlab_status2_one_check problem" &gt;&gt; /var/log/keepalived/check_gitlab.log sleep 1 fifigitlab_state ; gitlab_state_num=$? ; echo $gitlab_state_numif [ $gitlab_state_num -ne 0 ] ; then echo "`date +"%Y-%m-%d-%H-%M-%S"` gitlab_status_two_check problem " &gt;&gt; /var/log/keepalived/check_gitlab.log gitlab_state2 ; gitlab_state2_num=$? ; echo $gitlab_state2_num if [ $gitlab_state2_num -ne 0 ] ; then echo "`date +"%Y-%m-%d-%H-%M-%S"` gitlab_status2_two_check problem " &gt;&gt; /var/log/keepalived/check_gitlab.log echo "gitdb jiqun change node1" | mutt -s "gitdb.novogene.com" renjin@novogene.com kill_keepalived fifi git å®¢æˆ·ç«¯å¸¸ç”¨å‘½ä»¤12345678910111213141516# git config --global user.name &quot;name&quot; #è®¾ç½®å…¨å±€ç”¨æˆ·å# git config --global user.email xxx@novogene.com # è®¾ç½®å…¨å±€é‚®ç®±# git config --global --list #åˆ—å‡ºç”¨æˆ·å…¨å±€è®¾ç½®# git add index.html / . #æ·»åŠ æŒ‡å®šæ–‡ä»¶ã€ç›®å½•æˆ–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ•°æ®åˆ°æš‚å­˜åŒº# git commit -m &quot;xx&quot; #æäº¤æ–‡ä»¶åˆ°å·¥ä½œåŒº# git status #æŸ¥çœ‹å·¥ä½œåŒºçš„çŠ¶æ€# git push #æäº¤ä»£ç åˆ°æœåŠ¡å™¨# git pull # èŽ·å–ä»£ç åˆ°æœ¬åœ°# git log # æŸ¥çœ‹æ“ä½œæ—¥å¿—# vim .gitignore # å®šä¹‰å¿½ç•¥æ–‡ä»¶# git rest --hard HEAD^^ # gitç‰ˆæœ¬å›žæ»šï¼ŒHEADä¸ºå½“å‰ç‰ˆæœ¬ï¼ŒåŠ ä¸€ä¸ª^ä¸ºä¸Šä¸€ä¸ªï¼Œ^^ä¸ºä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬# git reflog # èŽ·å–æ¯æ¬¡æäº¤çš„ID,å¯ä»¥ä½¿ç”¨--hardæ ¹æ®æäº¤çš„IDè¿›è¡Œç‰ˆæœ¬å›žé€€# git reset --hard 5ae4b06 #å›žé€€åˆ°æŒ‡å®šidçš„ç‰ˆæœ¬# git branch # æŸ¥çœ‹å½“å‰æ‰€å¤„çš„åˆ†æ”¯# git checkout -b develop # åˆ›å»ºå¹¶åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯# git checkout develop #åˆ‡æ¢åˆ†æ”¯ gitç¼“å­˜åŒºä¸Žå·¥ä½œåŒºç­‰æ¦‚å¿µ å·¥ä½œåŒº: clone çš„ä»£ç æˆ–è€…å¼€å‘è‡ªå·±ç¼–å†™çš„ä»£ç æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œé€šå¸¸æ˜¯ä»£ç æ‰€åœ¨çš„ä¸€ä¸ªæœåŠ¡çš„ç›®å½•åç§°; æš‚å­˜åŒº: ç”¨äºŽå­˜å‚¨åœ¨å·¥ä½œåŒºä¸­å¯¹ä»£ç è¿›è¡Œä¿®æ”¹åŽçš„æ–‡ä»¶æ‰€ä¿å­˜çš„åœ°æ–¹ï¼Œä½¿ç”¨git addæ·»åŠ ; æœ¬åœ°ä»“åº“: ç”¨äºŽæäº¤å­˜å‚¨åœ¨å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸­æ”¹è¿‡çš„æ–‡ä»¶åœ°æ–¹ï¼Œä½¿ç”¨git commitæäº¤; è¿œç¨‹ä»“åº“: å¤šä¸ªå¼€å‘å…±åŒåä½œæäº¤ä»£ç çš„ä»“åº“ï¼Œå³gitlabæˆ–githubæœåŠ¡å™¨ã€‚ macos å®‰è£… gitæœªå®‰è£… Homebrew çš„éœ€è¦å…ˆå®‰è£…Homebrew 12# /usr/bin/ruby -e \ "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)" å®‰è£…git 1# brew install git CentOS å®‰è£… git1# yum -y install git Ubuntu å®‰è£… git1# apt-get install git]]></content>
  </entry>
  <entry>
    <title><![CDATA[python ç®—æ³•]]></title>
    <url>%2F2019%2F12%2F15%2Fpython%20%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[python ç®—æ³• å‘½åå…ƒç»„namedtuple12345678910111213In [1]: from collections import namedtupleIn [2]: Point = namedtuple('P','x,y')In [3]: type(Point)Out[3]: typeIn [4]: p1 = Point(1,10)In [5]: p1Out[5]: P(x=1, y=10)In [6]: p1.xOut[6]: 1In [7]: p1.yOut[7]: 10In [8]: p1.x + p1.yOut[8]: 11 æŽ’åº 12345678(py3_env) [root@ssjinyao:~/mypython/python3]# cat sort.py#!/usr/bin/env python3nums = []out = Nonefor i in range(3): nums.append(int(input('&#123;&#125;: '.format(i))))nums.sort()print(nums) 12345678910111213#!/usr/bin/env python3nums = []out = Nonefor i in range(3): nums.append(int(input('&#123;&#125;: '.format(i))))while True: cur = min(nums) print(cur) nums.remove(cur) if len(nums) == 1: print(nums[0]) break 12345678#!/usr/bin/env pythonnums = []out = Nonefor i in range(3): nums.append(int(input(&apos;&#123;&#125;:&apos;.format(i))))nums.sort()print(nums) å†’æ³¡æ³•ä»£ç å®žçŽ°(ä¸€)1234567891011121314151617181920#!/usr/bin/env python# -*- coding: utf-8 -*-num_list = [ [1,9,8,5,6,7,4,3,2], [1,2,3,4,5,6,7,8,9],]nums = num_list[0]print(nums)length = len(nums)count_swap = 0count = 0for i in range(length): for j in range(length-i-1): count += 1 if nums[j] &gt; nums [j+1]: tmp = nums[j] nums[j] = nums [j+1] nums[j+1] = tmp count_swap +=1print(nums, count_swap, count) 12[1, 9, 8, 5, 6, 7, 4, 3, 2][1, 2, 3, 4, 5, 6, 7, 8, 9] 25 36 å†’æ³¡æ³•ä»£ç å®žçŽ°(äºŒ)12345678910111213141516171819202122232425262728293031323334#!/usr/bin/env python# -*- coding: utf-8 -*-num_list = [ [1,9,8,5,6,7,4,3,2], [1,2,3,4,5,5,7,8,9]]nums = num_list[0]print(nums)length = len(nums)flag = Falsecount_swap = 0count = 0for i in range(length): for j in range(length-i-1): count += 1 if nums[j] &gt; nums[j+1]: tmp = nums[j] nums[j] = nums[j+1] nums[j+1] = tmp flag = True count_swap += 1 if not flag: breakprint(nums,count_swap,count)``` ## å­—ç¬¦ä¸²ä¿®æ”¹```pythons = "I am very very very sorry "s.strip()Out[4]: 'I am very very very sorry' å­—ç¬¦ä¸²æŸ¥æ‰¾1find(sub,[,start[end]]) -&gt; int 123In [1]: s = &quot;I am very very very sorry &quot;In [2]: s.find(&quot;very&quot;)Out[2]: 5]]></content>
      <tags>
        <tag>linux</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sge linuxé«˜æ€§èƒ½é›†ç¾¤çš„æ­å»ºä¸Žä½¿ç”¨]]></title>
    <url>%2F2019%2F11%2F12%2Fsge%E9%9B%86%E7%BE%A4%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[sgeé«˜æ€§èƒ½é›†ç¾¤çš„æ­å»ºä¸Žä½¿ç”¨ é›†ç¾¤çŽ¯å¢ƒçš„å‡†å¤‡ Node1(master) CentOS7.4 iptables/selinux(off) IP:10.180.66.11 hostname:node1 ali yumæº Node2(slave) CentOS7.4 iptables/selinux(off) IP:10.180.66.12 hostname:node2 ali yumæº Node3(slave) CentOS7.4 iptables/selinux(off) IP:10.180.66.13 hostname:node3 ali yumæº Node4(slave) CentOS7.4 iptables/selinux(off) IP:10.180.66.14 hostname:node4 ali yumæº Node5(slave) CentOS7.4 iptables/selinux(off) IP:10.180.66.15 hostname:node5 ali yumæº master èŠ‚ç‚¹å®‰è£…å®‰è£…ç›¸å…³ä¾èµ–åŒ…1# yum -y install jemalloc-devel openssl-devel ncurses-devel pam-devel libXmu-devel hwloc-devel hwloc hwloc-libs java-devel javacc ant-junit libdb-devel motif-devel csh ksh xterm db4-utils perl-XML-Simple perl-Env xorg-x11-fonts-ISO8859-1-100dpi xorg-x11-fonts-ISO8859-1-75dpi æ–°å»ºsgeç®¡ç†å‘˜ç”¨æˆ·123# groupadd -g 490 sgeadmin# useradd -u 495 -g 490 -r -m -d /home/sgeadmin -s /bin/bash -c &quot;SGE Admin&quot; sgeadmin# sed -i &apos;/^%wheel/a\%sgeadmin ALL=(ALL) NOPASSWD: ALL&apos; /etc/sudoers å®‰è£…sgesge é“¾æŽ¥ å¯†ç :c7hy 12345# cd /usr/local/src/# tar -xvf ge2011.11.tar.gz# mkdir -pv /data# cp -a ge2011.11 /data/sge# chown sgeadmin.sgeadmin /data/sge qmaster å®‰è£…è‡ªåŠ¨å›žç­”è„šæœ¬ï¼Œä¾èµ–è½¯ä»¶åŒ…expect, æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦å®‰è£… 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160# cd /data/sge/# vim master.sh#!/bin/bashuser="sgeadmin"/usr/bin/expect &lt;&lt;-EOFspawn ./install_qmasterexpect "*&gt;&gt;"send ""expect "*&gt;&gt;"send "y"expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send "n"expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect eofEOF# sh master.sh ä¿®æ”¹ä¸»èŠ‚ç‚¹çŽ¯å¢ƒå˜é‡ 123456# export SGE_ROOT=/data/sge# echo 'export SGE_ROOT=/data/sge' &gt;&gt; ~/.bashrc# echo 'PATH=$PATH:/data/sge/bin/linux-x64/:/data/sge/bin/' &gt;&gt; ~/.bashrc# cp /data/sge/default/common/settings.sh /etc/profile.d/# sh /etc/profile.d/settings.sh# source /etc/profile æ·»åŠ èŠ‚ç‚¹ 12345# qconf -ah node1# qconf -ah node2# qconf -ah node3# qconf -ah node4# qconf -ah node5 master æœåŠ¡å™¨æ­å»º nfs æœåŠ¡æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…1# yum -y install nfs-utils masterèŠ‚ç‚¹æ“ä½œ 123# vim /etc/exports/data/sge 10.180.66.0/24(rw,sync)# systemctl restart nfs slave èŠ‚ç‚¹æŒ‚è½½(node2,node3,node4,node5)æ‰§è¡Œ 123# mkdir /data/sge -pv# mount -t nfs 10.180.66.11:/data/sge /data/sge/# chown sgeadmin.sgeadmin /data/ slave æœåŠ¡å™¨å®‰è£…sgeexecd(node2,node3,node4,node5) æ‰§è¡Œ 123# yum -y install hwloc-devel# useradd -u 495 -g 490 -r -m -d /home/sgeadmin -s /bin/bash -c "SGE Admin" sgeadmin# sed -i '/^%wheel/a\%sgeadmin ALL=(ALL) NOPASSWD: ALL' /etc/sudoers ç”Ÿæ•ˆçŽ¯å¢ƒå˜é‡ 123456# echo 'export SGE_ROOT=/data/sge' &gt;&gt; ~/.bashrc# echo 'PATH=$PATH:/data/sge/bin/linux-x64/:/data/sge/bin/' &gt;&gt; ~/.bashrc# echo 'export SGE_CELL=default' &gt;&gt; ~/.bashrc# cp /data/sge/default/common/settings.sh /etc/profile.d/ -a# source ~/.bashrc# source /etc/profile è¿›è¡Œå®‰è£…ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œæ­¤è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061# vim slave.sh# cat slave.sh#!/bin/bashuser="sgeadmin"/usr/bin/expect &lt;&lt;-EOFspawn ./install_execdexpect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect "*&gt;&gt;"send ""expect eofEOF# sh slave.sh å®Œæˆé›†ç¾¤æ­å»º123456789# qhostHOSTNAME ARCH NCPU LOAD MEMTOT MEMUSE SWAPTO SWAPUS-------------------------------------------------------------------------------global - - - - - - -node1 linux-x64 1 0.01 968.3M 193.0M 2.0G 64.0Knode2 linux-x64 1 0.01 976.3M 151.0M 2.0G 0.0node3 linux-x64 1 0.02 978.3M 152.2M 2.0G 84.0Knode4 linux-x64 1 0.02 976.3M 155.4M 2.0G 0.0node5 linux-x64 1 0.01 978.3M 148.5M 2.0G 84.0K sgeé›†ç¾¤çš„ä½¿ç”¨]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kvmå­¦ä¹ ç¬”è®°]]></title>
    <url>%2F2019%2F08%2F28%2Fkvm%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[kvm å­¦ä¹ ç¬”è®° kvmç›¸å…³çŸ¥è¯†æ¢³ç†123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051KVM: kernel-based Virtual Machine, Qumranet å…¬å¸ï¼Œä¾èµ–äºŽHVM: Intel VT-x, ADM ADM-V:KVMæ¨¡å—è½½å…¥åŽçš„ç³»ç»Ÿçš„è¿è¡Œæ¨¡å¼: å†…æ ¸æ¨¡å¼: GuestOSæ‰§è¡ŒI/Oç±»æ“ä½œï¼Œæˆ–å…¶å®ƒçš„ç‰¹æ®ŠæŒ‡ä»¤çš„æ“ä½œï¼šç§°ä½œâ€œæ¥å®¾-å†…æ ¸â€æ¨¡å¼; ç”¨æˆ·æ¨¡å¼: ä»£è¡¨GuestOSè¯·æ±‚I/Oç±»æ“ä½œï¼Œå®¿ä¸»æœºç”¨æˆ·æ¨¡å¼; æ¥å®¾æ¨¡å¼: GuestOSçš„éžI/Oç±»æ“ä½œï¼›äº‹å®žä¸Šï¼Œå®ƒè¢«ç§°ä¸ºâ€œæ¥å®¾-ç”¨æˆ·â€æ¨¡å¼ã€‚ kvm hypervisor:KVMçš„ç»„ä»¶: /dev/kvm: å·¥ä½œäºŽhypervisor,åœ¨ç”¨æˆ·ç©ºé—´ï¼Œå¯é€šè¿‡ioctl()ç³»ç»Ÿè°ƒç”¨æ¥å®ŒæˆVMåˆ›å»ºã€å¯åŠ¨ç®¡ç†åŠŸèƒ½ï¼›å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ï¼ŒåŠŸèƒ½: åˆ›å»ºVMã€ä¸ºVMåˆ†é…å†…å­˜ã€è¯»å†™VCPUçš„å¯„å­˜å™¨ã€å‘VCPUæ³¨å…¥ä¸­æ–­ã€è¿è¡ŒVCPUç­‰ç­‰; qemuè¿›ç¨‹: å·¥ä½œäºŽç”¨æˆ·ç©ºé—´ï¼Œä¸»è¦ç”¨äºŽå®žçŽ°æ¨¡æ‹ŸPCæœºçš„IOè®¾å¤‡;KVMç‰¹æ€§: å†…å­˜ç®¡ç†: å°†åˆ†é…ç»™VMçš„å†…å­˜äº¤æ¢è‡³SWAP; æ”¯æŒä½¿ç”¨Huge Page; æ”¯æŒä½¿ç”¨Intel EPTæˆ–AMD RVIæŠ€æœ¯å®Œæˆå†…å­˜åœ°å€æ˜ å°„; GVA--&gt; GPA --&gt;HPA æ”¯æŒKSM(Kernel Same-page Merging)ç¡¬ä»¶æ”¯æŒ: å–å†³äºŽLinuxå†…æ ¸å­˜å‚¨: æœ¬åœ°å­˜å‚¨: ç½‘ç»œé™„åŠ å­˜å‚¨: å­˜å‚¨åŒºåŸŸåç½‘ç»œ åˆ†å¸ƒå¼å­˜å‚¨: ä¾‹å¦‚GlustFSå®žæ—¶è¿ç§»: å®žæ—¶è¿ç§»: æ”¯æŒçš„GuestOS: Linux, Windows, OpenBSD, FreeBSD, OpenSolaris; è®¾å¤‡é©±åŠ¨ï¼š IOè®¾å¤‡çš„å®Œå…¨è™šæ‹ŸåŒ–: æ¨¡æ‹Ÿç¡¬ä»¶ IOè®¾å¤‡çš„åŠè™šæ‹ŸåŒ–: åœ¨GuestOSä¸­å®‰è£…é©±åŠ¨: virtio virtio-blk, virtio-net, virtio-pci,virtio-console, virtio-ballonKVMå±€é™æ€§: ä¸€èˆ¬å±€é™æ€§: CPU overcommit æ—¶é—´è®°å½•éš¾ä»¥ç²¾ç¡®ï¼Œä¾èµ–äºŽæ—¶é—´åŒæ­¥æœºåˆ¶ MACåœ°å€: VMé‡ç‰¹åˆ«å¤§æ—¶ï¼Œå­˜åœ¨å†²çªçš„å¯èƒ½æ€§; å®žæ—¶è¿ç§»: æ€§èƒ½å±€é™æ€§:KVMçš„å·¥å…·æ ˆ qemu: qemu-kvm qemu-img libvirt GUI: virt-manager, virt-viewer CLI: virt-install, virsh QEMUä¸»è¦ç”¨åˆ°ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†: å¤„ç†å™¨æ¨¡æ‹Ÿå™¨ ä»¿çœŸIOè®¾å¤‡ å…³è”æ¨¡æ‹Ÿçš„è®¾å¤‡è‡³çœŸå®žè®¾å¤‡; è°ƒè¯•å™¨ ä¸Žæ¨¡æ‹Ÿå™¨äº¤äº’çš„ç”¨æˆ·æŽ¥å£ å®‰è£…1ã€ç¡®ä¿CPUæ”¯æŒHVM # grep -E --color=auto &quot;(vmx|svm)&quot; /proc/cpuinfo2ã€è£…è½½æ¨¡å— # modeprobe kvm # modeprobe kvm-intel3ã€éªŒè¯ /dev/kvm ç®¡ç†å·¥å…·æ ˆqemu-kvmlibvirtç®¡ç†kvmè™šæ‹Ÿçš„æ–¹æ¡ˆ: qemu: /usr/libexec/ å®‰è£…å·¥å…·: libvirt: virt-install virt-manager ç®¡ç†å·¥å…·: virsh virt-manager virt-viewer VM Platform1234567891011# yum install qemu-kvm# ln -sv /usr/libexec/qemu-kvm /usr/bin/å‘½ä»¤é€‰é¡¹ æ ‡å‡†é€‰é¡¹: æ˜¾ç¤ºé€‰é¡¹: å—è®¾å¤‡é€‰é¡¹: i386å¹³å°ä¸“ç”¨é€‰é¡¹: å­—ç¬¦è®¾å¤‡é€‰é¡¹: è“ç‰™è®¾å¤‡é€‰é¡¹: Linux å¯åŠ¨ä¸“ç”¨é€‰é¡¹: è°ƒè¯•/ä¸“å®¶æ¨¡å¼é€‰é¡¹: è¡¥å……èµ„æ–™: KVMå†…å­˜ç®¡ç†KVMç»§æ‰¿äº†Linuxç³»ç»Ÿç®¡ç†å†…å­˜çš„è¯¸å¤šç‰¹æ€§ï¼Œæ¯”å¦‚ï¼Œåˆ†é…ç»™è™šæ‹Ÿä½¿ç”¨çš„å†…å­˜å¯ä»¥è¢«äº¤æ¢è‡³äº¤æ¢ç©ºé—´ã€èƒ½å¤Ÿä½¿ç”¨å¤§å†…å­˜é¡µä»¥å®žçŽ°æ›´çš„å¥½çš„æ€§èƒ½ï¼Œä»¥åŠå¯¹NUMAçš„æ”¯æŒèƒ½å¤Ÿè®©è™šæ‹Ÿæœºé«˜æ•ˆè®¿é—®æ›´å¤§çš„å†…å­˜ç©ºé—´ç­‰ã€‚ KVMåŸºäºŽIntelçš„EPT(Extended Page Table) æˆ–AMDçš„ RVI(Rapid Virtualization Indexing) æŠ€æœ¯å¯ä»¥æ”¯æŒæ›´æ–°çš„å†…å­˜è™šæ‹ŸåŠŸèƒ½ï¼Œè¿™å¯ä»¥é™ä½ŽCPUçš„å ç”¨çŽ‡ï¼Œå¹¶æä¾›è¾ƒå¥½çš„åžåé‡ã€‚ æ­¤å¤–ï¼ŒKVMè¿˜å€ŸåŠ©äºŽKSM(kernel Same-page Merging) è¿™ä¸ªå†…æ ¸ç‰¹æ€§å®žçŽ°äº†å†…å­˜é¡µé¢å…±äº«ï¼ŒKSMé€šè¿‡æ‰«ææ¯ä¸ªè™šæ‹Ÿæœºçš„å†…å­˜æŸ¥æ‰¾å„è™šæ‹Ÿæœºé—´ç›¸åŒçš„é¡µé¢ï¼Œå¹¶å°†è¿™äº›å†…å­˜é¡µåˆå¹¶ä¸ºä¸€ä¸ªè¢«å„ç›¸å…³è™šæ‹Ÿæœºå…±äº«çš„å•ç‹¬é¡µé¢ã€‚åœ¨æŸè™šæ‹Ÿæœºè¯•å›¾ä¿®æ”¹æ­¤é¡µé¢ä¸­çš„æ•°æ®æ—¶ï¼ŒKSMä¼šé‡æ–°ä¸ºå…¶æä¾› ä¸€ä¸ªæ–°çš„é¡µé¢å‰¯æœ¬ã€‚å®žè·µä¸­ï¼Œè¿è¡ŒäºŽåŒä¸€ä¸ªç‰©ç†ä¸»æœºçš„å…·æœ‰ç›¸åŒGuestOSçš„è™šæ‹Ÿæœºä¹‹é—´å‡ºçŽ°ç›¸åŒå†…å­˜é¡µé¢çš„æ¦‚çŽ‡æ˜¯å¾ˆé«˜çš„ï¼Œæ¯”å¦‚å…±äº«åº“ï¼Œå†…æ ¸æˆ–å…¶å®ƒå†…å­˜å¯¹è±¡ç­‰éƒ½æœ‰å¯èƒ½è¡¨çŽ°ä¸ºæœºåŒçš„é¡µé¢ï¼Œå› æ­¤ï¼ŒKSMæŠ€æœ¯å¯ä»¥é™ä½Žå†…å­˜å ç”¨è¿›è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ è¡¥å……èµ„æ–™: VMM: å¯¹IOçš„é©±åŠ¨æœ‰ä¸‰ç§æ¨¡å¼: è‡ªä¸»VMM: VMM è‡ªè¡Œæä¾›é©±åŠ¨å’ŒæŽ§åˆ¶å°; æ··åˆVMM: å€ŸåŠ©äºŽOSæä¾›é©±åŠ¨; ä¾èµ–äºŽå¤–éƒ¨OSå®žçŽ°ç‰¹æƒåŸŸ è‡ªæˆ‘æä¾›ç‰¹æƒåŸŸ å¯„å®¿å¼VMM: IOè™šæ‹ŸåŒ–æ¨¡åž‹: æ¨¡æ‹Ÿ åŠè™šæ‹ŸåŒ– é€ä¼  KVMï¼šhvm kvm, 12345 # modinfo kvm # lsmod | grep kvmkvm_intel 170086 0kvm 566340 1 kvm_intelirqbypass 13503 1 kvm å¯åŠ¨ä½¿ç”¨å¾®ç¼©ç‰ˆLinuxcirros project : ä¸ºcloud çŽ¯å¢ƒæµ‹è¯•vmæä¾›çš„å¾®ç¼©ç‰ˆLinux:å¯åŠ¨ç¬¬ä¸€ä¸ªè™šæ‹Ÿæœº: cirros12# qemu-kvm -m 128 -smp 2 -name &quot;test&quot; -hda /images/kvm/cirros-0.3.4-x86_64-disk.imgVNC server running on `::1:5900&apos; å®‰è£…tigervnc 1# yum -y install tigervnc ç”¨-driveæŒ‡å®šç£ç›˜æ˜ åƒæ–‡ä»¶ 1# qemu-kvm -m 128 -name test -smp 2 -drive file=/images/kvm/cirros-0.3.4-x86_64-disk.img,if=virtio,media=disk,cache=writeback,fromat=qcow2 é€šè¿‡cdromå¯åŠ¨winxpçš„å®‰è£…: 1# qemu-kvm -name winxp -smp 4, sockets=1,cores=2,threads=2 -m 512 -drive file=/images/kvm/winxp.img,if=ide,media=disk,cache=writeback,format=qcow2 -drive file=/root/winxp_ghost.iso,media=cdrom æŒ‡å®šä½¿ç”¨æ ¼æ‹‰ç½‘ç»œæŽ¥å£: 12# qemu-kvm -m 128 -name test -smp 2 -drive file= /images/kvm/cirros-0.3.4-x86_64-disk.img,if=virtio,media=disk,cache=writeback,format=qcow2 -net nic -net tap,script=/etc/if-up,downscript=no -nographic qemu-kvmç®¡ç†KVMè™šæ‹ŸæœºQemuæ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„å¼€æºè®¡ç®—æœºä»¿çœŸå™¨å’Œè™šæ‹Ÿæœºã€‚å½“ä½œä¸ºä»¿çœŸå™¨æ—¶ï¼Œå¯ä»¥åœ¨ä¸€ç§æž¶æž„(å¦‚PCæœº)ä¸‹è¿è¡Œå¦ä¸€ä¸ªæž¶æž„(å¦‚ARM)ä¸‹çš„æ“ä½œç³»ç»Ÿå’Œç¨‹åºï¼Œè€Œé€šè¿‡åŠ¨æ€è½¬åŒ–ï¼Œå…¶å¯ä»¥èŽ·å–å¾ˆé«˜çš„è¿è¡Œæ•ˆçŽ‡ã€‚å½“ä½œä¸ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶ï¼Œqemuå¯ä»¥é€šè¿‡ç›´æŽ¥ä½¿ç”¨çœŸæœºçš„ç³»ç»Ÿèµ„æºï¼Œè®©è™šæ‹Ÿç³»ç»Ÿèƒ½å¤ŸèŽ·å¾—æŽ¥è¿‘äºŽç‰©ç†æœºçš„æ€§èƒ½è¡¨çŽ°ã€‚qemuæ”¯æŒxenæˆ–è€…kvmæ¨¡å¼ä¸‹çš„è™šæ‹ŸåŒ–ã€‚å½“ç”¨kvmæ—¶ï¼Œqemuå¯ä»¥è™šæ‹Ÿx86ã€æœåŠ¡å™¨å’ŒåµŒå…¥å¼powerpcï¼Œä»¥åŠs390ç³»ç»Ÿã€‚ QEMU å½“è¿è¡Œä¸Žä¸»æœºæž¶æž„ç›¸åŒçš„ç›®æ ‡æž¶æž„æ—¶å¯ä»¥ä½¿ç”¨KVMä¾‹å¦‚ï¼Œå½“åœ¨ä¸€ä¸ªx86å…¼å®¹å¤„ç†å™¨ä¸Šè¿è¡Œ qemu-system-x86æ—¶ï¼Œå¯ä»¥åˆ©KVMåŠ é€Ÿä¸€ä¸ºå®¿ä¸»æœºå’Œå®¢æˆ·æœºæä¾›æ›´å¥½çš„æ€§èƒ½ã€‚ Qemu æœ‰å¦‚ä¸‹å‡ ä¸ªéƒ¨ç»„æˆ: å¤„ç†å™¨æ¨¡æ‹Ÿå™¨(x86ã€PowerPCå’ŒSparc) ä»¿çœŸè®¾å¤‡(æ˜¾å¡ã€ç½‘å¡ã€ç¡¬ç›˜ã€é¼ æ ‡ç­‰) ç”¨äºŽå°†ä»¿çœŸè®¾å¤‡è¿žæŽ¥è‡³ä¸»æœºè®¾å¤‡(çœŸå®žè®¾å¤‡)çš„é€šç”¨è®¾å¤‡; è™šæ‹Ÿæœºçš„æè¿°ä¿¡æ¯; è°ƒè¯•å™¨ï¼› ä¸Žæ¨¡æ‹Ÿå™¨äº¤äº’çš„ç”¨æˆ·æŽ¥å£ã€‚ ä½¿ç”¨qemu-kvmå®‰è£…GueståŸºäºŽlibvirt çš„å·¥å…·å¦‚virt-managerå’Œvirt-installæä¾›äº†éžå¸¸ä¾¿æ·çš„è™šæ‹Ÿæœºç®¡ç†æŽ¥å£ï¼Œä½†å®ƒä»¬äº‹å®žä¸Šå·²ç»ç¬¬äºŒæ¬¡å¼€å‘åŽåˆå°è£…äº†qemu-kvmçš„å·¥å…·ã€‚å› æ­¤ï¼Œç›´æŽ¥ä½¿ç”¨qemu-vkmå‘½ä»¤ä¹Ÿèƒ½å¤Ÿå®Œæˆæ­¤å‰çš„ä»»åŠ¡ã€‚ 123# qemu-kvm -m 128 -cpu host -smp 2 -name &quot;test&quot; -drive file=/images/kvm/cirros-0.3.4-x86_64-disk.img,if=virtio,media=disk,format=qcow2,cache=writeback# qemu-img create -o size=20G,preallocation=metadata -f qcow2 /images/winxp.qcow2# qemu-kvm -m 512 -smp 2 -cpu host -drive file=/images/windows/winxp.qcow2,media=disk -drive file=/root/winxp_ghost.iso,media=cdrom --boot order=dc, once=d æŒ‡å®švnc æ¡Œé¢ï¼Œå¦‚æŒ‡å®šæ¡Œé¢å·ä¸º1 åˆ™å¯ç”¨ç«¯å£ä¸º5901, è‹¥æŒ‡å®šæ¡Œé¢å·ä¸º0ï¼Œåˆ™å¯ç”¨ç«¯å£ä¸º5900 1# qemu-kvm -m 128 -cpu host -smp 2 -name &quot;test&quot; -drive file=/images/kvm/cirros-0.3.4-x86_64-disk.img,if=virtio,media=disk,format=qcow2,cache=writeback -vnc 0.0.0.0:1 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081qemu-kvmå‘½ä»¤åœ¨RHEL6ä¸Šï¼Œqemu-kvmä½äºŽ/usr/libexecç›®å½•ä¸­ã€‚ç”±äºŽæ­¤ç›®å½•ä¸å±žäºŽPATHçŽ¯å¢ƒå˜é‡ï¼Œæ•…æ— æ³•ç›´æŽ¥ä½¿ç”¨ï¼Œè¿™æ ·ä¹Ÿé˜»æ­¢äº†å¯ä»¥ç›´æŽ¥ä½¿ç”¨qemuä½œä¸ºåˆ›å»ºå¹¶ç®¡ç†è™šæ‹Ÿæœºã€‚å¦‚è‹¥æƒ³ä½¿ç”¨qemuè™šæ‹Ÿæœºï¼Œå¯ä»¥é€šè¿‡å°†/usr/libexec/qemu-kvmé“¾æŽ¥ä¸º/usr/bin/qemuå®žçŽ°ã€‚# ln -sv /usr/lib/exec/qemu-kvm /usr/bin/qemu-kvmqemu-kvmå‘½ä»¤ä½¿ç”¨æ ¼å¼ä¸ºâ€œqemu-kvm [options] [disk_image]â€ï¼Œå…¶é€‰é¡¹éžå¸¸å¤šï¼Œä¸è¿‡ï¼Œå¤§è‡´å¯åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ã€‚ðŸ‘‰ðŸ¾ æ ‡å‡†é€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ USBé€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ æ˜¾ç¤ºé€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ i386å¹³å°ä¸“ç”¨é€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ ç½‘ç»œé€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ å­—ç¬¦è®¾å¤‡é€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ è“ç‰™ç›¸å…³é€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ Linuxç³»ç»Ÿå¼•å¯¼ä¸“ç”¨é€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ è°ƒè¯•/ä¸“å®¶æ¨¡å¼é€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ PowerPCä¸“ç”¨é€‰é¡¹ï¼›ðŸ‘‰ðŸ¾ Sparc32ä¸“ç”¨é€‰é¡¹ï¼›è€ƒè™‘åˆ°ç¯‡å¹…åŠä½¿ç”¨éœ€è¦ï¼Œè¿™é‡Œä»‹ç»çš„é€‰é¡¹ä¸»è¦æ¶‰åŠåˆ°æ ‡å‡†é€‰é¡¹ã€æ˜¾ç¤ºé€‰é¡¹ã€i386å¹³å°ä¸“ç”¨é€‰é¡¹åŠLinuxç³»ç»Ÿå¼•å¯¼ä¸“ç”¨é€‰é¡¹ç­‰ç›¸å…³çš„é€‰é¡¹ã€‚qemu-kvmçš„æ ‡å‡†é€‰é¡¹qemu-kvmçš„æ ‡å‡†é€‰é¡¹ä¸»è¦æ¶‰åŠæŒ‡å®šä¸»æœºç±»åž‹ã€CPUæ¨¡å¼ã€NUMAã€è½¯é©±è®¾å¤‡ã€å…‰é©±è®¾å¤‡åŠç¡¬ä»¶è®¾å¤‡ç­‰ã€‚ðŸ‘‰ðŸ¾ -name nameï¼šè®¾å®šè™šæ‹Ÿæœºåç§°ï¼›ðŸ‘‰ðŸ¾ -M machineï¼šæŒ‡å®šè¦æ¨¡æ‹Ÿçš„ä¸»æœºç±»åž‹ï¼Œå¦‚Standard PCã€ISA-only PCæˆ–Intel-Macç­‰ï¼Œå¯ä»¥ä½¿ç”¨â€œqemu-kvm -M ?â€èŽ·å–æ‰€æ”¯æŒçš„æ‰€æœ‰ç±»åž‹ï¼›ðŸ‘‰ðŸ¾ -m megsï¼šè®¾å®šè™šæ‹Ÿæœºçš„RAMå¤§å°ï¼›ðŸ‘‰ðŸ¾ -cpu modelï¼šè®¾å®šCPUæ¨¡åž‹ï¼Œå¦‚coreduoã€qemu64ç­‰ï¼Œå¯ä»¥ä½¿ç”¨â€œqemu-kvm -cpu ?â€èŽ·å–æ‰€æ”¯æŒçš„æ‰€æœ‰æ¨¡åž‹ï¼›ðŸ‘‰ðŸ¾ -smp n[,cores=cores][,threads=threads][,sockets=sockets][,maxcpus=maxcpus]ï¼šè®¾å®šæ¨¡æ‹Ÿçš„SMPæž¶æž„ä¸­CPUçš„ä¸ªæ•°ç­‰ã€æ¯ä¸ªCPUçš„æ ¸å¿ƒæ•°åŠCPUçš„socketæ•°ç›®ç­‰ï¼›PCæœºä¸Šæœ€å¤šå¯ä»¥æ¨¡æ‹Ÿ255é¢—CPUï¼›maxcpusç”¨äºŽæŒ‡å®šçƒ­æ’å…¥çš„CPUä¸ªæ•°ä¸Šé™ï¼›ðŸ‘‰ðŸ¾ -numa optsï¼šæŒ‡å®šæ¨¡æ‹Ÿå¤šèŠ‚ç‚¹çš„numaè®¾å¤‡ï¼›ðŸ‘‰ðŸ¾ -fda fileðŸ‘‰ðŸ¾ -fdb fileï¼šä½¿ç”¨æŒ‡å®šæ–‡ä»¶(file)ä½œä¸ºè½¯ç›˜é•œåƒï¼Œfileä¸º/dev/fd0è¡¨ç¤ºä½¿ç”¨ç‰©ç†è½¯é©±ï¼›ðŸ‘‰ðŸ¾ -hda fileðŸ‘‰ðŸ¾ -hdb fileðŸ‘‰ðŸ¾ -hdc fileðŸ‘‰ðŸ¾ -hdd fileï¼šä½¿ç”¨æŒ‡å®šfileä½œä¸ºç¡¬ç›˜é•œåƒï¼›ðŸ‘‰ðŸ¾ -cdrom fileï¼šä½¿ç”¨æŒ‡å®šfileä½œä¸ºCD-ROMé•œåƒï¼Œéœ€è¦æ³¨æ„çš„æ˜¯-cdromå’Œ-hdcä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼›å°†fileæŒ‡å®šä¸º/dev/cdromå¯ä»¥ç›´æŽ¥ä½¿ç”¨ç‰©ç†å…‰é©±ï¼›ðŸ‘‰ðŸ¾ -drive option[,option[,option[,...]]]ï¼šå®šä¹‰ä¸€ä¸ªç¡¬ç›˜è®¾å¤‡ï¼›å¯ç”¨å­é€‰é¡¹æœ‰å¾ˆå¤šã€‚ðŸ‘‰ðŸ¾ file=/path/to/somefileï¼šç¡¬ä»¶æ˜ åƒæ–‡ä»¶è·¯å¾„ï¼›ðŸ‘‰ðŸ¾ if=interfaceï¼šæŒ‡å®šç¡¬ç›˜è®¾å¤‡æ‰€è¿žæŽ¥çš„æŽ¥å£ç±»åž‹ï¼Œå³æŽ§åˆ¶å™¨ç±»åž‹ï¼Œå¦‚ideã€scsiã€sdã€mtdã€floppyã€pflashåŠvirtioç­‰ï¼›ðŸ‘‰ðŸ¾ index=indexï¼šè®¾å®šåŒä¸€ç§æŽ§åˆ¶å™¨ç±»åž‹ä¸­ä¸åŒè®¾å¤‡çš„ç´¢å¼•å·ï¼Œå³æ ‡è¯†å·ï¼›ðŸ‘‰ðŸ¾ media=mediaï¼šå®šä¹‰ä»‹è´¨ç±»åž‹ä¸ºç¡¬ç›˜(disk)è¿˜æ˜¯å…‰ç›˜(cdrom)ï¼›ðŸ‘‰ðŸ¾ snapshot=snapshotï¼šæŒ‡å®šå½“å‰ç¡¬ç›˜è®¾å¤‡æ˜¯å¦æ”¯æŒå¿«ç…§åŠŸèƒ½ï¼šonæˆ–offï¼›ðŸ‘‰ðŸ¾ cache=cacheï¼šå®šä¹‰å¦‚ä½•ä½¿ç”¨ç‰©ç†æœºç¼“å­˜æ¥è®¿é—®å—æ•°æ®ï¼Œå…¶å¯ç”¨å€¼æœ‰noneã€writebackã€unsafeå’Œwritethroughå››ä¸ªï¼›ðŸ‘‰ðŸ¾ format=formatï¼šæŒ‡å®šæ˜ åƒæ–‡ä»¶çš„æ ¼å¼ï¼Œå…·ä½“æ ¼å¼å¯å‚è§qemu-imgå‘½ä»¤ï¼›ðŸ‘‰ðŸ¾ -boot [order=drives][,once=drives][,menu=on|off]ï¼šå®šä¹‰å¯åŠ¨è®¾å¤‡çš„å¼•å¯¼æ¬¡åºï¼Œæ¯ç§è®¾å¤‡ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºï¼›ä¸åŒçš„æž¶æž„æ‰€æ”¯æŒçš„è®¾å¤‡åŠå…¶è¡¨ç¤ºå­—ç¬¦ä¸å°½ç›¸åŒï¼Œåœ¨x86 PCæž¶æž„ä¸Šï¼Œaã€bè¡¨ç¤ºè½¯é©±ã€cè¡¨ç¤ºç¬¬ä¸€å—ç¡¬ç›˜ï¼Œdè¡¨ç¤ºç¬¬ä¸€ä¸ªå…‰é©±è®¾å¤‡ï¼Œn-pè¡¨ç¤ºç½‘ç»œé€‚é…å™¨ï¼›é»˜è®¤ä¸ºç¡¬ç›˜è®¾å¤‡ï¼› -boot order=dc,once=dqemu-kvmçš„æ˜¾ç¤ºé€‰é¡¹æ˜¾ç¤ºé€‰é¡¹ç”¨äºŽå®šä¹‰è™šæ‹Ÿæœºå¯åŠ¨åŽçš„æ˜¾ç¤ºæŽ¥å£ç›¸å…³ç±»åž‹åŠå±žæ€§ç­‰ã€‚ðŸ‘‰ðŸ¾ -nographicï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œqemuä½¿ç”¨SDLæ¥æ˜¾ç¤ºVGAè¾“å‡ºï¼›è€Œæ­¤é€‰é¡¹ç”¨äºŽç¦æ­¢å›¾å½¢æŽ¥å£ï¼Œæ­¤æ—¶,qemuç±»ä¼¼ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œç¨‹åºï¼Œå…¶ä»¿çœŸä¸²å£è®¾å¤‡å°†è¢«é‡å®šå‘åˆ°æŽ§åˆ¶å°ï¼›ðŸ‘‰ðŸ¾ -cursesï¼šç¦æ­¢å›¾å½¢æŽ¥å£ï¼Œå¹¶ä½¿ç”¨curses/ncursesä½œä¸ºäº¤äº’æŽ¥å£ï¼›ðŸ‘‰ðŸ¾ -alt-grabï¼šä½¿ç”¨Ctrl+Alt+Shiftç»„åˆé”®é‡Šæ”¾é¼ æ ‡ï¼›ðŸ‘‰ðŸ¾ -ctrl-grabï¼šä½¿ç”¨å³Ctrlé”®é‡Šæ”¾é¼ æ ‡ï¼›ðŸ‘‰ðŸ¾ -sdlï¼šå¯ç”¨SDLï¼›ðŸ‘‰ðŸ¾ -spice option[,option[,...]]ï¼šå¯ç”¨spiceè¿œç¨‹æ¡Œé¢åè®®ï¼›å…¶æœ‰è®¸å¤šå­é€‰é¡¹ï¼Œå…·ä½“è¯·å‚ç…§qemu-kvmçš„æ‰‹å†Œï¼›ðŸ‘‰ðŸ¾ -vga typeï¼šæŒ‡å®šè¦ä»¿çœŸçš„VGAæŽ¥å£ç±»åž‹ï¼Œå¸¸è§ç±»åž‹æœ‰ï¼šðŸ‘‰ðŸ¾ cirrusï¼šCirrus Logic GD5446æ˜¾ç¤ºå¡ï¼›ðŸ‘‰ðŸ¾ stdï¼šå¸¦æœ‰Bochs VBIæ‰©å±•çš„æ ‡å‡†VGAæ˜¾ç¤ºå¡ï¼›ðŸ‘‰ðŸ¾ vmwareï¼šVMWare SVGA-IIå…¼å®¹çš„æ˜¾ç¤ºé€‚é…å™¨ï¼›ðŸ‘‰ðŸ¾ qxlï¼šQXLåŠè™šæ‹ŸåŒ–æ˜¾ç¤ºå¡ï¼›ä¸ŽVGAå…¼å®¹ï¼›åœ¨Guestä¸­å®‰è£…qxlé©±åŠ¨åŽèƒ½ä»¥å¾ˆå¥½çš„æ–¹å¼å·¥ä½œï¼Œåœ¨ä½¿ç”¨spiceåè®®æ—¶æŽ¨èä½¿ç”¨æ­¤ç±»åž‹ï¼›ðŸ‘‰ðŸ¾ noneï¼šç¦ç”¨VGAå¡ï¼›ðŸ‘‰ðŸ¾ -vnc display[,option[,option[,...]]]ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œqemuä½¿ç”¨SDLæ˜¾ç¤ºVGAè¾“å‡ºï¼›ä½¿ç”¨-vncé€‰é¡¹ï¼Œå¯ä»¥è®©qemuç›‘å¬åœ¨VNCä¸Šï¼Œå¹¶å°†VGAè¾“å‡ºé‡å®šå‘è‡³VNCä¼šè¯ï¼›ä½¿ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œå¿…é¡»ä½¿ç”¨-ké€‰é¡¹æŒ‡å®šé”®ç›˜å¸ƒå±€ç±»åž‹ï¼›å…¶æœ‰è®¸å¤šå­é€‰é¡¹ï¼Œå…·ä½“è¯·å‚ç…§qemu-kvmçš„æ‰‹å†Œï¼› display: ï¼ˆ1ï¼‰host:N 172.16.100.7:1, ç›‘å¬äºŽ172.16.100.7ä¸»çš„5900+Nçš„ç«¯å£ä¸Š (2) unix:/path/to/socket_file (3) none options: password: è¿žæŽ¥æ—¶éœ€è¦éªŒæ­£å¯†ç ï¼›è®¾å®šå¯†ç é€šè¿‡monitoræŽ¥å£ä½¿ç”¨change reverse: â€œåå‘â€è¿žæŽ¥è‡³æŸå¤„äºŽç›‘å¬çŠ¶æ€çš„vncviewä¸Šï¼› -monitor stdioï¼šè¡¨ç¤ºåœ¨æ ‡å‡†è¾“å…¥è¾“å‡ºä¸Šæ˜¾ç¤ºmonitorç•Œé¢ -nographic Ctrl-a, c: åœ¨consoleå’Œmonitorä¹‹é—´åˆ‡æ¢ Ctrl-a, h: æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯SDL: Simple Directmedia LayerVNC: Virtual Network Computingï¼ŒåŸºäºŽRFB # rpm -ql bridge-utils 12345678# brctl addbr br0# brctl stp br0 off# brctl delbr br0# brctl show# ip link set dev br0 down# ip link set dev br0 up# ip link show# ä¸´æ—¶ç”Ÿæ•ˆ 12# nmtui# nmcli 12# qemu-kvm -net nic,model=?qemu: Supported NIC models: ne2k_pci,i82551,i82557b,i82559er,rtl8139,e1000,pcnet,virtio 123456789101112131415161718192021ç½‘ç»œå±žæ€§ç›¸å…³é€‰é¡¹ç½‘ç»œå±žæ€§ç›¸å…³é€‰é¡¹ç”¨äºŽå®šä¹‰ç½‘ç»œè®¾å¤‡æŽ¥å£ç±»åž‹åŠå…¶ç›¸å…³çš„å„å±žæ€§ç­‰ä¿¡æ¯ã€‚è¿™é‡Œåªä»‹ç»nicã€tapå’Œuserä¸‰ç§ç±»åž‹ç½‘ç»œæŽ¥å£çš„å±žæ€§ï¼Œå…¶å®ƒç±»åž‹è¯·å‚ç…§qemu-kvmæ‰‹å†Œã€‚ðŸ‘‰ðŸ¾ -net nic[,vlan=n][,macaddr=mac][,model=type][,name=name][,addr=addr][,vectors=v]ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘å¡è®¾å¤‡å¹¶è¿žæŽ¥è‡³vlan nä¸­ï¼›PCæž¶æž„ä¸Šé»˜è®¤çš„NICä¸ºe1000ï¼Œmacaddrç”¨äºŽä¸ºå…¶æŒ‡å®šMACåœ°å€ï¼Œnameç”¨äºŽæŒ‡å®šä¸€ä¸ªåœ¨ç›‘æŽ§æ—¶æ˜¾ç¤ºçš„ç½‘ä¸Šè®¾å¤‡åç§°ï¼›emuå¯ä»¥æ¨¡æ‹Ÿå¤šä¸ªç±»åž‹çš„ç½‘å¡è®¾å¤‡ï¼Œå¦‚virtioã€i82551ã€i82557bã€i82559erã€ne2k_isaã€pcnetã€rtl8139ã€e1000ã€smc91c111ã€lanceåŠmcf_fecç­‰ï¼›ä¸è¿‡ï¼Œä¸åŒå¹³å°æž¶æž„ä¸Šï¼Œå…¶æ”¯æŒçš„ç±»åž‹å¯èƒ½åªåŒ…å«å‰è¿°åˆ—è¡¨çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨â€œqemu-kvm -net nic,model=?â€æ¥èŽ·å–å½“å‰å¹³å°æ”¯æŒçš„ç±»åž‹ï¼›ðŸ‘‰ðŸ¾ -net tap[,vlan=n][,name=name][,fd=h][,ifname=name][,script=file][,downscript=dfile]ï¼šé€šè¿‡ç‰©ç†æœºçš„TAPç½‘ç»œæŽ¥å£è¿žæŽ¥è‡³vlan nä¸­ï¼Œä½¿ç”¨script=fileæŒ‡å®šçš„è„šæœ¬(é»˜è®¤ä¸º/etc/qemu-ifup)æ¥é…ç½®å½“å‰ç½‘ç»œæŽ¥å£ï¼Œå¹¶ä½¿ç”¨downscript=fileæŒ‡å®šçš„è„šæœ¬(é»˜è®¤ä¸º/etc/qemu-ifdown)æ¥æ’¤æ¶ˆæŽ¥å£é…ç½®ï¼›ä½¿ç”¨script=noå’Œdownscript=noå¯åˆ†åˆ«ç”¨æ¥ç¦æ­¢æ‰§è¡Œè„šæœ¬ï¼›æ³¨æ„: é»˜è®¤mac åœ°å€å‡ä¸º: 52:54:00:12:34:56ï¼Œä½¿ç”¨ä¸­éœ€è¦æ‰‹åŠ¨æŒ‡å®šã€‚ðŸ‘‰ðŸ¾ -net user[,option][,option][,...]ï¼šåœ¨ç”¨æˆ·æ¨¡å¼é…ç½®ç½‘ç»œæ ˆï¼Œå…¶ä¸ä¾èµ–äºŽç®¡ç†æƒé™ï¼›æœ‰æ•ˆé€‰é¡¹æœ‰ï¼šðŸ‘‰ðŸ¾ vlan=nï¼šè¿žæŽ¥è‡³vlan nï¼Œé»˜è®¤n=0ï¼›ðŸ‘‰ðŸ¾ name=nameï¼šæŒ‡å®šæŽ¥å£çš„æ˜¾ç¤ºåç§°ï¼Œå¸¸ç”¨äºŽç›‘æŽ§æ¨¡å¼ä¸­ï¼›ðŸ‘‰ðŸ¾ net=addr[/mask]ï¼šè®¾å®šGuestOSå¯è§çš„IPç½‘ç»œï¼ŒæŽ©ç å¯é€‰ï¼Œé»˜è®¤ä¸º10.0.2.0/8ï¼›ðŸ‘‰ðŸ¾ host=addrï¼šæŒ‡å®šGuestOSä¸­çœ‹åˆ°çš„ç‰©ç†æœºçš„IPåœ°å€ï¼Œé»˜è®¤ä¸ºæŒ‡å®šç½‘ç»œä¸­çš„ç¬¬äºŒä¸ªï¼Œå³x.x.x.2ï¼›ðŸ‘‰ðŸ¾ dhcpstart=addrï¼šæŒ‡å®šDHCPæœåŠ¡åœ°å€æ± ä¸­16ä¸ªåœ°å€çš„èµ·å§‹IPï¼Œé»˜è®¤ä¸ºç¬¬16ä¸ªè‡³ç¬¬31ä¸ªï¼Œå³x.x.x.16-x.x.x.31ï¼›ðŸ‘‰ðŸ¾ dns=addrï¼šæŒ‡å®šGuestOSå¯è§çš„dnsæœåŠ¡å™¨åœ°å€ï¼›é»˜è®¤ä¸ºGuestOSç½‘ç»œä¸­çš„ç¬¬ä¸‰ä¸ªåœ°å€ï¼Œå³x.x.x.3ï¼›ðŸ‘‰ðŸ¾ tftp=dirï¼šæ¿€æ´»å†…ç½®çš„tftpæœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„dirä½œä¸ºtftpæœåŠ¡å™¨çš„é»˜è®¤æ ¹ç›®å½•ï¼›ðŸ‘‰ðŸ¾ bootfile=fileï¼šBOOTPæ–‡ä»¶åç§°ï¼Œç”¨äºŽå®žçŽ°ç½‘ç»œå¼•å¯¼GuestOSï¼›å¦‚ï¼šqemu -hda linux.img -boot n -net user,tftp=/tftpserver/pub,bootfile=/pxelinux.0brctl addbr br0brctl addif br0 eth0brctl addbr br1 kvmçš„ç½‘ç»œæ¨¡åž‹: 1ã€éš”ç¦»æ¨¡åž‹: åœ¨host åˆ›å»ºä¸€ä¸ªvswitch (bridge device): æ¯ä¸ªè™šæ‹Ÿæœºçš„tapè®¾å¤‡ç›´æŽ¥æ·»åŠ è‡³vswitchä¸Š;2ã€è·¯ç”±æ¨¡åž‹:æ¿€æ´»tap,å¹¶å°†å…¶åŠ å…¥åˆ°æŒ‡å®šçš„bridge,ç»™è™šæ‹Ÿçš„brigeæ·»åŠ åœ°å€ï¼Œæ‰“å¼€æ ¸å¿ƒè½¬å‘;3ã€NATæ¨¡åž‹:æ¿€æ´»tap,å¹¶å°†å…¶åŠ å…¥åˆ°æŒ‡å®šçš„bridge; é¢å¤–: æ‰“å¼€æ ¸å¿ƒè½¬å‘ï¼Œå¹¶æ·»åŠ åˆ°natè§„åˆ™;4ã€æ¡¥æŽ¥æ¨¡åž‹:æ¿€æ´»tap,å¹¶å°†å…¶åŠ å…¥åˆ°æŒ‡å®šçš„bridge; å®‰è£…ç¤ºä¾‹ 123456# qemu-kvm -name &quot;rhel5.8&quot; -m 512 \-smp 2 -boot d \-drive file=/VM/images/rhel5.8/hda,if=virtio,index=0,media=disk,format=qcow2 \-drive file=/isos/rhel-5.8.iso,index=1,media=cdrom \-net nic,model=virtio,macaddr=52:54:00:A5:41:1E \-vga cirrus -balloon virtio 12# qemu-img create /images/centos/centos6.img -o size=120G, preallocation=metadata -f qcow2# qemu-kvm -m 512 -smp 2 -name centos -drive file=/images/centos/centos6.img,media=disk,if=virtio -net nic,model=virtio,macaddr=52:54:00:55:31:18 -net tap,ifname=centos6.0,script=/etc/qemu-ifup -boot order=nc, once=n libvirt å·¥å…·æ ˆæ”¯æŒçš„è™šæ‹ŸåŒ–æŠ€æœ¯: KVM, XEN, VMAWARE, Qemu, LXC, OpenVZ; å®‰è£…:CentOS6yum install libvirt libvirt-client python-virtinst virt-managerCentOS7yum install libvirt libvirt-client virt-install virt-manager 12libvirt: å·¥å…·å®žçŽ°è™šæ‹Ÿæœºç®¡ç†ï¼š è£…ç³»ç»Ÿï¼švirt-manager, virt-install, virsh 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162ä½¿ç”¨virt-installåˆ›å»ºè™šæ‹Ÿæœºå¹¶å®‰è£…GuestOSvirt-installæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒèƒ½å¤Ÿä¸ºKVMã€Xenæˆ–å…¶å®ƒæ”¯æŒlibvrit APIçš„hypervisoråˆ›å»ºè™šæ‹Ÿæœºå¹¶å®ŒæˆGuestOSå®‰è£…ï¼›æ­¤å¤–ï¼Œå®ƒèƒ½å¤ŸåŸºäºŽä¸²è¡ŒæŽ§åˆ¶å°ã€VNCæˆ–SDLæ”¯æŒæ–‡æœ¬æˆ–å›¾å½¢å®‰è£…ç•Œé¢ã€‚å®‰è£…è¿‡ç¨‹å¯ä»¥ä½¿ç”¨æœ¬åœ°çš„å®‰è£…ä»‹è´¨å¦‚CDROMï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œæ–¹å¼å¦‚NFSã€HTTPæˆ–FTPæœåŠ¡å®žçŽ°ã€‚å¯¹äºŽé€šè¿‡ç½‘ç»œå®‰è£…çš„æ–¹å¼ï¼Œvirt-installå¯ä»¥è‡ªåŠ¨åŠ è½½å¿…è¦çš„æ–‡ä»¶ä»¥å¯åŠ¨å®‰è£…è¿‡ç¨‹è€Œæ— é¡»é¢å¤–æä¾›å¼•å¯¼å·¥å…·ã€‚å½“ç„¶ï¼Œvirt-installä¹Ÿæ”¯æŒPXEæ–¹å¼çš„å®‰è£…è¿‡ç¨‹ï¼Œä¹Ÿèƒ½å¤Ÿç›´æŽ¥ä½¿ç”¨çŽ°æœ‰çš„ç£ç›˜æ˜ åƒç›´æŽ¥å¯åŠ¨å®‰è£…è¿‡ç¨‹ã€‚virt-installå‘½ä»¤æœ‰è®¸å¤šé€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹å¤§ä½“å¯åˆ†ä¸ºä¸‹é¢å‡ å¤§ç±»ï¼ŒåŒæ—¶å¯¹æ¯ç±»ä¸­çš„å¸¸ç”¨é€‰é¡¹ä¹Ÿåšå‡ºç®€å•è¯´æ˜Žã€‚ðŸ‘‰ðŸ¾ ä¸€èˆ¬é€‰é¡¹ï¼šæŒ‡å®šè™šæ‹Ÿæœºçš„åç§°ã€å†…å­˜å¤§å°ã€VCPUä¸ªæ•°åŠç‰¹æ€§ç­‰ï¼›ðŸ‘‰ðŸ¾ -n NAME, --name=NAMEï¼šè™šæ‹Ÿæœºåç§°ï¼Œéœ€å…¨å±€æƒŸä¸€ï¼›ðŸ‘‰ðŸ¾ -r MEMORY, --ram=MEMORYï¼šè™šæ‹Ÿæœºå†…åœ¨å¤§å°ï¼Œå•ä½ä¸ºMBï¼›ðŸ‘‰ðŸ¾ --vcpus=VCPUS[,maxvcpus=MAX][,sockets=#][,cores=#][,threads=#]ï¼šVCPUä¸ªæ•°åŠç›¸å…³é…ç½®ï¼›ðŸ‘‰ðŸ¾ --cpu=CPUï¼šCPUæ¨¡å¼åŠç‰¹æ€§ï¼Œå¦‚coreduoç­‰ï¼›å¯ä»¥ä½¿ç”¨qemu-kvm -cpu ?æ¥èŽ·å–æ”¯æŒçš„CPUæ¨¡å¼ï¼›ðŸ‘‰ðŸ¾å®‰è£…æ–¹æ³•ï¼šæŒ‡å®šå®‰è£…æ–¹æ³•ã€GuestOSç±»åž‹ç­‰ï¼›ðŸ‘‰ðŸ¾ -c CDROM, --cdrom=CDROMï¼šå…‰ç›˜å®‰è£…ä»‹è´¨ï¼›ðŸ‘‰ðŸ¾ -l LOCATION, --location=LOCATIONï¼šå®‰è£…æºURLï¼Œæ”¯æŒFTPã€HTTPåŠNFSç­‰ï¼Œå¦‚ftp://172.16.0.1/pubï¼›ðŸ‘‰ðŸ¾ --pxeï¼šåŸºäºŽPXEå®Œæˆå®‰è£…ï¼›ðŸ‘‰ðŸ¾ --livecd: æŠŠå…‰ç›˜å½“ä½œLiveCDï¼›ðŸ‘‰ðŸ¾ --os-type=DISTRO_TYPEï¼šæ“ä½œç³»ç»Ÿç±»åž‹ï¼Œå¦‚linuxã€unixæˆ–windowsç­‰ï¼›ðŸ‘‰ðŸ¾ --os-variant=DISTRO_VARIANTï¼šæŸç±»åž‹æ“ä½œç³»ç»Ÿçš„å˜ä½“ï¼Œå¦‚rhel5ã€fedora8ç­‰ï¼›ðŸ‘‰ðŸ¾ -x EXTRA, --extra-args=EXTRAï¼šæ ¹æ®--locationæŒ‡å®šçš„æ–¹å¼å®‰è£…GuestOSæ—¶ï¼Œç”¨äºŽä¼ é€’ç»™å†…æ ¸çš„é¢å¤–é€‰é¡¹ï¼Œä¾‹å¦‚æŒ‡å®škickstartæ–‡ä»¶çš„ä½ç½®ï¼Œ--extra-args &quot;ks=http://172.16.0.1/class.cfg&quot;ðŸ‘‰ðŸ¾ --boot=BOOTOPTSï¼šæŒ‡å®šå®‰è£…è¿‡ç¨‹å®ŒæˆåŽçš„é…ç½®é€‰é¡¹ï¼Œå¦‚æŒ‡å®šå¼•å¯¼è®¾å¤‡æ¬¡åºã€ä½¿ç”¨æŒ‡å®šçš„è€Œéžå®‰è£…çš„kernel/initrdæ¥å¼•å¯¼ç³»ç»Ÿå¯åŠ¨ç­‰ ï¼›ä¾‹å¦‚ï¼šðŸ‘‰ðŸ¾ --boot cdrom,hd,networkï¼šæŒ‡å®šå¼•å¯¼æ¬¡åºï¼›ðŸ‘‰ðŸ¾ --boot kernel=KERNEL,initrd=INITRD,kernel_args=â€console=/dev/ttyS0â€ï¼šæŒ‡å®šå¯åŠ¨ç³»ç»Ÿçš„å†…æ ¸åŠinitrdæ–‡ä»¶ï¼›ðŸ‘‰ðŸ¾ å­˜å‚¨é…ç½®ï¼šæŒ‡å®šå­˜å‚¨ç±»åž‹ã€ä½ç½®åŠå±žæ€§ç­‰ï¼›ðŸ‘‰ðŸ¾ --disk=DISKOPTSï¼šæŒ‡å®šå­˜å‚¨è®¾å¤‡åŠå…¶å±žæ€§ï¼›æ ¼å¼ä¸º--disk /some/storage/path,opt1=val1ï¼Œopt2=val2ç­‰ï¼›å¸¸ç”¨çš„é€‰é¡¹æœ‰ï¼šðŸ‘‰ðŸ¾ deviceï¼šè®¾å¤‡ç±»åž‹ï¼Œå¦‚cdromã€diskæˆ–floppyç­‰ï¼Œé»˜è®¤ä¸ºdiskï¼›ðŸ‘‰ðŸ¾ busï¼šç£ç›˜æ€»ç»“ç±»åž‹ï¼Œå…¶å€¼å¯ä»¥ä¸ºideã€scsiã€usbã€virtioæˆ–xenï¼›ðŸ‘‰ðŸ¾ permsï¼šè®¿é—®æƒé™ï¼Œå¦‚rwã€roæˆ–shï¼ˆå…±äº«çš„å¯è¯»å†™ï¼‰ï¼Œé»˜è®¤ä¸ºrwï¼›ðŸ‘‰ðŸ¾ sizeï¼šæ–°å»ºç£ç›˜æ˜ åƒçš„å¤§å°ï¼Œå•ä½ä¸ºGBï¼›ðŸ‘‰ðŸ¾ cacheï¼šç¼“å­˜æ¨¡åž‹ï¼Œå…¶å€¼æœ‰noneã€writethrouthï¼ˆç¼“å­˜è¯»ï¼‰åŠwritebackï¼ˆç¼“å­˜è¯»å†™ï¼‰ï¼›ðŸ‘‰ðŸ¾ formatï¼šç£ç›˜æ˜ åƒæ ¼å¼ï¼Œå¦‚rawã€qcow2ã€vmdkç­‰ï¼›ðŸ‘‰ðŸ¾ sparseï¼šç£ç›˜æ˜ åƒä½¿ç”¨ç¨€ç–æ ¼å¼ï¼Œå³ä¸ç«‹å³åˆ†é…æŒ‡å®šå¤§å°çš„ç©ºé—´ï¼›ðŸ‘‰ðŸ¾ --nodisksï¼šä¸ä½¿ç”¨æœ¬åœ°ç£ç›˜ï¼Œåœ¨LiveCDæ¨¡å¼ä¸­å¸¸ç”¨ï¼›ðŸ‘‰ðŸ¾ç½‘ç»œé…ç½®ï¼šæŒ‡å®šç½‘ç»œæŽ¥å£çš„ç½‘ç»œç±»åž‹åŠæŽ¥å£å±žæ€§å¦‚MACåœ°å€ã€é©±åŠ¨æ¨¡å¼ç­‰ï¼›ðŸ‘‰ðŸ¾ -w NETWORK, --network=NETWORK,opt1=val1,opt2=val2ï¼šå°†è™šæ‹Ÿæœºè¿žå…¥å®¿ä¸»æœºçš„ç½‘ç»œä¸­ï¼Œå…¶ä¸­NETWORKå¯ä»¥ä¸ºï¼šðŸ‘‰ðŸ¾ bridge=BRIDGEï¼šè¿žæŽ¥è‡³åä¸ºâ€œBRIDEGâ€çš„æ¡¥è®¾å¤‡ï¼›ðŸ‘‰ðŸ¾ network=NAMEï¼šè¿žæŽ¥è‡³åä¸ºâ€œNAMEâ€çš„ç½‘ç»œï¼›å…¶å®ƒå¸¸ç”¨çš„é€‰é¡¹è¿˜æœ‰ï¼šðŸ‘‰ðŸ¾ modelï¼šGuestOSä¸­çœ‹åˆ°çš„ç½‘ç»œè®¾å¤‡åž‹å·ï¼Œå¦‚e1000ã€rtl8139æˆ–virtioç­‰ï¼›ðŸ‘‰ðŸ¾ macï¼šå›ºå®šçš„MACåœ°å€ï¼›çœç•¥æ­¤é€‰é¡¹æ—¶å°†ä½¿ç”¨éšæœºåœ°å€ï¼Œä½†æ— è®ºä½•ç§æ–¹å¼ï¼Œå¯¹äºŽKVMæ¥è¯´ï¼Œå…¶å‰ä¸‰æ®µå¿…é¡»ä¸º52:54:00ï¼›ðŸ‘‰ðŸ¾ --nonetworksï¼šè™šæ‹Ÿæœºä¸ä½¿ç”¨ç½‘ç»œåŠŸèƒ½ï¼›ðŸ‘‰ðŸ¾ å›¾å½¢é…ç½®ï¼šå®šä¹‰è™šæ‹Ÿæœºæ˜¾ç¤ºåŠŸèƒ½ç›¸å…³çš„é…ç½®ï¼Œå¦‚VNCç›¸å…³é…ç½®ï¼›ðŸ‘‰ðŸ¾ --graphics TYPE,opt1=val1,opt2=val2ï¼šæŒ‡å®šå›¾å½¢æ˜¾ç¤ºç›¸å…³çš„é…ç½®ï¼Œæ­¤é€‰é¡¹ä¸ä¼šé…ç½®ä»»ä½•æ˜¾ç¤ºç¡¬ä»¶ï¼ˆå¦‚æ˜¾å¡ï¼‰ï¼Œè€Œæ˜¯ä»…æŒ‡å®šè™šæ‹Ÿæœºå¯åŠ¨åŽå¯¹å…¶è¿›è¡Œè®¿é—®çš„æŽ¥å£ï¼›ðŸ‘‰ðŸ¾ TYPEï¼šæŒ‡å®šæ˜¾ç¤ºç±»åž‹ï¼Œå¯ä»¥ä¸ºvncã€sdlã€spiceæˆ–noneç­‰ï¼Œé»˜è®¤ä¸ºvncï¼›ðŸ‘‰ðŸ¾ portï¼šTYPEä¸ºvncæˆ–spiceæ—¶å…¶ç›‘å¬çš„ç«¯å£ï¼›ðŸ‘‰ðŸ¾ listenï¼šTYPEä¸ºvncæˆ–spiceæ—¶æ‰€ç›‘å¬çš„IPåœ°å€ï¼Œé»˜è®¤ä¸º127.0.0.1ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹/etc/libvirt/qemu.confå®šä¹‰æ–°çš„é»˜è®¤å€¼ï¼›ðŸ‘‰ðŸ¾ passwordï¼šTYPEä¸ºvncæˆ–spiceæ—¶ï¼Œä¸ºè¿œç¨‹è®¿é—®ç›‘å¬çš„æœåŠ¡è¿›æŒ‡å®šè®¤è¯å¯†ç ï¼›ðŸ‘‰ðŸ¾ --noautoconsoleï¼šç¦æ­¢è‡ªåŠ¨è¿žæŽ¥è‡³è™šæ‹Ÿæœºçš„æŽ§åˆ¶å°ï¼›ðŸ‘‰ðŸ¾ è®¾å¤‡é€‰é¡¹ï¼šæŒ‡å®šæ–‡æœ¬æŽ§åˆ¶å°ã€å£°éŸ³è®¾å¤‡ã€ä¸²è¡ŒæŽ¥å£ã€å¹¶è¡ŒæŽ¥å£ã€æ˜¾ç¤ºæŽ¥å£ç­‰ï¼›ðŸ‘‰ðŸ¾ --serial=CHAROPTSï¼šé™„åŠ ä¸€ä¸ªä¸²è¡Œè®¾å¤‡è‡³å½“å‰è™šæ‹Ÿæœºï¼Œæ ¹æ®è®¾å¤‡ç±»åž‹çš„ä¸åŒï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„é€‰é¡¹ï¼Œæ ¼å¼ä¸ºâ€œ--serial type,opt1=val1,opt2=val2,...â€ï¼Œä¾‹å¦‚ï¼šðŸ‘‰ðŸ¾ --serial ptyï¼šåˆ›å»ºä¼ªç»ˆç«¯ï¼›ðŸ‘‰ðŸ¾ --serial dev,path=HOSTPATHï¼šé™„åŠ ä¸»æœºè®¾å¤‡è‡³æ­¤è™šæ‹Ÿæœºï¼›ðŸ‘‰ðŸ¾ --video=VIDEOï¼šæŒ‡å®šæ˜¾å¡è®¾å¤‡æ¨¡åž‹ï¼Œå¯ç”¨å–å€¼ä¸ºcirrusã€vgaã€qxlæˆ–vmvgaï¼›ðŸ‘‰ðŸ¾ è™šæ‹ŸåŒ–å¹³å°ï¼šè™šæ‹ŸåŒ–æ¨¡åž‹ï¼ˆhvmæˆ–paravirtï¼‰ã€æ¨¡æ‹Ÿçš„CPUå¹³å°ç±»åž‹ã€æ¨¡æ‹Ÿçš„ä¸»æœºç±»åž‹ã€hypervisorç±»åž‹ï¼ˆå¦‚kvmã€xenæˆ–qemuç­‰ï¼‰ä»¥åŠå½“å‰è™šæ‹Ÿæœºçš„UUIDç­‰ï¼›ðŸ‘‰ðŸ¾ -v, --hvmï¼šå½“ç‰©ç†æœºåŒæ—¶æ”¯æŒå®Œå…¨è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–æ—¶ï¼ŒæŒ‡å®šä½¿ç”¨å®Œå…¨è™šæ‹ŸåŒ–ï¼›ðŸ‘‰ðŸ¾ -p, --paravirtï¼šæŒ‡å®šä½¿ç”¨åŠè™šæ‹ŸåŒ–ï¼›ðŸ‘‰ðŸ¾ --virt-typeï¼šä½¿ç”¨çš„hypervisorï¼Œå¦‚kvmã€qemuã€xenç­‰ï¼›æ‰€æœ‰å¯ç”¨å€¼å¯ä»¥ä½¿ç”¨â€™virsh capabilitiesâ€™å‘½ä»¤èŽ·å–ï¼›ðŸ‘‰ðŸ¾ å…¶å®ƒï¼šðŸ‘‰ðŸ¾ --autostartï¼šæŒ‡å®šè™šæ‹Ÿæœºæ˜¯å¦åœ¨ç‰©ç†å¯åŠ¨åŽè‡ªåŠ¨å¯åŠ¨ï¼›ðŸ‘‰ðŸ¾ --print-xmlï¼šå¦‚æžœè™šæ‹Ÿæœºä¸éœ€è¦å®‰è£…è¿‡ç¨‹(--importã€--boot)ï¼Œåˆ™æ˜¾ç¤ºç”Ÿæˆçš„XMLè€Œä¸æ˜¯åˆ›å»ºæ­¤è™šæ‹Ÿæœºï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤é€‰é¡¹ä»ä¼šåˆ›å»ºç£ç›˜æ˜ åƒï¼›ðŸ‘‰ðŸ¾ --forceï¼šç¦æ­¢å‘½ä»¤è¿›å…¥äº¤äº’å¼æ¨¡å¼ï¼Œå¦‚æžœæœ‰éœ€è¦å›žç­”yesæˆ–noé€‰é¡¹ï¼Œåˆ™è‡ªåŠ¨å›žç­”ä¸ºyesï¼›ðŸ‘‰ðŸ¾ --dry-runï¼šæ‰§è¡Œåˆ›å»ºè™šæ‹Ÿæœºçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œä½†ä¸çœŸæ­£åˆ›å»ºè™šæ‹Ÿæœºã€æ”¹å˜ä¸»æœºä¸Šçš„è®¾å¤‡é…ç½®ä¿¡æ¯åŠå°†å…¶åˆ›å»ºçš„éœ€æ±‚é€šçŸ¥ç»™libvirtï¼›ðŸ‘‰ðŸ¾ -d, --debugï¼šæ˜¾ç¤ºdebugä¿¡æ¯ï¼›å°½ç®¡virt-installå‘½ä»¤æœ‰ç€ç±»ä¼¼ä¸Šè¿°çš„ä¼—å¤šé€‰é¡¹ï¼Œä½†å®žé™…ä½¿ç”¨ä¸­ï¼Œå…¶å¿…é¡»æä¾›çš„é€‰é¡¹ä»…åŒ…æ‹¬--nameã€--ramã€--diskï¼ˆä¹Ÿå¯æ˜¯--nodisksï¼‰åŠå®‰è£…è¿‡ç¨‹ç›¸å…³çš„é€‰é¡¹ã€‚æ­¤å¤–ï¼Œæœ‰æ—¶è¿˜éœ€è¦ä½¿ç”¨æ‹¬--connect=CONNCTé€‰é¡¹æ¥æŒ‡å®šè¿žæŽ¥è‡³ä¸€ä¸ªéžé»˜è®¤çš„hypervisorã€‚ 1# virt-install -n centos6.7 -r 512 -vcpus=2, maxvcpus=4 --pxe --disk /images/centos/centos6.7.qcow2,size=120,format=qcow2,bus=virtio,spare=yes --network bridge=br0,model-virtio --force ç”Ÿäº§ç¤ºä¾‹ 1virt-install --name testwinserver --memory 6144 --vcpus 2 --disk device=cdrom,path=/kvmiso/cn_windows_server_2016_x64_dvd_9718765.iso --disk device=cdrom,path=/usr/share/virtio-win/virtio-win.iso --disk path=/kvmdata/testwinserver.img,size=300,bus=virtio --network bridge=br-ext,model=virtio --noautoconsole --accelerate --hvm --graphics vnc,listen=0.0.0.0 --video vga --input tablet,bus=usb --os-type=windows --check path_in_use=off]]></content>
      <tags>
        <tag>linux</tag>
        <tag>cloud</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesæ“ä½œè®°å½•(ä¸ƒ)]]></title>
    <url>%2F2019%2F06%2F15%2Fkubernetes%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%957%2F</url>
    <content type="text"><![CDATA[kubernetes æ“ä½œè®°å½•ä¸ƒ èµ„æºæŒ‡æ ‡APIåŠè‡ªå®šä¹‰æŒ‡æ ‡APIèµ„æºæŒ‡æ ‡: metrics-serverè‡ªå®šä¹‰æŒ‡æ ‡: prometheus, k8s-prometheus-adapter æ–°ä¸€ä»£æž¶æž„: æ ¸å¿ƒæŒ‡æ ‡æµæ°´çº¿ï¼šç”±kubeletã€metrics-server ä»¥åŠç”±API server æä¾›çš„apiç»„æˆ;CPUã€å†…å­˜å®žæ—¶ä½¿ç”¨çŽ‡ã€Podçš„èµ„æºå ç”¨çŽ‡åŠçª—å£çš„ç£ç›˜å ç”¨çŽ‡; ç›‘æŽ§æµæ°´çº¿: ç”¨äºŽä»Žç³»ç»Ÿæ”¶é›†å„ç§æŒ‡æ ‡æ•°æ®å¹¶æä¾›ç»ˆç«¯ç”¨æˆ·ã€å­˜å‚¨ç³»ç»Ÿä»¥åŠHPAã€‚å®ƒä»¬åŒ…å«æ ¸å¿ƒæŒ‡æ ‡åŠè®¸å¤šéžæ ¸å¿ƒæŒ‡æ ‡ã€‚éžæ ¸å¿ƒæŒ‡æ ‡æœ¬èº«ä¸èƒ½è¢«k8sæ‰€è§£æž; metrics-server: API server éƒ¨ç½² metrics-server1234# mkdir metrics-server# wget https://github.com/kubernetes-incubator/metrics-server/archive/v0.3.1.zip # cd metrics-server/metrics-server-0.3.1/deploy/1.8+/# mv * ../../../ é—®é¢˜ä¿®æ­£ é—®é¢˜1ï¼šmetrics-serveré»˜è®¤ä½¿ç”¨èŠ‚ç‚¹hostnameé€šè¿‡kubelet 10250ç«¯å£èŽ·å–æ•°æ®ï¼Œä½†æ˜¯corednsé‡Œé¢æ²¡æœ‰è¯¥æ•°æ®æ— æ³•è§£æž(10.96.0.10:53)ï¼Œå¯ä»¥åœ¨metrics serverå¯åŠ¨å‘½ä»¤æ·»åŠ å‚æ•° â€“kubelet-preferred-address-types=InternalIP ç›´æŽ¥ä½¿ç”¨èŠ‚ç‚¹IPåœ°å€èŽ·å–æ•°æ® é—®é¢˜2ï¼škubelet çš„10250ç«¯å£ä½¿ç”¨çš„æ˜¯httpsåè®®ï¼Œè¿žæŽ¥éœ€è¦éªŒè¯tlsè¯ä¹¦ã€‚å¯ä»¥åœ¨metrics serverå¯åŠ¨å‘½ä»¤æ·»åŠ å‚æ•°â€“kubelet-insecure-tlsä¸éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ é—®é¢˜3ï¼šyamlæ–‡ä»¶ä¸­çš„imageåœ°å€k8s.gcr.io/metrics-server-amd64:v0.3.0 éœ€è¦æ¢¯å­ï¼Œéœ€è¦æ”¹æˆä¸­å›½å¯ä»¥è®¿é—®çš„imageåœ°å€ï¼Œå¯ä»¥ä½¿ç”¨aliyunçš„ registry.cn-hangzhou.aliyuncs.com/google_containers/ ä¿®æ”¹ä»¥ä¸‹å†…å®¹ 12345678910111213containers: - name: metrics-server #image: k8s.gcr.io/metrics-server-amd64:v0.3.0 image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.0 imagePullPolicy: IfNotPresent command: - /metrics-server - --metric-resolution=30s - --kubelet-insecure-tls - --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP volumeMounts: - name: tmp-dir mountPath: /tmp 12# kubectl api-versions | grep metricsmetrics.k8s.io/v1beta1 12345678910111213141516171819202122232425262728# curl http://localhost:8080/apis/metrics.k8s.io/v1beta1&#123; "kind": "APIResourceList", "apiVersion": "v1", "groupVersion": "metrics.k8s.io/v1beta1", "resources": [ &#123; "name": "nodes", "singularName": "", "namespaced": false, "kind": "NodeMetrics", "verbs": [ "get", "list" ] &#125;, &#123; "name": "pods", "singularName": "", "namespaced": true, "kind": "PodMetrics", "verbs": [ "get", "list" ] &#125; ]&#125; é”™è¯¯æ—¥å¿—æŽ’æŸ¥ 1# kubectl logs -f metrics-server-68cdb458db-rgjtr -c metrics-server -n kube-system ä¸»è¦æä¾›node å’ŒPodçš„ç›‘æŽ§æ•°æ®; 123456kubectl top nodesNAME CPU(cores) CPU% MEMORY(bytes) MEMORY%node01 94m 4% 1574Mi 42%node02 92m 4% 1901Mi 51%node03 108m 5% 1803Mi 48%master 238m 11% 1879Mi 50% prometheus éƒ¨ç½²12345678910111213# git clone https://github.com/iKubernetes/k8s-prom.git# cd k8s-prom# kubectl apply -f namespace.yaml# cd node_exporter/# kubectl apply -f ./# kubectl get pods -n promNAME READY STATUS RESTARTS AGEprometheus-node-exporter-2xrqp 1/1 Running 0 47sprometheus-node-exporter-cgkp7 1/1 Running 0 47sprometheus-node-exporter-t7vh7 1/1 Running 0 47sprometheus-node-exporter-vrw89 1/1 Running 0 46s# cd ../prometheus/# kubectl apply -f ./ æ³¨: åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œè‡³å°‘è¦ç”¨pvå­˜å‚¨ï¼Œä¸ç„¶å½“Podåˆ é™¤æ—¶ï¼Œæ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤; å®‰è£… kube-state-metrics12345# cd ../kube-state-metrics/# vim kube-state-metrics-deploy.yaml # ä¿®æ”¹imageé•œåƒæºimage: quay.io/coreos/kube-state-metrics:v1.3.1# kubectl apply -f ./# kubectl get all -n prom å®‰è£… k8s-prometheus-adapter12345678# /etc/kubernetes/pki/# (umask 077; openssl genrsa -out serving.key 2048)# openssl req -new -key serving.key -out serving.csr -subj &quot;/CN=serving&quot;# openssl x509 -req -in serving.csr -CA ./ca.crt -CAkey ./ca.key -CAcreateserial -out serving.crt -days 36500# kubectl create generic cm-adapter-serving-certs --from-file=serving.crt --from-file=serving.key# kubectl create secret generic cm-adapter-serving-certs --from-file=serving.crt --from-file=serving.key -n prom# cd manifests/metrics/k8s-prom/k8s-prometheus-adapter# kubectl apply -f ./ å‘çŽ°k8s-prometheus-adapterä¸­çš„custom-metrics-apiserver-deployment.yaml é…ç½®å˜äº†ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®åŽŸæœ‰å†…å®¹ image: directxman12/k8s-prometheus-adapter-amd64 googleæœç´¢directxman12æ›´æ–° 12345# mv custom-metrics-apiserver-deployment.yaml&#123;,.bak&#125;# wget https://raw.githubusercontent.com/DirectXMan12/k8s-prometheus-adapter/master/deploy/manifests/custom-metrics-apiserver-deployment.yaml# vim custom-metrics-apiserver-deployment.yaml # æ”¹namespace: prom # wget https://raw.githubusercontent.com/DirectXMan12/k8s-prometheus-adapter/master/deploy/manifests/custom-metrics-config-map.yaml# vim custom-metrics-config-map.yaml # æ”¹namespace: prom 123456789# kubectl get all -n promNAME READY STATUS RESTARTS AGEpod/custom-metrics-apiserver-667fd4fffd-qs2zk 1/1 Running 0 3m18spod/kube-state-metrics-6697d66bbb-w7k4d 1/1 Running 0 20mpod/prometheus-node-exporter-2xrqp 1/1 Running 0 71mpod/prometheus-node-exporter-cgkp7 1/1 Running 0 71mpod/prometheus-node-exporter-t7vh7 1/1 Running 0 71mpod/prometheus-node-exporter-vrw89 1/1 Running 0 71mpod/prometheus-server-75cf46bdbc-kpgzs 1/1 Running 0 69m è¡¥å……kubelet å¯åŠ¨å¤±è´¥ swapoff -aæ–°å…¥æ–°èŠ‚ç‚¹æ—¶å¡ä½ kubeadm token create kubeadm token list 1# curl http://localhost:8080/apis/custom.metrics.k8s.io/v1beta1 å®‰è£… grafanaæ”¹åŽŸgrafana é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980apiVersion: apps/v1kind: Deploymentmetadata: name: monitoring-grafana namespace: promspec: replicas: 1 selector: matchLabels: task: monitoring k8s-app: grafana template: metadata: labels: task: monitoring k8s-app: grafana spec: containers: - name: grafana image: registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-grafana-amd64:v5.0.4 ports: - containerPort: 3000 protocol: TCP volumeMounts: - mountPath: /etc/ssl/certs name: ca-certificates readOnly: true - mountPath: /var name: grafana-storage env: #- name: INFLUXDB_HOST # value: monitoring-influxdb - name: GF_SERVER_HTTP_PORT value: "3000" # The following env variables are required to make Grafana accessible via # the kubernetes api-server proxy. On production clusters, we recommend # removing these env variables, setup auth for grafana, and expose the grafana # service using a LoadBalancer or a public IP. - name: GF_AUTH_BASIC_ENABLED value: "false" - name: GF_AUTH_ANONYMOUS_ENABLED value: "true" - name: GF_AUTH_ANONYMOUS_ORG_ROLE value: Admin - name: GF_SERVER_ROOT_URL # If you're only using the API Server proxy, set this value instead: # value: /api/v1/namespaces/kube-system/services/monitoring-grafana/proxy value: / volumes: - name: ca-certificates hostPath: path: /etc/ssl/certs - name: grafana-storage emptyDir: &#123;&#125;---apiVersion: v1kind: Servicemetadata: labels: # For use as a Cluster add-on (https://github.com/kubernetes/kubernetes/tree/master/cluster/addons) # If you are NOT using this as an addon, you should comment out this line. kubernetes.io/cluster-service: 'true' kubernetes.io/name: monitoring-grafana name: monitoring-grafana namespace: promspec: # In a production setup, we recommend accessing Grafana through an external Loadbalancer # or through a public IP. # type: LoadBalancer # You could also use NodePort to expose the service at a randomly-generated port # type: NodePort type: NodePort ports: - port: 80 targetPort: 3000 nodePort: 30098 protocol: TCP selector: k8s-app: grafana# kubectl apply -f grafana.yaml ä¸‹è½½å¹¶å¯¼å…¥æ¨¡ç‰ˆ èµ„æºé™åˆ¶ä¸Žä¼¸ç¼©12345678# kubectl run myapp --image=ikubernetes/myapp:v1 --replicas=0 --requests='cpu=50m,memory=256Mi' --limits='cpu=50m,memory=256Mi' --labels='app=myapp' --expose --port=80# kubectl autoscale deployment myapp --min=1 --max=8 --cpu-percent=60horizontalpodautoscaler.autoscaling/myapp autoscaled# kubectl get hpaNAME REFERENCE TARGETS MINPODS MAXPODS REPLICAS AGEmyapp Deployment/myapp 0%/60% 1 8 1 22s# kubectl patch svc myapp -p '&#123;"spec":&#123;"type": "NodePort"&#125;&#125;'service/myapp patched 1#ssjinyao âž¤ ab -c 100 -n 50000 http://xx.x.xx.xx:31257/index.html å½“åŽ‹æµ‹ï¼ŒCPU å†…å­˜èµ„æºè¶…å‡ºæ—¶ï¼Œä¼šæ‰©å±•Podæ•°ç›® 1234567891011121314151617181920apiVersion: autoscaling/v2beta1kind: HorizontalPodAutoscalermetadata: name: myapp-hpa-v2spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: myapp minReplicas: 1 maxReplicas: 10 metrics: - type: Resource resource: name: cpu targetAverageUtilization: 55 - type: Resource resource: name: memory targetAverageValue: 50Mi æ ¹æ®è¯·æ±‚æ•°å‡Podæ•° 12345678910111213141516apiVersion: autoscaling/v2beta1kind: HorizontalPodAutoscalermetadata: name: myapp-hpa-v2spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: myapp minReplicas: 1 maxReplicas: 10 metrics: - type: Pods pods: metricName: http_requests targetAverageValue: 800m helm å…¥é—¨æ ¸å¿ƒæœ¯è¯­: Chart: ä¸€ä¸ªhelmç¨‹åºåŒ…; Repository: Chartsä»“åº“,https/httpæœåŠ¡å™¨; Release:ç‰¹å®šçš„Chartéƒ¨ç½²äºŽç›®æ ‡é›†ç¾¤ä¸Šçš„ä¸€ä¸ªå®žä¾‹; Chart -&gt; Config -&gt; Releaseç¨‹åºæž¶æž„: helmï¼šå®¢æˆ·ç«¯ï¼Œç®¡ç†æœ¬åœ°çš„Chartä»“åº“ï¼Œç®¡ç†Chartï¼Œä¸ŽTilleræœåŠ¡å™¨äº¤äº’ï¼Œå‘é€Chart,å®žä¾‹å®‰è£…ã€æŸ¥è¯¢ã€å¸è½½ç­‰æ“ä½œ Tiller: æœåŠ¡ç«¯ ï¼ŒæŽ¥æ”¶helmå‘æ¥çš„Chartä¸ŽConfig,åˆå¹¶ç”Ÿæˆrelease; helm githubå®˜ç½‘ å®‰è£…helm123# wget https://get.helm.sh/helm-v2.9.1-linux-amd64.tar.gz# mv linux-amd64/helm /usr/sbin/# helm è¦ä½¿ç”¨helm è¿˜éœ€è¦å®‰è£… Tillerhelm ä¼šè¯†åˆ« .kube/config æ‰®æ¼”æˆkubectl å®¢æˆ·ç«¯åŽ»è¿žæŽ¥è‡³kubernetesé›†ç¾¤ å®‰è£… TillerClusterRoleBinding RBACé…ç½®æ–‡ä»¶ 12345678910111213141516171819202122# mkdir helm# cd helm/# vim tiller-rbac.yamlapiVersion: v1kind: ServiceAccountmetadata: name: tiller namespace: kube-system---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: tillerroleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-adminsubjects: - kind: ServiceAccount name: tiller namespace: kube-system# kubectl apply -f tiller-rbac.yaml 1# helm init --service-account tiller æŠ¥é”™ä¸Žå¤„ç† 1234567891011# helm init --service-account tillerCreating /root/.helmCreating /root/.helm/repositoryCreating /root/.helm/repository/cacheCreating /root/.helm/repository/localCreating /root/.helm/pluginsCreating /root/.helm/startersCreating /root/.helm/cache/archiveCreating /root/.helm/repository/repositories.yamlAdding stable repo with URL: https://kubernetes-charts.storage.googleapis.comError: Looks like "https://kubernetes-charts.storage.googleapis.com" is not a valid chart repository or cannot be reached: Get https://kubernetes-charts.storage.googleapis.com/index.yaml: read tcp 10.1.87.80:41084-&gt;172.217.163.240:443: read: connection reset by peer æ·»åŠ å›½å†…æº 1# helm init --client-only --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts å¦‚æžœæŠ¥å¦‚ä¸‹é”™è¯¯ï¼Œè¯·æŒ‰ç…§ä¸‹é¢è§£å†³ 12Error: Couldn't load repositories file (/home/docker/.helm/repository/repositories.yaml).You might need to run `helm init` (or `helm init --client-only` if tiller is already installed) è§£å†³åŠžæ³• 1helm init --client-only --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts â€“stable-repo-url æŒ‡å®šä¸‹è½½è½¯ä»¶ä»Žé‚£ä¸ªæºä¸‹è½½ï¼Œé»˜è®¤çš„æ˜¯ä»Žgoogleä¸‹è½½ï¼Œå›½å†…ä¸‹è½½ä¸ä¸‹æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æŒ‡å®šæºä¸ºé˜¿é‡Œäº‘çš„æºã€‚ ä¸‹è½½å®Œä¹‹åŽæˆ‘ä»¬è¿˜æŠŠæºæ›´æ¢å›žæ¥ï¼Œè¦ä¸ç„¶åŽé¢ä¼šæŠ¥é”™ 1# helm repo add rancher-stable https://releases.rancher.com/server-charts/stable 123# helm init --service-account tiller --tiller-image \registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.12.3 \--stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts æ›´æ–° helm æº 123456# helm repo updateHang tight while we grab the latest from your chart repositories......Skip local chart repository...Successfully got an update from the "stable" chart repository...Successfully got an update from the "rancher-stable" chart repositoryUpdate Complete. âŽˆ Happy Helming!âŽˆ helm å®˜æ–¹å¯ç”¨çš„Chartåˆ—è¡¨ 1234# helm search jenkins # æœç´¢åº”ç”¨# helm inspect stable/jenkins # æŸ¥çœ‹ä½¿ç”¨é…ç½®ä¿¡æ¯# helm install --name mem1 stable/memcached # å®‰è£…Memcached# kubectl get pods --namespace default -l "app=mem1-memcached" -o jsonpath="&#123;.items[0].metadata.name&#125;" mem1-memcached-0 #éªŒè¯ helm å¸¸ç”¨å‘½ä»¤release ç®¡ç† 123456insstalldeleteupgrade/rollbacklisthistorystatus èŽ·å–release çŠ¶æ€ä¿¡æ¯ chart ç®¡ç† 123456cratefetch get inspectpackageverify chart get åˆ°æœ¬åœ°è·¯å¾„ /root/.helm/cache/archive æ ¹æ®è‡ªå®šä¹‰å˜é‡åˆ›å»º 12# helm install --name redis1 -f values.yaml stable/redis# helm status redis1 # å†æ¬¡æ˜¾ç¤ºNOTES éƒ¨ç½²EFK æ—¥å¿—ç³»ç»Ÿéƒ¨ç½²elasticsearchEFK: Fluentd åœ¨å®¹å™¨é›†ç¾¤å²©è°ƒï¼Œå†æŽ¥å…¥PodæŸ¥è¯¢æ—¥å¿—æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥å¿…è¦çš„æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿ;ä¸€ä¸ªå®Œæ•´çš„kubernetesç³»ç»Ÿåº”è¯¥æœ‰:kubedns or coredns ,ingress-contraler,heapster or metracs server prometheus , dashboard ã€‚è€ŒEFKæ˜¯ä¸€ä¸ªkubernetesåŸºæœ¬ä¸Šéœ€è¦æä¾›çš„å®Œæ•´ç»„ä»¶; æ·»åŠ helmæº 123# helm repo add extra https://burdenbear.github.io/kube-charts-mirror/# helm repo add stable http://mirror.azure.cn/kubernetes/charts/ # helm repo add incubator http://mirror.azure.cn/kubernetes/charts-incubator/ 12345678910111213141516171819# helm fetch stable/elasticsearch# helm fetch stable/fluentd-elasticsearch# helm fetch stable/kibana# tar -xvf elasticsearch-1.28.5.tgz# tar -xvf fluentd-elasticsearch-2.0.7.tgz# tar -xvf kibana-3.1.0.tgz# cd elasticsearch# vim values.yaml # ä¿®æ”¹ä»¥ä¸‹å†…å®¹ pullPolicy: "IfNotPresent" persistence: enabled: false# kubectl create namespace efk# helm package elasticsearch/# æ–°å¼€å¯ä¸€ä¸ªç»ˆç«¯# helm serveRegenerating index. This may take a moment.Now serving you on 127.0.0.1:8879# helm install --name els1 --namespace=efk local/elasticsearch æµ‹è¯• 12345678910111213141516171819202122232425262728293031# kubectl run cirror-$RANDOM --rm -it --image=cirros -- /bin/sh/ # nslookup els1-elasticsearch-client.efk.svcServer: 10.96.0.10Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.localName: els1-elasticsearch-client.efk.svcAddress 1: 10.111.159.57 els1-elasticsearch-client.efk.svc.cluster.localcurl els1-elasticsearch-client.efk.svc.cluster.local:9200&#123; "name" : "els1-elasticsearch-client-787568fb55-9zd9k", "cluster_name" : "elasticsearch", "cluster_uuid" : "_na_", "version" : &#123; "number" : "6.4.3", "build_flavor" : "default", "build_type" : "tar", "build_hash" : "fe40335", "build_date" : "2018-10-30T23:17:19.084789Z", "build_snapshot" : false, "lucene_version" : "7.4.0", "minimum_wire_compatibility_version" : "5.6.0", "minimum_index_compatibility_version" : "5.0.0" &#125;, "tagline" : "You Know, for Search"&#125;/ # curl els1-elasticsearch-client.efk.svc.cluster.local:9200/_cat/nodes10.244.1.215 15 90 7 0.12 0.36 0.35 di - els1-elasticsearch-data-110.244.2.132 19 60 2 0.09 0.23 0.19 di - els1-elasticsearch-data-010.244.1.213 22 90 7 0.12 0.36 0.35 i - els1-elasticsearch-client-787568fb55-9zd9k10.244.2.131 26 60 2 0.09 0.23 0.19 i - els1-elasticsearch-client-787568fb55-sxhhp10.244.1.214 44 90 7 0.12 0.36 0.35 mi * els1-elasticsearch-master-0 éƒ¨ç½² fluentd12345678910111213141516171819202122232425# cd fluentd-elasticsearch/ # vim values.yamlimage: repository: registry.cn-hangzhou.aliyuncs.com/google_containers/fluentd-elasticsearchelasticsearch: host: 'els1-elasticsearch-client.efk.svc.cluster.local' port: 9200 scheme: 'http' ssl_version: TLSv1_2 buffer_chunk_limit: 2M buffer_queue_limit: 8 logstash_prefix: 'logstash'tolerations: - key: node-role.kubernetes.io/master operator: Exists effect: NoSchedulepodAnnotations: prometheus.io/scrape: "true" prometheus.io/port: "24231"service: type: ClusterIP ports: - name: "monitor-agent" port: 24231 12# helm package ../fluentd-elasticsearch/# helm install --name flu1 --namespace=efk local/fluentd-elasticsearch å®‰è£… kibana1234567891011121314151617181920212223242526# cd kibana# vim values.yaml # ä¿®æ”¹ä»¥ä¸‹å†…å®¹ elasticsearch.hosts: http://els1-elasticsearch-client.efk.svc.cluster.local:9200 service: type: NodePort# helm package ../kibana/# helm install --name kibana1 --namespace=efk local/kibana# kubectl get pods -n efkNAME READY STATUS RESTARTS AGEels1-elasticsearch-client-6b4b8c7485-7grbt 1/1 Running 0 96mels1-elasticsearch-client-6b4b8c7485-sqgtl 1/1 Running 0 96mels1-elasticsearch-data-0 1/1 Running 0 96mels1-elasticsearch-data-1 1/1 Running 0 78mels1-elasticsearch-master-0 1/1 Running 0 96mels1-elasticsearch-master-1 1/1 Running 0 93mels1-elasticsearch-master-2 1/1 Running 0 78mflu1-fluentd-elasticsearch-95b95 1/1 Running 0 26mflu1-fluentd-elasticsearch-vpcsg 1/1 Running 0 26mflu1-fluentd-elasticsearch-w5wjj 1/1 Running 0 26mflu1-fluentd-elasticsearch-xkpv2 1/1 Running 0 26mkibana1-5dcf5f5d47-rsmqb 1/1 Running 0 21m# kubectl get svc -n efkNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEels1-elasticsearch-client ClusterIP 10.98.8.75 &lt;none&gt; 9200/TCP 97mels1-elasticsearch-discovery ClusterIP None &lt;none&gt; 9300/TCP 97mkibana1 NodePort 10.96.230.3 &lt;none&gt; 443:31746/TCP 21m docker pull æŠ¥é”™ä¿¡æ¯æ€»ç»“error pulling image configuration 1234# echo &quot;DOCKER_OPTS=\&quot;\$DOCKER_OPTS --registry-mirror=http://f2d6cb40.m.daocloud.io\&quot;&quot; | tee -a /etc/default/docker# æˆ–è€… vim /etc/default/docker æ›´æ”¹ä»¥ä¸‹ä¿¡æ¯DOCKER_OPTS=&quot;$&#123;DOCKER_OPTS&#125; --registry-mirror=https://mirror.gcr.io&quot;# systemctl restart docker é…ç½®å¹¶è®¿é—®kibana]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesæ“ä½œè®°å½•(å…­)]]></title>
    <url>%2F2019%2F05%2F30%2Fkubernetes%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%956%2F</url>
    <content type="text"><![CDATA[kubernetes æ“ä½œè®°å½•å…­ è°ƒåº¦å™¨ã€é¢„é€‰ç­–ç•¥åŠä¼˜é€‰å‡½æ•°æ•´ä¸ªè°ƒåº¦å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹: Predicate(é¢„å…ˆ) â€“&gt; Priority(ä¼˜é€‰) â€“&gt; Select(é€‰å®š) è°ƒåº¦å™¨: é¢„é€‰ç­–ç•¥: CheckNodeCondition: æ£€æŸ¥èŠ‚ç‚¹æœ¬èº«æ˜¯å¦æ­£å¸¸; GeneralPredicates: HostName: æ£€æŸ¥Podå¯¹è±¡æ˜¯å¦å®šä¹‰äº† pod.spec.hostname, PodFitsHostPorts:pods.spec.containers.ports.hostPort MatchNodeSelector: pods.sepc.nodeSelector PodFitsResources: æ£€æŸ¥Podçš„èµ„æºéœ€æ±‚æ˜¯å¦èƒ½è¢«èŠ‚ç‚¹çš„éœ€æ±‚æ‰€æ»¡è¶³ NoDiskConflicts:æ£€æŸ¥Podä¾èµ–çš„å­˜å‚¨å·æ˜¯å¦èƒ½æ»¡è¶³éœ€æ±‚; PodToleratesNodeTaints: æ£€æŸ¥Podä¸Šçš„spec.tolerationså¯å®¹å¿çš„æ±¡ç‚¹æ˜¯å¦å®Œå…¨åŒ…å«èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹; PodToleratesNodeNoExecuteTaints: ä¸èƒ½æ‰§è¡Œçš„æ±¡ç‚¹,è¿™ä¸ªé¢„é€‰ç­–ç•¥é»˜è®¤æ˜¯ä¸æ£€æŸ¥çš„; CheckNodeLabelPresence: æ£€æŸ¥èŠ‚ç‚¹æŒ‡å®šæ ‡ç­¾çš„å­˜åœ¨æ€§; CheckServiceAffinity: æŠŠè¿™ä¸ªPodè°ƒåº¦åˆ°å®ƒæ‰€å±žçš„Service,å·²ç»è°ƒåº¦å®Œæˆå…¶å®ƒPodæ‰€åœ¨çš„èŠ‚ç‚¹ä¸ŠåŽ»; MaxEBSVolumeCount: MaxGCEPDVolumeCount: MaxAzureDiskVolumeCount: CheckVolumeBinding: NoVolumeZoneConflict: CheckNodeMemoryPressure:æ£€æŸ¥èŠ‚ç‚¹å†…å­˜èµ„æºæ˜¯å¦å¤„äºŽåŽ‹åŠ›è¿‡å¤§çš„çŠ¶æ€; CheckNodePidPressure:æ£€æŸ¥PIdçŠ¶æ€æ˜¯å¦ç´§ç¼º; CheckNodeDiskPressure: MatchInterPodAffity: ä¼˜é€‰å‡½æ•° LeastRequested: (cpu(capacity-sum(requested))*10/capacity)+memory((capacity-sum(requested))*10/capacity))/2 BalancedResourceAllocation: CPUå’Œå†…å­˜èµ„æºè¢«å ç”¨çŽ‡ç›¸è¿‘çš„èƒœå‡º; NodePreferAvoidPods: èŠ‚ç‚¹æ³¨è§£ä¿¡æ¯â€scheduler .alpha.kubernetes.io/preferAvoidPodsâ€ TaintToleration: å°†Podå¯¹è±¡çš„spec.tolerationsåˆ—è¡¨é¡¹ä¸ŽèŠ‚ç‚¹çš„taintsåˆ—è¡¨é¡¹è¿›è¡ŒåŒ¹é…åº¦æ£€æŸ¥ï¼ŒåŒ¹é…æ¡ç›®è¶Šå¤šï¼Œå¾—åˆ†è¶Šä½Ž; SelectorSpreading: æ ‡ç­¾é€‰æ‹©å™¨çš„åˆ†æ•£åº¦ï¼Œä¸Žå½“å‰Podå¯¹è±¡åŒå±žçš„æ ‡ç­¾é€‰æ‹©å™¨ï¼Œé€‰æ‹©é€‚é…çš„å…¶å®ƒPodçš„å¯¹è±¡æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œè¶Šå¤šçš„ï¼Œå¾—åˆ†è¶Šåº•ï¼Œå¦åˆ™å¾—åˆ†è¶Šé«˜; InterPodAffinity: éåŽ†Podçš„äº²å’Œæ€§æ¡ç›®ï¼Œå¹¶å°†é‚£äº›èƒ½å¤ŸåŒ¹é…åˆ°ç»™å®šèŠ‚ç‚¹çš„æ¡ç›®ç›¸åŠ ï¼Œç»“æžœå€¼è¶Šå¤§ï¼Œå¾—åˆ†è¶Šä½Ž; NodeAffinity: æ ¹æ®NodeSelecterè¿›è¡ŒåŒ¹é…åº¦æ£€æŸ¥ï¼Œèƒ½æˆåŠŸåŒ¹é…çš„è¶Šå¤šï¼Œå¾—åˆ†å°±è¶Šé«˜; MostRequested: ç©ºé—²é‡è¶Šå°çš„ï¼Œå¾—åˆ†è¶Šå¤§ã€‚ä»–ä¼šå°½é‡æŠŠä¸€ä¸ªèŠ‚ç‚¹çš„èµ„æºå…ˆç”¨å®Œ; NodeLabel: æ ‡ç­¾è¶Šå¤šï¼Œå¾—åˆ†è¶Šé«˜; ImageLocality: æ­¤èŠ‚ç‚¹æ˜¯å¦æœ‰æ­¤Pod æ‰€éœ€è¦çš„é•œåƒï¼Œæ‹¥æœ‰é•œåƒè¶Šå¤šçš„ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œè€Œå®ƒæ˜¯æ ¹æ®é•œåƒä½“ç§¯å¤§å°ä¹‹å’Œæ¥è®¡ç®—çš„; kubernetes é«˜çº§è°ƒåº¦æ–¹å¼èŠ‚ç‚¹é€‰æ‹©å™¨: nodeSelector, nodeNameèŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦: nodeAffinity æ³¨: å½“è°ƒåº¦é€‰æ‹©å™¨é€‰æ‹©äº†ä¸å­˜çš„æ ‡ç­¾æ—¶ï¼ŒPod ä¼šæˆä¸ºPendingçŠ¶æ€ nodeSelector: disktype: harddisk èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦; ç¡¬äº²å’Œ 12345678910111213141516171819202122# vim pod-nodeaffinity-demo.yamlapiVersion: v1kind: Podmetadata: name: pod-node-affinity-demo labels: app: myapp tier: frontendspec: containers: - name: myapp image: ikubernetes/myapp:v1 affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: zone operator: In values: - foo - bar è½¯äº²å’Œ 1234567891011121314151617181920212223# vIm pod-nodeaffinity-demo-2.yamlapiVersion: v1kind: Podmetadata: name: pod-node-affinity-demo-2 labels: app: myapp tier: frontendspec: containers: - name: myapp image: ikubernetes/myapp:v1 affinity: nodeAffinity: preferredDuringSchedulingIgnoredDuringExecution: - preference: matchExpressions: - key: zone operator: In values: - foo - bar weight: 60 123456789101112131415161718192021222324252627282930313233# vim pod-required-affinity-demo.yamlapiVersion: v1kind: Podmetadata: name: pod-first labels: app: myapp tier: frontendspec: containers: - name: myapp image: ikubernetes/myapp:v1---apiVersion: v1kind: Podmetadata: name: pod-second labels: app: backend tier: dbspec: containers: - name: busybox image: busybox:latest imagePullPolicy: IfNotPresent command: ["sh","-c","sleep 3600"] affinity: podAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - &#123;key: app, operator: In, values: ["myapp"]&#125; topologyKey: kubernetes.io/hostname æ³¨: podAntiAffinity ä¸€å®šä¸ä¼šè°ƒåº¦åˆ°åŒä¸€èŠ‚ç‚¹ä¸Š taint çš„effectå®šä¹‰å¯¹PodæŽ’æ–¥æ•ˆæžœ: NoSchedule: ä»…å½±å“è°ƒåº¦è¿‡ç¨‹ï¼Œå¯¹çŽ°å­˜çš„Podå¯¹è±¡ä¸äº§ç”Ÿå½±å“; NoExecute: æ—¢å½±å“è°ƒåº¦è¿‡ç¨‹ï¼Œä¹Ÿå½±å“çŽ°å­˜çš„Podå¯¹è±¡; ä¸å®¹å¿çš„Podå¯¹è±¡å°†è¢«é©±é€; PreferNoSchedule: 12# kubectl taint node node01 node-type=production:NoSchedule# kubectl taint node node02 node-type=dev:NoExecute 12345678910111213141516171819202122232425262728apiVersion: apps/v1kind: Deploymentmetadata: name: myapp-deploy namespace: defaultspec: replicas: 5 selector: matchLabels: app: myapp release: canary template: metadata: labels: app: myapp release: canary spec: containers: - name: myapp image: ikubernetes/myapp:v2 ports: - name: http containerPort: 80 tolerations: - key: "node-type" operator: "Equal" value: "production" effect: "NoSchedule" 123456tolerations:- key: "node-type" operator: "Equal" value: "production" effect: "NoExecute" tolerationSeconds: 3600 12345tolerations:- key: "node-type" operator: "Exists" value: "" effect: "NoExecute" å®¹å™¨èµ„æºéœ€æ±‚ã€é™åˆ¶ã€åŠHeapSterrequests: éœ€æ±‚ï¼Œæœ€ä½Žä¿éšœ;limits: é™åˆ¶ï¼Œç¡¬é™åˆ¶;limits ä¸€èˆ¬å¤§äºŽç­‰äºŽ requests CPU: 1é¢—é€»è¾‘CPU 1é€»è¾‘æ ¸å¿ƒ=1000,millicores 500m = 0.5CPUå†…å­˜: Eã€Pã€Tã€Gã€Mã€K Eiã€Pi å–æ¶ˆèŠ‚ç‚¹æ±¡ç‚¹ 1# kubectl taint node node01 node-type- 1234567891011121314151617181920apiVersion: v1kind: Podmetadata: name: pod-demo namespace: renjin labels: app: myapp tier: frontendspec: containers: - name: myapp image: ikubernetes/stress-ng command: ["/usr/bin/stress-ng", "-c 1", "--metrics-brief"] resources: requests: cpu: "500m" memory: "128Mi" limits: cpu: "500m" memory: "512Mi" QoS: Guranteed: æ¯ä¸ªå®¹å™¨åŒæ—¶è®¾ç½®CPUå’Œå†…åœ¨çš„requestså’Œlimits, cpu.limits=cpu.requests memory.limits=memory.request Burstable:è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨è®¾ç½®CPUæˆ–å†…å­˜èµ„æºçš„requests BestEffort: æ²¡æœ‰ä»»ä½•ä¸€ä¸ªå®¹å™¨è®¾ç½®äº†requestsæˆ–limitså±žæ€§;æœ€ä½Žä¼˜å…ˆçº§åˆ«; æ˜¯è‡ªåŠ¨é…ç½®çš„; é…ç½®influxdb12345678910111213141516 # wget https://raw.githubusercontent.com/kubernetes-retired/heapster/master/deploy/kube-config/influxdb/influxdb.yaml # æ›´æ”¹ä»¥ä¸‹å†…å®¹ apiVersion: apps/v1 spec: replicas: 1 selector: matchLabels: task: monitoring k8s-app: influxdb spec: containers: - name: influxdb image: registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-influxdb-amd64:v1.5.2# kubectl apply -f influxdb.yaml é…ç½®heapster-rbac12# wget https://raw.githubusercontent.com/kubernetes-retired/heapster/master/deploy/kube-config/rbac/heapster-rbac.yaml# kubectl apply -f heapster-rbac.yaml é…ç½®heapster12345678910111213141516# wget https://raw.githubusercontent.com/kubernetes-retired/heapster/master/deploy/kube-config/influxdb/heapster.yaml# ä¿®æ”¹ä»¥ä¸‹å†…å®¹apiVersion: apps/v1spec: replicas: 1 selector: matchLabels: task: monitoring k8s-app: heapsterimage: registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-amd64:v1.5.4spec: ports: - port: 80 targetPort: 8082 type: NodePort# kubectl apply -f heapster.yaml 123456# kubectl get svc -n kube-systemNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEheapster NodePort 10.101.89.141 &lt;none&gt; 80:31261/TCP 63skube-dns ClusterIP 10.96.0.10 &lt;none&gt; 53/UDP,53/TCP,9153/TCP 48dkubernetes-dashboard NodePort 10.103.25.80 &lt;none&gt; 443:30660/TCP 21dmonitoring-influxdb ClusterIP 10.103.131.36 &lt;none&gt; 8086/TCP 153m çœ‹ä¸‹å›¾è¯´æ˜Žï¼Œheapsteræ­¤æ—¶å¯ä»¥è°ƒé€š grafanaé…ç½®123456789101112131415# wget https://raw.githubusercontent.com/kubernetes-retired/heapster/master/deploy/kube-config/influxdb/grafana.yaml# vim grafana.yaml # ä¿®æ”¹ä»¥ä¸‹å†…å®¹apiVersion: apps/v1spec: replicas: 1 selector: matchLabels: task: monitoring k8s-app: grafana image: registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-grafana-amd64:v5.0.4 ports: - port: 80 targetPort: 3000 type: NodePort# kubectl apply -f grafana.yaml]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesæ“ä½œè®°å½•(äº”)]]></title>
    <url>%2F2019%2F05%2F24%2Fkubernetes%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%955%2F</url>
    <content type="text"><![CDATA[kubernetes æ“ä½œè®°å½•äº” é…ç½®ç½‘ç»œæ’ä»¶flannelåœ¨Kubernetesé›†ç¾¤ä¸­è¦è§£å†³å››ç§é€šä¿¡çš„é—®é¢˜;Kubernetesç½‘ç»œé€šä¿¡: (1) å®¹å™¨é—´é€šä¿¡: åŒä¸€ä¸ªPodå†…çš„å¤šä¸ªå®¹å™¨é—´çš„é€šä¿¡ï¼Œlo (2) Podé€šä¿¡: Pod IP &lt;â€“&gt; Pod IP (3) Podä¸Ž Serviceé€šä¿¡: PodIP &lt;â€“&gt; ClusterIP,ä¸åœ¨åŒä¸€ç½‘æ®µï¼Œé€šè¿‡iptablesè§„åˆ™å®žçŽ°é€šä¿¡ (4) Service ä¸Žé›†ç¾¤å¤–éƒ¨å®¢æˆ·ç«¯çš„é€šä¿¡;CNI: (Container Network Interface) flannel,calico,canel,kube-router â€¦ 12# kubectl get configmap kube-proxy -n kube-system -o yamlmode: "" # æ”¹ä¸ºipvs å°±å¯ä»¥äº† è§£å†³æ–¹æ¡ˆ: è™šæ‹Ÿç½‘æ¡¥: çº¯è½¯ä»¶çš„æ–¹å¼ï¼Œå®žçŽ°ä¸€ä¸ªè™šæ‹Ÿç½‘å¡æŽ¥åˆ°ç½‘æ¡¥ä¸ŠåŽ»; å¤šè·¯å¤ç”¨: MacVlAN é…ç½®å¤šä¸ªMacç‰©ç†åœ°å€ï¼Œä½¿å¾—ä¸€ä¸ªç‰©ç†ç½‘å¡ï¼Œå¯ä»¥æ‰¿è½½å¤šä¸ªå®¹å™¨åŽ»ä½¿ç”¨; ç¡¬ä»¶äº¤æ¢: SR-IOV å•æ ¹IOè™šæ‹ŸåŒ–; kubelet, /etc/cin/net.d/ 12345678910111213141516171819# cat /etc/cni/net.d/10-flannel.conflist&#123; &quot;name&quot;: &quot;cbr0&quot;, &quot;plugins&quot;: [ &#123; &quot;type&quot;: &quot;flannel&quot;, &quot;delegate&quot;: &#123; &quot;hairpinMode&quot;: true, &quot;isDefaultGateway&quot;: true &#125; &#125;, &#123; &quot;type&quot;: &quot;portmap&quot;, &quot;capabilities&quot;: &#123; &quot;portMappings&quot;: true &#125; &#125; ]&#125; flannel: æ”¯æŒå¤šç§åŽç«¯ VxLAN host-gw: Host Gateway 123456789# kubectl get daemonset -n kube-systemNAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGEkube-flannel-ds 3 3 3 3 3 beta.kubernetes.io/arch=amd64 31dkube-flannel-ds-amd64 4 4 4 4 4 beta.kubernetes.io/arch=amd64 31dkube-flannel-ds-arm 0 0 0 0 0 beta.kubernetes.io/arch=arm 31dkube-flannel-ds-arm64 0 0 0 0 0 beta.kubernetes.io/arch=arm64 31dkube-flannel-ds-ppc64le 0 0 0 0 0 beta.kubernetes.io/arch=ppc64le 31dkube-flannel-ds-s390x 0 0 0 0 0 beta.kubernetes.io/arch=s390x 31dkube-proxy 4 4 4 4 4 &lt;none&gt; 31d 12345678# kubectl get pods -n kube-system -o wide | grep "flannel"kube-flannel-ds-amd64-45rhc 1/1 Running 2 31d 10.1.87.80 bj-zb-vm-ops-test5 &lt;none&gt; &lt;none&gt;kube-flannel-ds-amd64-4cs6r 1/1 Running 0 31d 10.1.87.83 node03 &lt;none&gt; &lt;none&gt;kube-flannel-ds-amd64-bst7g 1/1 Running 0 31d 10.1.87.81 node01 &lt;none&gt; &lt;none&gt;kube-flannel-ds-amd64-gqvz2 1/1 Running 0 31d 10.1.87.82 node02 &lt;none&gt; &lt;none&gt;kube-flannel-ds-brzp7 2/2 Running 0 31d 10.1.87.83 node03 &lt;none&gt; &lt;none&gt;kube-flannel-ds-khpr5 2/2 Running 2 31d 10.1.87.82 node02 &lt;none&gt; &lt;none&gt;kube-flannel-ds-q6z65 2/2 Running 0 31d 10.1.87.81 node01 kube-flannel-cfg ç”¨æ¥é…ç½®ä»¥ä¸Šflannel Podæ˜¯å¦‚ä½•è¿è¡Œçš„; flannelçš„é…ç½®å‚æ•°: Network: flannelä½¿ç”¨çš„CIDRæ ¼å¼çš„ç½‘ç»œåœ°å€ï¼Œç”¨äºŽä¸ºPodçš„é…ç½®ç½‘ç»œåŠŸèƒ½; 10.244.0.0/16 -&gt; master: 10.244.0.0/24 node01:10.244.1.0/24 â€¦ node255: 10.244.255.0./24 SubnetLen: æŠŠNetworkåˆ‡åˆ†å­ç½‘ä¾›å„èŠ‚ç‚¹ä½¿ç”¨æ—¶ï¼Œä½¿ç”¨å¤šé•¿çš„æŽ©ç è¿›è¡Œåˆ‡åˆ†ï¼Œé»˜è®¤ä¸º24ä½; SubnetMin: 10.244.10.0/24 æŒ‡å®šå­ç½‘ä½¿ç”¨èµ·å§‹ï¼Œä»Žå“ªé‡Œå¼€å§‹; SubnetMax: 10.244.10.0/24 æŒ‡å®šå­ç½‘ä½¿ç”¨æœ€å¤§é™åˆ¶; Backend: å„Podé€šä¿¡æ—¶ä½¿ç”¨ä»€ä¹ˆæ–¹å¼è¿›è¡Œé€šä¿¡: vxlan, host-gw , udp æµ‹è¯• 12345# kubectl get pods -o wide# kubectl get pods -o wide | grep &quot;myapp-deploy&quot;myapp-deploy-675558bfc5-947g6 1/1 Running 0 4d1h 10.244.1.173 node01 &lt;none&gt; &lt;none&gt;myapp-deploy-675558bfc5-9xfdm 1/1 Running 0 4d6h 10.244.3.176 node03 &lt;none&gt; &lt;none&gt;myapp-deploy-675558bfc5-qhl4w 1/1 Running 0 5h41m 10.244.2.195 node02 &lt;none&gt; &lt;none&gt; æŽ¥å…¥ä¸€ä¸ªå®¹å™¨pingå¦ä¸€å®¹å™¨çš„ip 1234567# kubectl exec -it myapp-deploy-675558bfc5-947g6 -- /bin/sh/ # ping 10.244.2.195PING 10.244.2.195 (10.244.2.195): 56 data bytes64 bytes from 10.244.2.195: seq=0 ttl=62 time=0.871 ms64 bytes from 10.244.2.195: seq=1 ttl=62 time=0.925 ms64 bytes from 10.244.2.195: seq=2 ttl=62 time=0.886 ms64 bytes from 10.244.2.195: seq=3 ttl=62 time=1.171 ms åœ¨å®¹å™¨æ‰€åœ¨çš„ç‰©ç†æœåŠ¡å™¨ä¸ŠæŠ“åŒ…, 12345678910# tcpdump -i cni0 -nn icmptcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on cni0, link-type EN10MB (Ethernet), capture size 262144 bytes16:52:45.457148 IP 10.244.1.173 &gt; 10.244.2.195: ICMP echo request, id 3328, seq 0, length 6416:52:45.457743 IP 10.244.2.195 &gt; 10.244.1.173: ICMP echo reply, id 3328, seq 0, length 6416:52:46.457445 IP 10.244.1.173 &gt; 10.244.2.195: ICMP echo request, id 3328, seq 1, length 6416:52:46.457948 IP 10.244.2.195 &gt; 10.244.1.173: ICMP echo reply, id 3328, seq 1, length 6416:52:47.457722 IP 10.244.1.173 &gt; 10.244.2.195: ICMP echo request, id 3328, seq 2, length 6416:52:47.458313 IP 10.244.2.195 &gt; 10.244.1.173: ICMP echo reply, id 3328, seq 2, length 6416:52:48.458036 IP 10.244.1.173 &gt; 10.244.2.195: ICMP echo request, id 3328, seq 3, length 64 12345678910# tcpdump -i flannel.1 -nntcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on flannel.1, link-type EN10MB (Ethernet), capture size 262144 bytes17:01:13.757750 IP 10.244.1.0 &gt; 10.244.2.195: ICMP echo request, id 2, seq 37, length 6417:01:13.758396 IP 10.244.2.195 &gt; 10.244.1.0: ICMP echo reply, id 2, seq 37, length 6417:01:14.758058 IP 10.244.1.0 &gt; 10.244.2.195: ICMP echo request, id 2, seq 38, length 6417:01:14.758791 IP 10.244.2.195 &gt; 10.244.1.0: ICMP echo reply, id 2, seq 38, length 6417:01:15.758376 IP 10.244.1.0 &gt; 10.244.2.195: ICMP echo request, id 2, seq 39, length 6417:01:15.759072 IP 10.244.2.195 &gt; 10.244.1.0: ICMP echo reply, id 2, seq 39, length 6417:01:16.758661 IP 10.244.1.0 &gt; 10.244.2.195: ICMP echo request, id 2, seq 40, length 64 12345678910# tcpdump -i eth0 -nn host 10.1.87.82tcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes17:03:44.145010 IP 10.1.87.81.44247 &gt; 10.1.87.82.8472: OTV, flags [I] (0x08), overlay 0, instance 1IP 10.244.1.0 &gt; 10.244.2.195: ICMP echo request, id 3, seq 0, length 6417:03:44.145551 IP 10.1.87.82.8942 &gt; 10.1.87.81.8472: OTV, flags [I] (0x08), overlay 0, instance 1IP 10.244.2.195 &gt; 10.244.1.0: ICMP echo reply, id 3, seq 0, length 6417:03:45.145300 IP 10.1.87.81.44247 &gt; 10.1.87.82.8472: OTV, flags [I] (0x08), overlay 0, instance 1IP 10.244.1.0 &gt; 10.244.2.195: ICMP echo request, id 3, seq 1, length 6417:03:45.145854 IP 10.1.87.82.8942 &gt; 10.1.87.81.8472: OTV, flags [I] (0x08), overlay 0, instance 1 Flannel VxLANçš„Direct routingæ¨¡å¼é…ç½®12345678910111213141516171819# wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml# vim kube-flannel.yml net-conf.json: | &#123; "Network": "10.244.0.0/16", "Backend": &#123; "Type": "vxlan", "Directrouting": true # æ·»åŠ å­—æ®µ &#125; &#125;# kubectl delete -f kube-flannel.yml# kubectl apply -f kube-flannel.yml# ip route showdefault via 10.1.87.1 dev eth010.1.87.0/24 dev eth0 proto kernel scope link src 10.1.87.8010.244.0.0/24 dev cni0 proto kernel scope link src 10.244.0.110.244.1.0/24 via 10.1.87.81 dev eth010.244.2.0/24 via 10.1.87.82 dev eth010.244.3.0/24 via 10.1.87.83 dev eth0 æ³¨: åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä¸å¯ä»¥è¿™ä¹ˆåšï¼Œä¼šå½±å“åˆ°Podçš„ç½‘ç»œçŽ¯å¢ƒã€‚ç”Ÿäº§çŽ¯å¢ƒä¸€èˆ¬åœ¨ä½¿ç”¨å‰ä¼šè€ƒè™‘å¹¶åˆå§‹åŒ–å¥½ç½‘ç»œçŽ¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆä¿®æ”¹ flannel æ‰å¼€å§‹ä½¿ç”¨åˆ›å»ºPod; calico å®‰è£…ä½¿ç”¨Canal/flannel Hosted Install å®˜æ–¹æ–‡æ¡£ 12# kubectl apply -f https://docs.projectcalico.org/v3.0/getting-started/kubernetes/installation/hosted/canal/rbac.yaml# kubectl apply -f https://docs.projectcalico.org/v3.0/getting-started/kubernetes/installation/hosted/canal/canal.yaml åˆ›å»ºåç§°ç©ºé—´podSelector: {} ä¸ºç©ºæ—¶ï¼Œä»£è¡¨æ‰€æœ‰Pod1234567891011121314151617# kubectl create namespace devnamespace/dev created# kubectl create namespace prodnamespace/prod created# vim ingress-def.yamlapiVersion: networking.k8s.io/v1kind: NetworkPolicymetadata: name: deny-all-ingressspec: podSelector: &#123;&#125; policyTypes: - Ingress# kubectl apply -f ingress-def.yaml -n dev# kubectl get netpol -n devNAME POD-SELECTOR AGEdeny-all-ingress &lt;none&gt; 93s 12345678910111213# vim pod-a.yamlapiVersion: v1kind: Podmetadata: name: pod1spec: containers: - name: myapp image: ikubernetes/myapp:v1# kubectl apply -f pod-a.yaml -n dev# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod1 1/1 Running 0 54s 10.244.3.2 node03 &lt;none&gt; &lt;none&gt; è¿™æ˜¯è¯·æ±‚10.244.3.2 å‘çŽ°æ˜¯è¯·æ±‚ä¸é€šçš„ 12# curl 10.244.3.2curl: (7) Failed connect to 10.244.3.2:80; Connection timed out è€ŒæŠŠ pod-a.yaml åˆ›å»ºåœ¨prod åç§°ç©ºé—´ï¼Œæ­¤æ—¶prodåç§°ç©ºé—´æ˜¯æ²¡æœ‰å®šä¹‰çš„ 12345# kubectl apply -f pod-a.yaml -n prodpod/pod1 created# kubectl get pods -n prod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod1 1/1 Running 0 17s 10.244.3.3 node03 &lt;none&gt; &lt;none&gt;node è¯·æ±‚10.244.3.3åç§°ç©ºé—´çš„å¯ä»¥è¯·æ±‚é€š 12# curl 10.244.3.3Hello MyApp | Version: v1 | &lt;a href=&quot;hostname.html&quot;&gt;Pod Name&lt;/a&gt; å½“å…è®¸devåç§°ç©ºé—´çš„Pod éƒ½å¯ä»¥è®¿é—®æ—¶ï¼Œåªéœ€åŠ  ingress: - {} å°±å¯ä»¥äº† 12345678910111213apiVersion: networking.k8s.io/v1kind: NetworkPolicymetadata: name: deny-all-ingressspec: podSelector: &#123;&#125; ingress: - &#123;&#125; policyTypes: - Ingress# kubectl apply -f ingress-def.yaml -n dev# curl 10.244.3.2Hello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt; å®šä¹‰å…è®¸è®¿é—®ä¸€ç»„Pod,ä½¿ç”¨æ ‡ç­¾æ¥å®žçŽ° 12# kubectl label pods pod1 app=myapp -n devpod/pod1 labeled è¿˜åŽŸingress-def ä¸ºé»˜è®¤ï¼Œæ‹’ç»æ‰€æœ‰dev åç§°ç©ºé—´æ‰€æœ‰Podçš„è®¿é—® 123456789101112# vim ingress-def.yamlapiVersion: networking.k8s.io/v1kind: NetworkPolicymetadata: name: deny-all-ingressspec: podSelector: &#123;&#125; policyTypes: - Ingress# kubectl apply -f ingress-def.yaml -n dev# curl 10.244.3.2curl: (7) Failed connect to 10.244.3.2:80; Connection timed out é…ç½®æµ‹ç•¥ï¼Œå…è®¸æŸç½‘æ®µå…è®¸è®¿é—®æŒ‡å®šç­–ç•¥ 123456789101112131415161718192021222324252627# vim allow-netpol-demo.yamlapiVersion: networking.k8s.io/v1kind: NetworkPolicymetadata: name: allow-myapp-ingressspec: podSelector: matchLabels: app: myapp ingress: - from: - ipBlock: cidr: 10.244.0.0/16 except: - 10.244.1.2/32 ports: - protocol: TCP port: 80 - protocol: TCP port: 443# kubectl apply -f allow-netpol-demo.yaml -n dev# kubectl get netpol -n devNAME POD-SELECTOR AGEallow-myapp-ingress app=myapp 2mdeny-all-ingress &lt;none&gt; 34m# curl 10.244.3.2:80Hello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt; ç®¡æŽ§å‡ºç«™æµé‡çš„æ–¹å¼ 1234567891011121314151617181920212223# vim egress-def.yamlapiVersion: networking.k8s.io/v1kind: NetworkPolicymetadata: name: deny-all-egressspec: podSelector: &#123;&#125; policyTypes: - Egress# kubectl apply -f egress-def.yaml -n prodnetworkpolicy.networking.k8s.io/deny-all-egress created# kubectl apply -f pod-a.yaml -n prod # å°†ä¹‹å‰çš„pod-a.yaml åˆ›å»ºåˆ°prodåç§°ç©ºé—´pod/pod1 unchanged# kubectl get pods -n prod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod1 1/1 Running 0 34m 10.244.3.3 node03 &lt;none&gt; &lt;none&gt;node# kubectl exec pod1 -it -n prod -- /bin/sh/ # ping 10.1.87.81PING 10.1.87.81 (10.1.87.81): 56 data bytes^C--- 10.1.87.81 ping statistics ---4 packets transmitted, 0 packets received, 100% packet loss/ # 123456789101112131415161718192021# vim egress-def.yamlapiVersion: networking.k8s.io/v1kind: NetworkPolicymetadata: name: deny-all-egressspec: podSelector: &#123;&#125; egress: - &#123;&#125; policyTypes: - Egress# kubectl apply -f egress-def.yaml -n prod# kubectl exec pod1 -it -n prod -- /bin/sh/ # ping 10.1.87.81PING 10.1.87.81 (10.1.87.81): 56 data bytes64 bytes from 10.1.87.81: seq=0 ttl=63 time=0.660 ms64 bytes from 10.1.87.81: seq=1 ttl=63 time=0.564 ms^C--- 10.1.87.81 ping statistics ---2 packets transmitted, 2 packets received, 0% packet lossround-trip min/avg/max = 0.564/0.612/0.660 ms å¯ä»¥çœ‹åˆ°æ”¾è¡Œæ‰€æœ‰Podå‡ºç«™è§„åˆ™,ç½‘ç»œæ˜¯é€šçš„; ç½‘ç»œç­–ç•¥: åç§°ç©ºé—´: æ‹’ç»æ‰€æœ‰å‡ºç«™ï¼Œå…¥ç«™; æ”¾è¡Œæ‰€æœ‰å‡ºç«™ç›®æ ‡æœ¬åç§°ç©ºé—´å†…çš„æ‰€æœ‰Pod;]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesæ“ä½œè®°å½•(å››)]]></title>
    <url>%2F2019%2F05%2F22%2Fkubernetes%E5%AE%9E%E6%93%8D%E8%AE%B0%E5%BD%954%2F</url>
    <content type="text"><![CDATA[kubernetes æ“ä½œè®°å½•å›› kubernetesè®¤è¯åŠService Accountåœ¨masteræœåŠ¡å™¨ä¸Šå¯åŠ¨ proxy å¹¶ç›‘å¬è‡³8080 12# kubectl proxy --port=8080 &amp;# curl http://localhost:8080/api/v1/namespaces ä»…æœ‰æƒé™èŽ·å–å½“å‰Podè‡ªèº«çš„ç›¸å…³ä¿¡æ¯ 1234# kubectl get secret -n ingress-nginxNAME TYPE DATA AGEdefault-token-t54dl kubernetes.io/service-account-token 3 5d23hnginx-ingress-serviceaccount-token-5dwv4 kubernetes.io/service-account-token 3 5d23h ç”Ÿæˆyamlæ¡†æž¶ï¼Œå¿«é€Ÿç¼–å†™æ¸…å• 1234567# kubectl create serviceaccount mysa -o yaml --dry-runapiVersion: v1kind: ServiceAccountmetadata: creationTimestamp: null name: mysa# kubectl get pods myapp-deploy-675558bfc5-2rfrs -o yaml --export 1234567891011121314151617# kubectl create serviceaccount admin# kubectl describe sa adminName: adminNamespace: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Image pull secrets: &lt;none&gt;Mountable secrets: admin-token-hxqqfTokens: admin-token-hxqqfEvents: &lt;none&gt;# kubectl get secretNAME TYPE DATA AGEadmin-token-hxqqf kubernetes.io/service-account-token 3 66sdefault-token-2sgn5 kubernetes.io/service-account-token 3 26dmysql-root-password Opaque 1 45htomcat-ingress-secret kubernetes.io/tls 2 5d22h 12345678910111213141516171819202122# vim pod-sa-demo.yamlapiVersion: v1kind: Podmetadata: name: pod-sa-demo namespace: default labels: app: myapp tier: frontend annotations: ssjinyao.com/create-by: "cluster admin"spec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80 serviceAccountName: admin# kubectl apply -f pod-sa-demo.yaml# kubectl describe pods pod-sa-demo | grep 'SecretName' SecretName: admin-token-hxqqf kubernetes é›†ç¾¤æœ‰ä¸¤ç±»è®¤è¯æ—¶çš„ç”¨æˆ·è´¦å·useraccount,æˆ‘ä»¬ç§°ä¹‹ä¸ºç”¨æˆ·è´¦å·ï¼Œé€šå¸¸å®šä¹‰çš„æ˜¯äººä½¿ç”¨çš„è´¦å·servicecacount, æœåŠ¡è´¦å·ï¼ŒæŒ‡podä¸­åº”ç”¨çš„åº”ç”¨ç¨‹åºè¿è¡Œåœ¨kubernetes ï¼Œæƒ³è®¿é—®apiserveræ—¶ç”¨çš„è®¤è¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åå¯†ç ç­‰ç­‰; 1234567891011121314151617181920# kubectl config viewapiVersion: v1clusters:- cluster: certificate-authority-data: DATA+OMITTED server: https://10.1.87.80:6443 name: kubernetescontexts:- context: cluster: kubernetes user: kubernetes-admin name: kubernetes-admin@kubernetescurrent-context: kubernetes-admin@kuberneteskind: Configpreferences: &#123;&#125;users:- name: kubernetes-admin user: client-certificate-data: REDACTED client-key-data: REDACTED 12345678910111213141516171819202122/etc/kubernetes/pki# (umask 077; openssl genrsa -out ssjinyao.key 2048)# openssl req -new -key ssjinyao.key -out ssjinyao.csr -subj "/CN=ssjinyao"# openssl x509 -req -in ssjinyao.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out ssjinyao.crt -days 36500Signature oksubject=/CN=ssjinyaoGetting CA Private Key# openssl x509 -in ssjinyao.crt -text -nooutCertificate: Data: Version: 1 (0x0) Serial Number: f3:fe:ff:e5:0e:0b:37:e2 Signature Algorithm: sha256WithRSAEncryption Issuer: CN=kubernetes Validity Not Before: May 22 07:57:01 2019 GMT Not After : Apr 28 07:57:01 2119 GMT Subject: CN=ssjinyao Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) æŽ¥ä¸‹æ¥æŠŠç”¨æˆ·è´¦å·ä¿¡æ¯æ·»åŠ åˆ°è¿žæŽ¥kubernetes çš„é…ç½®ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# kubectl config set-credentials ssjinyao --client-certificate=./ssjinyao.crt --client-key=./ssjinyao.key --embed-certs=trueUser "ssjinyao" set.# kubectl config viewapiVersion: v1clusters:- cluster: certificate-authority-data: DATA+OMITTED server: https://10.1.87.80:6443 name: kubernetescontexts:- context: cluster: kubernetes user: kubernetes-admin name: kubernetes-admin@kubernetescurrent-context: kubernetes-admin@kuberneteskind: Configpreferences: &#123;&#125;users:- name: kubernetes-admin user: client-certificate-data: REDACTED client-key-data: REDACTED- name: ssjinyao user: client-certificate: /etc/kubernetes/pki/ssjinyao.crt client-key: /etc/kubernetes/pki/ssjinyao.key# kubectl config set-context ssjinyao@kubernetes --cluster=kueberntes --user=ssjinyaoContext "ssjinyao@kubernetes" created.# kubectl config viewapiVersion: v1clusters:- cluster: certificate-authority-data: DATA+OMITTED server: https://10.1.87.80:6443 name: kubernetescontexts:- context: cluster: kubernetes user: kubernetes-admin name: kubernetes-admin@kubernetes- context: cluster: kueberntes user: ssjinyao name: ssjinyao@kubernetescurrent-context: kubernetes-admin@kuberneteskind: Configpreferences: &#123;&#125;users:- name: kubernetes-admin user: client-certificate-data: REDACTED client-key-data: REDACTED- name: ssjinyao user: client-certificate: /etc/kubernetes/pki/ssjinyao.crt client-key: /etc/kubernetes/pki/ssjinyao.key è¿™æ—¶å€™å¤šäº†ä¸€ä¸ªcontext, å¯åˆ‡æ¢ç”¨æˆ· 12# kubectl config use-context ssjinyao@kubernetesSwitched to context &quot;ssjinyao@kubernetes&quot;. 1234567891011121314# kubectl config set-cluster mycluster --kubeconfig=/tmp/test.conf --server=&quot;https://10.1.87.80:6443&quot; --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=trueCluster &quot;mycluster&quot; set.# kubectl config view --kubeconfig=/tmp/test.confapiVersion: v1clusters:- cluster: certificate-authority-data: DATA+OMITTED server: https://10.1.87.80:6443 name: myclustercontexts: []current-context: &quot;&quot;kind: Configpreferences: &#123;&#125;users: [] RBACæŽˆæƒæ’ä»¶: Node, ABAC,RBAC,Webhook(åŸºäºŽhttpçš„å›žè°ƒæ¥å®žçŽ°)RBAC: Role-based AC è§’è‰² (role)è®¸å¯ (permission) role: operations,objectsrolebinding: user account OR service account , roleclusterrole: clusterrolebinding æ“ä½œ: GET HEAD PUT PUST PATCH DELETE role bindingå®šä¹‰ 123456789101112131415161718192021222324252627282930313233343536373839404142# kubectl create role pods-reader --verb=get,list,watch --resource=pods --dry-run -o yaml &gt; role-demo.yaml# vim role-demo.yamlapiVersion: rbac.authorization.k8s.io/v1kind: Rolemetadata: creationTimestamp: null name: pods-reader namespace: defaultrules:- apiGroups: - "" resources: - pods verbs: - get - list - watch# kubectl apply -f role-demo.yaml# kubectl describe role pods-readerName: pods-readerLabels: &lt;none&gt;Annotations: kubectl.kubernetes.io/last-applied-configuration: &#123;"apiVersion":"rbac.authorization.k8s.io/v1","kind":"Role","metadata":&#123;"annotations":&#123;&#125;,"creationTimestamp":null,"name":"pods-reader","nam...PolicyRule: Resources Non-Resource URLs Resource Names Verbs --------- ----------------- -------------- ----- pods [] [] [get list watch]# kubectl create rolebinding ssjinyao-read-pods --role=pods-reader --user=ssjinyao --dry-run -o yaml &gt; rolebinding-demo.yaml# vim rolebinding-demo.yamlapiVersion: rbac.authorization.k8s.io/v1kind: RoleBindingmetadata: creationTimestamp: null name: ssjinyao-read-podsroleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: pods-readersubjects:- apiGroup: rbac.authorization.k8s.io kind: User name: ssjinyao clusterrole binding å®šä¹‰ 1234# useradd ik8s# cp -a .kube/ /home/ik8s/# chown -R ik8s.ik8s /home/ik8s/# 123456789101112131415161718# kubectl config use-context kubernetes-admin@kubernetes# kubectl create clusterrole cluster-reader --verb=get,list,watch --resource=pods -o yaml --dry-run &gt; clusterrole-demo.yaml# vim clusterrole-demo.yaml kind: ClusterRolemetadata: name: cluster-readerrules:- apiGroups: - "" resources: - pods verbs: - get - list - watch# kubectl apply -f clusterrole-demo.yamlclusterrole.rbac.authorization.k8s.io/cluster-reader created# kubectl create clusterrolebinding ssjinyao-read-all-pods --clusterrole=cluster-reader --user=ssjinyao --dry-run -o yaml &gt; clusterrolebind-demo.yaml cluster-role è¢« rolebinding ä¼šä½¿çš„cluster è¢«é™çº§ 1# kubectl create rolebinding ssjinyao-read-pods --clusterrole=cluster-reader --user=ssjinayo --dry-run -o yaml &gt; rolebinding-clusterrole-demo.yaml æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤çš„æŽˆæƒå¼•ç”¨æŽˆæƒ 123# kubectl get clusterrole admin -o yaml# kubectl create rolebinding default-ns-admin --clusterrole=admin --user=ssjinyaorolebinding.rbac.authorization.k8s.io/default-ns-admin created dashboard åŠè®¤è¯åˆ†çº§æŽˆæƒéƒ¨ç½² dashboard 1# kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml éƒ¨ç½²æ—¶ä¸‹è½½é•œåƒå‡ºé”™ 12345678910# kubectl describe pods -n kube-system kubernetes-dashboard-5f7b999d65-jpmhsEvents: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 113s default-scheduler Successfully assigned kube-system/kubernetes-dashboard-5f7b999d65-jpmhs to node01 Warning Failed 53s (x3 over 105s) kubelet, node01 Failed to pull image "k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1": rpc error: code = Unknown desc = Error response from daemon: Get https://k8s.gcr.io/v2/: dial tcp 74.125.203.82:443: connect: connection timed out Warning Failed 53s (x3 over 105s) kubelet, node01 Error: ErrImagePull Normal BackOff 15s (x5 over 105s) kubelet, node01 Back-off pulling image "k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1" Warning Failed 15s (x5 over 105s) kubelet, node01 Error: ImagePullBackOff Normal Pulling 2s (x4 over 112s) kubelet, 01 Pulling image "k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1" ç”¨æ‰‹åŠ¨ä¸‹è½½çš„æ–¹æ³•è¿›è¡Œè§£å†³ 123456# vim docker_install_dashboard.sh#!/bin/shdocker pull mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.1docker tag mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.1 k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1docker rmi mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.1# sh docker_install_dashboard.sh ç„¶åŽå†æ‰§è¡Œä»¥ä¸‹éƒ¨ç½²æ¸…å• 123 kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml # kubectl get pods -n kube-system | grep dashkubernetes-dashboard-5f7b999d65-fcb28 1/1 Running 0 71s å¯ä»¥çœ‹åˆ°kubernetes-dashbroad å·²ç»è¿è¡Œ é»˜è®¤æœåŠ¡æš´éœ²ä¸ºClusterIPç±»åž‹çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ”¹ä¸ºNodePort ç±»åž‹12345# kubectl patch svc kubernetes-dashboard -p '&#123;"spec":&#123;"type":"NodePort"&#125;&#125;' -n kube-system# kubectl get svc -n kube-system\NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEkube-dns ClusterIP 10.96.0.10 &lt;none&gt; 53/UDP,53/TCP,9153/TCP 27dkubernetes-dashboard NodePort 10.109.190.204 &lt;none&gt; 443:31984/TCP 3m41s è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°ç™»å½•ç•Œé¢ ä½¿ç”¨ç”¨tokenå®žçŽ°è®¤è¯ç™»å½•è¿™é‡Œç™»å½•éœ€è¦çš„æ˜¯serviceaccountç”¨æˆ·ï¼Œ æ‰€ä»¥è¿™é‡Œåˆ›å»º serviceaccount 1234# kubectl create serviceaccount dashboard-admin -n kube-systemserviceaccount/dashboard-admin created # kubectl get sa -n kube-system | grep dashdashboard-admin 1 6m33s serviceaccount åˆ›å»ºå¥½åŽï¼Œ éœ€è¦å°†serviceaccountç»‘å®šclusterè¿™ä¸ªè§’è‰²ä¸Š 1234# kubectl create clusterrolebinding dashboard-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-adminclusterrolebinding.rbac.authorization.k8s.io/dashboard-cluster-admin created# kubectl get secret -n kube-system | grep dashdashboard-admin-token-grj84 kubernetes.io/service-account-token 3 5m46s ç»‘å®šå¥½ cluster åŽï¼Œ æŸ¥çœ‹tokenä¿¡æ¯ï¼Œå¹¶æ‹¿tokenè¿›è¡Œç™»å½• 1# kubectl describe secret -n kube-system dashboard-admin-token-grj84 ç™»å½•åŽï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªkubernetesé›†ç¾¤çš„æ¦‚å†µ å»ºç«‹ä¸“ç”¨dashboradç”¨æˆ· 123456789# cd /etc/kubernetes/pki/# (umask 077; openssl genrsa -out dashboard.key 2048)# openssl req -new -key dashboard.key -out dashboard.csr -subj "/O=ssjinyao/CN=dashboard"# openssl x509 -req -in dashboard.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out dashboard.crt -days 3650Signature oksubject=/O=ssjinyao/CN=dashboardGetting CA Private Key# kubectl create secret generic dashboard-cert -n kube-system --from-file=dashboard.crt=./dashboard.crt --from-file=dashboard.key=./dashboard.keysecret/dashboard-cert created 12# kubectl create serviceaccount def-ns-admin -n defaultserviceaccount/def-ns-admin created role binding åˆ° default åç§°ç©ºé—´ï¼Œåªå…è®¸è®¿é—®default åç§°ç©ºé—´ 123# kubectl create rolebinding def-ns-admin --clusterrole=admin --serviceaccount=default:def-ns-adminrolebinding.rbac.authorization.k8s.io/def-ns-admin created# kubectl describe secret admin-token-hxqqf # æŸ¥çœ‹ tokenä¿¡æ¯ç™»å½• æŽ¥ä¸‹æ¥é…ç½®kube config æ–‡ä»¶è®¤è¯ 1234567891011121314# kubectl config set-cluster kubernetes --certificate-authority=./ca.crt --server="https://10.1.87.80:6443" --embed-certs=true --kubeconfig=/root/def-ns-admin.confCluster "kubernetes" set.# kubectl config view --kubeconfig=/root/def-ns-admin.confapiVersion: v1clusters:- cluster: certificate-authority-data: DATA+OMITTED server: https://10.1.87.80:6443 name: kubernetescontexts: []current-context: ""kind: Configpreferences: &#123;&#125;users: [] 12345# CLUSTER_ADMIN_TOKEN=$(kubectl get secret -n kube-system dashboard-admin-token-grj84 -o jsonpath=&#123;.data.token&#125; | base64 -d )# kubectl config set-credentials dashboard-cluster-admin --token=$CLUSTER_ADMIN_TOKEN --kubeconfig=/root/def-ns-admin.confUser "dashboard-cluster-admin" set.# kubectl config set-context dashboard-cluster-admin@kubernetes --cluster=kubernetes --user=dashboard-cluster-admin --kubeconfig=/root/def-ns-admin.conf# kubectl config use-context dashboard-cluster-admin@kubernetes --kubeconfig=/root/def-ns-admin.conf å°†ç”Ÿæˆçš„confæ–‡ä»¶è¿œç¨‹å¤åˆ¶åˆ°æ¡Œé¢ä¸Š 1ssjinyao âž¤ scp root@10.1.87.80:/root/def-ns-admin.conf ~/Desktop æ­¤æ—¶ä½¿ç”¨å¯ä»¥ç”¨ kubeconfig æ¥ç™»å½•dashboard äº†]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesæ“ä½œè®°å½•(ä¸‰)]]></title>
    <url>%2F2019%2F05%2F17%2Fkubernets%E5%AE%9E%E6%93%8D%E8%AE%B0%E5%BD%953%2F</url>
    <content type="text"><![CDATA[kubernetes æ“ä½œè®°å½•ä¸‰ å­˜å‚¨å·emptyDir1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# vim pod-vol-demo.yaml apiVersion: v1kind: Podmetadata: name: pod-demo namespace: default labels: app: myapp tier: frontend annotations: ssjinyao.com/create-by: "cluster admin"spec: containers: - name: myapp image: ikubernetes/myapp:v1 imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 volumeMounts: - name: html mountPath: /data/www/html command: ["/bin/sh"] args: ["-c" , "httpd -h /data/www/html &amp;&amp; sleep 300000"] - name: busybox image: busybox:latest imagePullPolicy: IfNotPresent volumeMounts: - name: html mountPath: /data/ command: ["/bin/sh"] args: [ "-c", "while sleep 2 ; do echo $(date) &gt;&gt; /data/index.html; done"] volumes: - name: html emptyDir: &#123;&#125;# kubectl exec -it pod-demo -c busybox -- /bin/sh/ # echo $(date) &gt;&gt; /data/index.html/ # cat /data/index.htmlFri May 17 06:59:59 UTC 2019# kubectl exec -it pod-demo -c myapp -- /bin/sh/ # ls /data/web/html/index.html/data/web/html/index.html/ # cat /data/web/html/index.htmlFri May 17 06:59:59 UTC 2019# curl 10.244.2.183Fri May 17 07:33:24 UTC 2019Fri May 17 07:33:26 UTC 2019Fri May 17 07:33:28 UTC 2019Fri May 17 07:33:30 UTC 2019Fri May 17 07:33:32 UTC 2019Fri May 17 07:33:34 UTC 2019Fri May 17 07:33:36 UTC 2019Fri May 17 07:33:38 UTC 2019Fri May 17 07:33:40 UTC 2019Fri May 17 07:33:42 UTC 2019Fri May 17 07:33:44 UTC 2019 hostPathæŒ‚è½½ä½¿ç”¨12345678910111213141516171819# vim pod-hostpath-vol.yamlapiVersion: v1kind: Podmetadata: name: pod-vol-hostpath namespace: defaultspec: containers: - name: myapp image: ikubernets/myapp:v1 volumeMounts: - name: html mountPath: /usr/share/nginx/html/ volumes: - name: html hostPath: path: /data/pod/volume1 type: DirectoryOrCreate# kubectl apply -f pod-hostpath-vol.yaml node1,node2,node3 åˆ†åˆ«åˆ›å»ºä»¥ä¸‹ç›®å½• 123456# mkdir -p /data/pod/volume1/ #æ³¨ä¸‰ä¸ªèŠ‚ç‚¹éƒ½è¦æ‰§è¡Œ# echo "node1.ssjinyao.com" &gt;&gt; /data/pod/volume1/index.html# echo "node2.ssjinyao.com" &gt;&gt; /data/pod/volume1/index.html# echo "node3.ssjinyao.com" &gt;&gt; /data/pod/volume1/index.html# curl 10.244.1.155node1.ssjinyao.com å¯ä»¥çœ‹å‡ºå½“å‰è¿è¡Œåœ¨node1èŠ‚ç‚¹ä¸Š nfs å·æŒ‚è½½ä½¿ç”¨é€‰æ‹©ä¸€å°æœåŠ¡å™¨ï¼Œå®‰è£…å¹¶å¼€å¯nfs æœåŠ¡ 12345# mkdir -pv /data/volumes# yum -y install nfs nfs-utils # vim /etc/exports/data/volumes 10.1.87.83/24(rw,no_root_squash)# systemctl start nfs æ³¨: å…¶å®ƒèŠ‚ç‚¹ä¹Ÿéœ€è¦å®‰è£… nfs-utils ä¸ç„¶podé©±åŠ¨ä¸äº† åœ¨node02ä¸Šæ‰‹åŠ¨æµ‹è¯•æŒ‚è½½ 1# mount -t nfs node03:/data/volumes/ /mnt åœ¨kubernetes é›†ç¾¤ä¸­ä½¿ç”¨nfs volumes 123456789101112131415161718apiVersion: v1kind: Podmetadata: name: pod-vol-nfs namespace: defaultspec: containers: - name: myapp image: ikubernetes/myapp:v1 volumeMounts: - name: html mountPath: /usr/share/nginx/html/ volumes: - name: html nfs: path: /data/volumes server: node03# kubectl apply -f pod-vol-nfs.yaml åœ¨nfsæœåŠ¡å™¨ä¸Šå†™å…¥æ•°æ® 1# echo "&lt;h1&gt;nfs.ssjinyao.com&lt;/h1&gt;" &gt;&gt; /data/volumes/index.html å°è¯•è®¿é—® 12# curl 10.244.2.185&lt;h1&gt;nfs.ssjinyao.com&lt;/h1&gt; pv, pvc çš„ä½¿ç”¨nfs æœåŠ¡å™¨ä¸Šåˆ›å»ºå¤šä¸ªç›®å½• 1234567891011121314# mkdir /data/volumes/v&#123;1,2,3,4,5&#125;# vim /etc/exports/data/volumes/v1 10.1.87.83/24(rw,no_root_squash)/data/volumes/v2 10.1.87.83/24(rw,no_root_squash)/data/volumes/v3 10.1.87.83/24(rw,no_root_squash)/data/volumes/v4 10.1.87.83/24(rw,no_root_squash)/data/volumes/v5 10.1.87.83/24(rw,no_root_squash)# exportfs -arvexporting 10.1.87.83/24:/data/volumes/v5exporting 10.1.87.83/24:/data/volumes/v4exporting 10.1.87.83/24:/data/volumes/v3exporting 10.1.87.83/24:/data/volumes/v2exporting 10.1.87.83/24:/data/volumes/v1# systemctl restart nfs 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778# vim pv-demo.yamlapiVersion: v1kind: PersistentVolumemetadata: name: pv01 labels: name: pv001spec: nfs: path: /data/volumes/v1 server: node03 accessModes: ["ReadWriteMany","ReadWriteOnce"] capacity: storage: 5Gi---apiVersion: v1kind: PersistentVolumemetadata: name: pv02 labels: name: pv002spec: nfs: path: /data/volumes/v2 server: node03 accessModes: ["ReadWriteOnce"] capacity: storage: 10Gi---apiVersion: v1kind: PersistentVolumemetadata: name: pv03 labels: name: pv003spec: nfs: path: /data/volumes/v3 server: node03 accessModes: ["ReadWriteMany","ReadWriteOnce"] capacity: storage: 20Gi---apiVersion: v1kind: PersistentVolumemetadata: name: pv04 labels: name: pv004spec: nfs: path: /data/volumes/v4 server: node03 accessModes: ["ReadWriteMany","ReadWriteOnce"] capacity: storage: 10Gi---apiVersion: v1kind: PersistentVolumemetadata: name: pv05 labels: name: pv005spec: nfs: path: /data/volumes/v5 server: node03 accessModes: ["ReadWriteMany","ReadWriteOnce"] capacity: storage: 10Gi---# kubectl get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGEpv01 5Gi RWO,RWX Retain Available 74spv02 10Gi RWO Retain Available 74spv03 20Gi RWO,RWX Retain Available 74spv04 10Gi RWO,RWX Retain Available 74spv05 10Gi RWO,RWX Retain Available 74s pvc ç»‘å®š pv 123456789101112131415161718192021222324252627282930313233343536373839# cat pod-vol-pvc.yamlapiVersion: v1kind: PersistentVolumeClaimmetadata: name: mypvc namespace: defaultspec: accessModes: ["ReadWriteMany"] resources: requests: storage: 11Gi---apiVersion: v1kind: Podmetadata: name: pod-vol-pvc namespace: defaultspec: containers: - name: myapp image: ikubernetes/myapp:v1 volumeMounts: - name: html mountPath: /usr/share/nginx/html/ volumes: - name: html persistentVolumeClaim: claimName: mypvc# kubectl apply -f pod-vol-pvc.yaml# kubectl get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGEpv01 5Gi RWO,RWX Retain Available 40mpv02 10Gi RWO Retain Available 40mpv03 20Gi RWO,RWX Retain Bound default/mypvc 40mpv04 10Gi RWO,RWX Retain Available 40mpv05 10Gi RWO,RWX Retain Available 40m# kubectl get pvcNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGEmypvc Bound pv03 20Gi RWO,RWX 8s configmap çš„ä½¿ç”¨1234567891011121314151617181920# kubectl create configmap nginx-config --from-literal=nginx_port=80 --from-literal=server_name=myapp.ssjinyao.comconfigmap/nginx-config created# kubectl get cmNAME DATA AGEnginx-config 2 25s# kubectl describe cm nginx-configName: nginx-configNamespace: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Data====nginx_port:----80server_name:----myapp.ssjinyao.comEvents: &lt;none&gt; 123456789101112131415161718192021222324252627# mkdir configmap# cd configmap/# vim www.confserver &#123; server_name myapp.ssjinyao.com; listen 80; root /data/web/html/;&#125;# kubectl create configmap nginx-www --from-file=./www.conf# kubectl get cmNAME DATA AGEnginx-config 2 4m4snginx-www 1 3s# kubectl get cm nginx-www -o yamlapiVersion: v1data: www.conf: "server &#123;\n\tserver_name myapp.ssjinyao.com;\n listen 80;\n root /data/web/html/;\n\n&#125;\n"kind: ConfigMapmetadata: creationTimestamp: "2019-05-20T08:17:37Z" name: nginx-www namespace: default resourceVersion: "3462936" selfLink: /api/v1/namespaces/default/configmaps/nginx-www uid: ba1625a7-7ad7-11e9-8902-525400c45563 Pod å¼•ç”¨ configmap ï¼ŒçŽ¯å¢ƒå˜é‡æ–¹å¼ 1234567891011121314151617181920212223242526272829303132333435# vim pod-configmap.yamlapiVersion: v1kind: Podmetadata: name: pod-cm-1 namespace: default labels: app: myapp tier: frontend annotations: ssjinyao.com/create-by: "cluster admin"spec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80 env: - name: NGINX_SERVER_PORT valueFrom: configMapKeyRef: name: nginx-config key: nginx_port - name: NGINX_SERVER_NAME valueFrom: configMapKeyRef: name: nginx-config key: server_name# kubectl apply -f pod-configmap.yamlpod/pod-cm-1 created# kubectl exec pod-cm-1 -it -- /bin/sh/ # printenv | grep NGINX_SERVERNGINX_SERVER_PORT=80NGINX_SERVER_NAME=myapp.ssjinyao.com å½“çŽ¯å¢ƒå˜é‡èŽ·å–æ—¶ï¼Œå®¹å™¨çš„å˜é‡ä¸æ˜¯å®žæ—¶æ›´æ–°çš„ 123456789101112131415161718192021222324# kubectl edit cm nginx-configconfigmap/nginx-config edited# å°†nginx_port: "80" æ”¹å˜ nginx_port: "8080"# å¯ä»¥çœ‹åˆ°configmap æ˜¯å®žæ—¶ç”Ÿæ•ˆçš„# kubectl describe cm nginx-configName: nginx-configNamespace: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Data====nginx_port:----8080server_name:----myapp.ssjinyao.comEvents: &lt;none&gt;# è€Œå®¹å™¨ä¸­åˆ™ä¸ä¼šæ—¶å®žæ›´æ–°å˜é‡# kubectl exec pod-cm-1 -it -- /bin/sh/ # printenv | grep NGINX_SERVERNGINX_SERVER_PORT=80NGINX_SERVER_NAME=myapp.ssjinyao.com å­˜å‚¨å·æŒ‚è½½æ–¹å¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# vim pod-configmap2.yamlapiVersion: v1kind: Podmetadata: name: pod-cm-2 namespace: default labels: app: myapp tier: frontend annotations: ssjinyao.com/create-by: "cluster admin"spec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80 volumeMounts: - name: nginxconf mountPath: /etc/nginx/config.d/ readOnly: true volumes: - name: nginxconf configMap: name: nginx-config# kubectl apply -f pod-configmap2.yamlpod/pod-cm-2 created# kubectl exec pod-cm-2 -it -- /bin/sh/ # cd /etc/nginx/confconf.d/ config.d// # cd /etc/nginx/config.d//etc/nginx/config.d # lsnginx_port server_name/etc/nginx/config.d # cat nginx_port8080/etc/nginx/config.d #/etc/nginx/config.d # cat server_namemyapp.ssjinyao.com/etc/nginx/config.d ## kubectl edit cm nginx-configconfigmap/nginx-config edited# å°†nginx_port: "8080" æ”¹ä¸º nginx_port: "8088" # ç¨ç­‰ç‰‡åˆ»åŽï¼ŒæŽ¥å…¥å®¹å™¨å‘çŽ°nginx_portå€¼å®žæ—¶æ›´æ–°# kubectl edit cm nginx-configEdit cancelled, no changes made.[root@bj-zb-vm-ops-test5 configmap]# kubectl exec pod-cm-2 -it -- /bin/sh/ # cd /etc/nginx/config.d//etc/nginx/config.d # cat nginx_port8088/etc/nginx/config.d # æ¡ˆä¾‹,é…ç½®æ–‡ä»¶ç„™è¿›é•œåƒ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354# vim pod-configmap3.yaml# kubectl apply -f pod-configmap3.yamlapiVersion: v1kind: Podmetadata: name: pod-cm-3 namespace: default labels: app: myapp tier: frontend annotations: ssjinyao.com/create-by: "cluster admin"spec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80 volumeMounts: - name: nginxconf mountPath: /etc/nginx/conf.d/ readOnly: true volumes: - name: nginxconf configMap: name: nginx-www# kubectl exec pod-cm-3 -it -- /bin/sh/ # cd /etc/nginx/conf.d//etc/nginx/conf.d # cat www.confserver &#123; server_name myapp.ssjinyao.com; listen 80; root /data/web/html/;&#125;# kubectl edit cm nginx-wwwconfigmap/nginx-www edited# å°† listen 80 æ”¹ä¸º listen 8080ï¼Œç¨ç­‰ç‰‡åˆ»åŽæŽ¥å…¥å®¹å™¨æŸ¥çœ‹é…ç½®# kubectl exec pod-cm-3 -it -- /bin/sh/ # cd /etc/nginx/conf.d//etc/nginx/conf.d # cat www.confserver &#123; server_name myapp.ssjinyao.com; listen 8080; root /data/web/html/;&#125;# echo "&lt;h1&gt; Nginx Server Configured by CM &lt;/h1&gt;" &gt; /data/web/html/index.html# è¯´æ˜Žé…ç½®æ–‡ä»¶ç„™è¿›é•œåƒçš„æ–¹å¼æ˜¯å¯ä»¥å®žæ—¶æ›´æ–°çš„;å½“ç„¶é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼Œéœ€è¦nginx -s reload# vim /etc/hosts åŠ å…¥æœ¬åœ°è§£æžè‡³Pod ip10.244.1.158 myapp.ssjinyao.com# curl http://myapp.ssjinyao.com:8080&lt;h1&gt; Nginx Server Configured by CM &lt;/h1&gt; secret çš„ä½¿ç”¨configmap éƒ½æ˜¯æ˜Žæ–‡å­˜æ•°æ®çš„ï¼Œç§é’¥å’Œè¯ä¹¦è¦æ”¾åœ¨secretä¸­ï¼Œå¯†ç è¦å†™æˆdns secret è€Œéžconfigamp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# kubectl create secret generic mysql-root-password --from-literal=passwod=H@ndih3secret/mysql-root-password created# kubectl get secretNAME TYPE DATA AGEdefault-token-2sgn5 kubernetes.io/service-account-token 3 24dmysql-root-password Opaque 1 45stomcat-ingress-secret kubernetes.io/tls 2 4d# kubectl describe secret mysql-root-passwordName: mysql-root-passwordNamespace: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Type: OpaqueData====passwod: 7 bytes# å¯¹æ¯”configmap çš„Dataæ•°æ®ï¼Œsecret å€¼æ˜¯ä¸æ˜¾ç¤ºçš„# kubectl describe configmap nginx-wwwName: nginx-wwwNamespace: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Data====www.conf:----server &#123; server_name myapp.ssjinyao.com; listen 8080; root /data/web/html/;&#125;Events: &lt;none&gt;# è€Œ configmap Dataçš„å€¼æ˜¯æ˜¾ç¤ºçš„# æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·çœ‹# kubectl get secret mysql-root-password -o yamlapiVersion: v1data: passwod: SEBuZGloMw==kind: Secretmetadata: creationTimestamp: "2019-05-20T09:20:53Z" name: mysql-root-password namespace: default resourceVersion: "3469600" selfLink: /api/v1/namespaces/default/secrets/mysql-root-password uid: 90cd9aaa-7ae0-11e9-8902-525400c45563type: Opaqueã€ å¯ä»¥çœ‹å‡ºæ•°æ®è¿˜æ˜¯æœ‰çš„ï¼Œå› æ­¤å®‰å…¨æ²¡æœ‰é‚£å¥½ï¼Œä¹Ÿæ²¡æœ‰åŠ å¯†ç çš„æ„ä¹‰å¯ä»¥ç›´æŽ¥ç”¨ base64 -d è¿›è¡Œè§£å¯† 12# echo SEBuZGloMw== | base64 -dH@ndih3 123456789101112131415161718192021222324# vim pod-secret-1.yamlapiVersion: v1kind: Podmetadata: name: pod-secret-1 namespace: default labels: app: myapp tier: frontend annotations: ssjinyao.com/create-by: "cluster admin"spec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80 env: - name: MYSQL_ROOT_PASSWORD valueFrom: secretKeyRef: name: mysql-root-password key: passwod 12# kubectl exec pod-secret-1 -- printenv | grep MYSQLMYSQL_ROOT_PASSWORD=H@ndih3 statefulset çš„ä½¿ç”¨nfsæœåŠ¡å™¨è¿˜æ˜¯åœ¨node3 ä¸Šï¼Œé…ç½®ä¿¡æ¯å¦‚ä¸‹ 123456# cat /etc/exports/data/volumes/v1 10.1.87.83/24(rw,no_root_squash)/data/volumes/v2 10.1.87.83/24(rw,no_root_squash)/data/volumes/v3 10.1.87.83/24(rw,no_root_squash)/data/volumes/v4 10.1.87.83/24(rw,no_root_squash)/data/volumes/v5 10.1.87.83/24(rw,no_root_squash) æ³¨ï¼šç¡®ä¿ä¸‰å°nodeæœåŠ¡å™¨éƒ½å®‰è£…äº† nfs-utils pvæ”¹åŠ¨åŠåˆ›å»º 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172# cat volumes/pv-demo.yamlapiVersion: v1kind: PersistentVolumemetadata: name: pv01 labels: name: pv001spec: nfs: path: /data/volumes/v1 server: node03 accessModes: ["ReadWriteMany","ReadWriteOnce"] capacity: storage: 5Gi---apiVersion: v1kind: PersistentVolumemetadata: name: pv02 labels: name: pv002spec: nfs: path: /data/volumes/v2 server: node03 accessModes: ["ReadWriteOnce"] capacity: storage: 5Gi---apiVersion: v1kind: PersistentVolumemetadata: name: pv03 labels: name: pv003spec: nfs: path: /data/volumes/v3 server: node03 accessModes: ["ReadWriteMany","ReadWriteOnce"] capacity: storage: 5Gi---apiVersion: v1kind: PersistentVolumemetadata: name: pv04 labels: name: pv004spec: nfs: path: /data/volumes/v4 server: node03 accessModes: ["ReadWriteMany","ReadWriteOnce"] capacity: storage: 10Gi---apiVersion: v1kind: PersistentVolumemetadata: name: pv05 labels: name: pv005spec: nfs: path: /data/volumes/v5 server: node03 accessModes: ["ReadWriteMany","ReadWriteOnce"] capacity: storage: 10Gi---# kubectl apply -f volumes/pv-demo.yaml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879# vim stateful-demo.yamlapiVersion: v1kind: Servicemetadata: name: myapp labels: app: myappspec: ports: - port: 80 name: web clusterIP: None selector: app: myapp-pod---apiVersion: apps/v1kind: StatefulSetmetadata: name: myappspec: serviceName: myapp replicas: 3 selector: matchLabels: app: myapp-pod template: metadata: labels: app: myapp-pod spec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - containerPort: 80 name: web volumeMounts: - name: myappdata mountPath: /usr/share/nginx/html volumeClaimTemplates: - metadata: name: myappdata spec: accessModes: ["ReadWriteOnce"] resources: requests: storage: 5Gi# kubectl get podsNAME READY STATUS RESTARTS AGEclient 1/1 Running 0 23dmyapp-0 1/1 Running 0 7m10smyapp-1 1/1 Running 0 7m5smyapp-2 1/1 Running 0 7m1s# kubectl get stsNAME READY AGEmyapp 3/3 7m32s# kubectl get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGEpv01 5Gi RWO,RWX Retain Bound default/myappdata-myapp-1 8m12spv02 5Gi RWO Retain Bound default/myappdata-myapp-0 8m12spv03 5Gi RWO,RWX Retain Bound default/myappdata-myapp-2 8m12spv04 10Gi RWO,RWX Retain Available 8m12spv05 10Gi RWO,RWX Retain Available 8m12s# kubectl exec -it myapp-0 -- /bin/sh/ # nslookup myapp-0.myapp.default.svc.cluster.localnslookup: can't resolve '(null)': Name does not resolveName: myapp-0.myapp.default.svc.cluster.localAddress 1: 10.244.1.162 myapp-0.myapp.default.svc.cluster.local/ # nslookup myapp-1.myapp.default.svc.cluster.localnslookup: can't resolve '(null)': Name does not resolveName: myapp-1.myapp.default.svc.cluster.localAddress 1: 10.244.2.192 myapp-1.myapp.default.svc.cluster.local/ # nslookup myapp-2.myapp.default.svc.cluster.localnslookup: can't resolve '(null)': Name does not resolveName: myapp-2.myapp.default.svc.cluster.localAddress 1: 10.244.3.172 myapp-2.myapp.default.svc.cluster.local pod æ•°é‡æ‰©å±• 1234567891011# kubectl scale sts myapp --replicas=5statefulset.apps/myapp scaled# kubectl patch sts myapp -p '&#123;"spec":&#123;"replicas":2&#125;&#125;'statefulset.apps/myapp patched# kubectl patch sts myapp -p '&#123;"spec":&#123;"updateStrategy":&#123;"rollingUpdate":&#123;"partition":4&#125;&#125;&#125;&#125;'statefulset.apps/myapp patched# kubectl set image sts/myapp myapp=ikubernetes/myapp:v2statefulset.apps/myapp image updated# kubectl get sts -o wideNAME READY AGE CONTAINERS IMAGESmyapp 2/2 53m myapp ikubernetes/myapp:v2]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesæ“ä½œè®°å½•(äºŒ)]]></title>
    <url>%2F2019%2F05%2F10%2Fkubernetes%E5%AE%9E%E6%93%8D%E8%AE%B0%E5%BD%952%2F</url>
    <content type="text"><![CDATA[kubernetes æ“ä½œè®°å½•äºŒ Kubernetes Pod æŽ§åˆ¶å™¨Replica Set(RS) kubernetes æ–°ä¸€ä»£çš„Pod controller1234567891011121314151617181920212223242526272829303132333435363738394041424344# vim rs-demo.yamlapiVersion: apps/v1kind: ReplicaSetmetadata: name: myapp namespace: defaultspec: replicas: 2 selector: matchLabels: app: myapp release: canary template: metadata: name: myapp-pod labels: app: myapp release: canary environment: qa spec: containers: - name: myapp-container image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80# kubectl get rsNAME DESIRED CURRENT READY AGEmyapp 2 2 2 6m51s# kubectl get podsNAME READY STATUS RESTARTS AGEmyapp-5xbwq 1/1 Running 0 7m17smyapp-jdzph 1/1 Running 0 7m17s# curl 10.244.3.157Hello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;# kubectl delete pods myapp-5xbwq # kubectl get podsNAME READY STATUS RESTARTS AGEmyapp-jdzph 1/1 Running 0 10mmyapp-xg9mm 1/1 Running 0 16s# kubectl label pods pod-demo release=canary# kubectl get pods --show-labelsNAME READY STATUS RESTARTS AGE LABELSmyapp-jdzph 1/1 Running 0 31m app=myapp,environment=qa,release=canary ç²¾ç¡®æ»¡è¶³ç”¨æˆ·æœŸæœ› apply -f å£°æ˜Žå¼æ›´æ–°ï¼Œå³å¯ä»¥åˆ›å»ºï¼Œä¹Ÿå¯ä»¥æ›´æ–°12345678910111213141516171819202122232425262728293031323334353637383940# vim deploy-demo.yamlapiVersion: apps/v1kind: Deploymentmetadata: name: myapp-deploy namespace: defaultspec: replicas: 2 selector: matchLabels: app: myapp release: canary template: metadata: labels: app: myapp release: canary spec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80# kubectl apply -f deploy-demo.yaml# kubectl get deployNAME READY UP-TO-DATE AVAILABLE AGEmyapp-deploy 2/2 2 2 115s# kubectl get podsNAME READY STATUS RESTARTS AGEmyapp-deploy-67b6dfcd8-6q725 1/1 Running 0 4m39smyapp-deploy-67b6dfcd8-mshw8 1/1 Running 0 4m39s# vim deploy-demo.yamlå°† replicas: 2 æ”¹ä¸º replicas: 3# kubectl apply -f deploy-demo.yaml# kubectl get podsNAME READY STATUS RESTARTS AGEmyapp-deploy-67b6dfcd8-6q725 1/1 Running 0 6m34smyapp-deploy-67b6dfcd8-gltjz 1/1 Running 0 58smyapp-deploy-67b6dfcd8-mshw8 1/1 Running 0 6m34s å®žçŽ°æµåŠ¨æ›´æ–°1234567891011121314151617181920212223242526272829303132# vim deploy-demo.yamlimage: ikubernetes/myapp:v1 æ”¹ä¸º image: ikubernetes/myapp:v2# kubcetl apply -f deploy-demo.yaml# kubectl get pods -l app=myapp -wNAME READY STATUS RESTARTS AGEmyapp-deploy-67b6dfcd8-6q725 1/1 Running 0 3h23mmyapp-deploy-67b6dfcd8-gltjz 1/1 Running 0 3h18mmyapp-deploy-67b6dfcd8-mshw8 1/1 Running 0 3h23mmyapp-deploy-675558bfc5-89nc7 0/1 Pending 0 0smyapp-deploy-675558bfc5-89nc7 0/1 Pending 0 0smyapp-deploy-675558bfc5-89nc7 0/1 ContainerCreating 0 0smyapp-deploy-675558bfc5-89nc7 1/1 Running 0 2smyapp-deploy-67b6dfcd8-gltjz 1/1 Terminating 0 3h18mmyapp-deploy-675558bfc5-7zht2 0/1 Pending 0 0smyapp-deploy-675558bfc5-7zht2 0/1 Pending 0 0smyapp-deploy-675558bfc5-7zht2 0/1 ContainerCreating 0 0smyapp-deploy-67b6dfcd8-gltjz 0/1 Terminating 0 3h18mmyapp-deploy-675558bfc5-7zht2 1/1 Running 0 3smyapp-deploy-67b6dfcd8-6q725 1/1 Terminating 0 3h24mmyapp-deploy-675558bfc5-xjq9z 0/1 Pending 0 0smyapp-deploy-675558bfc5-xjq9z 0/1 Pending 0 0smyapp-deploy-675558bfc5-xjq9z 0/1 ContainerCreating 0 0smyapp-deploy-67b6dfcd8-gltjz 0/1 Terminating 0 3h18mmyapp-deploy-67b6dfcd8-gltjz 0/1 Terminating 0 3h18mmyapp-deploy-67b6dfcd8-6q725 0/1 Terminating 0 3h24mmyapp-deploy-675558bfc5-xjq9z 1/1 Running 0 2smyapp-deploy-67b6dfcd8-mshw8 1/1 Terminating 0 3h24mmyapp-deploy-67b6dfcd8-6q725 0/1 Terminating 0 3h24mmyapp-deploy-67b6dfcd8-6q725 0/1 Terminating 0 3h24mmyapp-deploy-67b6dfcd8-mshw8 0/1 Terminating 0 3h24mmyapp-deploy-67b6dfcd8-mshw8 0/1 Terminating 0 3h24mmyapp-deploy-67b6dfcd8-mshw8 0/1 Terminating 0 3h24m æŸ¥çœ‹ç›®å‰æ‰€æœ‰çš„replica set1234# kubectl get rs -o wideNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTORmyapp-deploy-675558bfc5 3 3 3 3m19s myapp ikubernetes/myapp:v2 app=myapp,pod-template-hash=675558bfc5,release=canarymyapp-deploy-67b6dfcd8 0 0 0 3h27m myapp ikubernetes/myapp:v1 app=myapp,pod-template-hash=67b6dfcd8,release=canary æŸ¥çœ‹åŽ†å²æ»šåŠ¨ä¿¡æ¯12345# kubectl rollout history deployment myapp-deploydeployment.extensions/myapp-deployREVISION CHANGE-CAUSE1 &lt;none&gt;2 &lt;none&gt; å®šä¹‰ä¸€ä¸ªè¡¥ä¸12345678# kubectl patch deployment myapp-deploy -p '&#123;"spec":&#123;"replicas":5&#125;&#125;'# kubectl get podsNAME READY STATUS RESTARTS AGEmyapp-deploy-675558bfc5-7zht2 1/1 Running 0 11mmyapp-deploy-675558bfc5-89nc7 1/1 Running 0 11mmyapp-deploy-675558bfc5-9nkk4 1/1 Running 0 33smyapp-deploy-675558bfc5-rbs4d 1/1 Running 0 33smyapp-deploy-675558bfc5-xjq9z 1/1 Running 0 11m 1234# kubectl patch deployment myapp-deploy -p '&#123;"spec":&#123;"strategy":&#123;"rollingUpdate":&#123;"maxSurge":1,"maxUnavailable":0&#125;&#125;&#125;&#125;'deployment.extensions/myapp-deploy patched# kubectl describe deployment myapp-deployRollingUpdateStrategy: 0 max unavailable, 1 max surge é‡‘ä¸é›€æ›´æ–°å‘å¸ƒ1234567891011121314# kubectl set image deployment myapp-deploy myapp=ikubernetes/myapp:v3 &amp;&amp; kubectl rollout pause deployment myapp-deploy # æ›´æ–°å¹¶ä¸”æš‚åœæ›´æ–°deployment.extensions/myapp-deploy image updateddeployment.extensions/myapp-deploy paused# kubectl get pods -l app=myapp -wNAME READY STATUS RESTARTS AGEmyapp-deploy-675558bfc5-7zht2 1/1 Running 0 27mmyapp-deploy-675558bfc5-89nc7 1/1 Running 0 27mmyapp-deploy-675558bfc5-9nkk4 1/1 Running 0 17mmyapp-deploy-675558bfc5-rbs4d 1/1 Running 0 17mmyapp-deploy-675558bfc5-xjq9z 1/1 Running 0 27mmyapp-deploy-7f577979c8-92tj8 0/1 Pending 0 0smyapp-deploy-7f577979c8-92tj8 0/1 Pending 0 0smyapp-deploy-7f577979c8-92tj8 0/1 ContainerCreating 0 0smyapp-deploy-7f577979c8-92tj8 1/1 Running 0 14s ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç›‘æŽ§æ›´æ–°12# kubectl rollout status deployment myapp-deployWaiting for deployment "myapp-deploy" rollout to finish: 1 out of 5 new replicas have been updated... è‹¥å‘çŽ°æ²¡æœ‰é—®é¢˜åŽç»§ç»­æ›´æ–° 1234567891011121314151617181920# kubectl rollout resume deployment myapp-deploydeployment.extensions/myapp-deploy resumed# kubectl rollout status deployment myapp-deployWaiting for deployment "myapp-deploy" rollout to finish: 1 out of 5 new replicas have been updated...Waiting for deployment spec update to be observed...Waiting for deployment spec update to be observed...Waiting for deployment "myapp-deploy" rollout to finish: 1 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 1 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 2 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 2 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 2 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 3 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 3 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 3 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 4 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 4 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 4 out of 5 new replicas have been updated...Waiting for deployment "myapp-deploy" rollout to finish: 1 old replicas are pending termination...Waiting for deployment "myapp-deploy" rollout to finish: 1 old replicas are pending termination...deployment "myapp-deploy" successfully rolled out è‹¥æ›´æ–°æ—¶å‘çŽ°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œå›žæ»šæŸ¥çœ‹å¯ä»¥å›žæ»šçš„ç‰ˆæœ¬ 123456# kubectl rollout history deployment myapp-deploydeployment.extensions/myapp-deployREVISION CHANGE-CAUSE1 &lt;none&gt;2 &lt;none&gt;3 &lt;none&gt; 12345678# kubectl rollout undo deployment myapp-deploy --to-revision=1deployment.extensions/myapp-deploy rolled back# kubectl rollout history deployment myapp-deploydeployment.extensions/myapp-deployREVISION CHANGE-CAUSE2 &lt;none&gt;3 &lt;none&gt;4 &lt;none&gt; è¿™æ—¶ç¬¬ä¸€ç‰ˆå·²ç»å›žæ»šæˆç¬¬ä¸€ç‰ˆäº† 1234# kubectl get rs -o wideNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTORmyapp-deploy-675558bfc5 0 0 0 42m myapp ikubernetes/myapp:v2 app=myapp,pod-template-hash=675558bfc5,release=canarymyapp-deploy-67b6dfcd8 5 5 5 4h6m myapp ikubernetes/myapp:v1 app=myapp,pod-template-hash=67b6dfcd8,release=canary DaemonSetDaemonSet åœ¨æ•´ä¸ªé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªè¿è¡ŒæŒ‡å®šPodçš„ä¸€ä¸ªå‰¯æœ¬ï¼Œç”¨äºŽç³»ç»Ÿçº§çš„ç®¡ç†åŠŸèƒ½æ¯”å¦‚filebeatï¼Œæ”¶é›†æ—¥å¿—çš„æœåŠ¡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354# vim ds-demo.yamlapiVersion: apps/v1kind: Deploymentmetadata: name: redis namespace: defaultspec: replicas: 1 selector: matchLabels: app: redis role: logstor template: metadata: labels: app: redis role: logstor spec: containers: - name: redis image: redis:4.0-alpine ports: - name: redis containerPort: 6379---apiVersion: apps/v1kind: DaemonSetmetadata: name: filebeat-ds namespace: defaultspec: selector: matchLabels: app: filebeat release: stable template: metadata: labels: app: filebeat release: stable spec: containers: - name: filebeat image: ikubernetes/filebeat:5.6.5-alpine env: - name: REDIS_HOST value: redis.default.svc.cluster.local - name: REDIS_LOG_LEVEL value: info# kubectl apply -f ds-demo.yaml# kubectl expose deployment redis --port=6379service/redis exposed# kubectl set image daemonsets filebeat-ds filebeat=ikubernetes/filebeat:5.6.6-alpinedaemonset.extensions/filebeat-ds image updated Kubernetes ServiceExternalName, ClusterIP, NodePort, and LoadBalancer 123456789101112131415# vim redis-svc.yamlapiVersion: v1kind: Servicemetadata: name: redis namespace: defaultspec: selector: app: redis role: logstor clusterIP: 10.96.88.88 type: ClusterIP ports: - port: 6339 targetPort: 6379 èµ„æºè®°å½•SVC_NAME.NS_NAME.DOMAIN.LTD.svc.cluster.localredis.default.svc.cluster.local 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# vim myapp-svc.yamlapiVersion: v1kind: Servicemetadata: name: myapp namespace: defaultspec: selector: app: myapp release: canary clusterIP: 10.99.99.99 type: NodePort ports: - port: 80 targetPort: 80 nodePort: 30080# kubectl get svc myappNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEmyapp NodePort 10.99.99.99 &lt;none&gt; 80:30080/TCP 4m50sssjinyao âž¤ while true; do curl 10.1.87.82:30080/hostname.html ; sleep 1 ; donemyapp-deploy-675558bfc5-5c8hnmyapp-deploy-675558bfc5-qtlqfmyapp-deploy-675558bfc5-qtlqfmyapp-deploy-675558bfc5-5c8hnmyapp-deploy-675558bfc5-qgps7myapp-deploy-675558bfc5-5c8hnmyapp-deploy-675558bfc5-qgps7myapp-deploy-675558bfc5-qgps7myapp-deploy-675558bfc5-qtlqf# æ¥è‡ªåŒä¸Šå®¢æˆ·ç«¯çš„è¯·æ±‚å‘å¾€åŒä¸€Pod# kubectl patch svc myapp -p '&#123;"spec":&#123;"sessionAffinity":"ClientIP"&#125;&#125;'service/myapp patched# kubectl describe svc myappName: myappNamespace: defaultLabels: &lt;none&gt;Annotations: kubectl.kubernetes.io/last-applied-configuration: &#123;"apiVersion":"v1","kind":"Service","metadata":&#123;"annotations":&#123;&#125;,"name":"myapp","namespace":"default"&#125;,"spec":&#123;"clusterIP":"10.99.99.99","...Selector: app=myapp,release=canaryType: NodePortIP: 10.99.99.99Port: &lt;unset&gt; 80/TCPTargetPort: 80/TCPNodePort: &lt;unset&gt; 30080/TCPEndpoints: 10.244.1.150:80,10.244.2.166:80,10.244.3.167:80Session Affinity: ClientIPExternal Traffic Policy: ClusterEvents: &lt;none&gt;ssjinyao âž¤ while true; do curl 10.1.87.82:30080/hostname.html ; sleep 1 ; donemyapp-deploy-675558bfc5-qgps7myapp-deploy-675558bfc5-qgps7myapp-deploy-675558bfc5-qgps7myapp-deploy-675558bfc5-qgps7 æ— å¤´æœåŠ¡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# vim myapp-svc-headless.yamlapiVersion: v1kind: Servicemetadata: name: myapp-svc namespace: defaultspec: selector: app: myapp release: canary clusterIP: None ports: - port: 80 targetPort: 80# kubectl apply -f myapp-svc-headless.yamlservice/myapp-svc created# dig -t A myapp-svc.default.svc.cluster.local. @10.96.0.10; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-73.el7_6 &lt;&lt;&gt;&gt; -t A myapp-svc.default.svc.cluster.local. @10.96.0.10;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 38590;; flags: qr aa rd; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1;; WARNING: recursion requested but not available;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096;; QUESTION SECTION:;myapp-svc.default.svc.cluster.local. IN A;; ANSWER SECTION:myapp-svc.default.svc.cluster.local. 5 IN A 10.244.3.167myapp-svc.default.svc.cluster.local. 5 IN A 10.244.1.150myapp-svc.default.svc.cluster.local. 5 IN A 10.244.2.166;; Query time: 0 msec;; SERVER: 10.96.0.10#53(10.96.0.10);; WHEN: Thu May 16 10:59:03 CST 2019;; MSG SIZE rcvd: 217# kubectl get svc -n kube-systemNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEkube-dns ClusterIP 10.96.0.10 &lt;none&gt; 53/UDP,53/TCP,9153/TCP 20d# kubectl get pods -o wide -l app=myappNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESmyapp-deploy-675558bfc5-5c8hn 1/1 Running 0 42h 10.244.1.150 bj-gzf-vm-ops-test01 &lt;none&gt; &lt;none&gt;myapp-deploy-675558bfc5-qgps7 1/1 Running 0 42h 10.244.2.166 bj-gzf-vm-ops-test02 &lt;none&gt; &lt;none&gt;myapp-deploy-675558bfc5-qtlqf 1/1 Running 0 42h 10.244.3.167 bj-gzf-vm-ops-test03 &lt;none&gt; &lt;none&gt; ingress åŠ ingress controller123# mkdir ingress-nginxfor file in configmap.yaml mandatory.yaml namespace.yaml rbac.yaml with-rbac.yaml ; do wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/$file ; done# kubectl apply -f ./ 123456789101112131415161718192021222324252627282930313233343536373839# cat deploy-demo.yamlapiVersion: v1kind: Servicemetadata: name: myapp namespace: defaultspec: selector: app: myapp release: canary ports: - name: httpd targetPort: 80 port: 80---apiVersion: apps/v1kind: Deploymentmetadata: name: myapp-deploy namespace: defaultspec: replicas: 3 selector: matchLabels: app: myapp release: canary template: metadata: labels: app: myapp release: canary spec: containers: - name: myapp image: ikubernetes/myapp:v2 ports: - name: http containerPort: 80 12345# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/provider/baremetal/service-nodeport.yaml# pwd/root/ingress-nginx# lsconfigmap.yaml mandatory.yaml namespace.yaml rbac.yaml service-nodeport.yaml with-rbac.yaml 12345678910111213141516171819202122232425262728293031# vim service-nodeport.yamlapiVersion: v1kind: Servicemetadata: name: ingress-nginx namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginxspec: type: NodePort ports: - name: http port: 80 targetPort: 80 protocol: TCP nodePort: 30080 - name: https port: 443 targetPort: 443 protocol: TCP nodePort: 30443 selector: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx---# kubectl apply -f ./# kubectl get svc -n ingress-nginxNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEingress-nginx NodePort 10.96.59.169 &lt;none&gt; 80:30080/TCP,443:30443/TCP 2m35s çŽ°åœ¨å¯ä»¥å°è¯•è®¿é—® æŸ¥çœ‹è®¿é—®apiVersion 1234# kubectl explain ingressKIND: IngressVERSION: extensions/v1beta1# kubectl explain ingress.spec.rules.http.paths 1234567891011121314151617# vim ingress-myapp.yamlapiVersion: extensions/v1beta1kind: Ingressmetadata: name: ingress-myapp namespace: default annotations: kubernetes.io/ingress.class: "nginx"spec: rules: - host: myapp.ssjinyao.com http: paths: - path: backend: serviceName: myapp servicePort: 80 12345678910111213141516171819# kubectl describe ingress ingress-myappName: ingress-myappNamespace: defaultAddress:Default backend: default-http-backend:80 (&lt;none&gt;)Rules: Host Path Backends ---- ---- -------- myapp.ssjinyao.com myapp:80 (10.244.1.150:80,10.244.2.166:80,10.244.3.167:80)Annotations: kubectl.kubernetes.io/last-applied-configuration: &#123;"apiVersion":"extensions/v1beta1","kind":"Ingress","metadata":&#123;"annotations":&#123;"kubernetes.io/ingress.class":"nginx"&#125;,"name":"ingress-myapp","namespace":"default"&#125;,"spec":&#123;"rules":[&#123;"host":"myapp.ssjinyao.com","http":&#123;"paths":[&#123;"backend":&#123;"serviceName":"myapp","servicePort":80&#125;,"path":null&#125;]&#125;&#125;]&#125;&#125; kubernetes.io/ingress.class: nginxEvents: Type Reason Age From Message ---- ------ ---- ---- ------- Normal CREATE 18s nginx-ingress-controller Ingress default/ingress-myapp# kubectl exec -n ingress-nginx nginx-ingress-controller-5694ccb578-xkgkx -it -- /bin/sh è¿™æ—¶å†è®¿é—® tomcat ä¸ƒå±‚è´Ÿè½½åˆ›å»º 1234567891011121314151617181920212223242526272829303132333435363738394041424344# vim tomcat-deploy.yamlapiVersion: v1kind: Servicemetadata: name: tomcat namespace: defaultspec: selector: app: tomcat release: canary ports: - name: httpd targetPort: 8080 port: 8080 - name: ajp targetPort: 8009 port: 8009---apiVersion: apps/v1kind: Deploymentmetadata: name: tomcat-deploy namespace: defaultspec: replicas: 3 selector: matchLabels: app: tomcat release: canary template: metadata: labels: app: tomcat release: canary spec: containers: - name: tomcat image: tomcat:8.5.32-jre8-alpine ports: - name: http containerPort: 8080 - name: ajp containerPort: 8009# kubectl apply -f tomcat-deploy.yaml 123456789101112131415161718# vim ingress-tomcat.yamlapiVersion: extensions/v1beta1kind: Ingressmetadata: name: ingress-tomcat namespace: default annotations: kubernetes.io/ingress.class: "nginx"spec: rules: - host: tomcat.ssjinyao.com http: paths: - path: backend: serviceName: tomcat servicePort: 8080# kubectl apply -f ingress-tomcat.yaml secret åˆ›å»ºä¸Žä½¿ç”¨ 1234567891011121314# kubectl create secret tls tomcat-ingress-secret --cert=2214184_tomcat.ssjinyao.com.pem --key=2214184_tomcat.ssjinyao.com.keysecret/tomcat-ingress-secret created# kubectl describe secret tomcat-ingress-secretName: tomcat-ingress-secretNamespace: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Type: kubernetes.io/tlsData====tls.crt: 3659 bytestls.key: 1675 bytes 12345678910111213141516171819202122232425262728293031323334353637383940414243444546# vim ingress-tomcat-tls.yamlapiVersion: extensions/v1beta1kind: Ingressmetadata: name: ingress-tomcat-tls namespace: default annotations: kubernetes.io/ingress.class: "nginx"spec: tls: - hosts: - tomcat.ssjinyao.com secretName: tomcat-ingress-secret rules: - host: tomcat.ssjinyao.com http: paths: - path: backend: serviceName: tomcat servicePort: 8080# kubectl apply -f ingress-tomcat-tls.yaml# kubectl get ingressNAME HOSTS ADDRESS PORTS AGEingress-tomcat tomcat.ssjinyao.com 80 39mingress-tomcat-tls tomcat.ssjinyao.com 80, 443 93s# kubectl describe ingress ingress-tomcat-tlsName: ingress-tomcat-tlsNamespace: defaultAddress:Default backend: default-http-backend:80 (&lt;none&gt;)TLS: tomcat-ingress-secret terminates tomcat.ssjinyao.comRules: Host Path Backends ---- ---- -------- tomcat.ssjinyao.com tomcat:8080 (10.244.1.153:8080,10.244.2.171:8080,10.244.3.170:8080)Annotations: kubectl.kubernetes.io/last-applied-configuration: &#123;"apiVersion":"extensions/v1beta1","kind":"Ingress","metadata":&#123;"annotations":&#123;"kubernetes.io/ingress.class":"nginx"&#125;,"name":"ingress-tomcat-tls","namespace":"default"&#125;,"spec":&#123;"rules":[&#123;"host":"tomcat.ssjinyao.com","http":&#123;"paths":[&#123;"backend":&#123;"serviceName":"tomcat","servicePort":8080&#125;,"path":null&#125;]&#125;&#125;],"tls":[&#123;"hosts":["tomcat.ssjinyao.com"],"secretName":"tomcat-ingress-secret"&#125;]&#125;&#125; kubernetes.io/ingress.class: nginxEvents: Type Reason Age From Message ---- ------ ---- ---- ------- Normal CREATE 2m29s nginx-ingress-controller Ingress default/ingress-tomcat-tls]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesæ“ä½œè®°å½•(ä¸€)]]></title>
    <url>%2F2019%2F04%2F25%2Fkubernetes%E5%AE%9E%E6%93%8D%E8%AE%B0%E5%BD%951%2F</url>
    <content type="text"><![CDATA[kubernetes æ“ä½œè®°å½•(ä¸€)kubernetes æœ‰ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼Œå…¶ä¸­ä¸€ç§æ–¹å¼æ˜¯å°†kubernetes æ¯ä¸ªç»„ä»¶éƒ½ä»¥ç³»ç»Ÿè¿›ç¨‹çš„æ–¹å¼è¿è¡Œæˆç³»ç»Ÿå±‚é¢çš„æœåŠ¡;è¿™æ ·çš„éƒ¨ç½²ç¹çè€Œå¤æ‚ï¼Œå½“ç„¶ä¹Ÿå¯ç”¨åˆ«äººå†™çš„ansibleè‡ªåŠ¨åŒ–å·¥å…·æŽ¨é€ä¸€æ¬¡;å¦å¤–ä¸€éƒ¨ç½²éƒ¨ç½²æ–¹å¼æ˜¯å°±æ˜¯ç”¨ kubeadm å°† Kuberntes æ¯ä¸ªç»„ä»¶éƒ½Podå½¢åŠ¿è¿›è¡Œéƒ¨ç½²; ä½¿ç”¨ kubeadm é›†ç¾¤éƒ¨ç½² kubernetes èŠ‚ç‚¹ç½‘ç»œ 10.1.87.0/24 Podç½‘ç»œ 10.244.0.0/16 Serviceç½‘ç»œ 10.96.0.0/12 éƒ¨ç½²å‡†å¤‡kubeadm éœ€è¦æ¯ä¸ªèŠ‚ç‚¹éƒ½å®‰è£… kubelte,docker è€ŒæŠŠå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹åˆå§‹åŒ–ä¸ºmaster;å…¶kuberntes è‡ªå·±çš„å„ä¸ªç»„ä»¶éƒ½è¿è¡Œä¸ºPodï¼Œå…¶ä¸­çš„è¿™äº›Podéƒ½æ˜¯é™æ€Pod; kubeadm1ã€ master,nodes: å®‰è£…kubelet,kubeadm,docker2ã€ master: kubeadm init3ã€ nodes: kubeadm join https://github.com/kubernetes/kubeadm/blob/master/docs/design/design_v1.10.md èŠ‚ç‚¹æœåŠ¡å™¨å…±å››å°ï¼Œ/etc/hostsé…ç½®ä¿¡æ¯å¦‚ä¸‹ 123410.1.87.80 master10.1.87.81 node0110.1.87.82 node0210.1.87.83 node03 æ³¨: å››å°èŠ‚ç‚¹æœåŠ¡å™¨æ—¶é—´éœ€è¦åŒæ­¥ é…ç½® kubernetes åŠ docker çš„Yumæº123456789101112Master:é…ç½®# vim /etc/yum.repos.d/kubernetes.repo[kubernetes]name=kebernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpggpgcheck=1enabled=1# cd /etc/yum.repos.d/ &amp;&amp; wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# yum clean all &amp;&amp; yum makecacheåŒæ­¥Yumé…ç½®åˆ°å…¶å®ƒèŠ‚ç‚¹ # for i in &#123;1..3&#125; ;do scp docker-ce.repo kubernetes.repo node0$i:/etc/yum.repos.d/ ; done å››å°æœåŠ¡å™¨å®‰è£…ä»¥ä¸‹è½¯ä»¶åŒ… 1234# yum -y install docker-ce kubelet kubeadm kubectlå‡ºçŽ°gpgkeyé—®é¢˜ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³# wget https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg # rpm --import rpm-package-key.gpg 12345678master# vim /usr/lib/systemd/system/docker.serviceåœ¨[service]ä¸‹æ·»åŠ ä»¥ä¸‹å†…å®¹Environment="HTTPS_PROXY=http://www.ik8s.io:10080"Environment="NO_PROXY=127.0.0.0/8, 10.1.87.0/24"# systemctl daemon-reload# systemctl restart docker# docker info ç¡®ä¿ä»¥ä¸‹ä¸¤ä¸ªå†…æ ¸å‚æ•°éƒ½æ˜¯å¼€å¯çŠ¶æ€ 1234# cat /proc/sys/net/bridge/bridge-nf-call-ip6tables1# cat /proc/sys/net/bridge/bridge-nf-call-iptables1 æŸ¥çœ‹kubelet æ‰€ç”Ÿæˆçš„æ–‡ä»¶ 1234567# rpm -ql kubelet/etc/kubernetes/manifests/etc/sysconfig/kubelet/usr/bin/kubelet/usr/lib/systemd/system/kubelet.service# systemctl enable kubelet# systemctl enable docker æˆ–è€…ç”¨è„šæœ¬ä¸‹è½½ï¼Œå¹¶ä¿®æ”¹æ ‡ç­¾ 12345678910111213141516# vim docker_install_kubelet_image.sh#!/bin/bashdocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.14.0docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.14.0docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.14.0docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.14.0docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.3.10docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.3.1docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.14.0 k8s.gcr.io/kube-apiserver:v1.14.0docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.14.0 k8s.gcr.io/kube-controller-manager:v1.14.0docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.14.0 k8s.gcr.io/kube-scheduler:v1.14.0docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.14.0 k8s.gcr.io/kube-proxy:v1.14.0docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1 k8s.gcr.io/pause:3.1docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.3.10 k8s.gcr.io/etcd:3.3.10docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.3.1 k8s.gcr.io/coredns:1.3.1 æŸ¥çœ‹ kubeadm init åˆå§‹åŒ–é›†ç¾¤çš„å¸®åŠ©ä¿¡æ¯ 1# kubeadm init --help kubernetes åˆå§‹åŒ–123# vim /etc/sysconfig/kubeletKUBELET_EXTRA_ARGS="--fail-swap-on=false"# kubeadm init --kubernetes-version=v1.14.0 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12 --ignore-preflight-errors=swap 12345# mkdir -p $HOME/.kube# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config# sudo chown $(id -u):$(id -g) $HOME/.kube/configkubeadm join 10.1.87.80:6443 --token 7pr4nt.q2vfoir7qia0vrcd \ --discovery-token-ca-cert-hash sha256:7e38f83642e4633a48efa1bd2bdc3cd2523e83736091b38ead58c88530758bdc 12345# kubectl get cs (componentstatus)NAME STATUS MESSAGE ERRORscheduler Healthy okcontroller-manager Healthy oketcd-0 Healthy &#123;"health":"true"&#125; 123# kubectl get nodesNAME STATUS ROLES AGE VERSIONmaster NotReady master 23m v1.14.1 éƒ¨ç½²flannel 1# kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml è¿™æ—¶å†çœ‹kubernetesé›†ç¾¤å·²ç»è¿è¡Œèµ·æ¥äº† 123# kubectl get nodesNAME STATUS ROLES AGE VERSIONmaster Ready master 27m v1.14.1 æŸ¥çœ‹Kubernetesçš„åç§°ç©ºé—´ 123456# kubectl get nsNAME STATUS AGEdefault Active 28mkube-node-lease Active 28mkube-public Active 28mkube-system Active 28m å…¶å®ƒnode{1..3}èŠ‚ç‚¹åŠ å…¥kubernetes é›†ç¾¤åœ¨node{1..3} åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ 12# systemctl start docker &amp;&amp; systemctl enable docker &amp;&amp; systemctl enable kubelet# kubeadm join 10.1.87.80:6443 --token 7pr4nt.q2vfoir7qia0vrcd --discovery-token-ca-cert-hash sha256:7e38f83642e4633a48efa1bd2bdc3cd2523e83736091b38ead58c88530758bdc --ignore-preflight-errors=swap æ³¨: è¿™é‡Œéœ€è¦æ‰‹åŠ¨åŽ»ä¸‹è½½æŒ‡å®šçš„é•œåƒ 123456# vim docker_install_join_kublet_image.sh#!/bin/bashdocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1 k8s.gcr.io/pause:3.1docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.14.0docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.14.0 k8s.gcr.io/kube-proxy:v1.14.0 å°†è¿™ä¸ªè„šæœ¬åŒæ­¥åˆ°å…¶å®ƒæ‰€æœ‰ä»ŽæœåŠ¡å™¨å¹¶æ‰§è¡Œ 1234# scp docker_install_join_kublet_image.sh node02:/root/# scp docker_install_join_kublet_image.sh node03:/root/# å…¶ä½™èŠ‚ç‚¹æ‰§è¡Œ# sh docker_install_join_kublet_image.sh 123456# kubectl get nodesNAME STATUS ROLES AGE VERSIONnode01 Ready &lt;none&gt; 74m v1.14.1node02 Ready &lt;none&gt; 74m v1.14.1node03 Ready &lt;none&gt; 71m v1.14.1master Ready master 16h v1.14. è‡³æ­¤kubernetes é›†ç¾¤å·²ç»åˆå§‹åŒ–å®Œæˆ kubernetes åº”ç”¨å¿«é€Ÿå…¥é—¨æè¿°ä¸€ä¸ªèŠ‚ç‚¹ 1# kubectl describe node node01 æŸ¥çœ‹kubernetes é›†ç¾¤ä¿¡æ¯ 12# kubectl version# kubectl cluster-info åˆ›å»ºä¸€ä¸ªnginx Pod 1# kubectl run nginx-deploy --image=nginx:1.14-alpine --port=80 --replicas=1 1234567891011121314151617181920212223242526# curl 10.244.3.2&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;style&gt; body &#123; width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&lt;p&gt;If you see this page, the nginx web server is successfully installed andworking. Further configuration is required.&lt;/p&gt;&lt;p&gt;For online documentation and support please refer to&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;Commercial support is available at&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; å½“æŠŠpod æ‰‹åŠ¨åˆ é™¤æ—¶ï¼Œä¼šé‡æ–°åˆ›å»ºï¼Œå› ä¸ºé¦–æ¬¡åˆ›å»ºpod æ—¶æŒ‡å®šäº† replicas=1 1# kubectl delete pod nginx-deploy-55d8d67cf-qwlc2 123# kubectl get pods -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESnginx-deploy-55d8d67cf-qj9z8 1/1 Running 0 5m44s 10.244.1.2 node01 &lt;none&gt; &lt;none&gt; æš´éœ²æœåŠ¡ç«¯å£ 123456# kubectl expose deployment nginx-deploy --name=nginx --port=80 --target-port=80 --protocol=TCPservice/nginx exposed# kubectl get svcNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEkubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 2d16hnginx ClusterIP 10.96.181.70 &lt;none&gt; 80/TCP 52s åœ¨é›†ç¾¤å†…éƒ¨è®¿é—® 10.96.181.70 123456789101112131415161718192021222324252627# curl 10.96.181.70&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;style&gt; body &#123; width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&lt;p&gt;If you see this page, the nginx web server is successfully installed andworking. Further configuration is required.&lt;/p&gt;&lt;p&gt;For online documentation and support please refer to&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;Commercial support is available at&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;You have new mail in /var/spool/mail/root æŸ¥çœ‹ kube-system (kube-dns) çš„CLUSTER-IP 123# kubectl get svc -n kube-systemNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEkube-dns ClusterIP 10.96.0.10 &lt;none&gt; 53/UDP,53/TCP,9153/TCP 2d16h åˆ›å»ºå®¢æˆ·ç«¯ Pod 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# kubectl run client --image=busybox --replicas=1 -it --restart=Never/ # cat /etc/resolv.confnameserver 10.96.0.10search default.svc.cluster.local svc.cluster.local cluster.local localdomainoptions ndots:5# dig -t A nginx.default.svc.cluster.local @10.96.0.10; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-73.el7_6 &lt;&lt;&gt;&gt; -t A nginx.default.svc.cluster.local @10.96.0.10;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 19937;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1;; WARNING: recursion requested but not available;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096;; QUESTION SECTION:;nginx.default.svc.cluster.local. IN A;; ANSWER SECTION:nginx.default.svc.cluster.local. 5 IN A 10.96.181.70;; Query time: 1 msec;; SERVER: 10.96.0.10#53(10.96.0.10);; WHEN: Sun Apr 28 10:41:56 CST 2019;; MSG SIZE rcvd: 107/ # wget -O - -q nginx&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;style&gt; body &#123; width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&lt;p&gt;If you see this page, the nginx web server is successfully installed andworking. Further configuration is required.&lt;/p&gt;&lt;p&gt;For online documentation and support please refer to&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;Commercial support is available at&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; 1# kubectl run myapp --image=ikubernetes/myapp:v1 --replicas=2 1234# kubectl get deployment -wNAME READY UP-TO-DATE AVAILABLE AGEmyapp 1/2 2 1 70snginx-deploy 1/1 1 1 60m 1# kubectl expose deployment myapp --name=myapp --port=80 ä¸¤ä¸ªpod ä¹‹é—´éšæœºè°ƒåº¦ 123456789101112131415161718/ # wget -O - -q myappHello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;/ # wget -O - -q myapp/hostname.htmlmyapp-5bc569c47d-fhf7w/ # wget -O - -q myapp/hostname.htmlmyapp-5bc569c47d-fhf7w/ # wget -O - -q myapp/hostname.htmlmyapp-5bc569c47d-fhf7w/ # wget -O - -q myapp/hostname.htmlmyapp-5bc569c47d-fhf7w/ # wget -O - -q myapp/hostname.htmlmyapp-5bc569c47d-fhf7w/ # wget -O - -q myapp/hostname.htmlmyapp-5bc569c47d-xnslk/ # wget -O - -q myapp/hostname.htmlmyapp-5bc569c47d-xnslk/ # wget -O - -q myapp/hostname.htmlmyapp-5bc569c47d-fhf7w ä¿®æ”¹podæ•°é‡ 1# kubectl scale --replicas=5 deployment myapp 123456789# kubectl get podsNAME READY STATUS RESTARTS AGEclient 1/1 Running 0 35mmyapp-5bc569c47d-fhf7w 1/1 Running 0 22mmyapp-5bc569c47d-mqzdc 1/1 Running 0 112smyapp-5bc569c47d-w55fb 1/1 Running 0 13mmyapp-5bc569c47d-xkk2x 1/1 Running 0 112smyapp-5bc569c47d-xnslk 1/1 Running 0 22mnginx-deploy-55d8d67cf-v85hb 1/1 Running 0 32m 123456789101112# while sleep 1 ; do wget -O - -q myapp/hostname.html ;donemyapp-5bc569c47d-mqzdcmyapp-5bc569c47d-mqzdcmyapp-5bc569c47d-xkk2xmyapp-5bc569c47d-xnslkmyapp-5bc569c47d-w55fbmyapp-5bc569c47d-mqzdcmyapp-5bc569c47d-w55fbmyapp-5bc569c47d-fhf7wmyapp-5bc569c47d-xnslkmyapp-5bc569c47d-xkk2xmyapp-5bc569c47d-xnslk æ»šåŠ¨æ›´æ–° 12# kubectl set image deployment myapp myapp=ikubernetes/myapp:v2deployment.extensions/myapp image updated å®žæ—¶ç›‘æŽ§æ»šåŠ¨æ›´æ–° 1# kubectl rollout status deployment myapp 1234567# while sleep 1 ; do wget -O - -q myapp ;doneHello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;Hello MyApp | Version: v2 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;Hello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;Hello MyApp | Version: v2 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;Hello MyApp | Version: v2 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;Hello MyApp | Version: v2 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt; å›žæ»šæ“ä½œ 12# kubectl rollout undo deployment myappdeployment.extensions/myapp rolled back 12345/ # while sleep 1 ; do wget -O - -q myapp ;doneHello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;Hello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;Hello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt;Hello MyApp | Version: v1 | &lt;a href="hostname.html"&gt;Pod Name&lt;/a&gt; ä»¥myapp ä¸ºä¾‹ï¼Œåœ¨é›†ç¾¤å¤–éƒ¨è¿›è¡Œè®¿é—® 123# kubectl edit svc myapptype: ClusterIp æ”¹ä¸ºä»¥ä¸‹type: NodePort 12345# kubectl get svcNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEkubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 2d17hmyapp NodePort 10.100.210.54 &lt;none&gt; 80:32672/TCP 46mnginx ClusterIP 10.96.181.70 &lt;none&gt; 80/TCP 77m å®¢æˆ·ç«¯å¤–éƒ¨è®¿é—® 1234567~ âž¤ while sleep 1 ; do curl http://10.1.87.80:32672/hostname.html ; donemyapp-86984b4c7c-2vpjqmyapp-86984b4c7c-2vpjqmyapp-86984b4c7c-vw5mdmyapp-86984b4c7c-vj7qmmyapp-86984b4c7c-vj7qmmyapp-86984b4c7c-2vpjq æ­¤æ—¶ä¾¿å¯ä»¥ä½¿ç”¨keepalived + nginx(æˆ–haproxy)ç­‰å®žçŽ°è´Ÿè½½å‡è¡¡ èµ„æºå®šä¹‰æ¸…å•å…¥é—¨å®šä¹‰ä¸€ä¸ªç®€å•çš„èµ„æºæ¸…å• 12345678910111213141516171819# vim pod-demo.yamlapiVersion: v1kind: Podmetadata: name: pod-demo namespace: default labels: app: myapp tier: frontendspec: containers: - name: myapp image: ikubernetes/myapp:v1 - name: busybox image: busybox:latest command: - "/bin/sh" - "-c" - "sleep 5000" 1234# kubectl create -f pod-demo.yaml# kubectl get pods -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATEpod-demo 1/2 Running 5 4m19s 10.244.3.124 node03 &lt;none&gt; &lt;none&gt; æŸ¥çœ‹ç›¸å…³Podç›¸å…³ä¿¡æ¯ 1# kubectl describe pod-demo PodæŽ§åˆ¶å™¨åº”ç”¨è¿›é˜¶-L é€‰é¡¹ ç”¨äºŽæŒ‡å®šæ˜¾ç¤ºæŒ‡å®šèµ„æºå¯¹è±¡ç±»åˆ«æ‰€æœ‰èµ„æºå¯¹åº”æ ‡ç­¾çš„å€¼ 1234567# kubectl get pods -L appNAME READY STATUS RESTARTS AGE APPclient 1/1 Running 0 8dmyapp-86984b4c7c-rf4lz 1/1 Running 0 27hmyapp-86984b4c7c-wss2h 1/1 Running 0 28hnginx-deploy-55d8d67cf-v85hb 1/1 Running 0 8dpod-demo 2/2 Running 121 7d2h myapp -l èŽ·å–æ ‡ç­¾ï¼Œåšæ ‡ç­¾è¿‡æ»¤ 123# kubectl get pods -l app --show-labelsNAME READY STATUS RESTARTS AGE LABELSpod-demo 2/2 Running 121 7d2h app=myapp,tier=frontend æ˜¾ç¤ºå¤šä¸ªæ ‡ç­¾çš„æ ‡ç­¾å€¼ 1234567# kubectl get pods -L app,runNAME READY STATUS RESTARTS AGE APP RUNclient 1/1 Running 0 8d clientmyapp-86984b4c7c-rf4lz 1/1 Running 0 27h myappmyapp-86984b4c7c-wss2h 1/1 Running 0 28h myappnginx-deploy-55d8d67cf-v85hb 1/1 Running 0 8d nginx-deploypod-demo 2/2 Running 121 7d2h myapp pod-demo å†æ¬¡æ‰“æ ‡ç­¾ 12345# kubectl label pods pod-demo release=canarypod/pod-demo labeled# kubectl get pods -l app --show-labels;NAME READY STATUS RESTARTS AGE LABELSpod-demo 2/2 Running 121 7d2h app=myapp,release=canary,tier=frontend å¦‚æžœå·²æœ‰æ ‡ç­¾å¼ºè¡Œæ‰“æ ‡çš„è¯ä¼šæŠ¥é”™ 12# kubectl label pods pod-demo release=stableerror: 'release' already has a value (canary), and --overwrite is false è¿™ä¸ªæ—¶å€™éœ€è¦åŠ ä¸Š â€“overwrite 12# kubectl label pods pod-demo release=stable --overwritepod/pod-demo labeled æŸ¥çœ‹æ—¢æœ‰releaseæ ‡ç­¾çš„åˆæœ‰appæ ‡ç­¾çš„Pod 123# kubectl get pods -l release,appNAME READY STATUS RESTARTS AGEpod-demo 2/2 Running 121 7d2h ç»™nginx-deploy Podæ‰“æ ‡ç­¾ release=canary 12# kubectl label pods nginx-deploy-55d8d67cf-v85hb release=canarypod/nginx-deploy-55d8d67cf-v85hb labeled æŸ¥çœ‹ æ ‡ç­¾release=canaryçš„Pod 123456# kubectl get pods -l releaseNAME READY STATUS RESTARTS AGEnginx-deploy-55d8d67cf-v85hb 1/1 Running 0 8dpod-demo 2/2 Running 121 7d3h# kubectl get pods -l release=canaryNAME READY STATUS RESTARTS AGE æ ‡ç­¾é€‰æ‹©å™¨å¤šæ¡ä»¶é€‰æ‹© 123# kubectl get pods -l release=stable,app=myappNAME READY STATUS RESTARTS AGEpod-demo 2/2 Running 121 7d3h 123456# kubectl get pods -l release!=stableNAME READY STATUS RESTARTS AGEclient 1/1 Running 0 8dmyapp-86984b4c7c-rf4lz 1/1 Running 0 27hmyapp-86984b4c7c-wss2h 1/1 Running 0 28hnginx-deploy-55d8d67cf-v85hb 1/1 Running 0 8d 123456789# kubectl get pods -l "release in (canary,beta,alpha)"NAME READY STATUS RESTARTS AGEnginx-deploy-55d8d67cf-v85hb 1/1 Running 0 8d# kubectl get pods -l "release notin (canary,beta,alpha)"NAME READY STATUS RESTARTS AGEclient 1/1 Running 0 8dmyapp-86984b4c7c-rf4lz 1/1 Running 0 27hmyapp-86984b4c7c-wss2h 1/1 Running 0 28hpod-demo 2/2 Running 121 7d3h 123456# kubectl get nodes --show-labelsNAME STATUS ROLES AGE VERSION LABELSnode01 Ready &lt;none&gt; 10d v1.14.1 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node01,kubernetes.io/os=linuxnode02 Ready &lt;none&gt; 10d v1.14.1 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node02,kubernetes.io/os=linuxnode03 Ready &lt;none&gt; 10d v1.14.1 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node03,kubernetes.io/os=linuxmaster Ready master 10d v1.14.1 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=master,kubernetes.io/os=linux,node-role.kubernetes.io/master= ç»™node01 æ‰“é¢å¤–æ ‡ç­¾ï¼Œç£ç›˜ç±»åž‹æœ‰å›ºæ€ç¡¬ç›˜ 1234# kubectl label nodes node01 disktype=ssd# kubectl get nodes node01 --show-labelsNAME STATUS ROLES AGE VERSION LABELSnode01 Ready &lt;none&gt; 10d v1.14.1 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,disktype=ssd,kubernetes.io/arch=amd64,kubernetes.io/hostname=node01,kubernetes.io/os=linux è¿™æ ·åšçš„å¥½å¤„: å½“èŠ‚ç‚¹æœ‰æ ‡ç­¾åŽï¼ŒéšåŽæ·»åŠ èµ„æºæ—¶å°±å¯ä»¥å¯¹èŠ‚ç‚¹æœ‰å€¾å‘æ€§ å¦‚ä¸‹ï¼Œåˆ›å»ºPodæ—¶æŒ‡å®šnodeSelector 1234567891011121314151617181920212223242526apiVersion: v1kind: Podmetadata: name: pod-demo namespace: default labels: app: myapp tier: frontendspec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80 - name: https containerPort: 443 - name: busybox image: busybox:latest imagePullPolicy: IfNotPresent command: - "/bin/sh" - "-c" - "sleep 5000" nodeSelector: disktype: ssd nodeSelector disktype: ssdnodeName æŒ‡å®šç›´æŽ¥è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Š 12345# kubectl describe pods pod-demoå¯ä»¥æŸ¥çœ‹ä»¥ä¸‹ä¿¡æ¯ï¼Œç¡®å®špod-demo è¿è¡Œåœ¨node01ä¸Šé¢ Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 2m46s default-scheduler Successfully assigned default/pod-demo to node01 annotations æ·»åŠ æ³¨è§£ 12345678910111213141516171819202122232425262728apiVersion: v1kind: Podmetadata: name: pod-demo namespace: default labels: app: myapp tier: frontend annotations: ssjinyao.com/create-by: "cluster admin"spec: containers: - name: myapp image: ikubernetes/myapp:v1 ports: - name: http containerPort: 80 - name: https containerPort: 443 - name: busybox image: busybox:latest imagePullPolicy: IfNotPresent command: - "/bin/sh" - "-c" - "sleep 5000" nodeSelector: disktype: ssd 123# kubectl create -f pod-demo.yaml# kubectl describe pods pod-demoAnnotations: ssjinyao.com/create-by: cluster admin ExecAction ç”¨è‡ªå®šä¹‰çš„å‘½ä»¤å­˜æ´»æ€§æŽ¢æµ‹ 1234567891011121314151617181920212223242526272829# vim liveness-exec.yamlapiVersion: v1kind: Podmetadata: name: liveness-exec-pod namespace: defaultspec: containers: - name: liveness-exec-container image: busybox:latest imagePullPolicy: IfNotPresent command: ["/bin/sh" , "-c", "touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 3600"] livenessProbe: exec: command: ["test","-e","/tmp/healthy"] initialDelaySeconds: 1 periodSeconds: 3# kubectl create -f liveness-exec.yaml# kubectl get pods -wNAME READY STATUS RESTARTS AGEclient 1/1 Running 0 10dliveness-exec-pod 1/1 Running 0 47smyapp-86984b4c7c-rf4lz 1/1 Running 0 3d4hmyapp-86984b4c7c-wss2h 1/1 Running 0 3d5hnginx-deploy-55d8d67cf-v85hb 1/1 Running 0 10dpod-demo 2/2 Running 34 2dliveness-exec-pod 1/1 Running 1 69sliveness-exec-pod 1/1 Running 2 2m19sliveness-exec-pod 1/1 Running 3 3m28s è¿™ä¸ªæ—¶å€™liveness-exec-pod ä¼šä¸æ–­å› å­˜æ´»æ€§æŽ¢æµ‹è€Œé‡å¯ åŸºäºŽHTTPGetActionæŽ¢æµ‹ 12345678910111213141516171819202122232425262728# vim liveness-httpget.yaml# cat liveness-httpget.yamlapiVersion: v1kind: Podmetadata: name: liveness-httpget-pod namespace: defaultspec: containers: - name: liveness-httpget-container image: ikubernetes/myapp:v1 imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 livenessProbe: httpGet: port: http path: /index.html initialDelaySeconds: 1 periodSeconds: 3# kubectl create -f liveness-httpget.yaml# kubectl exec liveness-httpget-pod -it -- /bin/sh# rm -f /usr/share/nginx/html/index.html# kubectl get podsNAME READY STATUS RESTARTS AGEclient 1/1 Running 0 10dliveness-httpget-pod 1/1 Running 2 6m31s å°±ç»­çŠ¶æ€æ£€æŸ¥ï¼Œå¦‚æžœpodä¸å°±ç»­åˆ™ä¸å‘å¤–æä¾›æœåŠ¡ 12345678910111213141516171819202122232425# vim readiness-httpget.yamlapiVersion: v1kind: Podmetadata: name: readiness-httpget-pod namespace: defaultspec: containers: - name: readiness-httpget-container image: ikubernetes/myapp:v1 imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 readinessProbe: httpGet: port: http path: /index.html initialDelaySeconds: 1 periodSeconds: 3# kubectl exec readiness-httpget-pod -it -- /bin/sh/ # rm -f /usr/share/nginx/html/index.html# kubectl get podsNAME READY STATUS RESTARTS AGEreadiness-httpget-pod 0/1 Running 0 2m52s å¯ä»¥çœ‹åˆ°readinss-httpget-pod æ˜¯ä¸å°±ç»­çš„ 12345# kubectl exec readiness-httpget-pod -it -- /bin/sh/ # echo "test html" &gt; /usr/share/nginx/html/index.html# kubectl get podsNAME READY STATUS RESTARTS AGEreadiness-httpget-pod 1/1 Running 0 4m30s å½“åˆ›å»ºå°±ç»ªæŽ¢æµ‹HTTPGeté¡µé¢æ–‡ä»¶æ—¶ï¼Œ pod å°±ç»ªçŠ¶æ€ç«‹é©¬æ¢å¤; Podç”Ÿå‘½å‘¨æœŸè¡Œä¸ºï¼Œå¯åŠ¨å‰é’©å­ï¼Œç»ˆæ­¢å‰é’©å­ lifecycle postStart postStop; æ³¨: å¯åŠ¨å®¹å™¨æ—¶å…ˆæ‰§è¡Œcommand å†æ‰§è¡ŒpostStartå› æ­¤ commandå‘½ä»¤ä¸èƒ½å¼ºä¾èµ–äºŽpostStartæ‰§è¡Œç»“æžœ; 12345678910111213141516171819# vim poststart-pod.yamlapiVersion: v1kind: Podmetadata: name: poststart-pod namespace: defaultspec: containers: - name: busybox-httpd image: busybox:latest ports: - containerPort: 80 imagePullPolicy: IfNotPresent lifecycle: postStart: exec: command: ["/bin/sh","-c","echo 'welcome www.ssjinyao.com' &gt; /tmp/index.html"] command: ["/bin/sh"] args: ["-c","httpd -h /tmp &amp;&amp; sleep 300000" ]]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[fabricè‡ªåŠ¨åŒ–ä¹‹kvmç§æœ‰äº‘æœåŠ¡å™¨å¿«é€Ÿå¼€é€šä¸Žäº¤ä»˜]]></title>
    <url>%2F2019%2F03%2F20%2Ffabric%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B9%8Bkvm%E7%A7%81%E6%9C%89%E4%BA%91%E5%BF%AB%E9%80%9F%E5%BC%80%E9%80%9A%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å…ˆæ¥çœ‹çœ‹éœ€æ±‚åŠå¯¹åº”çš„è®¾è®¡å›¾ äºŒã€é¡¹ç›®ç»“æž„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107kvm_create/â”œâ”€â”€ applicationâ”‚ â”œâ”€â”€ appcreate.pyâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ kvmcreate.pyâ”œâ”€â”€ configâ”‚ â”œâ”€â”€ hosts.pyâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ messages.pyâ”‚ â””â”€â”€ testâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ kvm_config.pyâ”œâ”€â”€ filesâ”‚ â”œâ”€â”€ adminset_agent.tar.gzâ”‚ â”œâ”€â”€ mysqlxxxxâ”‚ â”‚ â”œâ”€â”€ backup.shâ”‚ â”‚ â”œâ”€â”€ init_backup.shâ”‚ â”‚ â”œâ”€â”€ lepus_slowquery.shâ”‚ â”‚ â”œâ”€â”€ mysql-x.x.xx-linux-glibcx.xx-x86_64.tar.gzâ”‚ â”‚ â””â”€â”€ percona-toolkit_x.x.xx-x.tar.gzâ”‚ â”œâ”€â”€ mysqlxxxxâ”‚ â”‚ â”œâ”€â”€ backup.shâ”‚ â”‚ â”œâ”€â”€ init_backup.shâ”‚ â”‚ â”œâ”€â”€ lepus_slowquery.shâ”‚ â”‚ â”œâ”€â”€ mysql-x.xx.xx-linux-glibcx.xx-86_64.tar.gzâ”‚ â”‚ â””â”€â”€ percona-toolkit_x.x.xx-x.tar.gzâ”‚ â”œâ”€â”€ nginxâ”‚ â”‚ â”œâ”€â”€ nginx-1.xx.x.tar.gzâ”‚ â”‚ â””â”€â”€ nginx-1.xx.x.tar.gzâ”‚ â”œâ”€â”€ node_exporterâ”‚ â”‚ â”œâ”€â”€ LICENSEâ”‚ â”‚ â”œâ”€â”€ node_exporterâ”‚ â”‚ â””â”€â”€ NOTICEâ”‚ â”œâ”€â”€ phpâ”‚ â”‚ â”œâ”€â”€ php-x.x.xx.tar.gzâ”‚ â”‚ â”œâ”€â”€ php-x.x.xx.tar.gzâ”‚ â”‚ â”œâ”€â”€ php-x.x.xx.tar.gzâ”‚ â”‚ â”œâ”€â”€ php-x.x.xx.tar.gzâ”‚ â”‚ â”œâ”€â”€ php-x.x.xx.tar.gzâ”‚ â”‚ â””â”€â”€ php.iniâ”‚ â”œâ”€â”€ redisâ”‚ â”‚ â””â”€â”€ redis-x.x.x.tar.gzâ”‚ â””â”€â”€ zabbixâ”‚ â””â”€â”€ zabbix-x.x.x.tar.gzâ”œâ”€â”€ kernelâ”‚ â”œâ”€â”€ clone.pyâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ last.pyâ”‚ â”œâ”€â”€ mysqlxxxx.pyâ”‚ â”œâ”€â”€ mysqlxx.pyâ”‚ â”œâ”€â”€ nginx.pyâ”‚ â”œâ”€â”€ php.pyâ”‚ â”œâ”€â”€ redis.pyâ”‚ â”œâ”€â”€ standard.pyâ”‚ â”œâ”€â”€ start.pyâ”‚ â”œâ”€â”€ yum.pyâ”‚ â”œâ”€â”€ zabbix_agent.pyâ”œâ”€â”€ kvm.pyâ”œâ”€â”€ localâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ localall.pyâ”‚ â”œâ”€â”€ mysqlxxxxreplace.pyâ”‚ â”œâ”€â”€ mysqlxxreplace.pyâ”‚ â”œâ”€â”€ nginxreplace.pyâ”‚ â”œâ”€â”€ phpreplace.pyâ”‚ â”œâ”€â”€ redisreplace.pyâ”‚ â”œâ”€â”€ replacetemp.pyâ”‚ â”œâ”€â”€ zabbixreplace.pyâ”œâ”€â”€ templatesâ”‚ â”œâ”€â”€ hostsâ”‚ â”œâ”€â”€ ifcfg-eth0â”‚ â”œâ”€â”€ mysqlxxâ”‚ â”‚ â”œâ”€â”€ my.cnfâ”‚ â”‚ â”œâ”€â”€ mysql_install.shâ”‚ â”‚ â””â”€â”€ mysql.serviceâ”‚ â”œâ”€â”€ mysqlxxxxâ”‚ â”‚ â”œâ”€â”€ my.cnfâ”‚ â”‚ â”œâ”€â”€ mysql_install.shâ”‚ â”‚ â””â”€â”€ mysql.serviceâ”‚ â”œâ”€â”€ nginxâ”‚ â”‚ â”œâ”€â”€ nginx.confâ”‚ â”‚ â”œâ”€â”€ nginx_install.shâ”‚ â”‚ â”œâ”€â”€ nginx.serviceâ”‚ â”‚ â””â”€â”€ vhost.confâ”‚ â”œâ”€â”€ phpâ”‚ â”‚ â”œâ”€â”€ php-fpm.confâ”‚ â”‚ â”œâ”€â”€ php-fpm.serviceâ”‚ â”‚ â”œâ”€â”€ php_install.shâ”‚ â”‚ â””â”€â”€ www.confâ”‚ â”œâ”€â”€ redisâ”‚ â”‚ â”œâ”€â”€ redis.confâ”‚ â”‚ â”œâ”€â”€ redis_install.shâ”‚ â”‚ â””â”€â”€ redis.serviceâ”‚ â””â”€â”€ zabbixâ”‚ â”œâ”€â”€ zabbix_agentdâ”‚ â”œâ”€â”€ zabbix_agentd.confâ”‚ â””â”€â”€ zabbixagent_install.shâ”œâ”€â”€ tmp_cacheâ””â”€â”€ vars â”œâ”€â”€ __init__.py â”œâ”€â”€ kvmvar.py â”œâ”€â”€ mysqlxxxx.py â”œâ”€â”€ mysqlxxxx.py â”œâ”€â”€ nginxvar.py â”œâ”€â”€ phpvar.py â”œâ”€â”€ redisvar.py â””â”€â”€ zabbix_agentvar.py ä¸‰ã€kernel ç›®å½•ä¸‹çš„åŠŸèƒ½æ¨¡å—kvmæœåŠ¡å™¨é•œåƒclone åŒæ­¥ã€kvm xml é…ç½®æ¨¡æ¿çš„ç”ŸæˆåŒæ­¥ï¼Œç½‘å¡é…ç½®æ–‡ä»¶æ•´åˆkvmæ–°æœåŠ¡å™¨;1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#!/usr/bin/env python2# -*- coding: utf-8 -*-from fabric.contrib.files import *from config import *from vars.kvmvar import *from local.replacetemp import *class generate_kvmimg(object): def __init__(self): pass def clone_cevsxx(self): run(' [ -d' + ' ' + kvmtmpdir + ' ' +']' + ' ' + '||' + ' ' + 'mkdir -pv' + ' ' + kvmtmpdir) run('virt-clone -o ' + kvmce7name + ' ' + '-n' + ' ' + KVM_IP_HOSTNAME + ' ' + '-f' + ' ' + kvmtmpdir + KVM_IP_HOSTNAME + '.img') # run('mv' + ' ' + kvmdata + KVM_IP_HOSTNAME + '.img' + ' ' + kvmtmpdir) run('sed -i' + ' ' + '"s' + '#' + kvmtmpdir + '#' + kvmdata + '#g"' + ' ' + kvmqemu + KVM_IP_HOSTNAME + '.xml' ) run('cp' + ' ' + kvmqemu + KVM_IP_HOSTNAME + '.xml' + ' ' + kvmtmpdir) run('virsh undefine' + ' ' + KVM_IP_HOSTNAME) def site_imgip(self): rekvmeth = replace_tmp_file() rekvmeth.kvm_eth0() put(local_write_eth0 , kvmtmpdir) rekvmeth.kvm_eth0_local_remove() with cd(kvmtmpdir): run('virt-copy-in' + ' ' + 'ifcfg-eth0' + ' ' + '-a' + ' ' + KVM_IP_HOSTNAME + '.img' + ' ' + kvm_eth0_dir + '/') run('rm -f' + ' ' + kvmtmpdir + 'ifcfg-eth0') def site_imgxml_cpu(self): with cd(kvmtmpdir): run('sed -i \"s\\current=\'2\'\\current=\'' + KVM_CPU +'\'\\g\"' + ' ' + KVM_IP_HOSTNAME + '.xml') def site_imgxml_mem(self): with cd(kvmtmpdir): run('sed -i \"s\\4194304\\' + KVM_MEM + '\\g\"' + ' ' + KVM_IP_HOSTNAME + '.xml') def scp_cloned_img(self): run('scp' + ' ' + kvmtmpdir + KVM_IP_HOSTNAME + '.img' + ' ' + 'root@' + TARGETS_HOST + ':' + kvmdata) #run('scp' + ' ' + '-l 25000' + ' ' + kvmtmpdir + KVM_IP_HOSTNAME + '.img' + ' ' + 'root@' + TARGETS_HOST + ':' + kvmdata) run('rm -f' + ' ' + kvmtmpdir + KVM_IP_HOSTNAME + '.img') def scp_cloned_xml(self): run('scp' + ' ' + kvmtmpdir + KVM_IP_HOSTNAME + '.xml' + ' ' + 'root@' + TARGETS_HOST + ':' + kvmqemu) run('rm -f' + ' ' + kvmtmpdir + KVM_IP_HOSTNAME + '.xml') çªç ´ virt-copy-in å‘½ä»¤å¯ä»¥å°†å·²ç”Ÿæˆçš„ç½‘å¡é…ç½®æ–‡ä»¶ç„™è¿›é•œåƒï¼Œä¾èµ–å·¥å…·åŒ…libguestfs-tools-c è¿™æ ·è™šæ‹ŸæœåŠ¡å™¨å¼€æœºåŽå°±å¯ä»¥ç›´æŽ¥åˆ†é…æŒ‡å®šçš„ip æ“ä½œç›®æ ‡æœåŠ¡å™¨ï¼Œå°†å·²ç»åŒæ­¥xmlé…ç½®å®šä¹‰ä¸ºè™šæ‹Ÿæœºï¼Œæ‰©å±•ç›¸åº”ç£ç›˜ã€å¹¶å¼€å¯è™šæ‹ŸæœåŠ¡å™¨;123456789101112131415161718192021222324#!/usr/bin/env python2# -*- coding: utf-8 -*-from fabric.contrib.files import *from config import *from vars.kvmvar import *class start_kvm(object): def __init__(self): pass def define_kvm(self): run('virsh define' + ' ' + kvmqemu + KVM_IP_HOSTNAME + '.xml') run(' [ -d' + ' ' + kvmtmpdir + ' ' + ']' + ' ' + '||' + ' ' + 'mkdir -pv' + ' ' + kvmtmpdir) def start_kvm(self): run('virsh start' + ' ' + KVM_IP_HOSTNAME) def extend_disk(self): run('qemu-img create -f qcow2' + ' ' + kvmdata + KVM_IP_HOSTNAME + '-data1.img' + ' ' + KVM_DISK) run('virsh attach-disk' + ' ' + KVM_IP_HOSTNAME + ' ' + kvmdata + KVM_IP_HOSTNAME + '-data1.img' + ' ' + 'vdc --subdriver=qcow2') run('virsh dumpxml' + ' ' + KVM_IP_HOSTNAME + ' ' + '&gt;' + ' ' + kvmqemu + KVM_IP_HOSTNAME + '.xml') run('virsh destroy' + ' ' + KVM_IP_HOSTNAME ) run('virsh define' + ' ' + kvmqemu + KVM_IP_HOSTNAME + '.xml') run('virsh start' + ' ' + KVM_IP_HOSTNAME) è™šæ‹ŸæœåŠ¡å™¨å¼€æœºåŽå®Œæˆç›¸åº”çš„è¡¥å……æ“ä½œ12345678910111213141516171819202122232425262728293031323334353637383940414243444546#!/usr/bin/env python2# -*- coding: utf-8 -*-from fabric.contrib.files import *from vars.kvmvar import localsrc,kvmsrc,kvm_install_localfrom config import LOGING_USERfrom local.replacetemp import *from local.localall import *class standard_kvm(object): def __init__(self): pass def site_kvm_hosts(self): kvm_host_init = replace_tmp_file() kvm_host_init.kvm_hosts() put(local_write_hosts,'/etc') local('rm -f' + ' ' + local_write_hosts) run('hostnamectl set-hostname' + ' ' + KVM_IP_HOSTNAME) run('mkfs.xfs /dev/vdb') run('ls -l /data &amp;&gt;/dev/null || mkdir /data') fstab_shell_list = ''' cat /etc/fstab | grep data &gt; /dev/null || \\ for i in `ls -l /dev/disk/by-uuid/ | grep vdb | awk '&#123;print $9&#125;'` ; \\ do echo "UUID=$i /data xfs defaults 0 0" &gt;&gt; /etc/fstab; \\ done ''' run(fstab_shell_list) run('mount -a') def install_kvm_adminsetd(self): put(localsrc + '/' + 'adminset_agent.tar.gz',kvmsrc) run('yum clean all') yum_clean_wait = command(25) yum_clean_wait.wait_sleep() with cd(kvmsrc): run('tar -xvf' + ' ' + 'adminset_agent.tar.gz') with cd(kvmsrc +'/' + 'adminset_agent'): run('sh install.sh') def install_node_exporter(self): put(localsrc + '/' + 'node_exporter', kvm_install_local) run('chmod +x /usr/local/node_exporter/node_exporter') run('echo \" nohup /usr/local/node_exporter/node_exporter &amp;&gt; /dev/null &amp; \" &gt;&gt; /etc/rc.local') run('nohup /usr/local/node_exporter/node_exporter &amp;&gt; /dev/null &amp;') run('hwclock --systohc') def set_kvm_passwd(self): run('echo' + ' ' + '\"' + new_pass + '\"' + ' ' + '| passwd --stdin' + ' ' + LOGING_USER) mysqlxx è¡¥å……æ¨¡å—, å®žçŽ°åŠŸèƒ½ä¸Žansible-playbook roles ç±»ä¼¼ï¼ŒçŽ°æ•´åˆåœ¨kvmè‡ªåŠ¨åŒ–ä¸­123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081#!/usr/bin/env python2# -*- coding: utf-8 -*-from vars.mysqlxx import *from local.mysqlxxreplace import replace_mysqlxx_tmpfrom fabric.contrib.files import *from vars.kvmvar import tmp_cache, systemdreplace_mysqlxx = replace_mysqlxx_tmp()class mysqlxx_kvm(object): def __init__(self): pass def delete_old_conf(self): run('rm -f /etc/my.cnf') def delete_old_conf_dir(self): run('rm -rf /etc/my.cnf') def cp_source(self): put(mysqlfile + 'mysql-' + mysqlversion + '.tar.gz', datasrc) with cd(datasrc): run('tar -xvf' + ' ' 'mysql-' + mysqlversion + '.tar.gz' + ' ' + '-C /usr/local') def cp_mysql_conf(self): put(mysqltemp + 'my.cnf', '/etc/') def copy_mysql_install_sh(self): replace_mysqlxx.mysql_install_sh() put(tmp_cache + 'mysql_install.sh', datasrc) def add_mysql_user_and_group(self): run('id -g' + ' ' + mysqlgroup + ' ' + '||' + ' ' + 'groupadd' + ' ' + mysqlgroup) run('id -u' + ' ' + mysqluser + ' ' + '||' + ' ' + 'useradd -r' + ' ' + mysqluser + ' ' + '-g' + ' ' + mysqluser + ' ' + '-s' + ' ' + '/sbin/nologin') def create_related_directories(self): run('mkdir -pv' + ' ' + mysqldatapath ) run('mkdir -pv' + ' ' + mysqlbinlogpath) run('mkdir -pv' + ' ' + mysqlslowlogpath) run('mkdir -pv' + ' ' + mysqltmppath) run('mkdir -pv' + ' ' + mysqlerrlogpath) run('chmod 755' + ' ' + mysqldatapath) run('chmod 755' + ' ' + mysqlbinlogpath) run('chmod 755' + ' ' + mysqlslowlogpath) run('chmod 755' + ' ' + mysqltmppath) run('chmod 755' + ' ' + mysqlerrlogpath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqldatapath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqlbinlogpath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqlslowlogpath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqltmppath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqlerrlogpath) def create_slowlog_file(self): run('touch' + ' ' + mysqlslowlogpath + 'slowquery.log') run('chmod 644' + ' ' + mysqlslowlogpath + 'slowquery.log') run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqlslowlogpath + 'slowquery.log') def install_mysql(self): with cd(datasrc): run('/bin/bash' + ' ' + 'mysql_install.sh' + ' ' + '&amp;&amp; touch /tmp/mysql_installed') def add_mysql_to_PATH(self): run('echo \'export PATH=$PATH:' + mysqlinstallpath + 'bin\' &gt;&gt; /etc/profile &amp;&amp; touch /tmp/mysql_addtopath') def copy_mysql_service_file(self): replace_mysqlxx.mysql_service() put(tmp_cache + 'mysql.service', systemd) def clean_local_tmp_cache_file(self): replace_mysqlxx.clean_mysqlxx_tmp_cache() def start_mysql_and_enable_it_onboot(self): run('systemctl daemon-reload') run('systemctl start mysql') run('systemctl enable mysql') run('pip install MySQL-python') run('ln -s /data/mysqltmp/mysql.sock /tmp/mysql.sock') run('ln -s /usr/local/mysql-x.x.xx-linux-glibcx.xx-x86_64/lib/libmysqlclient.so.20 /usr/lib64/libmysqlclient.so.20') run('ln -s /usr/local/mysql-x.x.xx-linux-glibcx.xx-x86_64/ /usr/local/mysql') run('[ -d /data/scripts/ ] || mkdir /data/scripts/') put(mysqlfile + 'backup.sh', '/data/scripts') put(mysqlfile + 'lepus_slowquery.sh', '/data/scripts') put(mysqlfile + 'percona-toolkit_x.x.xx-x.tar.gz', '/data/scripts') put(mysqlfile + 'init_backup.sh', '/data/scripts') mysqlxxxx åŒä¸Šï¼Œå®žçŽ°å¤šç‰ˆæœ¬å¹¶å­˜123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081#!/usr/bin/env python2# -*- coding: utf-8 -*-from vars.mysqlxxxx import *from local.mysqlxxxxreplace import replace_mysqlxx13_tmpfrom fabric.contrib.files import *from vars.kvmvar import tmp_cache, systemdreplace_mysqlxxxx = replace_mysqlxxxx_tmp()class mysqlxxxx_kvm(object): def __init__(self): pass def delete_old_conf(self): run('rm -f /etc/my.cnf') def delete_old_conf_dir(self): run('rm -rf /etc/my.cnf') def cp_source(self): put(mysqlfile + 'mysql-' + mysqlversion + '.tar.gz', datasrc) with cd(datasrc): run('tar -xvf' + ' ' 'mysql-' + mysqlversion + '.tar.gz' + ' ' + '-C /usr/local') def cp_mysql_conf(self): put(mysqltemp + 'my.cnf', '/etc/') def copy_mysql_install_sh(self): replace_mysqlxxxx.mysql_install_sh() put(tmp_cache + 'mysql_install.sh', datasrc) def add_mysql_user_and_group(self): run('id -g' + ' ' + mysqlgroup + ' ' + '||' + ' ' + 'groupadd' + ' ' + mysqlgroup) run('id -u' + ' ' + mysqluser + ' ' + '||' + ' ' + 'useradd -r' + ' ' + mysqluser + ' ' + '-g' + ' ' + mysqluser + ' ' + '-s' + ' ' + '/sbin/nologin') def create_related_directories(self): run('mkdir -pv' + ' ' + mysqldatapath ) run('mkdir -pv' + ' ' + mysqlbinlogpath) run('mkdir -pv' + ' ' + mysqlslowlogpath) run('mkdir -pv' + ' ' + mysqltmppath) run('mkdir -pv' + ' ' + mysqlerrlogpath) run('chmod 755' + ' ' + mysqldatapath) run('chmod 755' + ' ' + mysqlbinlogpath) run('chmod 755' + ' ' + mysqlslowlogpath) run('chmod 755' + ' ' + mysqltmppath) run('chmod 755' + ' ' + mysqlerrlogpath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqldatapath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqlbinlogpath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqlslowlogpath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqltmppath) run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqlerrlogpath) def create_slowlog_file(self): run('touch' + ' ' + mysqlslowlogpath + 'slowquery.log') run('chmod 644' + ' ' + mysqlslowlogpath + 'slowquery.log') run('chown' + ' ' + mysqluser + ':' + mysqlgroup + ' ' + mysqlslowlogpath + 'slowquery.log') def install_mysql(self): with cd(datasrc): run('/bin/bash' + ' ' + 'mysql_install.sh' + ' ' + '&amp;&amp; touch /tmp/mysql_installed') def add_mysql_to_PATH(self): run('echo \'export PATH=$PATH:' + mysqlinstallpath + 'bin\' &gt;&gt; /etc/profile &amp;&amp; touch /tmp/mysql_addtopath') def copy_mysql_service_file(self): replace_mysqlxxxx.mysql_service() put(tmp_cache + 'mysql.service', systemd) def clean_local_tmp_cache_file(self): replace_mysqlxxxx.clean_mysqlxxxx_tmp_cache() def start_mysql_and_enable_it_onboot(self): run('systemctl daemon-reload') run('systemctl start mysql') run('systemctl enable mysql') run('pip install MySQL-python') run('ln -s /data/mysqltmp/mysql.sock /tmp/mysql.sock') run('ln -s /usr/local/mysql-x.x.xx-linux-glibc2.5-x86_64/lib/libmysqlclient.so.20 /usr/lib64/libmysqlclient.so.20') run('ln -s /usr/local/mysql-x.x.xx-linux-glibc2.5-x86_64/ /usr/local/mysql') run('[ -d /data/scripts/ ] || mkdir /data/scripts/') put(mysqlfile + 'backup.sh', '/data/scripts') put(mysqlfile + 'lepus_slowquery.sh', '/data/scripts') put(mysqlfile + 'percona-toolkit_x.x.xx-1.tar.gz', '/data/scripts') put(mysqlfile + 'init_backup.sh', '/data/scripts') kvm æ•´åˆ rediså®‰è£…è‡ªåŠ¨åŒ–1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/env python2# -*- coding: utf-8 -*-from local.redisreplace import replace_redis_tmpfrom vars.redisvar import *from fabric.contrib.files import *from vars.kvmvar import tmp_cache, systemdreplace_redis = replace_redis_tmp()class redis_kvm(object): def __init__(self): pass def cp_source(self): put(redisfile + 'redis-' + redisversion + '.tar.gz', datasrc) with cd(datasrc): run('tar -xvf' + ' ' + 'redis-' + redisversion + '.tar.gz') def cp_redis_install_shell(self): replace_redis.redis_install_sh() put(tmp_cache + 'redis_install.sh', datasrc) def create_redis_group_and_user(self): run('id -g' + ' ' + redisgroup + ' ' + '||' + ' ' + 'groupadd' + ' ' + redisgroup) run('id -u' + ' ' + redisgroup + ' ' + '||' + ' ' + 'useradd -r' + ' ' + redisuser + ' ' + '-g' + ' ' + redisgroup + ' ' + '-s' + ' ' + '/sbin/nologin') def install_redis(self): run('/bin/bash' + ' ' + datasrc + 'redis_install.sh' + ' ' + '&amp;&amp; touch /tmp/redis_installed') def create_redis_log_file(self): run('touch' + ' ' + redislogpath) run('chmod 644' + ' ' + redislogpath) run('chown' + ' ' + redisuser + ':' + redisgroup + ' ' + redislogpath) def crate_redis_data_dir(self): run('mkdir -pv' + ' ' + redisdatapath) run('chmod 755' + ' ' + redisdatapath) run('chown' + ' ' + redisuser + ':' + redisgroup + ' ' + redisdatapath) def copy_redis_config(self): replace_redis.redis_conf() put(tmp_cache + 'redis.conf', redisdatapath + 'redis' + redisport + '.conf') run('chmod 644' + ' ' + redisdatapath + 'redis' + redisport + '.conf') run('chown' + ' ' + redisuser + ':' + redisgroup + ' ' + redisdatapath + 'redis' + redisport + '.conf') def copy_redis_service_config(self): replace_redis.redis_service() put(tmp_cache + 'redis.service', systemd + 'redis' + redisport + '.service') run('systemctl daemon-reload') run('systemctl start' + ' ' + 'redis' + redisport) def clean_local_tmp_cache_file(self): replace_redis.clean_redis_tmp_cache() run('echo \'export PATH=$PATH:/usr/local/src/redis-' + redisversion + '/src/' + '\' &gt;&gt; /etc/profile') kvmæ•´åˆnginx å®‰è£…è‡ªåŠ¨åŒ–1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/env python2# -*- coding: utf-8 -*-from local.nginxreplace import replace_nginx_tmpfrom fabric.contrib.files import *from vars.nginxvar import *from vars.kvmvar import kvmsrc,tmp_cache,systemdreplace_nginx = replace_nginx_tmp()class nginx_kvm(object): def __init__(self): pass def copy_source(self): put(nginxfile + 'nginx-' + nginxversion + '.tar.gz' , kvmsrc) with cd(kvmsrc): run('tar -xvf' + ' ' + 'nginx-' + nginxversion + '.tar.gz') def copy_nginx_install_shell(self): replace_nginx.nginx_install_sh() put(tmp_cache + 'nginx_install.sh', kvmsrc) def create_nginx_log_dir(self): run('mkdir -pv' + ' ' + nginxlogpath) run('chmod 755' + ' ' + nginxlogpath) def create_nginx_group_and_user(self): run('id -g' + ' ' + nginxgroup + ' ' + '||' + ' ' + 'groupadd' + ' ' + nginxgroup) run('id -u' + ' ' + nginxuser + ' ' + '||' + ' ' + 'useradd -r' + ' ' + nginxuser + ' ' + '-g' + ' ' + nginxgroup + ' ' + '-s' + ' ' + '/sbin/nologin') def install_nginx(self): with cd(kvmsrc): run('/bin/bash' + ' ' + 'nginx_install.sh') def create_nginx_vhosts_dir(self): run('mkdir -pv' + ' ' + nginxinstallpath + 'conf/vhost') run('chmod 755' + ' ' + nginxinstallpath + 'conf/vhost') def copy_main_template_config_file(self): replace_nginx.nginx_conf() # run('mv' + ' ' + nginxinstallpath + 'conf/nginx.conf&#123;,.bak&#125;') put(tmp_cache + 'nginx.conf', nginxinstallpath + 'conf/nginx.conf') def copy_vhost_template_config_file(self): replace_nginx.nginx_vhost() put(tmp_cache + 'vhost.conf', nginxinstallpath + 'conf/vhost') def clean_local_tmp_cache_file(self): replace_nginx.clean_nginx_tmp_cache() def copy_service_config_file(self): replace_nginx.nginx_service() put(tmp_cache + 'nginx.service',systemd) def start_nginx(self): run('systemctl daemon-reload') run('systemctl start nginx') kvm æ•´åˆphp è‡ªåŠ¨åŒ–1234567891011121314151617181920212223242526272829303132333435363738394041424344454647!/usr/bin/env python2# -*- coding: utf-8 -*-from local.phpreplace import replace_php_tmpfrom vars.phpvar import *from fabric.contrib.files import *from vars.kvmvar import kvmsrc, tmp_cache, systemdreplace_php = replace_php_tmp()class php_kvm(object): def __init__(self): pass def cp_source(self): put(phpfile + 'php-' + phpversion + '.tar.gz', kvmsrc) with cd(kvmsrc): run('tar -xvf' + 'php-' + phpversion + '.tar.gz') def cp_php_install_shell(self): replace_php.php_install_sh() put(tmp_cache + 'php_install.sh', kvmsrc) def create_php_group_and_user(self): run('id -g' + ' ' + phpgroup + ' ' + '||' + ' ' + 'groupadd' + ' ' + phpgroup) run('id -u' + ' ' + phpuser + ' ' + '||' + ' ' + 'useradd -r' + ' ' + phpuser + ' ' + '-g' + ' ' + phpgroup + ' ' + '-s' + ' ' + '/sbin/nologin') def create_php_log_dir(self): run('mkdir -pv' + ' ' + phplogpath) run('chmod 755' + ' ' + phplogpath) run('chown' + ' ' + phpuser + ':' + phpgroup + ' ' + phplogpath) def create_php_error_log_file(self): run('touch' + ' ' + phplogpath + 'php_errors.log') run('chmod 644' + ' ' + phplogpath + 'php_errors.log') run('chown' + ' ' + phpuser + ':' + phpgroup + ' ' + phplogpath + 'php_errors.log') def install_php(self): with cd(kvmsrc): run('/bin/bash' + ' ' + 'php_install.sh') def cp_main_phpini_config(self): put(phpfile + 'php.ini', phpinstallpath + 'etc/') def cp_php_www_conf_config(self): replace_php.php_www() put(tmp_cache + 'www.conf', phpinstallpath + 'etc/php-fpm.d/') def cp_php_php_fpm_config(self): replace_php.php_conf() put(tmp_cache + 'php-fpm.conf', phpinstallpath + 'etc/') def cp_php_php_fpm_service(self): replace_php.php_service() put(tmp_cache + 'php-fpm.service', systemd) def start_php(self): run('systemctl daemon-reload') run('systemctl start php-fpm || ss -tnl | grep 9000') def clean_local_tmp_cache_files(self): replace_php.clean_php_tmp_cache() kvm æ•´åˆzabbix_agentè‡ªåŠ¨åŒ–1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#!/usr/bin/env python2# -*- coding: utf-8 -*-from vars.zabbix_agentvar import *from local.zabbixreplace import replace_zabbix_tmpfrom fabric.contrib.files import *from vars.kvmvar import kvmsrc, tmp_cache, systemdreplace_zabbix_agent = replace_zabbix_tmp()class zabbix_agent_kvm(object): def __init__(self): pass def cp_source(self): put(zabbixfile + 'zabbix-' + zabbixagentversion + '.tar.gz' , datasrc) with cd(datasrc): run('tar -xvf' + ' ' + 'zabbix-' + zabbixagentversion + '.tar.gz') def cp_zabbix_agent_install_shell(self): replace_zabbix_agent.zabbix_agent_install_sh() put(tmp_cache + 'zabbixagent_install.sh', datasrc) def create_zabbix_group_and_user(self): run('id -g' + ' ' + zabbixagentgroup + ' ' + '||' + ' ' + 'groupadd' + ' ' + zabbixagentgroup) run('id -u' + ' ' + zabbixagentuser + ' ' + '||' + ' ' + 'useradd -r' + ' ' + zabbixagentuser + ' ' + '-g' + ' ' + zabbixagentgroup + ' ' + '-s' + ' ' + '/sbin/nologin') def create_zabbix_agent_log_dir(self): run('mkdir -pv' + ' ' + zabbixagentlogpath) run('chmod 755' + ' ' + zabbixagentlogpath) run('chown' + ' ' + zabbixagentuser + ':' + zabbixagentgroup + ' ' + zabbixagentlogpath) def install_zabbix_agent(self): with cd(datasrc): run('/bin/bash' + ' ' + 'zabbixagent_install.sh' + ' ' + 'touch /tmp/zabbixagent_installed') def copy_zabbix_agent_config_file(self): replace_zabbix_agent.zabbix_agent_conf() put(tmp_cache + 'zabbix_agentd.conf', zabbixagentinstallpath + '/etc/') def copy_zabbix_agent_init_file(self): replace_zabbix_agent.zabbix_agent_service() put(tmp_cache + 'zabbix_agentd', '/etc/init.d/') run('chmod 755' + ' ' + '/etc/init.d/zabbix_agentd') def clean_local_tmp_cache_file(self): replace_zabbix_agent.clean_zabbix_tmp_cache() def add_zabbix_agent_init(self): run('chkconfig --add zabbix_agentd') run('chkconfig zabbix_agentd on') def start_zabbix_agentd(self): run('service zabbix_agentd start') yum å®‰è£…ç›¸å…³ä¾èµ–åŒ…123456789#!/usr/bin/env python2# -*- coding: utf-8 -*-from fabric.contrib.files import *from vars.kvmvar import yum_install_require_packages,yum_install_jdk_packagesdef yum_install_packages(): run('yum -y install' + '\\' + yum_install_require_packages)def yum_install_jdk(): run('yum -y install' + '\\' + yum_install_jdk_packages) è¾“å…¥è¾“å‡ºä¿¡æ¯æ‰“å°123456789101112131415161718192021222324252627282930313233343536373839404142434445#!/usr/bin/env python2# -*- coding: utf-8 -*-from fabric.colors import redfrom config import TARGETS_HOST, KVM_IP_HOSTNAME, KVM_IP_HOST, KVM_IP_GATEWAY, KVM_IP_NETMASK, ENV, APP, KVM_CPU, KVM_MEM ,KVM_DISK,KVM_IP_PASSWDfrom config.messages import MESSAGE_INFOfrom local.localall import new_pass, common_firstclass last(object): def __init__(self): pass def print_start_kvm_message(self): app_list = str(APP) app_list = app_list.replace("'","") app_list = app_list.replace("[","") app_list = app_list.replace("]","") app_list = app_list.replace(",","") first_print = common_first(MESSAGE_INFO['env'] + ENV, MESSAGE_INFO['name'] + KVM_IP_HOSTNAME, MESSAGE_INFO['ip'] + KVM_IP_HOST, MESSAGE_INFO['target'] +TARGETS_HOST, MESSAGE_INFO['gateway'] + KVM_IP_GATEWAY, MESSAGE_INFO['netmask'] + KVM_IP_NETMASK, MESSAGE_INFO['app'] + app_list, MESSAGE_INFO['cpu'] + KVM_CPU, MESSAGE_INFO['memory'] + KVM_MEM, MESSAGE_INFO['disk'] + KVM_DISK, MESSAGE_INFO['passwd'] + KVM_IP_PASSWD) first_print.message_all() user_choice = raw_input(red('If the information is incorrect, please input no: ')) if user_choice == "N" or user_choice == "n" or user_choice == "no" or user_choice == "No" or user_choice == "NO": print print(red('User check configuration is incorrect. Please rewrite configuration!')) print exit(1000) def print_kvm_message(self): app_list = str(APP) app_list = app_list.replace("'","") app_list = app_list.replace("[","") app_list = app_list.replace("]","") app_list = app_list.replace(",","") last_print = common_first(MESSAGE_INFO['env'] + ENV, MESSAGE_INFO['name'] + KVM_IP_HOSTNAME, MESSAGE_INFO['ip'] + KVM_IP_HOST, MESSAGE_INFO['target'] + TARGETS_HOST, MESSAGE_INFO['gateway'] + KVM_IP_GATEWAY, MESSAGE_INFO['netmask'] + KVM_IP_NETMASK, MESSAGE_INFO['app'] + app_list, MESSAGE_INFO['cpu'] + KVM_CPU, MESSAGE_INFO['memory'] + KVM_MEM, MESSAGE_INFO['disk'] + KVM_DISK, MESSAGE_INFO['passwd'] + new_pass) last_print.last_message_all() local å®žçŽ°é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸Žæ›¿æ¢ä¾‹ifcfg-eth0 123456789101112131415161718192021222324252627282930313233343536373839#!/usr/bin/env python2# -*- coding: utf-8 -*-from fabric.api import *from vars.kvmvar import local_read_eth0,local_write_eth0,local_read_hosts,local_write_hosts,tmp_cachefrom config import KVM_IP_HOST,KVM_IP_NETMASK,KVM_IP_GATEWAY,KVM_IP_STATUE,KVM_IP_HOSTNAMEimport reclass replace_tmp_file(): def __init__(self): pass def kvm_eth0(self): network_file_read = open(local_read_eth0,"r") network_file_write = open(local_write_eth0,"w") with network_file_read as f: data = f.read() data = data.replace('$NETWORK_STATUS$',KVM_IP_STATUE) data = data.replace('$NETWORK_IPADDR$',KVM_IP_HOST) data = data.replace('$NETWORK_NETMASK$',KVM_IP_NETMASK) data = data.replace('$NETWORK_GATEWAY$',KVM_IP_GATEWAY) with network_file_write as f: f.write(data) def kvm_eth0_local_remove(self): local('rm -f' + ' ' + local_write_eth0) def kvm_hosts(self): hosts_file_read = open(local_read_hosts,"r") hosts_file_write = open(local_write_hosts,"w") with hosts_file_read as f: hosts = f.read() hosts = hosts.replace('$HOSTSIP$', KVM_IP_HOST) hosts = hosts.replace('$HOSTNAME$', KVM_IP_HOSTNAME) with hosts_file_write as f: f.write(hosts) def kvm_hosts_remove(self): local('rm -f' + ' ' + local_write_eth0) å…¶å®ƒåŠŸç›¸å…³è°ƒç”¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485#!/usr/bin/env python2# -*- coding: utf-8 -*-import randomimport stringfrom fabric.colors import *from time import sleepclass command(object): def __init__(self,info): self.info = info def wait_sleep(self): sleep(self.info) def create_pass(self,chars=string.ascii_uppercase+string.ascii_lowercase+string.digits):#string.punctuation return ''.join([random.choice(chars) for i in range(self.info)])from fabric.colors import *class common(object): def __init__(self,info): self.info = info def wait(self): for waits in range(1,2): sleep(waits) def message_green(self): print green('**' * 50) print green('&#123;:&lt;10&#125;&#123;:^80&#125;&#123;:&gt;10&#125;'.format('*' * 10, self.info , '*' * 10)) print green('**' * 50) print def message_blue(self): print blue('**' * 50) print blue('&#123;:&lt;10&#125;&#123;:^80&#125;&#123;:&gt;10&#125;'.format('*' * 10, self.info , '*' * 10)) print blue('**' * 50) print def message_orange(self): print yellow('**' * 50) print yellow('&#123;:&lt;10&#125;&#123;:^80&#125;&#123;:&gt;10&#125;'.format('*' * 10, self.info , '*' * 10)) print yellow('**' * 50) printclass common_first(object): def __init__(self, env, name, ip, target, gateway, netmask, app, cpu, memory, disk ,passwd): self.env = env self.name = name self.ip = ip self.target = target self.gateway = gateway self.netmask = netmask self.app = app self.cpu = cpu self.memory = memory self.disk = disk self.passwd = passwd def message_all(self): print magenta('**' * 50) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.env, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.name, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.ip, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.target, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.gateway, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.netmask, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.app, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.cpu, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.memory, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.disk, '*' * 10)) print magenta('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.passwd, '*' * 10)) print magenta('**' * 50) print def last_message_all(self): print cyan('**' * 50) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.env, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.name, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.ip, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.target, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.gateway, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.netmask, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.app, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.cpu, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.memory, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.disk, '*' * 10)) print cyan('&#123;:&lt;10&#125;&#123;:&lt;80&#125;&#123;:&gt;10&#125;'.format('*' * 10, ' ' + self.passwd, '*' * 10)) print cyan('**' * 50) printnewpasswd = command(12)new_pass = newpasswd.create_pass() config ç›®å½•å­˜æ”¾é…ç½®ç›¸å…³çš„ä¿¡æ¯message.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107#!/usr/bin/env python2# -*- coding: utf-8 -*-from config import ENVMESSAGE_INFO = &#123; &apos;start_kvm_site&apos;: &apos;Now Start KVM Create&apos;, &apos;app_clone&apos;: &apos;App Clone Genreate CentOS74&apos;, &apos;site_image_ip&apos;: &apos;Source Hosts Site Image IP&apos;, &apos;site_imgxml_cpu&apos;: &apos;Sources Hosts Site Image XML CPU&apos;, &apos;site_imgxml_mem&apos;: &apos;Sources Hosts Site Image XML Memory&apos;, &apos;scp_cloned_img&apos;: &apos;Sources Hosts Scp Cloned Image To Targets hosts&apos;, &apos;scp_cloned_xml&apos;: &apos;Sources Hosts Scp Cloned XML To Targets hosts&apos;, &apos;define_kvm&apos;: &apos;Targets Hosts Define Kvm Hosts&apos;, &apos;start_kvm&apos;: &apos;Targets Hosts Start Kvm Hosts&apos;, &apos;extend_disk&apos;: &apos;Targets Hosts Extend Kvm Disk&apos;, &apos;wait_sleep&apos;: &apos;Sleep 60s For Wait Start Kvm Hosts&apos;, &apos;site_kvm_hosts&apos;: &apos;KVM Site KVM Hosts&apos;, &apos;install_kvm_adminsetd&apos;: &apos;KVM Install Adminsetd And Node_exporter&apos;, &apos;start_yum_tools_install&apos;: &apos;Now Start Yum Tools Install&apos;, &apos;start_nginx_install&apos;: &apos;Now Start Nginx Install&apos;, &apos;nginx_copy&apos;: &apos;Nginx Copy Source File&apos;, &apos;copy_nginx_install_shell&apos;: &apos;Nginx Copy Install Shell&apos;, &apos;create_nginx_log_dir&apos;: &apos;Nginx Create Log Dir&apos;, &apos;create_nginx_group_and_user&apos;: &apos;Nginx Create Group And User&apos;, &apos;install_nginx&apos;: &apos;Nginx Install&apos;, &apos;create_nginx_vhosts_dir&apos;: &apos;Nginx Create Vhosts Dir&apos;, &apos;copy_main_template_config_file&apos;: &apos;Nginx Main Template Config File&apos;, &apos;copy_vhost_template_config_file&apos;: &apos;Nginx Copy Vhost Template Config File&apos;, &apos;copy_service_config_file&apos;: &apos;Nginx Copy Service Config File&apos;, &apos;start_nginx&apos;: &apos;Nginx Start&apos;, &apos;nginx_clean_local_tmp_cache_file&apos;: &apos;Nginx Clean local Tmp Cache File&apos;, &apos;start_php_install&apos;: &apos;Now Start PHP Install&apos;, &apos;php_copy&apos;: &apos;PHP Copy Source File&apos;, &apos;cp_php_install_shell&apos;: &apos;PHP Copy Install Shell&apos;, &apos;create_php_group_and_user&apos;: &apos;PHP Create Group And User&apos;, &apos;create_php_log_dir&apos;: &apos;PHP Create Log Dir&apos;, &apos;create_php_error_log_file&apos;: &apos;PHP Create Error Log File&apos;, &apos;install_php&apos;: &apos;PHP Install&apos;, &apos;cp_main_phpini_config&apos;: &apos;PHP Copy Phpini Config&apos;, &apos;cp_php_www_conf_config&apos;: &apos;PHP Copy PHP WWW Config&apos;, &apos;cp_php_php_fpm_config&apos;: &apos;PHP Copy php-fpm Config&apos;, &apos;cp_php_php_fpm_service&apos;: &apos;PHP Copy php-fpm Service&apos;, &apos;start_php&apos;: &apos;PHP Start&apos;, &apos;php_clean_local_tmp_cache_files&apos;: &apos;PHP Clean local Tmp Cache File&apos;, &apos;start_redis_install&apos;: &apos;Now Start Reids Install&apos;, &apos;redis_copy&apos;: &apos;Redis Copy Source File&apos;, &apos;cp_redis_install_shell&apos;: &apos;Redis Copy Install Shell&apos;, &apos;create_redis_group_and_user&apos;: &apos;Redis Create Grup And User&apos;, &apos;install_redis&apos;: &apos;Redis Install&apos;, &apos;create_redis_log_file&apos;: &apos;Redis Create Redis Log File&apos;, &apos;crate_redis_data_dir&apos;: &apos;Redis Create Data Dir&apos;, &apos;copy_redis_config&apos;: &apos;Redis Copy Config&apos;, &apos;copy_redis_service_config&apos;: &apos;Redis Copy Service Config&apos;, &apos;redis_clean_local_tmp_cache_file&apos;: &apos;Redis Clean Local Tmp Cache File&apos;, &apos;start_jdk_install&apos;: &apos;Now Start Install JDK&apos;, &apos;yum_install_jdk&apos;: &apos;JDK Yum Install&apos;, &apos;start_zabbix_agentd_install&apos;: &apos;Now Start Zabbix Agent Install&apos;, &apos;zabbix_copy&apos;: &apos;Zabbix Copy Source File&apos;, &apos;cp_zabbix_agent_install_shell&apos;: &apos;Zabbix Copy Agent Install Shell&apos;, &apos;create_zabbix_group_and_user&apos;: &apos;Zabbix Create Zabbix Group And User&apos;, &apos;create_zabbix_agent_log_dir&apos;: &apos;Zabbix Create Agent Log Dir&apos;, &apos;install_zabbix_agent&apos;: &apos;Zabbix Install Agent&apos;, &apos;copy_zabbix_agent_config_file&apos;: &apos;Zabbix Copy Zabbix Agent Config&apos;, &apos;copy_zabbix_agent_init_file&apos;: &apos;Zabbix Copy Zabbix Agent init&apos;, &apos;add_zabbix_agent_init&apos;: &apos;Zabbix Agent init&apos;, &apos;start_zabbix_agentd&apos;: &apos;Zabbix Agent start&apos;, &apos;zabbix_clean_local_tmp_cache_file&apos;: &apos;Zabbix Clean Local Tmp Cache File&apos;, &apos;start_mysqlxx_install&apos;: &apos;Now Start Mysqlxx Install&apos;, &apos;deletexx_old_conf&apos;: &apos;MySQLxx Delete Old Conf&apos;, &apos;deletexx_old_conf_dir&apos;: &apos;MySQLxx Delete Old Conf Dir&apos;, &apos;mysqlxx_source&apos;: &apos;MySQLxx Copy Source File&apos;, &apos;cp_mysqlxx_conf&apos;: &apos;MySQLxx Copy Conf&apos;, &apos;copy_mysqlxx_install_sh&apos;: &apos;MySQLxx Copy Install Shell&apos;, &apos;add_mysqlxx_user_and_group&apos;: &apos;MySQLxx Add User And Group&apos;, &apos;createxx_related_directories&apos;: &apos;MySQlxx Create Related Directories&apos;, &apos;createxx_slowlog_file&apos;: &apos;MySQLxx Create Slowlog File&apos;, &apos;install_mysqlxx&apos;: &apos;MySQLxx Install&apos;, &apos;add_mysqlxx_to_PATH&apos;: &apos;MySQLxx Add To PATH&apos;, &apos;cleanxx_local_tmp_cache_file&apos;: &quot;MySQLxx Clean Local Tmp Cache File&quot;, &apos;copy_mysqlxx_service_file&apos;: &quot;MySQLxx Copy Service File&quot;, &apos;start_mysqlxx_and_enable_it_onboot&apos;: &apos;MySQLxx start And Enable Onboot&apos;, &apos;start_mysqlxx13_install&apos;: &apos;Now Start Mysqlxx13 Install&apos;, &apos;deletexx13_old_conf&apos;: &apos;MySQLxx13 Delete Old Conf&apos;, &apos;deletexx13_old_conf_dir&apos;: &apos;MySQLxx13 Delete Old Conf Dir&apos;, &apos;mysqlxx13_source&apos;: &apos;MySQLxx13 Copy Source File&apos;, &apos;cp_mysqlxx13_conf&apos;: &apos;MySQLxx13 Copy Conf&apos;, &apos;copy_mysqlxx13_install_sh&apos;: &apos;MySQLxx13 Copy Install Shell&apos;, &apos;add_mysqlxx13_user_and_group&apos;: &apos;MySQLxx13 Add User And Group&apos;, &apos;createxx13_related_directories&apos;: &apos;MySQlxx13 Create Related Directories&apos;, &apos;createxx13_slowlog_file&apos;: &apos;MySQLxx13 Create Slowlog File&apos;, &apos;install_mysqlxx13&apos;: &apos;MySQLxx13 Install&apos;, &apos;add_mysqlxx13_to_PATH&apos;: &apos;MySQLxx13 Add To PATH&apos;, &apos;cleanxx13_local_tmp_cache_file&apos;: &quot;MySQLxx13 Clean Local Tmp Cache File&quot;, &apos;copy_mysqlxx13_service_file&apos;: &quot;MySQLxx13 Copy Service File&quot;, &apos;start_mysqlxx13_and_enable_it_onboot&apos;: &apos;MySQLxx13 Start And Enable Onboot&apos;, &apos;set_kvm_passwd&apos;: &apos;KVM Set root passwd&apos;, &apos;env&apos;: &apos;KVM ENV Is: &apos;, &apos;name&apos;: &apos;KVM Host Name Is: &apos;, &apos;ip&apos;: &apos;KVM IP Is: &apos;, &apos;target&apos;: &apos;TARGET IP Is: &apos;, &apos;gateway&apos;: &apos;KVM Gateway Is: &apos;, &apos;netmask&apos;: &apos;KVM Netmask Is: &apos;, &apos;app&apos;: &apos;KVM APP Is: &apos;, &apos;cpu&apos;: &apos;KVM CPU Is: &apos;, &apos;memory&apos;: &apos;KVM Memory Is: &apos;, &apos;disk&apos;: &apos;KVM Disk Is: &apos;, &apos;passwd&apos;: &apos;KVM Passwd IS: &apos;&#125; host.py å¼€é€šæœåŠ¡å™¨æ‰€è¦æ“æŽ§çš„ä¸‰å°æœåŠ¡å™¨ 1234567891011121314#!/usr/bin/env python2# -*- coding: utf-8 -*-from config import *SOURCES_HOSTS = [ LOGING_USER + '@' + SOURCES_HOST]TARGETS_HOSTS = [ LOGING_USER + '@' + TARGETS_HOST]KVM_HOSTS = [ LOGING_USER + '@' + KVM_IP_HOST] init.py ç”Ÿäº§ä¸Žç”Ÿäº§çŽ¯å¢ƒé…ç½®çš„å¼€å…³ 1234#!/usr/bin/env python2# -*- coding: utf-8 -*-#from config.prod.kvm_config import *from config.test.kvm_config import * kvm_create.py æ¯æ¬¡å¼€é€šæœåŠ¡å™¨æ‰€éœ€è¦çš„é…ç½®ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#!/usr/bin/env python2# -*- coding: utf-8 -*-from fabric.api import envfrom local.localall import newpasswd########################################### ä»¥ä¸‹ä¸ºé€šå¸¸ä¸å˜çš„ä¿¡æ¯ ########################################## ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºrootENV = 'prod'LOGING_USER = 'root'## ç”Ÿäº§çŽ¯å¢ƒç½‘å…³ä¿¡æ¯,ç”Ÿäº§ç½‘å…³é»˜è®¤ä¸å˜KVM_IP_GATEWAY = 'xxx.xx.xx.xx'## kvmæœåŠ¡å™¨å¯†ç ä¿¡æ¯kvmæœåŠ¡å™¨ä¸­çš„æ¨¡æ¿ï¼Œä¸€èˆ¬ä¸å˜KVM_IP_PASSWD = 'xxxxxxxxXXXX'## æºæœåŠ¡å™¨ä¿¡æ¯ï¼Œä¸€èˆ¬ä»Žç‰©ç†æœåŠ¡å™¨(xxx.xx.xx.xx)è¿›è¡Œå…‹éš†SOURCES_HOST = 'xxx.xx.xx.xx'SOURCES_PASS = 'xxxxxxxxxxxxxxxxxxxxxxx'## kvmè™šæ‹Ÿæœºå¯åŠ¨åŽç½‘å¡çš„å¼€å¯çŠ¶æ€ï¼Œä¸€èˆ¬ä¸å˜KVM_IP_STATUE = 'yes'########################################## ä»¥ä¸‹ä¸ºé€šå¸¸æ”¹å˜çš„ä¿¡æ¯ ############################################# ç›®æ ‡æœåŠ¡å™¨ä¿¡æ¯(åˆ‡è®°æ”¹å˜é…ç½®ä¿¡æ¯)#TARGETS_HOST = 'xxx.xx.xxx.xx'#TARGETS_PASS = 'xxxxxxxxxxxxxxxxxxxxxxxx'### kvmæœåŠ¡å™¨ä¿¡æ¯(åˆ‡è®°æ”¹å˜é…ç½®ä¿¡æ¯)#KVM_IP_HOSTNAME = 'xx-xxxx-xx-xxx-xxxx-xxxx'#KVM_IP_HOST = '172.30.70.'#KVM_IP_NETMASK = '255.255.192.0'#KVM_CPU = '2'#KVM_DISK = '100G'##KVM_MEM = '10xx144'##KVM_MEM = '2114288'##KVM_MEM = '2097152'##KVM_MEM = '4194304'##KVM_MEM = '6291456'#KVM_MEM = '8388608'##KVM_MEM = '1048xx60'##KVM_MEM = '12582912'##KVM_MEM = '14680064'##KVM_MEM = '16777216'##KVM_MEM = '20971520'##KVM_MEM = '25165824'#APP = ['zabbix_agent', 'jdk']##APP = ['zabbix_agent', 'nginx', 'php', 'redis', 'jdk', 'mysql_xx', 'mysql_xx13']############################################# ä»¥ä¸‹ä¸ºä»£æ›¿çš„æ‰§è¡Œç™»å½•ä¿¡æ¯ ####################################env.passwords[LOGING_USER + '@' + SOURCES_HOST + ':22'] = SOURCES_PASSenv.passwords[LOGING_USER + '@' + TARGETS_HOST + ':22'] = TARGETS_PASSenv.passwords[LOGING_USER + '@' + KVM_IP_HOST + ':22'] = KVM_IP_PASSWD application å®šä¹‰è‡ªåŠ¨åŒ–æ‰§è¡Œæµç¨‹ kvmcreate.py å®šä¹‰kvm è‡ªåŠ¨éƒ¨ç½²æµç¨‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374#!/usr/bin/env python2# -*- coding: utf-8 -*-from config import KVM_CPU,KVM_MEM,KVM_DISKfrom config.messages import MESSAGE_INFOfrom kernel.clone import *from kernel.start import *from kernel.standard import *from kernel.last import *from local.localall import commonapp_clone_generate = generate_kvmimg()app_targets_hosts_start = start_kvm()app_kvm_hosts_start_site = standard_kvm()app_kvm_hosts_start_print = last()def kvm_create(): print_first_message = last() print_first_message.print_start_kvm_message() print_kvm_message = common(MESSAGE_INFO['start_kvm_site']) print_kvm_message.message_blue() print_kvm_message = common(MESSAGE_INFO['app_clone']) print_kvm_message.message_green() app_clone_generate.clone_cevs74() print_kvm_message = common(MESSAGE_INFO['site_image_ip']) print_kvm_message.message_green() app_clone_generate.site_imgip() if KVM_CPU != '2' and KVM_MEM != '4194304': print_kvm_message = common(MESSAGE_INFO['site_imgxml_cpu']) print_kvm_message.message_green() app_clone_generate.site_imgxml_cpu() print_kvm_message = common(MESSAGE_INFO['site_imgxml_mem']) print_kvm_message.message_green() app_clone_generate.site_imgxml_mem() if KVM_CPU != '2' and KVM_MEM == '4194304': print_kvm_message = common(MESSAGE_INFO['site_imgxml_cpu']) print_kvm_message.message_green() app_clone_generate.site_imgxml_cpu() if KVM_MEM != '4194304' and KVM_CPU == '2': print_kvm_message = common(MESSAGE_INFO['site_imgxml_mem']) print_kvm_message.message_green() app_clone_generate.site_imgxml_mem() print_kvm_message = common(MESSAGE_INFO['scp_cloned_img']) print_kvm_message.message_green() app_clone_generate.scp_cloned_img() print_kvm_message = common(MESSAGE_INFO['scp_cloned_xml']) print_kvm_message.message_green() app_clone_generate.scp_cloned_xml()def targets_hosts_start_kvm(): print_kvm_message = common(MESSAGE_INFO['define_kvm']) print_kvm_message.message_green() app_targets_hosts_start.define_kvm() print_kvm_message = common(MESSAGE_INFO['start_kvm']) print_kvm_message.message_green() app_targets_hosts_start.start_kvm() if KVM_DISK is not '': print_kvm_message = common(MESSAGE_INFO['extend_disk']) print_kvm_message.message_green() app_targets_hosts_start.extend_disk() print_kvm_message = common(MESSAGE_INFO['wait_sleep']) print_kvm_message.message_green() time_sleep_wait_start = command(60) time_sleep_wait_start.wait_sleep()def kvm_virture_hosts_site(): print_kvm_message = common(MESSAGE_INFO['site_kvm_hosts']) print_kvm_message.message_green() app_kvm_hosts_start_site.site_kvm_hosts() print_kvm_message = common(MESSAGE_INFO['install_kvm_adminsetd']) print_kvm_message.message_green() app_kvm_hosts_start_site.install_kvm_adminsetd() app_kvm_hosts_start_site.install_node_exporter()def kvm_tirture_hosts_site_passwd(): print_kvm_message = common(MESSAGE_INFO['set_kvm_passwd']) print_kvm_message.message_green() app_kvm_hosts_start_site.set_kvm_passwd()def kvm_virture_hosts_print(): app_kvm_hosts_start_print.print_kvm_message() appcreate.py ç”¨äºŽå®šä¹‰åº”ç”¨ç¨‹åºçš„éƒ¨ç½²æµç¨‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348#!/usr/bin/env python2# -*- coding: utf-8 -*-from config.messages import MESSAGE_INFOfrom local.localall import commonfrom kernel.yum import yum_install_packages, yum_install_jdkfrom kernel.nginx import nginx_kvmfrom kernel.php import php_kvmfrom kernel.redis import redis_kvmfrom kernel.zabbix_agent import zabbix_agent_kvmfrom kernel.mysqlxx import mysqlxx_kvmfrom kernel.mysqlxxxx import mysqlxxxx_kvmfrom config import APPnginx_install = nginx_kvm()php_install = php_kvm()redis_install = redis_kvm()zabbix_agent_install = zabbix_agent_kvm()mysqlxx_install = mysqlxx_kvm()mysqlxxxx_install = mysqlxxxx_kvm()def run_yum_install(): yum_install_packages()def run_install_nginx(): print_application_message = common(MESSAGE_INFO['nginx_copy']) print_application_message.message_green() nginx_install.copy_source() print_application_message = common(MESSAGE_INFO['copy_nginx_install_shell']) print_application_message.message_green() nginx_install.copy_nginx_install_shell() print_application_message = common(MESSAGE_INFO['create_nginx_log_dir']) print_application_message.message_green() nginx_install.create_nginx_log_dir() print_application_message = common(MESSAGE_INFO['create_nginx_group_and_user']) print_application_message.message_green() nginx_install.create_nginx_group_and_user() print_application_message = common(MESSAGE_INFO['install_nginx']) print_application_message.message_green() nginx_install.install_nginx() print_application_message = common(MESSAGE_INFO['create_nginx_vhosts_dir']) print_application_message.message_green() nginx_install.create_nginx_vhosts_dir() print_application_message = common(MESSAGE_INFO['copy_main_template_config_file']) print_application_message.message_green() nginx_install.copy_main_template_config_file() print_application_message = common(MESSAGE_INFO['copy_vhost_template_config_file']) print_application_message.message_green() nginx_install.copy_vhost_template_config_file() print_application_message = common(MESSAGE_INFO['copy_service_config_file']) print_application_message.message_green() nginx_install.copy_service_config_file() print_application_message = common(MESSAGE_INFO['start_nginx']) print_application_message.message_green() nginx_install.start_nginx() print_application_message = common(MESSAGE_INFO['nginx_clean_local_tmp_cache_file']) print_application_message.message_green() nginx_install.clean_local_tmp_cache_file()def run_install_php(): print_application_message = common(MESSAGE_INFO['php_copy']) print_application_message.message_green() php_install.cp_source() print_application_message = common(MESSAGE_INFO['cp_php_install_shell']) print_application_message.message_green() php_install.cp_php_install_shell() print_application_message = common(MESSAGE_INFO['create_php_group_and_user']) print_application_message.message_green() php_install.create_php_group_and_user() print_application_message = common(MESSAGE_INFO['create_php_log_dir']) print_application_message.message_green() php_install.create_php_log_dir() print_application_message = common(MESSAGE_INFO['create_php_error_log_file']) print_application_message.message_green() php_install.create_php_error_log_file() print_application_message = common(MESSAGE_INFO['install_php']) print_application_message.message_green() php_install.install_php() print_application_message = common(MESSAGE_INFO['cp_main_phpini_config']) print_application_message.message_green() php_install.cp_main_phpini_config() print_application_message = common(MESSAGE_INFO['cp_php_www_conf_config']) print_application_message.message_green() php_install.cp_php_www_conf_config() print_application_message = common(MESSAGE_INFO['cp_php_php_fpm_config']) print_application_message.message_green() php_install.cp_php_php_fpm_config() print_application_message = common(MESSAGE_INFO['cp_php_php_fpm_service']) print_application_message.message_green() php_install.cp_php_php_fpm_service() print_application_message = common(MESSAGE_INFO['start_php']) print_application_message.message_green() php_install.start_php() print_application_message = common(MESSAGE_INFO['php_clean_local_tmp_cache_files']) print_application_message.message_green() php_install.clean_local_tmp_cache_files()def run_install_redis(): print_application_message = common(MESSAGE_INFO['redis_copy']) print_application_message.message_green() redis_install.cp_source() print_application_message = common(MESSAGE_INFO['cp_redis_install_shell']) print_application_message.message_green() redis_install.cp_redis_install_shell() print_application_message = common(MESSAGE_INFO['create_redis_group_and_user']) print_application_message.message_green() redis_install.create_redis_group_and_user() print_application_message = common(MESSAGE_INFO['install_redis']) print_application_message.message_green() redis_install.install_redis() print_application_message = common(MESSAGE_INFO['create_redis_log_file']) print_application_message.message_green() redis_install.create_redis_log_file() print_application_message = common(MESSAGE_INFO['crate_redis_data_dir']) print_application_message.message_green() redis_install.crate_redis_data_dir() print_application_message = common(MESSAGE_INFO['copy_redis_config']) print_application_message.message_green() redis_install.copy_redis_config() print_application_message = common(MESSAGE_INFO['copy_redis_service_config']) print_application_message.message_green() redis_install.copy_redis_service_config() print_application_message = common(MESSAGE_INFO['redis_clean_local_tmp_cache_file']) print_application_message.message_green() redis_install.clean_local_tmp_cache_file()def run_install_jdk(): print_application_message = common(MESSAGE_INFO['yum_install_jdk']) print_application_message.message_green() yum_install_jdk()def run_install_zabbix_agent(): print_application_message = common(MESSAGE_INFO['zabbix_copy']) print_application_message.message_green() zabbix_agent_install.cp_source() print_application_message = common(MESSAGE_INFO['cp_zabbix_agent_install_shell']) print_application_message.message_green() zabbix_agent_install.cp_zabbix_agent_install_shell() print_application_message = common(MESSAGE_INFO['create_zabbix_group_and_user']) print_application_message.message_green() zabbix_agent_install.create_zabbix_group_and_user() print_application_message = common(MESSAGE_INFO['create_zabbix_agent_log_dir']) print_application_message.message_green() zabbix_agent_install.create_zabbix_agent_log_dir() print_application_message = common(MESSAGE_INFO['install_zabbix_agent']) print_application_message.message_green() zabbix_agent_install.install_zabbix_agent() print_application_message = common(MESSAGE_INFO['copy_zabbix_agent_config_file']) print_application_message.message_green() zabbix_agent_install.copy_zabbix_agent_config_file() print_application_message = common(MESSAGE_INFO['copy_zabbix_agent_init_file']) print_application_message.message_green() zabbix_agent_install.copy_zabbix_agent_init_file() print_application_message = common(MESSAGE_INFO['zabbix_clean_local_tmp_cache_file']) print_application_message.message_green() zabbix_agent_install.clean_local_tmp_cache_file() print_application_message = common(MESSAGE_INFO['add_zabbix_agent_init']) print_application_message.message_green() zabbix_agent_install.add_zabbix_agent_init() print_application_message = common(MESSAGE_INFO['start_zabbix_agentd']) print_application_message.message_green() zabbix_agent_install.start_zabbix_agentd()def run_install_mysqlxx(): print_application_message = common(MESSAGE_INFO['deletexx_old_conf']) print_application_message.message_green() mysqlxx_install.delete_old_conf() print_application_message = common(MESSAGE_INFO['deletexx_old_conf_dir']) print_application_message.message_green() mysqlxx_install.delete_old_conf_dir() print_application_message = common(MESSAGE_INFO['mysqlxx_source']) print_application_message.message_green() mysqlxx_install.cp_source() print_application_message = common(MESSAGE_INFO['cp_mysqlxx_conf']) print_application_message.message_green() mysqlxx_install.cp_mysql_conf() print_application_message = common(MESSAGE_INFO['copy_mysqlxx_install_sh']) print_application_message.message_green() mysqlxx_install.copy_mysql_install_sh() print_application_message = common(MESSAGE_INFO['add_mysqlxx_user_and_group']) print_application_message.message_green() mysqlxx_install.add_mysql_user_and_group() print_application_message = common(MESSAGE_INFO['createxx_related_directories']) print_application_message.message_green() mysqlxx_install.create_related_directories() print_application_message = common(MESSAGE_INFO['createxx_slowlog_file']) print_application_message.message_green() mysqlxx_install.create_slowlog_file() print_application_message = common(MESSAGE_INFO['install_mysqlxx']) print_application_message.message_green() mysqlxx_install.install_mysql() print_application_message = common(MESSAGE_INFO['add_mysqlxx_to_PATH']) print_application_message.message_green() mysqlxx_install.add_mysql_to_PATH() print_application_message = common(MESSAGE_INFO['copy_mysqlxx_service_file']) print_application_message.message_green() mysqlxx_install.copy_mysql_service_file() print_application_message = common(MESSAGE_INFO['cleanxx_local_tmp_cache_file']) print_application_message.message_green() mysqlxx_install.clean_local_tmp_cache_file() print_application_message = common(MESSAGE_INFO['start_mysqlxx_and_enable_it_onboot']) print_application_message.message_green() mysqlxx_install.start_mysql_and_enable_it_onboot()def run_install_mysqlxx13(): print_application_message = common(MESSAGE_INFO['deletexx13_old_conf']) print_application_message.message_green() mysqlxx13_install.delete_old_conf() print_application_message = common(MESSAGE_INFO['deletexx13_old_conf_dir']) print_application_message.message_green() mysqlxx13_install.delete_old_conf_dir() print_application_message = common(MESSAGE_INFO['mysqlxx13_source']) print_application_message.message_green() mysqlxx13_install.cp_source() print_application_message = common(MESSAGE_INFO['cp_mysqlxx13_conf']) print_application_message.message_green() mysqlxx13_install.cp_mysql_conf() print_application_message = common(MESSAGE_INFO['copy_mysqlxx13_install_sh']) print_application_message.message_green() mysqlxx13_install.copy_mysql_install_sh() print_application_message = common(MESSAGE_INFO['add_mysqlxx13_user_and_group']) print_application_message.message_green() mysqlxx13_install.add_mysql_user_and_group() print_application_message = common(MESSAGE_INFO['createxx13_related_directories']) print_application_message.message_green() mysqlxx13_install.create_related_directories() print_application_message = common(MESSAGE_INFO['createxx13_slowlog_file']) print_application_message.message_green() mysqlxx13_install.create_slowlog_file() print_application_message = common(MESSAGE_INFO['install_mysqlxx13']) print_application_message.message_green() mysqlxx13_install.install_mysql() print_application_message = common(MESSAGE_INFO['add_mysqlxx13_to_PATH']) print_application_message.message_green() mysqlxx13_install.add_mysql_to_PATH() print_application_message = common(MESSAGE_INFO['copy_mysqlxx13_service_file']) print_application_message.message_green() mysqlxx13_install.copy_mysql_service_file() print_application_message = common(MESSAGE_INFO['cleanxx13_local_tmp_cache_file']) print_application_message.message_green() mysqlxx13_install.clean_local_tmp_cache_file() print_application_message = common(MESSAGE_INFO['start_mysqlxx13_and_enable_it_onboot']) print_application_message.message_green() mysqlxx13_install.start_mysql_and_enable_it_onboot()def run_install_all_application_package(): if len(APP) != (0): print_application_message = common(MESSAGE_INFO['start_yum_tools_install']) print_application_message.message_blue() run_yum_install() if 'nginx' in APP: print_application_message = common(MESSAGE_INFO['start_nginx_install']) print_application_message.message_blue() run_install_nginx() if 'php' in APP: print_application_message = common(MESSAGE_INFO['start_php_install']) print_application_message.message_blue() run_install_php() if 'redis' in APP: print_application_message = common(MESSAGE_INFO['start_redis_install']) print_application_message.message_blue() run_install_redis() if 'jdk' in APP: print_application_message = common(MESSAGE_INFO['start_jdk_install']) print_application_message.message_blue() run_install_jdk() if 'zabbix_agent' in APP: print_application_message = common(MESSAGE_INFO['start_zabbix_agentd_install']) print_application_message.message_blue() run_install_zabbix_agent() if 'mysql_xx' in APP: print_application_message = common(MESSAGE_INFO['start_mysqlxx_install']) print_application_message.message_blue() run_install_mysqlxx() if 'mysql_xx13' in APP: print_application_message = common(MESSAGE_INFO['start_mysqlxx13_install']) print_application_message.message_blue() run_install_mysqlxx13() å®šä¹‰å…¥å£æ–‡ä»¶kvm.py æ˜¯æ‰€æœ‰ç¨‹åºæ‰§è¡Œçš„å…¥å£æ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#!/usr/bin/env python2# -*- coding: utf-8 -*-from prettytable import PrettyTablefrom config.hosts import SOURCES_HOSTS,TARGETS_HOSTS,KVM_HOSTSfrom fabric.contrib.files import *from application.kvmcreate import *from application.appcreate import *@hosts(SOURCES_HOSTS)def kvm_sources_clone_scp(): kvm_create()@hosts(TARGETS_HOSTS)def kvm_targets_site(): targets_hosts_start_kvm()@hosts(KVM_HOSTS)def kvm_virture_host_start_site(): kvm_virture_hosts_site() run_install_all_application_package() kvm_tirture_hosts_site_passwd() kvm_virture_hosts_print()@task(name='install')def run_all(): execute(kvm_sources_clone_scp) execute(kvm_targets_site) execute(kvm_virture_host_start_site)@task(name='help')def deploy_help(): print green("KVMäº§å“åŠCentOS7åº”ç”¨éƒ¨ç½²") print yellow(" 1.é…ç½®æ–‡ä»¶") helper = PrettyTable() helper.field_names = ["é…ç½®","è¯´æ˜Ž"] helper.align = "l" helper.add_row(["config/__init__.py", "é…ç½®æ–‡ä»¶å¼€å…³"]) helper.add_row(["config/test/kvm_config.py", "æµ‹è¯•çŽ¯å¢ƒéƒ¨ç½²é…ç½®"]) helper.add_row(["config/prod/kvm_config.py", "ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²é…ç½®"]) print helper print red(" 2.æŒ‡ä»¤è¯´æ˜Ž") helper = PrettyTable() helper.field_names = ["æŒ‡ä»¤","è¯´æ˜Ž"] helper.align = "l" helper.add_row(["fab -f kvm.py -l", "åˆ—å‡ºéƒ¨ç½²äº§å“"]) helper.add_row(["fab -f kvm.py install", "å®‰è£…kvm,å¹¶æ•´åˆé…ç½®çš„åº”ç”¨è‡³kvmæ–°è™šæ‹ŸæœåŠ¡å™¨"]) print helper print blue(" 3.ä½œè€…ä¿¡æ¯") helper = PrettyTable() helper.field_names = ["ä½œè€…","ä¿¡æ¯"] helper.add_row(["å§“å", "ä»»é”¦"]) helper.add_row(["æ‰‹æœºå·", "13161389224"]) helper.add_row(["åšå®¢åœ°å€", "www.ssjinyao.com"]) print helper æœåŠ¡å™¨éƒ¨ç½²å®Œæ­¤ä»£ç åŽï¼Œå®šä¹‰åˆ«åè°ƒç”¨kvm.pyå®žçŽ°å¿«é€Ÿå¼€é€š1234567# alias kc1='source /root/renjin/kvm_pyenv/bin/activate &amp;&amp; vim /root/renjin/kvm_create/config/__init__.py'# alias kc2p='vim +33 /root/renjin/kvm_create/config/prod/kvm_config.py'# alias kc2t='vim +33 /root/renjin/kvm_create/config/test/kvm_config.py'# alias kc3='cd /root/renjin/kvm_create/ &amp;&amp; fab -f kvm.py install'# alias kcok1='vim /root/renjin/kvm_create/config/__init__.py'# alias kcok2p='vim +33 /root/renjin/kvm_create/config/prod/kvm_config.py'# alias kcok2t='vim +33 /root/renjin/kvm_create/config/test/kvm_config.py' è‡ªåŠ¨åŒ–å¿«é€Ÿå¼€å¯å¼€é€škvmè™šæ‹ŸåŒ–æœåŠ¡å™¨123456789101112131415************************************************************************************************************** KVM ENV Is: test ******************** KVM Host Name Is: xx-xxxx-xx-xxx-xxxx-xxxx ******************** KVM IP Is: xxx.xx.xx.xx ******************** TARGET IP Is: xxx.xx.xxx.xx ******************** KVM Gateway Is: xxx.xx.x.x ******************** KVM Netmask Is: xxx.xxx.xxx.x ******************** KVM APP Is: zabbix_agent nginx mysql_xx ******************** KVM CPU Is: 2 ******************** KVM Memory Is: 4194304 ******************** KVM Disk Is: 100G ******************** KVM Passwd IS: xxxxxxxXXXX **************************************************************************************************************If the information is incorrect, please input no: å¼€é€škvmè™šä¼¼æœåŠ¡å™¨å·²ç»å®Œæˆï¼Œä¿¡æ¯å¦‚ä¸‹12345678910111213141516171819************************************************************************************************************** KVM ENV Is: test ******************** KVM Host Name Is: bj-xxxx-xx-xxx-xxxx-xxxxx ******************** KVM IP Is: xxx.xx.xx.xx ******************** TARGET IP Is: xxx.xx.xxx.xx ******************** KVM Gateway Is: xxx.xx.xx.x ******************** KVM Netmask Is: xxx.xxx.xxx.0 ******************** KVM APP Is: zabbix_agent nginx mysql_xx ******************** KVM CPU Is: 2 ******************** KVM Memory Is: 4194304 ******************** KVM Disk Is: 100G ******************** KVM Passwd IS: XXXXXXXX **************************************************************************************************************Done.Disconnecting from xxx.xx.xx.xx... done.Disconnecting from xxx.xx.xx.xx... done.Disconnecting from xxx.xx.xx.xx... done.]]></content>
      <tags>
        <tag>linux</tag>
        <tag>cloud</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽæŸç³»ç»Ÿé˜µå‘æ€§ç½‘ç»œé—®é¢˜çš„å¤„ç†ã€‚]]></title>
    <url>%2F2019%2F03%2F16%2F%E5%85%B3%E4%BA%8E%E6%9F%90%E7%B3%BB%E7%BB%9F%E9%98%B5%E5%8F%91%E6%80%A7%E7%BD%91%E7%BB%9C%E5%A4%84%E7%90%86%2F</url>
    <content type="text"><![CDATA[å…³äºŽæŸç³»ç»Ÿé˜µå‘æ€§ç½‘ç»œé—®é¢˜çš„å¤„ç†ã€‚ ä¸€ã€é—®é¢˜æè¿° 1ã€xxx ã€ç§»åŠ¨ xx ç­‰ç³»ç»Ÿé˜µå‘æ€§ç½‘ç»œè¿žæŽ¥å¤±è´¥; 2ã€keepalived è™šæ‹Ÿipæœªå‘ç”Ÿåˆ‡æ¢ï¼Œnginx è®¿é—®æ—¥å¿—è®°å½•æ­£å¸¸ï¼Œæœªæ”¶åˆ°é”™è¯¯æ—¥å¿—ï¼Œç½‘ç»œåŠé“¾è·¯æµ‹è¯•æ­£å¸¸; 3ã€keepalvied+ nginx åä»£çš„å…¶ä½™ç³»ç»Ÿæœªå‘çŽ°é˜µå‘æ€§ç½‘ç»œé—®é¢˜; 4ã€ä¿®æ”¹æœ¬åœ°è§£æžåˆ°keepalivedè™šæ‹Ÿipï¼ŒXXXç›¸å…³ç³»ç»Ÿè®¿é—®æ­£å¸¸ã€‚ äºŒã€åº”æ€¥åˆ‡æ¢ä¸Žæ•…éšœé‡çŽ° 1ã€å‘¨äºŒé¢‘ç¹å‡ºçŽ°é˜µå‘æ€§ç½‘ç»œè¿žæŽ¥å¤±è´¥ï¼Œåº”æ€¥å°†XXXè™šipåˆ‡æ¢å›žåŽŸç§æœ‰äº‘æœåŠ¡å™¨ï¼Œç³»ç»Ÿæ¢å¤; 2ã€åŽè€ƒè™‘ç§»åŠ¨xxç³»ç»Ÿå‡ºçŽ°çš„ç½‘ç»œé—®é¢˜é¢‘çŽ‡è¾ƒé«˜ï¼Œå› æ­¤è€ƒè™‘åœ¨ä¸ªäººå®¢æˆ·ç«¯é‡çŽ°æ•…éšœ; 3ã€åœ¨ä¸ªäººmacosä¸­æ­å»ºdnsæœåŠ¡å™¨ï¼Œé…ç½®xxåŸŸåè§£æžåˆ°éžXXX ç³»ç»Ÿkeepavliedè™šipæ‰€æ˜ å°„çš„å…¬ç½‘ip; 4ã€åœ¨æ‰‹æœºä¸Šåˆ·æ–°appï¼Œå¤šæ¬¡åˆ·æ–°ï¼Œé”å±å†æ‰“å¼€åŽæ•…éšœé‡çŽ°ã€‚ ä¸‰ã€é—®é¢˜å®šä½ 1ã€æ•…éšœé‡çŽ°åŽï¼Œåœ¨XXXç³»ç»Ÿ keepailved æ‰€åœ¨çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œ tcpdump æŠ“åŒ…åˆ†æž; 2ã€å› ç›®å‰åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è®¿é—®éžXXX nginxï¼Œå› æ­¤å¯ä»¥çœ‹åˆ°nginxæ—¥å¿—æ˜¯ä¸€ä¸ªå…¬ç½‘ipè®¿é—®è¿‡æ¥çš„; 3ã€å¼€å¯ä¸¤ä¸ªç»ˆç«¯ï¼Œä¸€ä¸ªå®žæ—¶ç›‘æŽ§æ—¥å¿—ï¼Œå¦ä¸€ä¸ªç”¨äºŽtcpdumpæŠ“åŒ…ä¿å­˜ 12# tail -f /var/log/nginx/oa.huatu.com.log # tcpdump -i team1 -s 0 -n &apos;host xxx.xxx.xxx.xxx&apos; -w /tmp/xx_packet.pcap 4ã€å½“appç«¯é—®é¢˜å¤çŽ°åŽï¼Œå‘çŽ°nginx æœªè®°å½•æ—¥å¿—, å°† xx_packet.pcap å¯¼å‡ºï¼Œç”¨wireshark å¯¼å‡ºåˆ†æž 5ã€å‘çŽ°æœ‰ä¸‰æ¬¡tcpè¯·æ±‚æ˜¯æ­£å¸¸è¿›å…¥ç½‘å¡çš„ï¼Œä½†æ˜¯æœåŠ¡å™¨æ²¡æœ‰å›žåº”ï¼Œé—®é¢˜å®šä½åœ¨æœåŠ¡å™¨ç½‘ç»œå±‚é¢; 6ã€googleæœç´¢ linux tcp æ²¡æœ‰å›žåŒ… ï¼Œå‘çŽ°åŽŸç†æ˜¯ç”±ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°å¯¼è‡´çš„ 7ã€net.ipv4.tcp_timestamps net.ipv4.tcp_tw_recycle; 8ã€å‘çŽ°æœåŠ¡å™¨ä¸Šçš„net.ipv4.tcp_timestampsï¼Œnet.ipv4.tcp_tw_recycle éƒ½ä¸º1; å››ã€æ•…éšœå¤„ç†ä¿®æ”¹ä¸¤å°æœåŠ¡å™¨çš„ /etc/sysctl.conf ä»¥ä¸‹ä¸¤æ¡å†…æ ¸å‚æ•°ï¼Œå¹¶ç”Ÿæ•ˆ; 12345# vim /etc/sysctl.confnet.ipv4.tcp_tw_recycle = 0net.ipv4.tcp_timestamps = 0 # sysctl -p ç”Ÿæ•ˆ å°†keepalived è™šæ‹Ÿipå†åˆ‡æ¢å›žç‰©ç†æœåŠ¡å™¨ï¼Œæ•…éšœå¤„ç†; äº”ã€å†…æ ¸å‚æ•°è¯´æ˜Ž; 1ã€net.ipv4.tcp_timestamps æ˜¯ç»™æ‰€æœ‰è¿›å…¥æœåŠ¡å™¨ç½‘å¡çš„æµé‡æ‰“æ—¶é—´æ ‡ç­¾ï¼Œå°±åƒç”Ÿäº§çš„é¢åŒ…æ‰“å°ç”Ÿäº§æ—¥æœŸ; 2ã€net.ipv4.tcp_tw_recycle æ˜¯å¯¹è¿žæŽ¥æ—¶é—´è¶…è¿‡60sçš„tcpèµ„æºè¿›è¡Œå›žæ”¶å¹¶rejectï¼ŒåŒä¸€æ—¶é—´å†…åŒä¸€ipè®¿é—®è¿‡å¤šçš„tcpè¿žæŽ¥ï¼Œå®ƒåªä¼šè®¤ä¸ºæœ€è¿‘çš„ä¸€æ¬¡SYNæœ‰æ•ˆï¼Œå…¶ä½™çš„SYNæ‹’ç»; è¿™ä¸¤æ¡å‚æ•°é…åˆèµ·æ¥ï¼Œå½“éƒ½å¼€å¯æ—¶ç”¨äºŽé˜²èŒƒtcpæ”»å‡»; 3ã€è¿™ä¸¤ä¸ªå‚æ•°ç»“åˆèµ·æ¥æ˜¯ä¸ºäº†é˜²æ­¢åŒä¸€ipçš„tcpæ”»å‡»ï¼Œå› åŒä¸€å±€åŸŸç½‘å†…æ˜¯åŒä¸€ä¸ªå…¬ç½‘ipï¼Œæ•…é€ æˆåŒä¸€å±€åŸŸç½‘å†…å¤šäººè®¿é—®æ—¶ï¼ŒSYNè¢«æ‹’ç»ï¼ŒæŠ¥ç½‘ç»œé”™è¯¯ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä½•éžXXXä¸šåŠ¡è®¿é—®æœªå‡ºçŽ°è¿™æ ·çš„é—®é¢˜ã€é€šè¿‡ä¿®æ”¹æœ¬åœ°hostè§£æžç›´æŽ¥è®¿é—®ç§ç½‘ipæœªå‡ºçŽ°è¿™æ ·çš„é—®é¢˜ã€‚]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nginx+lua+redis å®žçŽ°çŸ­é“¾æŽ¥è½¬å‘é•¿é“¾æŽ¥]]></title>
    <url>%2F2019%2F03%2F11%2Fnginx-lua-redis%E5%AE%9E%E7%9F%AD%E9%93%BE%E6%8E%A5%E8%BD%AC%E5%8F%91%E9%95%BF%E9%93%BE%E6%8E%A5%2F</url>
    <content type="text"><![CDATA[nginx + lua + redis å®žçŽ°çŸ­é“¾æŽ¥è½¬å‘é•¿é“¾æŽ¥ é‡æ–°ç¼–è¯‘å®‰è£… nginx åŠç›¸å…³ä¾èµ–å®‰è£…ç›¸å…³ä¾èµ–åŒ… 1# yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel lua-devel luajit-devel pcre pcre-devel libxml2 libxml2-dev libxslt-devel gd-devel perl-devel perl-ExtUtils-Embed GeoIP GeoIP-devel GeoIP-data gperftools ä¸‹è½½nginx_devel_kit lua-nginx-module 1234# wget https://github.com/simplresty/ngx_devel_kit/archive/master.zip# wget https://github.com/openresty/lua-nginx-module/archive/v0.10.13.tar.gz# unzip master.zip &amp;&amp; mv ngx_devel_kit-master/ /usr/local/# tar -xvf v0.10.13.tar.gz -C /usr/local/ é‡æ–°å®‰è£… nginx 123# cd /usr/local/src/nginx-1.12.2# ./configure --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/lib/nginx/tmp/client_body --http-proxy-temp-path=/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path=/var/lib/nginx/tmp/scgi --pid-path=/run/nginx.pid --lock-path=/run/lock/subsys/nginx --user=nginx --group=nginx --with-file-aio --with-ipv6 --with-http_auth_request_module --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_slice_module --with-http_stub_status_module --with-http_perl_module=dynamic --with-mail=dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream=dynamic --with-stream_ssl_module --with-google_perftools_module --with-debug --with-cc-opt='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic' --with-ld-opt='-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E' --add-module=/usr/local/lua-nginx-module-0.10.13 --add-module=/usr/local/ngx_devel_kit-master# make &amp;&amp; make install å®‰è£…lua-resty-redis 12345678# cd /usr/local/src# wget https://github.com/openresty/lua-resty-redis/archive/master.zip# unzip master.zip# cd lua-resty-redis-master/# make &amp;&amp; make installmake: Nothing to be done for `all'.install -d /usr/local/lib/lua//restyinstall lib/resty/*.lua /usr/local/lib/lua//resty ä¿®æ”¹nginx http æ®µå†…é…ç½®æ–‡ä»¶httpå†…æ·»åŠ  lua_package_path &quot;/usr/local/lib/lua/?.lua;;&quot;;;; ä»£è¡¨çš„æ˜¯LuaJITå®‰è£…æ—¶çš„åŽŸå§‹æœç´¢è·¯å¾„ 1# nginx -t &amp;&amp; nginx -s reload ä¿®æ”¹nginx serveræˆ–location å­—æ®µ1234location /lua &#123; default_type text/plain; content_by_lua_file /usr/local/lua/request.lua; &#125; request.lua12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455# vim /usr/local/lua/request.lualocal redis = require "resty.redis"local cache = redis:new()-- redisè¿žæŽ¥local ok,err = cache.connect(cache, '127.0.0.1', '25612')if not ok then ngx.say("failed to connect redis cache:", err); returnend-- redisè®¤è¯local countcount, err = cache:get_reused_times()if 0 == count then ok,err = cache:auth("xxxxx") if not ok then ngx.say("failed to auth redis: " , err) return endelseif err then ngx.say("failed to get reused times: ", err) returnend-- é€‰æ‹©ä½¿ç”¨çš„redisæ•°æ®åº“cache:select(7)-- å½“å‰è®¿é—®åœ°å€local url = ngx.var.uri-- ä¸»æœºålocal host = ngx.var.host-- é“¾æŽ¥å‚æ•°local args = ngx.var.args-- èŽ·å–æ–¹æ³•local sch =ngx.var.scheme-- èŽ·å–ç«¯å£--local pot =ngx.var.server_port-- å®šä¹‰é€šç”¨å®Œæ•´ url è·¯å¾„local url_full_path = sch .. "://" .. host .. url-- èŽ·å–redis ä¸­çš„å€¼local res, err = cache:get(url_full_path)-- ngx.req.set_uri(url)if res then --ngx.say(sch .. "://" .. host .. url .. " " .. res) ngx.redirect(res,302)end# nginx -s reload åœ¨redis å†™å…¥key å¹¶æµ‹è¯•1234567# redis-cli -h 127.0.0.1 -p 25612127.0.0.1:25612&gt; AUTH xxxxxxxxxxOK127.0.0.1:25612&gt; SELECT 7OK127.0.0.1:25612[7]&gt; set https://www.ssjinyao.com/lua/test https://www.ssjinyao.com/2019/03/16/%E5%85%B3%E4%BA%8E%E6%9F%90%E7%B3%BB%E7%BB%9F%E9%98%B5%E5%8F%91%E6%80%7%E7%BD%91%E7%BB%9C%E5%A4%84%E7%90%86/OK å¯ä»¥çœ‹åˆ°è®¿é—®æ—¶çš„ä¸­è½¬ è¡¥å……nginx rewriteè½¬å‘æ­£åˆ™åŒ¹é…1rewrite ^/([0-9][0-9][0-9][0-9])/([0-1][0-9][0-9][0-9])/([0-9]+\.html) http://test.ssjinyao.com/$1/$2/$3 permanent;]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœåŠ¡å™¨å¸¸ç”¨é…ç½®å‚æ•°æ˜Žç»†]]></title>
    <url>%2F2018%2F10%2F29%2F%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E6%98%8E%E7%BB%86%2F</url>
    <content type="text"><![CDATA[çº¿ä¸ŠæœåŠ¡é…ç½®å‚æ•°æ˜Žç»† nginxæœåŠ¡é…ç½®é¡¹1ã€ nginx å…¨å±€é…ç½®æ˜Žç»† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162# é»˜è®¤ /etc/nginx/nginx.conf å…¨å±€é…ç½®æ–‡ä»¶ #æŒ‡å®šnginx workerè¿›ç¨‹è¿è¡Œç”¨æˆ·ä»¥åŠç”¨æˆ·ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯ user www-data www-data;user www-data; # æŒ‡æ˜Žnginxè¦å¼€å¯çš„è¿›ç¨‹æ•°ä¸º4ï¼Œä¸€èˆ¬ä¸ºCPUæ ¸å¿ƒæ•°çš„1åˆ°2å€;worker_processes 4;# nginx pidæ–‡ä»¶å­˜æ”¾ä½ç½® pid /run/nginx.pid;# events &#123;è¿™é‡Œéƒ½æ˜¯nginxçš„äº‹ä»¶æ¨¡å—&#125;events &#123;# worker_connetctions æ˜¯æŒ‡nginxæœ€å¤§çš„å¹¶å‘è¿žæŽ¥æ•°; worker_connections 768;&#125;# http &#123;è®¾å®šhttpæœåŠ¡&#125;http &#123;# è®¾ç½®nginxä¸Šä¼ æ–‡ä»¶æœ€å¤§é™åˆ¶ client_max_body_size 50m; # é…ç½®å¯ä»¥æé«˜ Nginx é™æ€èµ„æºæ‰˜ç®¡æ•ˆçŽ‡ã€‚sendfile æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç›´æŽ¥åœ¨å†…æ ¸ç©ºé—´å®Œæˆæ–‡ä»¶å‘é€ï¼Œä¸éœ€è¦å…ˆ read å† writeï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€; sendfile on; # Nginx é‡Œç»Ÿä¸€ç”¨ tcp_nopush æ¥æŽ§åˆ¶å®ƒ,åªæœ‰åœ¨å¯ç”¨äº† sendfile ä¹‹åŽæ‰ç”Ÿæ•ˆï¼Œå¯ç”¨å®ƒä¹‹åŽï¼Œæ•°æ®åŒ…ä¼šç´¯è®¡åˆ°ä¸€å®šå¤§å°ä¹‹åŽæ‰ä¼šå‘é€ï¼Œå‡å°äº†é¢å¤–å¼€é”€ï¼Œæé«˜ç½‘ç»œæ•ˆçŽ‡; tcp_nopush on; # å¯ç”¨åŽä¼šç¦ç”¨ Nagle ç®—æ³•ï¼Œå°½å¿«å‘é€æ•°æ®ï¼ŒNginx åªä¼šé’ˆå¯¹å¤„äºŽ keep-alive çŠ¶æ€çš„ TCP è¿žæŽ¥æ‰ä¼šå¯ç”¨; tcp_nodelay on; # é•¿è¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’,é•¿è¿žæŽ¥è¯·æ±‚å¤§é‡å°æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘é‡å»ºè¿žæŽ¥çš„å¼€é”€ï¼Œä½†å‡å¦‚æœ‰å¤§æ–‡ä»¶ä¸Šä¼  # 65så†…æ²¡ä¸Šä¼ å®Œæˆä¼šå¯¼è‡´å¤±è´¥ã€‚å¦‚æžœè®¾ç½®æ—¶é—´è¿‡é•¿ï¼Œç”¨æˆ·åˆå¤šï¼Œé•¿æ—¶é—´ä¿æŒè¿žæŽ¥ä¼šå ç”¨å¤§é‡èµ„æºã€‚ keepalive_timeout 65; # types_hash_max_size å½±å“æ•£åˆ—è¡¨çš„å†²çªçŽ‡ã€‚types_hash_max_sizeè¶Šå¤§ï¼Œå°±ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜# ä½†æ•£åˆ—keyçš„å†²çªçŽ‡ä¼šé™ä½Žï¼Œæ£€ç´¢é€Ÿåº¦å°±æ›´å¿«# types_hash_max_sizeè¶Šå°ï¼Œæ¶ˆè€—çš„å†…å­˜å°±è¶Šå°ï¼Œä½†æ•£åˆ—keyçš„å†²çªçŽ‡å¯èƒ½ä¸Šå‡ types_hash_max_size 2048; # å®šä¹‰ mime é…ç½®æ–‡ä»¶çš„æ–‡ä½ include /etc/nginx/mime.types; # å½“ç”¨æˆ·è¯·æ±‚çš„æ–‡ä»¶ç±»åž‹ ä¸åœ¨æœåŠ¡å™¨å®šä¹‰çš„mimeç±»åž‹æ˜ å°„æ—¶ï¼Œä½¿ç”¨DefaultType default_type application/octet-stream; # å®šä¹‰nginxæ­£å¸¸è®¿é—®æ—¥å¿—ä½ç½® access_log /var/log/nginx/access.log; # å®šä¹‰nginxé”™è¯¯è®¿é—®æ—¥å¿—ä½ç½® error_log /var/log/nginx/error.log; # å¼€å¯nginxåŽ‹ç¼©åŠŸèƒ½ï¼ŒåŽ‹ç¼©çš„è¿‡ç¨‹æ˜¯ä¸ªæ¶ˆè€—CPUçš„è¿‡ç¨‹ï¼Œè€ŒåŽ‹ç¼©è¿‡åŽä¼ è¾“è¿‡ç¨‹å¯ä»¥èŠ‚çœå¸¦å®½; gzip on; # å¯¹äºŽmicrosoft explorer 6 ä¸å¯ç”¨gzipåŽ‹ç¼©åŠŸèƒ½; gzip_disable &quot;msie6&quot;;# nginx è™šæ‹ŸæœåŠ¡å™¨é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•; include /etc/nginx/conf.d/*.conf; # nginx è™šæ‹ŸæœåŠ¡å™¨é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•; include /etc/nginx/sites-enabled/*.conf;&#125; 2ã€ nginx é»˜è®¤80é‡å®šå‘443é…ç½® 12345678910111213141516# æ¯ä¸ªserverä»£è¡¨ä¸€å°è™šæ‹Ÿä¸»æœº;server &#123; # listen 80 ç›‘å¬80ç«¯å£; listen 80; # server_name _; å®šä¹‰ä»»æ„åŸŸå; server_name _ï¼›# å°†è¿”å›ž301çš„é‡å†™åˆ°https://æºæœåŠ¡å™¨æºuri; return 301 https://$HOST$request_uri;# å°†server_name æ°¸ä¹…çš„å°†ä»»æ„å­—ç¬¦å¼€å¤´ç»“å°¾çš„ é‡å†™è‡³https://æºä¸»æœºæºuriä½ç½®;# server_name test.com; # rewrite ^(.*)$ https://$host$1 permanent; &#125; 3ã€ nginx çº¿ä¸Šè™šæ‹Ÿä¸»æœºé…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657# æ¯ä¸ªserverä»£è¡¨åˆ°å“ªè™šæ‹Ÿä¸»æœº;server &#123;# ç›‘å¬httpsä¼ è¾“åè®®çš„443ç«¯å£ï¼Œsslä¸ºé‡‡ç”¨åŠ å¯†ä¼ è¾“ï¼Œå¹¶ä¸”èº«ä»½è¯æ˜Ž; listen 443 ssl;# sslå®‰å…¨ä¼ è¾“å¼€å¯; ssl on;# æ³¨åœ¨apacheä¸­è¯ä¹¦ä¸ŽåŠ å¯†ä¼ è¾“è¿˜æœ‰pemæ˜¯ä¸‰ä¸ªæ–‡ä»¶# sslæŽˆæƒè¯ä¹¦æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºèº«ä»½çš„è¯æ˜Žæ–‡ä»¶; ssl_certificate /home/admin/api_ssl/server.crt;# sslåŠ å¯†æ–‡ä»¶,æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ­¤å¯†é’¥æ–‡ä»¶å°†ä¼ é€çš„æ•°æ®åŠ å¯†ç ; ssl_certificate_key /home/admin/api_ssl/server.key;# è®¾ç½®å®¢æˆ·ç«¯èƒ½å¤Ÿé‡å¤ä½¿ç”¨å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„ä¼šè¯å‚æ•°æ—¶é—´ä¸º5åˆ†é’Ÿ; ssl_session_timeout 5m;# æŒ‡å®šä½¿ç”¨çš„SSLåè®® ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;# æŒ‡å®šè®¸å¯å¯†ç çš„æè¿°ã€‚å¯†ç ä»¥opensslæ”¯æŒçš„æ ¼å¼æŒ‡å®šï¼› ssl_ciphers &quot;HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES&quot;;# å¯¹SSLv3å’ŒTLSv1åè®®çš„æœåŠ¡å™¨ç«¯å¯†ç éœ€æ±‚ä¼˜å…ˆçº§é«˜äºŽå®¢æˆ·ç«¯å¯†ç ; ssl_prefer_server_ciphers on;# æŒ‡å®šè™šæ‹Ÿä¸»æœºçš„ä¸»æœºå; server_name api.ssjinyao.com.com; # location æŒ‡å®šåŒ¹é…è§„åˆ™, / è¿™é‡ŒæŒ‡é»˜è®¤åŒ¹é…é¡¹; location / &#123; # å°†åŒ¹é…åˆ°çš„locationåä»£åˆ°è‡³http://127.0.0.1:17777; proxy_pass http://127.0.0.1:17777; # è¿™é‡Œæ˜¯æŒ‡å‘ gunicorn host çš„æœåŠ¡åœ°å€# è®¾ç½®åå‘ä»£ç†çš„è¯·æ±‚å¤´éƒ¨hostä¸ºæºhttpçš„è¯·æ±‚host; proxy_set_header Host $host;# è®¾ç½®åå‘ä»£ç†çš„è¯·æ±‚å¤´éƒ¨è½¬å‘çš„å†…å®¹ä¸ºè¯·æ±‚urlçš„æºåœ°å€; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;# è®¾ç½®å°†ç”¨æˆ·çš„IPèµ‹å€¼ç»™X-Real-IPä»¥ä¾›å„åº”ç”¨è°ƒç”¨; proxy_set_header X-Real-Ip $Remote_addr;# è®¾ç½®ä»£ç†ç¼“å†²å¤§å°ä¸º128k proxy_buffer_size 128k;# è®¾ç½®ä»£ç†ç¼“å†²åŒºé—´4è‡³ 256k proxy_buffers 4 256k; # è®¾ç½®ä»£ç†æœ€å¤§ç¼“å†²åŒºé—´ä¸º256k; proxy_busy_buffers_size 256k; &#125;&#125; 4ã€éœ€æ±‚-è´Ÿè½½å‡è¡¡é…ç½®é¡¹: 12345678910111213# åœ¨httpæ®µä¸­åŠ å…¥ä»¥ä¸‹é…ç½®# æŒ‡å®šupstreamè´Ÿè½½å‡è¡¡æ¨¡å—,æŒ‡å®šå°†è¦åœ¨serverä¸­è°ƒç”¨çš„è°ƒåº¦æœåŠ¡åç§°; upstream tewww &#123;# æŒ‡å®šwebæœåŠ¡çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹; æ³¨:ä¹‹åŽé…ç½®ä½¿ç”¨IPæ¥é…ç½®ï¼Œè€Œä¸ä½¿ç”¨åŸŸå server wwwnode1.ssjinyao.com.com:443; # è‹¥æœ‰æ€§èƒ½è¾ƒé«˜çš„æœåŠ¡å™¨ï¼Œå¯ä»¥é‡‡ç”¨åŠ æƒè½®è¯¢ï¼Œé‚£ä¹ˆè¿™å°æœåŠ¡å™¨çš„æƒé‡æ˜¯3/5; server wwwnode2.ssjinyao.com.com:443 weight=3;# æŒ‡å®šwebæœåŠ¡çš„ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹; server wwwnode3.ssjinyao.com.com:443; &#125; 12345678910111213141516171819202122# åœ¨å®šä¹‰ä¸€å°è™šæ‹Ÿä¸»æœºï¼›server &#123; listen 443; server_name www.ssjinyao.com.com; ssl on; ssl_certificate /etc/nginx/te_ssl/ssjinyao.com.crt; ssl_certificate_key /etc/nginx/te_ssl/ssjinyao.com.key; ssl_session_timeout 5m; ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers &quot;HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES&quot;; ssl_prefer_server_ciphers on; location / &#123;# æŒ‡å®šåä»£çš„æœåŠ¡å™¨ï¼Œä¸ºtewwwè´Ÿè½½å‡è¡¡é›†ç¾¤; proxy_pass http://tewww; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; &#125; 5ã€nginxæ“ä½œæ³¨æ„é¡¹ 12345678aã€ä¸å½±å“å…¶å®ƒæœåŠ¡çš„æƒ…å†µä¸‹é‡è¯»é…ç½®æ–‡ä»¶, ä¸€å®šè¦å…ˆå¯¹nginxçš„é…ç½®è¯­æ³•è¿›è¡Œæµ‹è¯•; # sudo nginx -t bã€åœ¨æ²¡æœ‰nginxç›‘å¬ç«¯å£å˜æ›´çš„æƒ…å†µä¸‹ï¼Œåˆ™ä¸è¦é‡å¯æœåŠ¡; # sudo nginx -s reload cã€å¦‚ä¸Šï¼Œåä¹‹ï¼Œåˆ™å¿…éœ€é‡å¯æœåŠ¡å™¨ # sudo nginx -s restart # sudo /etc/init.d/nginx restart 6ã€nginxç›‘æŽ§ 1æœåŠ¡ç«¯çš„ç›‘æŽ§ï¼Œç›‘æŽ§nginx 443ç«¯å£ï¼Œ80ç«¯å£, æœ€è¿‘æœ€åŽä¸€æ¬¡å€¼ä¸ä¸º1æ—¶æŠ¥è­¦; 7ã€æ‰‹å¤´å­˜ä¸€ä»½æ ‡å‡†çš„é…ç½®æ–‡ä»¶ 8ã€ä¸€æ¬¡æ¯”è¾ƒå¤æ‚çš„è™šæ‹Ÿä¸»æœºé…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758server &#123; listen 80; server_name jr.local.ssjinyao.com; charset gb2312; access_log /Users/zlz/wwwroot/logs/jr.access.log; location / &#123; root /Users/zlz/wwwroot/dedecms/a/bank; index index.html index.htm index.php; location ~ \.php$ &#123; # default_type text/html; # add_header Content-Type &apos;text/html; charset=utf-8&apos;; # return 200 &quot;$document_root , $fastcgi_script_name&quot;; fastcgi_split_path_info ^(.+\.php)(.*)$; fastcgi_param PATH_INFO $fastcgi_path_info; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; &#125; &#125; location /zt &#123; alias /Users/zlz/wwwroot/dedecms/zt; #default_type text/html; #add_header Content-Type &apos;text/html; charset=utf-8&apos;; #return 200 &quot;&lt;h1&gt;åæœˆåä¸ƒ&lt;/h1&gt;&quot;; location ~ /zt/(.*)\.php(.*)$ &#123; #default_type text/html; #add_header Content-Type &apos;text/html; charset=utf-8&apos;; #return 200 &quot;$document_root , $fastcgi_script_name&quot;; alias /Users/zlz/wwwroot/dedecms; fastcgi_split_path_info ^(.+\.php)(.*)$; fastcgi_param PATH_INFO $fastcgi_path_info; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; &#125; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; location ~ /\.ht &#123; deny all; &#125;&#125;# proxy_pass http://127.0.0.1:8080/;#/Users/zlz/wwwroot/dedecms/zt;#proxy_pass http://127.0.0.1:8089/; è¡¥å……ä¸€ä¼ªé™æ€çš„é‡å†™ï¼Œå³ ww.ssjinyao.com/xxxx/xxxxx é‡å†™è‡³ www.ssjinyao.com/xxxx/xxxx/ 1rewrite /(.*) https://www.ssjinyao.com/$1/ permanent; rewrite ç›´æŽ¥é‡å†™ç›®å½• rewrite 301 12rewrite ^/zhaokao/ /list/zhaokao/ permanent;rewrite ^/szrd/ /list/szrd/ permanent; rewrite 302 12rewrite ^/zhaokao/ /list/zhaokao/ redirect;rewrite ^/szrd/ /list/szrd/ redirect; nginx php-fpm å®‰å…¨é¡¹é…ç½® 12345678910111213# php-fpm.confsecurity.limit_extensions = .php .php2 .php4 .php5 .php7 .html .htm# nginx vhostslocation ~* ^/jt/.*.(php|php3|php4|php5)$ &#123;deny all;&#125;# æµ‹è¯•è®¿é—®è°ƒåº¦ location ~ \.php|\.php7|\.html|.htm$ &#123; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; fastcgi_read_timeout 600; &#125;&#125; redisæœåŠ¡é…ç½®é¡¹1ã€redisæŒä¹…åŒ–é…ç½® æ³¨: è‹¥ä¸éœ€è¦åˆ™å…³é—­ä»¥ä¸‹é…ç½®ï¼› 1234567891011121314151617# æŒä¹…åŒ–æ•°æ®ä¿å­˜è§„åˆ™# è‡ªå·±æ”¯å®žçŽ°ä¸€ä¸‹# 900 ç§’å†…å¦‚æžœè‡³å°‘æœ‰ 1 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜# 300 ç§’å†…å¦‚æžœè‡³å°‘æœ‰ 10 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜# 60 ç§’å†…å¦‚æžœè‡³å°‘æœ‰ 10000 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜save 900 1save 300 10save 60 10000# redisæŒä¹…åŒ–ä¿å­˜æ•°æ®é…ç½®stop-writes-on-bgsave-error yes# æ•°æ®ä¿å­˜çš„ä½ç½®dir /usr/local/redis/db/# æ•°æ®åº“çš„æ–‡ä»¶åç§°,å¦å¤–è¦ç¡®å®šæ•°æ®ä¿å­˜çš„ä½ç½®redisæœ‰owneræƒé™dbfilename dump.rdb 2ã€redisæ˜¯å¦éœ€è¦å¤–ç½‘è¿žæŽ¥; 12345678# ç»‘å®šçš„ip # bind 127.0.0.1# port 6379 æˆ–è€…port 25133# è‹¥éœ€è¦å¤–ç½‘è¿žæŽ¥ï¼Œåˆ™# bind 0.0.0.0# port 6379 æˆ–è€…port 25133 æ³¨: å¦å¤–è¿˜éœ€è¦åœ¨é˜¿é‡Œäº‘ä¸Šæ·»åŠ å¯¹åº”çš„éœ€è¦è®¿é—®çš„åœ°å€ç™½åå•ä¸Žç«¯å£ç™½åå•; 3ã€ç›®å‰ä¸‰æ¡ä¸šåŠ¡çº¿ä¸Šçš„redisæ•°æ®é‡è¦æ€§ 12345678910111213# é…ç½®æœªå¼€æŒä¹…åŒ–ï¼Œä¿å­˜çš„æ•°æ®çš†ä¸ºä¸´æ—¶æ•°æ®ï¼Œå¯ä»¥æ¸…ç©º;# é…ç½®å·²ç»å¼€å¯æŒä¹…åŒ–ï¼Œä¿å­˜çš„æ•°æ®ä¸ºæ•°æ®ç´¢å¼•;æ•°æ®ä¸å¯ä»¥æ¸…ç©º;# é…ç½®å·²ç»å¼€å¯æŒä¹…åŒ–ï¼Œä¿å­˜çš„æ•°æ®ä¸ºç”¨æˆ·æ•°æ®;æ•°æ®ä¸å¯ä»¥æ¸…ç©º;æ³¨: ä¸è®ºæ•°æ®æ˜¯å¦ä¸ºä¸´æ—¶æ•°æ®ï¼Œæ¯æ¬¡å¯¹æœåŠ¡å™¨çš„æ“ä½œéƒ½è¦å…ˆå¯¹æ•°æ®ä¸´æ—¶ä¿å­˜ï¼Œç¡®ä¿æ“ä½œåŽä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±;# æ“ä½œè¿‡ç¨‹å¦‚ä¸‹# redis-cli 127.0.0.1:6379&gt; AUTH Amdce0De1fxxxxxOK127.0.0.1:6379&gt; CONFIG SET dir &quot;/usr/local/redis/db&quot;OK127.0.0.1:6379&gt; SAVEOK127.0.0.1:6379&gt; 4ã€æŽŒæ¡redisé‡å¯å‘½ä»¤ 12345# /etc/init.d/redis-server stop# /etc/init.d/redis-server start# /etc/init.d/redis-server restart# redis-cli -h 127.0.0.1 -p 6379 shutdown # kill -9 REDISPID 5ã€redisç›‘æŽ§ 1aã€ç›‘æŽ§æœåŠ¡redisç«¯å£ 25133 æˆ–è€… 6379 6ã€è®°å¾—åœ¨/etc/redis/redis.confä¸­è¦é…ç½®å¯†ç  1# requirepass Amdce0De1fxxxxx 7ã€æ³¨æ„ç™½åå•é…ç½®ï¼Œè®©çº¿ä¸Šçš„æœåŠ¡å™¨å¯ä»¥è®¿é—®; mongoæœåŠ¡é…ç½®é¡¹1ã€ä¿è¯æœ‰éœ€è¦å¼€æœºè‡ªå¯mongoçš„æœåŠ¡å™¨,å¼€æœºå¯åŠ¨mongo 123# åœ¨mongoçš„/etc/rc.localä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ # mongod --auth --fork -f /etc/mongod.conf # å¹¶ä¿è¯ /etc/rc.localæœ‰æ‰§è¡Œæƒé™ 2ã€ä¿è¯çº¿ä¸Šä½¿ç”¨çš„mongoæœåŠ¡å™¨éƒ½æ˜¯3.4çš„ 123456789# sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv # 0C49F3730359A14518585931BC711F9BA15703C6 # echo &quot;deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu &quot;$(lsb_release -sc)&quot;/mongodb-org/3.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-3.4.list&apos; # sudo apt-get update # sudo apt-get install mongodb-org # sudo killall mongod# sudo echo &apos;never&apos; &gt; /sys/kernel/mm/transparent_hugepage/enabled# sudo echo &apos;never&apos; &gt; /sys/kernel/mm/transparent_hugepage/defrag# sudo service mongod restart # sudo chkconfig mongod on 3ã€ä¼šå¯¹ç”¨æˆ·çš„æ“ä½œ(å¢ž/åˆ /æ”¹/æŸ¥) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106# æ·»åŠ adminç”¨æˆ·use admindb.auth(&quot;admin&quot;,&quot;passwdxxxxxxxxxxx&quot;)use bc_cccdb.createUser( &#123; user:&quot;ht_eedu&quot;, pwd:&apos;ht_eedom99xxx&apos;, roles:[ &#123;role:&quot;dbOwner&quot;,db:&apos;ht_eedu&apos;&#125; ] &#125; ) db.createUser( &#123; user:&quot;admin&quot;, pwd:&apos;passwdxxxxxxxxxxx&apos;, roles:[ &#123;role:&quot;dbOwner&quot;,db:&apos;test&apos;&#125; ] &#125; ) db.createUser( &#123; user:&quot;admin&quot;, pwd:&apos;passwdxxxxxxxxxxx&apos;, roles:[ &#123;role:&quot;userAdminAnyDatabase&quot;,db:&apos;admin&apos;&#125; ] &#125; ) # æ·»åŠ å¯¹åº”æ•°æ®åº“çš„ç”¨æˆ· use te_data;db.createUser( &#123; user:&quot;admin&quot;, pwd:&apos;passwdxxxxxxxxxxxx&apos;, roles:[ &#123;role:&quot;dbOwner&quot;,db:&apos;test_data&apos;&#125; ] &#125; )# åˆ é™¤ç”¨æˆ·db.dropUser(&quot;test_data&quot;) db.createUser( &#123; user:&quot;test_data_read&quot;, pwd:&apos;passwdxxxxxxxxxxx&apos;, roles:[ &#123;role:&quot;read&quot;,db:&apos;test_data&apos;&#125; ] &#125; ) db.createUser( &#123; user:&quot;test_read&quot;, pwd:&apos;passwdxxxxxxxxxxx&apos;, roles:[ &#123;role:&quot;read&quot;,db:&apos;test&apos;&#125; ] &#125; ) # ä¿®æ”¹ç”¨æˆ·å¯†ç db.changeUserPassword(&apos;admin&apos;,&apos;passwdxxxxxxxxxxxx&apos;);# æŸ¥çœ‹ç›®å‰å­˜åœ¨çš„ç”¨æˆ·&gt; show dbsadmin 0.000GBbac_data 0.000GBkk 0.000GBlocal 0.000GBmigrate_data 0.000GBte_data 0.031GB&gt; show users&#123; &quot;_id&quot; : &quot;admin.admin&quot;, &quot;user&quot; : &quot;admin&quot;, &quot;db&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &#123; &quot;role&quot; : &quot;userAdminAnyDatabase&quot;, &quot;db&quot; : &quot;admin&quot; &#125; ]&#125;&gt; use trisk_tmp&gt; show users;&gt; db.dropAllUsers()# åœ¨åº“ä¸­å¢žæ–°å»ºè¡¨use bm_kycdb.createCollection(&quot;ep_search&quot;)db.createCollection(&quot;screening_sections&quot;)# åˆ é™¤å­—æ®µdb.screening_sections.remove(&#123;&apos;no&apos;:&apos;5a279xxxxxxxxx&apos;&#125;) 4ã€æ•°æ®çš„å¤‡ä»½(å¯¼å…¥/å¯¼å‡º) 1234567mkdir /tmp/bak/mongomongodump --db test_kyc --out /tmp/bak/mongo/`date +&quot;%m-%d-%y&quot;`cd /tmp/bak/mongo &amp;&amp; tar -cvf xxxx-xx-xx.tar.gz xxxx-xx-xxscp /tmp/bak/mongo/xxxx-xx-xx.tar.gz root@xx.xxx.xx.xxx:/tmp/crontab -e3 1 * * * find /tmp/bak/mongo -mtime +7 -exec rm -rf &#123;&#125; \;mongorestore -u admin -p xxxx --db newdb --drop /tmp/bak/mongo æ³¨: --drop è¦å°å¿ƒä½¿ç”¨ 5ã€phpæ¨¡å—ç¼–è¯‘å®‰è£…3.4çš„æ”¯æŒ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758aã€mac å®‰è£…php mongoæ¨¡å—çš„æ”¯æŒ# brew install mongo# brew install mongodb# cd /Library/WebServer/Documents# brew install php56-mongo# ä»¥ä¸‹ä¸ºæµ‹è¯•è¿žæŽ¥æ–‡ä»¶ âžœ cat index.php &lt;?php $m = new MongoClient(&apos;mongodb://admin:passwdxxxxxxxxxxx@47.92.xxx.xxxx:20911/bc_ccc&apos;); echo &quot;Connection to database successfully&quot;; // é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ $db = $m-&gt;bm_kyc; echo &quot;Database mydb selected&quot;; ?&gt;âžœ cat test2.php &lt;?php phpinfo();?&gt;# sudo vim /etc/php.ini extension=/usr/local/opt/php56-mongodb/mongodb.so extension=/usr/local/opt/php56-mongo/mongo.so bã€ubuntu å®‰è£… php mongoæ¨¡å—çš„æ”¯æŒ# cd root &amp;&amp; wget https://github.com/mongodb/mongo-php-driver-legacy/archive/master.zip# cd root &amp;&amp; unzip master.zip # cd /root/mongo-php-driver-legacy-master/# phpize# ./configure # make# make install# ls /usr/lib/php5/20121212/mongo.so # vim /etc/php5/apache2/php.iniextension = /usr/lib/php5/20121212/mongo.so# apachectl restartæµ‹è¯•âžœ cat index.php &lt;?php $m = new MongoClient(&apos;mongodb://admin:passwdxxxxxxxxxxx@47.92.162.27:20911/bc_ccc&apos;); echo &quot;Connection to database successfully&quot;; // é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ $db = $m-&gt;bc_ccc; echo &quot;Database mydb selected&quot;; ?&gt; âžœ cat test2.php &lt;?php phpinfo();?&gt;# è®¿é—®test2.phpå¯ä»¥è¿‡æ»¤åˆ°ä»¥ä¸‹å†…å®¹MONGODB-CR enabledSCRAM-SHA-1 enabledMONGODB-X509 enabledGSSAPI (Kerberos) disabledPLAIN disabled 6ã€æ³¨æ„ç™½åå•é…ç½®ï¼Œè®©çº¿ä¸Šçš„æœåŠ¡å™¨å¯ä»¥è®¿é—®; 123net: port =20133 # é…ç½®mongoç›‘å¬åœ°å€ bind_ip =0.0.0.0 # é…ç½®ç»‘å®šçš„IP 7ã€ æ³¨æ„é…ç½®æ–‡ä»¶ä¸­å¼€å¯authè®¤è¯ 1auth =true 8ã€ä»£ç ä¸­ä¸æ”¯æŒå¸¦æœ‰@çš„å¯†ç  mysqlæœåŠ¡é…ç½®é¡¹123# æ³¨æ„æ¸…ç©ºè¿žæŽ¥mysqlçš„ä½¿ç”¨è®°å½•# æ³¨æ„æ•°æ®åº“çš„å¤‡ä»½æ–‡ä»¶æ‰€åœ¨çš„æœåŠ¡å™¨åªèƒ½ä»¥å¯†é’¥ç™»å½•# æ³¨æ„RDSçš„ä½¿ç”¨çŽ‡ apacheæœåŠ¡é…ç½®é¡¹1ã€apacheå…¨å±€é…ç½®é¡¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556Mutex file:$&#123;APACHE_LOCK_DIR&#125; defaultPidFile $&#123;APACHE_PID_FILE&#125;Timeout 300KeepAlive OnMaxKeepAliveRequests 100KeepAliveTimeout 5User $&#123;APACHE_RUN_USER&#125;Group $&#123;APACHE_RUN_GROUP&#125;# ä½¿å¾—ä¸»æœºåèƒ½è¢«è®°å…¥æ—¥å¿—HostnameLookups OffErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log# å®šä¹‰apacheè®°å½•æ—¥å¿—çš„çº§åˆ«ä¸ºwarnLogLevel warn#åŠ è½½æ¨¡å—é…ç½®æ–‡ä»¶ï¼Œè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶ï¼Œä¸Žç«¯é…ç½®æ–‡ä»¶IncludeOptional mods-enabled/*.loadIncludeOptional mods-enabled/*.confInclude ports.conf# å®šä¹‰ä¸å…è®¸è®¿é—®ç«™ç‚¹æ ¹ç›®å½•ç´¢å¼•&lt;Directory /&gt; Options FollowSymLinks AllowOverride None Require all denied&lt;/Directory&gt;&lt;Directory /usr/share&gt; AllowOverride None Require all granted&lt;/Directory&gt;# å…è®¸åœ¨/var/www/ä¸­å»ºç«‹url&lt;Directory /var/www/&gt; AllowOverride All Require all granted&lt;/Directory&gt;# å®šä¹‰å…è®¸è®¿é—®çš„ç”¨æˆ·ï¼Œ .htaccesså®šä¹‰äº†ç”¨æˆ·åAccessFileName .htaccess# æ‹’ç»æ‰€ä»¥ ä»»æ„ä»¥.htåŽç¼€ç»“å°¾çš„æ–‡ä»¶ &lt;FilesMatch &quot;^\.ht&quot;&gt; Require all denied&lt;/FilesMatch&gt;# å®šä¹‰ vhost_combined combined comman refererçš„å››ç§æ—¥å¿—æ ¼å¼,ä¾›è™šæ‹Ÿä¸»æœºè°ƒç”¨LogFormat &quot;%v:%p %h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot; vhost_combinedLogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot; combinedLogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O&quot; commonLogFormat &quot;%&#123;Referer&#125;i -&gt; %U&quot; refererLogFormat &quot;%&#123;User-agent&#125;i&quot; agentIncludeOptional conf-enabled/*.confIncludeOptional sites-enabled/*.conf 2ã€apacheè™šæ‹Ÿä¸»æœºé…ç½®é¡¹ 12345678910111213141516# æŒ‡å®š VirtualHost ä»¥ç«¯å£è¿›è¡Œå®šä¹‰&lt;VirtualHost *:8001&gt;# æŒ‡å®šVirtualHoståŸŸå ServerAdmin www.ssjinyao.com.com# æŒ‡å®šè™šæ‹Ÿä¸»æœºurlæ ¹è·¯å¾„ DocumentRoot /var/www/html/tweb# æŒ‡å®šè®¿é—®é”™è¯¯æ—¥å¿—ä¿è·¯å¾„ ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log# æŒ‡å®šè®¿é—®æ—¥å¿—ä¿å­˜è·¯å¾„ CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined&lt;/VirtualHost&gt; 3ã€åŒnginxä¸€æ ·ï¼Œåšå®Œå˜æ›´ä¹‹åŽéœ€è¦å…ˆæµ‹è¯•è¯­æ³•å†é‡è¯»ï¼Œæˆ–é‡èµ· 4ã€ç«¯å£é…ç½®æ–‡ä»¶ 1234567# å°†è™šæ‹Ÿä¸»æœºä¸­æ‰€ç”¨åˆ°çš„å¯¹åº”ç«¯å£å¯åŠ¨; # Listen 80Listen 8001Listen 8002Listen 8003Listen 8004Listen 8101 supvisord æœåŠ¡é…ç½®é¡¹1ã€æ›´æ¢æœåŠ¡å™¨ä¹‹åŽï¼Œéœ€è¦ä¿®æ”¹æœåŠ¡å™¨çš„ç›‘å¬åœ°å€ï¼› 123# éƒ¨ç½²ç›‘å¬ç«¯å£çš„é—®é¢˜[inet_http_server] ; inet (TCP) server disabled by defaultport=172.17.xxx.xxx:7558 ; (ip_address:port specifier, *:port for all iface) 2ã€éƒ¨ç½²pythonç³»ç»Ÿæ—¶æŠ¥ä¾èµ–é—®é¢˜ 1234cd /home/admin/xbasement/source ./ENV/bin/activatepip install -r requirements.txt å¦‚æžœå®‰è£…è½¯ä»¶åŒ…å­˜åœ¨é—®é¢˜ï¼ŒæŠŠå¯¹åº”çš„è½¯ä»¶åŒ…ç»™åˆ é™¤; 3ã€æŸ¥çœ‹å¯¹åº”æœåŠ¡å™¨å¯åŠ¨æ—¶çš„æŠ¥é”™ 1234567891011admin@iZ2zegjb9m90kxovynpkbzZ:~$ tail -f ~/xbasement/log/xbasement-server-stdout.log File &quot;server.py&quot;, line 3, in &lt;module&gt; from tornado.wsgi import WSGIContainerImportError: No module named tornado.wsgiTraceback (most recent call last): File &quot;server.py&quot;, line 3, in &lt;module&gt; from tornado.wsgi import WSGIContainerImportError: No module named tornado.wsgiTraceback (most recent call last): File &quot;server.py&quot;, line 3, in &lt;module&gt; from tornado.wsgi import WSGIContainerImportError: No module named tornado.wsgi 4ã€pythonéƒ¨ç½²æ—¶ç¼ºå°‘æ¨¡å—çš„é—®é¢˜ 123456789101112131415161718192021222324252627282930# é—®é¢˜å¦‚ä¸‹supervisor&gt; statuscustomer:customer-0 RUNNING pid 7981, uptime 0:00:19customer:job-recieve-0 RUNNING pid 7980, uptime 0:00:19order:api-0 FATAL Exited too quickly (process log may have details)order:forward-job-0 FATAL Exited too quickly (process log may have details)order:order-job-payment-0 FATAL Exited too quickly (process log may have details)order:order-risk-job-0 FATAL Exited too quickly (process log may have details)supervisor&gt; staus*** Unknown syntax: staussupervisor&gt; admin@ssjinyao.com-007:~/torder/venv/lib/python2.7/site-packages$ !tailtail -f torder/log/order-api-out.log from api import appImportError: No module named apiTraceback (most recent call last): File &quot;api/server.py&quot;, line 10, in &lt;module&gt; from api import appImportError: No module named apiTraceback (most recent call last): File &quot;api/server.py&quot;, line 10, in &lt;module&gt; from api import appImportError: No module named api# è§£å†³æ–¹å¼ admin@ssjinyao.com-007:~/torder/venv/lib/python2.7/site-packages$ cat v.pth /home/admin/torderadmin@ssjinyao.com-007:~/torder/venv/lib/python2.7/site-packages$ pwd/home/admin/torder/venv/lib/python2.7/site-packagesadmin@ssjinyao.com-007:~/torder/venv/lib/python2.7/site-packages$ history | grep ln ln -s /home/admin/torder/ . 5ã€åŠ å…¥æ–°å·¥ç¨‹æ—¶ï¼Œè¦å¤åˆ¶ç¼–è¾‘~/opt/supervisord.conf 12[include]files = /home/admin/xbasement/config/supervisor/xbasement.server.ini /home/admin/topen/config/supervisor/*.ini /home/admin/cashier/config/supervisor/*.ini 6ã€éƒ¨ç½²open å·¥ç¨‹æ—¶ï¼Œè¦æŠŠsslä¹Ÿå¤åˆ¶ä¸Š7ã€åº”ç”¨å˜åŠ¨æ—¶ï¼Œè¦æ³¨æ„mongo,redisç™½åå• zabbix é…ç½®1ã€zabbix_agent é…ç½® 123456789101112131415161718192021222324# è¿›ç¨‹çš„pidä¿å­˜çš„é…ç½®PidFile=/tmp/zabbix_agentd.pid# zabbix_agent ç«¯æ—¥å¿—ä¿å­˜ä½ç½® LogFile=/var/log/zabbix-agent/zabbix_agentd.log# æ—¥å¿—æ–‡ä»¶å­˜å‚¨å¤§å° LogFileSize=33# æ—¥å¿—çº§åˆ«DebugLevel=4# æ³¨:è¿™ä¸ªæ˜¯é‡ç‚¹ï¼Œéœ€è¦æŒ‡å®šzabbix_serverç«¯çš„ip zabbix_serverç«¯æ‰èƒ½å®žåˆ«Server=121.xxx.xx.xxx# ç›‘å¬çš„ç«¯å£ListenPort=10050# zabbix_agent ç«¯è¿›ç¨‹ç›‘å¬çš„åœ°å€ ListenIP=0.0.0.0# zabbix_agent ä¸»åŠ¨è¯·æ±‚æœåŠ¡ç«¯æ—¶çš„åœ°å€ ä¸Ž Serveré…åˆä½¿ç”¨ServerActive=121.xxx.xx.xxxHostname=te_server 2ã€ zabbix_server ç«¯é…ç½® 1234567891011121314151617181920212223242526272829303132333435363738# æŒ‡å®šzabbix_server ç«¯ç›‘å¬çš„åœ°å€ListenPort=10051# æŒ‡å®šzabbix_server äº§ç”Ÿçš„æ—¥å¿—æ‰€ä¿å­˜çš„æ–‡ä»¶ä½ç½® LogFile=/var/log/zabbixsrv/zabbix_server.log# æŒ‡å®šæ—¥å¿—çš„å¤§å°LogFileSize=0# æŒ‡å®šzabbix_server PidFileæ‰€ä¿å­˜çš„ä½ç½®PidFile=/var/run/zabbixsrv/zabbix_server.pid# æŒ‡å®šzabbix è°ƒç”¨çš„æ•°æ®åº“åº“åDBName=zabbix# æŒ‡å®šzabbix è°ƒç”¨çš„æ•°æ®åº“çš„ç”¨æˆ·å DBUser=zabbix# æŒ‡å®šzabbix ä½¿ç”¨çš„æ•°æ®åº“å¯†ç DBPassword=centos.xxxxxxxx# æŒ‡å®šmysqlçš„sockæ–‡ä»¶DBSocket=/var/lib/mysql/mysql.sock# æŒ‡å®šmysqlæ‰€ç›‘å¬çš„ç«¯å£ï¼Œæ³¨ï¼Œzabbix_serveræ‰€å ç”¨çš„æ•°æ®åº“ä¸å¤§ï¼Œä¸”åªéœ€è¦ç›‘å¬æœ¬åœ°DBPort=3306# æŒ‡å®šzabbix_server æ‰€ç›‘å¬çš„åœ°å€ListenIP=0.0.0.0# æŒ‡å®šä¾›zabbixè°ƒç”¨çš„è„šæœ¬ç¨‹åº(bash || python || perl),ç›®å‰ä½¿ç”¨çš„æ˜¯bashAlertScriptsPath=/var/lib/zabbixsrv/alertscripts# è‡ªå®šä¹‰ç›‘æŽ§é¡¹æ—¶çš„ä¿å­˜ä½ç½® ExternalScripts=/var/lib/zabbixsrv/externalscripts# æŒ‡å®šä¸´æ—¶çš„è„šæœ¬ç¨‹åº TmpDir=/var/lib/zabbixsrv/tmp 123456789101112131415# è°ƒç”¨æŽ¥å£ç¨‹åº#!/bin/bash#export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/binecho &quot;$2$3&quot; | /usr/bin/mutt -s &quot;ZABBIX æŠ¥è­¦&quot; $1zabbix.sh #!/bin/bash#Can send weixin mail export path=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin#/bin/weixin --corpid=ww3bba6a2898b91e69 --corpsecret=3GqhGNZeEYuVvr9SRSyBWCOsbGvNcc6LXAn0uCO24XM --msg=&quot;$2 $3&quot; --user=&quot;$1&quot; --agentid=1000002/bin/weixin --corpid=wwfc47b4739f369c7c --corpsecret=hD0ITPFehD8WJm-3ydJVxWamXQYs2l64xPCx9K76doM --msg=&quot;$2$3&quot; --user=$1 --agentid=1000003 12345678910111213141516171819202122# å®‰è£…å‘é€é‚®ä»¶æŠ¥è­¦ç¨‹åºçš„ä¾èµ–# yum -y install msmtp mutt# é‚®ä»¶å‘æ˜¯ç”±ç³»ç»Ÿç”¨æˆ·zabbixsrvè°ƒç”¨ï¼Œæ‰€ä»¥é…ç½®æ–‡ä»¶è¦åœ¨å…¬å…±é…ç½®ç›®å½•/etc/ä¸­é…ç½®# ä¸å¯ä»¥åœ¨ admin/root æˆ–è€…å…¶å®ƒç”¨æˆ·ä¸‹é…ç½®# muttrc é…ç½®é¡¹/etc/muttrc set sendmail=&quot;/usr/bin/msmtp&quot;set use_from=yesset realname=&quot;15822097176@139.com&quot;set editor=&quot;vim&quot;# msmtprc é…ç½®é¡¹/etc/msmtprc account defaulthost smtp.ssjinyao.comport 25from dev@ssjinyao.comauth logintls offuser dev@ssjinyao.compassword xxxxxxxxxx 12éœ€æ±‚, ä»£ç è¦ä¸€æ¡æ¡çš„å†™ è®¾è®¡, å…ˆå®žçŽ°å†è®¾è®¡ä¼˜åŒ– çº¿ä¸ŠsshæœåŠ¡é…ç½®é¡¹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889# æŒ‡å®šsshé»˜è®¤ç›‘å¬çš„åœ°å€Port 22# æŒ‡å®šsshä½¿ç”¨çš„åè®®Protocol 2# æŒ‡å®šå½“å‰æœåŠ¡å™¨ä½¿ç”¨çš„ç§é’¥HostKey /etc/ssh/ssh_host_rsa_keyHostKey /etc/ssh/ssh_host_dsa_keyHostKey /etc/ssh/ssh_host_ecdsa_keyHostKey /etc/ssh/ssh_host_ed25519_key# æ˜¯å¦è®©sshdé€šè¿‡åˆ›å»ºéžç‰¹æƒå­è¿›ç¨‹å¤„ç†æŽ¥å…¥è¯·æ±‚çš„æ–¹æ³•æ¥è¿›è¡Œæƒé™åˆ†ç¦»ã€‚é»˜è®¤å€¼æ˜¯&quot;yes&quot;ã€‚è®¤è¯æˆåŠŸåŽï¼Œå°†ä»¥è¯¥è®¤è¯ç”¨æˆ·çš„èº«ä»½åˆ›å»ºå¦ä¸€ä¸ªå­è¿›ç¨‹ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢é€šè¿‡æœ‰ç¼ºé™·çš„å­è¿›ç¨‹æå‡æƒé™ï¼Œä»Žè€Œä½¿ç³»ç»Ÿæ›´åŠ å®‰å…¨UsePrivilegeSeparation yes# è®¾ç½®åœ¨å¤šå°‘ç§’ä¹‹åŽè‡ªåŠ¨é‡æ–°ç”ŸæˆæœåŠ¡å™¨çš„å¯†åŒ™ï¼ˆå¦‚æžœä½¿ç”¨å¯†åŒ™ï¼‰ã€‚é‡æ–°ç”Ÿæˆå¯†åŒ™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨ç›—ç”¨çš„å¯†åŒ™è§£å¯†è¢«æˆªèŽ·çš„ä¿¡æ¯ã€‚KeyRegenerationInterval 3600# Server Key çš„åŠ å¯†ç å¼ºåº¦ï¼Œå¼ºåº¦è¶Šå¤§è¶Šå®‰å…¨ï¼Œä¼ è¾“é€ŸçŽ‡ä¹Ÿè¶Šæ…¢ServerKeyBits 1024# sshd è®°å½•æ—¥å¿—çš„çº§åˆ« LogLevel INFO# ç”¨æˆ·ç™»å½•æ—¶å¯è§†ç•Œé¢åŠæ—¶é—´LoginGraceTime 120# å½“ä½¿ç”¨è€…çš„ host key æ”¹å˜ä¹‹åŽï¼ŒServer å°±ä¸æŽ¥å—è”æœºï¼ŒStrictModes yes# ä½¿ç”¨çº¯rsaè®¤è¯æ–¹å¼RSAAuthentication yes# æ˜¯å¦å…è®¸pubkeyè®¤è¯PubkeyAuthentication yes# æ˜¯å¦å–æ¶ˆä½¿ç”¨ ~/.ssh/.hosts æ¥åšä¸ºè®¤è¯IgnoreRhosts yes# è¿™ä¸ªé€‰é¡¹æ˜¯ä¸“é—¨ç»™ version 1 ç”¨çš„RhostsRSAAuthentication no# è¿™ä¸ªé¡¹ç›®ä¸Žä¸Šé¢çš„é¡¹ç›®ç±»ä¼¼ï¼Œä¸è¿‡æ˜¯ç»™ version 2 ä½¿ç”¨çš„HostbasedAuthentication no#è¿™ä¸ªé¡¹ç›®åœ¨æ˜¯å¦å…è®¸ä»¥ç©ºçš„å¯†ç ç™»å…¥ï¼# æ­¤é¡¹è¦æ³¨æ„PermitEmptyPasswords no# æŒ‘æˆ˜ä»»ä½•çš„å¯†ç è®¤è¯, ä»»ä½• login.conféƒ½èƒ½ä½¿ç”¨ ChallengeResponseAuthentication no# x11è½¬å‘åŠŸèƒ½å¼€å¯ï¼Œå¯ä»¥ä½¿ç”¨åŸºäºŽsshçš„åŠ å¯†ç å›¾å½¢å·¥å…·X11Forwarding yes# è‡ªé€‚å¤§å°X11DisplayOffset 10# æ‰“å°Motdä¿¡æ¯PrintMotd no# ç™»å½•å‰åŽè¾“å‡ºæ—¥å¿—PrintLastLog yes# å¼€å¯tcpé•¿è¿žæŽ¥TCPKeepAlive yes# è®¾ç½®x11çš„è½¬è¾“è¯­è¨€åŠç¼–ç AcceptEnv LANG LC_*# åŸºäºŽssh çš„vftpæœåŠ¡Subsystem sftp /usr/lib/openssh/sftp-server#åˆ©ç”¨ PAM ç®¡ç†ä½¿ç”¨è€…è®¤è¯UsePAM yes#ä½¿ç”¨dnsè§£æž UseDNS no#AddressFamily inet# å…è®¸rootç”¨æˆ·ç›´æŽ¥ç™»å½• PermitRootLogin yes# è®°å½•ç³»ç»Ÿæ—¥å¿—SyslogFacility AUTHPRIV# å¼€å¯ç”¨æˆ·è®¤è¯ç™»å½•PasswordAuthentication yes]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesç¬”è®°]]></title>
    <url>%2F2018%2F10%2F04%2Fkubernetes%20%E7%AC%94%E8%AE%B0%E4%B8%80%2F</url>
    <content type="text"><![CDATA[kubernetes ç¬”è®°CI: æŒç»­é›†æˆCD: æŒç»­äº¤ä»˜ï¼ŒDeliveryCD: æŒç»­éƒ¨ç½²ï¼ŒDeployment kubernetesçš„releasesç‰ˆæœ¬ kubernetes è‡ªåŠ¨è£…ç®±ã€è‡ªæˆ‘ä¿®å¤ã€è‡ªåŠ¨å®žçŽ°æ°´å¹³æ‰©å±•è‡ªåŠ¨å®žçŽ°æœåŠ¡å‘çŽ°å’Œè´Ÿè½½å‡è¡¡ï¼Œè‡ªåŠ¨å‘å¸ƒå’Œå›žæ»šå¯†é’¥å’Œé…ç½®é›†ä¸­åŒ–ç®¡ç†ã€å­˜å‚¨ç¼–æŽ’(åŠ¨æ€ä¾›ç»™)ä»»åŠ¡æ‰¹å¤„ç† 123456789101112131415161718master/node master: API Sserver,Scheduler, Controller-Manager node: kubelet, docker(å®¹å™¨å¼•æ“Ž), kube-proxyPodï¼Œ Label, Label Selector Label: key=value Label: Selector:Pod: è‡ªä¸»å¼Pod æŽ§åˆ¶å™¨ç®¡ç†çš„Pod ReplicationController ReplicaSet Deployment StateFulSet(æœ‰çŠ¶æ€å‰¯æœ¬é›†) DaemonSet Job,Ctonjob AddOns: é™„åŠ ç»„ä»¶HPA HorizontalPodAutoscaler Master èŠ‚ç‚¹: æ•´ä¸ªk8sé›†ç¾¤çš„å¸ä»¤éƒ¨æ ¸å¿ƒç»„ä»¶: api_server è´Ÿè´£æŽ¥æ”¶å¹¶å¤„ç†è¯·æ±‚ schechuler è°ƒåº¦å®¹å™¨çš„åˆ›å»ºè¯·æ±‚ æŽ§åˆ¶å™¨ç®¡ç†å™¨: ç¡®ä¿æŽ§åˆ¶å™¨æ˜¯å¥åº·çŠ¶æ€çš„k8s å¹¶ä¸ç›´æŽ¥è°ƒåº¦å®¹å™¨ï¼Œè€Œè°ƒåº¦çš„æ˜¯podã€‚podå¯¹å®¹å™¨åšä¸ºå°è£…; æœåŠ¡çš„è‡ªåŠ¨å‘çŽ°åŠŸèƒ½ï¼Œå°±æ˜¯æŠŠè‡ªå·±ä¿¡æ¯æ³¨å†Œä¸ŠåŽ»;NMT: ä¸€èˆ¬å¼€æ”¾ç»™å¤–éƒ¨è®¿é—®çš„åªæœ‰Nï¼Œè€ŒN åœ¨é›†ç¾¤å†…å…¶å®žæ˜¯ä¹Ÿæ˜¯å®¢æˆ·ç«¯;åœ¨ä¸€ä¸ªå¤§çš„é›†ç¾¤ä¸­ï¼ŒåªæŠŠæœ‰ç‰¹æ®Šéœ€æ±‚çš„ï¼Œå¼€æ”¾ç»™å®¢æˆ·ç«¯;LBaaS: è´Ÿè½½å‡è¡¡åŠæœåŠ¡; å¤šç§é€šä¿¡åŒä¸€ä¸ªPodå†…çš„å¤šä¸ªå®¹å™¨é—´é€šä¿¡:loå„Podä¹‹é—´çš„é€šä¿¡ Overlay Network,å åŠ ç½‘ç»œé€šä¿¡(äºŒå±‚å åŠ ï¼Œä¸‰å±‚å åŠ )Podä¸ŽServiceä¹‹é—´çš„é€šä¿¡ 1234CNIæ’ä»¶ä½“ç³»:å®¹å™¨ç½‘ç»œæŽ¥å£ flannel: ç½‘ç»œé…ç½® calico: ç½‘ç»œé…ç½®ï¼Œç½‘ç»œç­–ç•¥ canel: ç½‘ç»œé…ç½®ï¼Œç½‘ç»œç­–ç•¥ å®¢æˆ·ç«¯â€“&gt; API server user: username, uid group: extra: çŽ¯å¢ƒ: 1234master: etcd: 10.180.66.11node1: 10.180.66.12node2: 10.180.66.13æ³¨æ„è¿™ä¸‰å°æœåŠ¡å™¨éœ€è¦æ—¶é—´åŒæ­¥ å‰æ: 123451ã€åŸºäºŽä¸»æœºåé€šä¿¡: /etc/hosts;2ã€æ—¶é—´åŒæ­¥;3ã€å…³é—­firewalldå’Œiptables.service;OS: CentOS 7.3.1611ï¼Œ Extrasä»“åº“ä¸­; å®‰è£…é…ç½®æ­¥éª¤: 12345678910111ã€etcd clusterï¼Œä»…MasterèŠ‚ç‚¹;2ã€flannel,é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹;3ã€é…ç½®k8sçš„master:ä»…masterèŠ‚ç‚¹; kubernetes-master å¯åŠ¨çš„æœåŠ¡: kube-apiserver,kub-scheduler,kube-controller-manager4ã€é…ç½®k8sçš„å„NodeèŠ‚ç‚¹; kubernetes-node å…ˆè®¾å®šå¯åŠ¨dockeræœåŠ¡; å¯åŠ¨çš„k8sçš„æœåŠ¡: kube-proxy,kubelet kubeadm 123451ã€master, nodes:å®‰è£…kubelet,kubeadm,docker2ã€master: kubeadm init3ã€nodes: kubeadm join https://github.com/kubernetes/kubeadm/blob/master/docs/design/design_v1.10.mdæ— è®ºserver è¿˜æ˜¯node ä¸€èˆ¬æœåŠ¡ 1234567891011master:# cd /etc/yum.repos.d/# wget https://mirrors.aliyun.com/docker-ce/linux/centos-ce.repo# vim kubernetes.repo [kubernetes]name=Kubernetes Repo baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kuberentes-el7-x86_64/gpgcheck=1pgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpgenabled=1# yum -y install docker-ce kubelet kubeadm kubectl è¡¥å……:æ¸…åŽå¤§å­¦mirrorsåœ°å€é˜¿é‡Œäº‘k8såœ°å€ æä¾›ç½‘ç»œåŠŸèƒ½RESTful GET, PUT, DELETE, POST, â€¦ kubectl run, get, edit, â€¦èµ„æº:å¯¹è±¡ å·¥ä½œè´Ÿè½½æ€§èµ„æºå¯¹è±¡ workload: Pod,ReplicaSet, Deployment, StatefulSet, DaemonSet, Job, Cronjob, â€¦ æœåŠ¡å‘çŽ°åŠæœåŠ¡å‡è¡¡: Service, Ingerss, â€¦ é…ç½®ä¸Žå­˜å‚¨: Volume,CSI ConfigMap,Secret, DownwardAPI, é›†ç¾¤çº§èµ„æº: Namespace,Node,Role,ClusterRole,RoleBinding, ClusterRoleBinding æ— æ•°æ®åž‹èµ„æº: HPA,PodTemplate,LimitRangeåˆ›å»ºèµ„æºçš„æ–¹æ³•: apiserverä»…æŽ¥æ”¶JSONæ ¼å¼çš„èµ„æºå®šä¹‰; yamlæ ¼å¼æä¾›é…ç½®æ¸…å•ï¼Œapiserverå¯è‡ªåŠ¨å°†å…¶è½¬ä¸ºjsonæ ¼å¼ï¼Œè€ŒåŽå†æäº¤; å¤§éƒ¨åˆ†èµ„æºçš„é…ç½®æ¸…å•: apiversion:group/version; $ kubectl api-versions kind:èµ„æºç±»åˆ« metadata:å…ƒæ•°æ® nameå¿…éœ€æ˜¯å”¯ä¸€çš„ namespace labels annotations æ¯ä¸ªèµ„æºçš„å¼•ç”¨PATH /api/GROUP/VERSION/namspace/NAMESAPCE/TYPE/NAME spec:æœŸæœ›çš„çŠ¶æ€ï¼Œdisired state status: å½“å‰çŠ¶æ€ï¼Œcurrent state,æœ¬å­—æ®µç”±kubernetesé›†ç¾¤ç»´æŠ¤;èµ„æºé…ç½®æ¸…å•: è‡ªä¸»å¼Podèµ„æº èµ„æºçš„æ¸…å•æ ¼å¼: ä¸€çº§å­—æ®µ: apiVersion(group/version),kind,metadata(name,namespace,lables,annotations,â€¦)spec,status(åªè¯») Podèµ„æº: spec.container&lt;[]object&gt; - name &lt;string&gt; - image &lt;string&gt; imagePullPloicy &lt;string&gt; Always(ä¸‹è½½), Never(ä¸ä¸‹è½½), IfNotPresent(æœ¬åœ°ä¸å­˜åœ¨é•œåƒåˆ™ä¸‹è½½) ä¿®æ”¹é•œåƒä¸­çš„é»˜è®¤åº”ç”¨: command,args https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/ liveness probe:å­˜æ´»çŠ¶æ€æ£€æµ‹ Image Entrypoint Image Cmd Container command Container args Command run [/ep-1] [foo bar] \ \ [ep-1 foo bar] [/ep-1] [foo bar] [/ep-2] \ [ep-2] [/ep-1] [foo bar] \ [zoo boo] [ep-1 zoo boo] [/ep-1] [foo bar] [/ep-2] [zoo boo] [ep-2 zoo boo] æ ‡ç­¾: key=value key: å­—æ¯ã€æ•°å­—ã€_ã€-ã€. value: å¯ä»¥ä¸ºç©º,åªèƒ½å­—æ¯æˆ–æ•°å­—å¼€å¤´åŠç»“å°¾ï¼Œä¸­é—´å¯ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨: ç­‰å€¼å…³ç³»:=ï¼Œ==ï¼Œ!= é›†åˆå…³ç³»: KEY in (VALUE1,VALUE2,â€¦) KEY notin (VALUE1,VALUE2,â€¦) KEY å­˜åœ¨è¿™ä¸ªé”®å°±å¯ä»¥ !KEY ä¸å­˜åœ¨è¿™ä¸ªé”®çš„èµ„æº1# kubectl get pods -l &quot;release notin (canary,beta,alpha)&quot; è®¸å¤šèµ„æºæ”¯æŒå†…åµŒå­—æ®µå®šä¹‰å…¶ä½¿ç”¨çš„æ ‡ç­¾é€‰æ‹©å™¨:matchLables: ç›´æŽ¥ç»™å®šé”®å€¼matchLables: åŸºäºŽç»™å®šçš„è¡¨è¾¾å¼æ¥å®šä¹‰ä½¿ç”¨çš„æ ‡ç­¾é€‰æ‹©å™¨,{key:â€KEYâ€,operator:â€OPERATORâ€, value:[VAL1,VAL2,â€¦]} æ“ä½œç¬¦: IN, NotIN:vlaueså­—æ®µçš„å€¼å¿…é¡»ä¸ºç©ºåˆ—è¡¨; Exists, NotExists:valueså­—æ®µçš„å€¼å¿…é¡»ä¸ºç©ºåˆ—è¡¨; nodeSelector èŠ‚ç‚¹æ ‡ç­¾é€‰æ‹©å™¨,nodeName annotations: ä¸Žlabelä¸åŒçš„åœ°æ–¹åœ¨äºŽï¼Œ å®ƒä¸èƒ½ç”¨äºŽæŒ‘é€‰èµ„æºå¯¹è±¡ï¼Œä»…ç”¨äºŽä¸ºå¯¹è±¡æä¾›â€å…ƒæ•°æ®â€ã€‚Podçš„ç”Ÿå‘½å‘¨æœŸ çŠ¶æ€:Pending(æŒ‚èµ·)ï¼Œå·²ç»åˆ›å»ºï¼Œä½†æœªæ‰¾åˆ°è¿è¡Œå®ƒçš„èŠ‚ç‚¹; Running; Failed; Succeede; Unknown Podç”Ÿå‘½å‘¨æœŸä¸­çš„é‡è¦è¡Œä¸ºï¼š å®žå§‹åŒ–å®¹å™¨ å®¹å™¨æŽ¢æµ‹ï¼š liveness readliness restartPolicy: Always, OnFailure, Never. Default to Always. æŽ¢é’ˆç±»åž‹æœ‰ä¸‰ç§: ExecActionã€ TCPSocketActionã€ HTTPGetAction PodæŽ§åˆ¶å™¨: ReplicationController: ReplicaSet: ä»£ç”¨æˆ·åˆ›å»ºæŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬ï¼Œå¤šé€€å°‘è¡¥ï¼Œæ»šåŠ¨æ›´æ–°;æ–°ä¸€ä»£çš„ReplicationController Deployment: å»ºæž„åœ¨ReplicaSetä¹‹ä¸Šçš„ï¼ŒæµåŠ¨æ›´æ–°ï¼Œå›žæ»šï¼Œå£°æ˜Žå¼é…ç½®; DemonSet: Job: CronJob: StatefulSet TRR: Third Party Resources, 1.2+, 1.7 CDR: Custom Defined Resources, 1.8+ Operator:ä¸€ä¸ªåçš„è„šæœ¬åœ¨k8sé›†ç¾¤ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´æ•´ä¸ªk8sé›†ç¾¤å²©æŽ‰; 1234567891011121314151617181920212223242526apiVersion: apps/v1kind: ReplicaSetmetadata: name: myapp namespace: default spec: replicas: 2 relector: matchLabels: app: myapp replease: canary template: metadata: name: myapp-pod labels: app: myapp replease: canary environment:qa spec: contrainers: - name: myapp-container image: ikuberentes/myapp:v1 ports: - name: http containerPort: 80# kubectl create -f rs-demo.yaml Helm: å¤–å£³ ç±»ä¼¼äºŽredhatç³»ç»Ÿä¸Šçš„yumç®¡ç†å™¨ä¸€æ · Service å·¥ä½œæ¨¡å¼:userspace, iptables, ipvs userspace: 1.1- iptables: 1.10- ipvs: 1.11+ ç±»åž‹: ExternalName, CluseterIP, NodePort, and LoadBalancer èµ„æºè®°å½•: SVC_NAME.NS_NAME.DOMAIN.LTD. svc.cluster.local. redis.default.svc.custer.local. NodePort:client â€“&gt; NodeIP:NodePort â€“&gt;ClusterIP:ServciePort â€“&gt; PodIP:containerPortLoadBalancerExternelName FQDN CNAME â€“&gt; FQDNNo ClusterIP: Headless Service ServiceName â€“&gt; PodIP è§£å†³æ–¹æ¡ˆå¤šç»„nginx server å¯¹åº”å¤šä¸ªpod;å¤šä¸ªurl æ˜ å°„å¤šä¸ªpod; é…ç½®å®¹å™¨åŒ–åº”ç”¨çš„æ–¹å¼: 1ã€ è‡ªå®šä¹‰å‘½ä»¤è¡Œå‚æ•°; args: [] 2ã€ æŠŠé…ç½®æ–‡ä»¶ç›´æŽ¥ç„™è¿›é•œåƒ; 3ã€ çŽ¯å¢ƒå˜é‡ (1) Cloud Nativeçš„åº”ç”¨ç¨‹åºä¸€èˆ¬å¯ä»¥ç›´æŽ¥ é€šè¿‡çŽ¯å¢ƒå˜é‡åŠ è½½é…ç½®; (2) é€šè¿‡entrypointè„šæœ¬æ¥é¢„å¤„ç†å˜é‡ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯; 4ã€ å­˜å‚¨å· CoreOS: operatorStatefulSet: 1ã€ç¨³å®šä¸”æƒŸä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦;2ã€ç¨³å®šä¸”æŒä¹…çš„å­˜å‚¨;3ã€æœ‰åºã€å¹³æ»‘åœ°éƒ¨ç½²å’Œæ‰©å±•;4ã€æœ‰åºã€å¹³æ»‘åœ°åˆ é™¤å’Œç»ˆæ­¢;5ã€æœ‰åºçš„æ»šåŠ¨æ›´æ–°; ä¸‰ä¸ªç»„ä»¶: headless serviceã€ StatefulSet ã€ volumeClaimTemplatepod_name.service_name.ns_name.svc.cluster.local myapp-0.myapp.default.svc.cluster.local APIRequest path http://172.20.0.70:6443/apls/apps/v1/namespaces/default/deployment/myapp-deploy/ HTTP request verb: get, post, pub, deleteAPI request verb: get, list, create, update, patch, watch, redirect, delete, deletecollection Resource:Subresource:NamespaceAPI group Object URL: /apis///namespaces// role: operation objectsrolebinding: user account OR service account role clusterrole, clusterrolebinding role æŽˆæƒ: get * ; get pod ; get deployment; æŽˆæƒæ’ä»¶: Node, ABAC, RBAC, Webhook(åŸºäºŽhttpdçš„å›žè°ƒæœºåˆ¶) RBAC: Role-based AC â€˜ è§’è‰²(role) è®¸å¯(permission) å½“ç”¨æˆ·æƒé™ rolebinding ç»‘å®šåˆ° clusterrolebinding æ—¶ï¼Œclusterrolebinding ä¼šè¢«é™æƒä¸ºrolebinding; spec.serviceAccountName rolebinding serviceaccount role Kubernetes:è®¤è¯ã€æŽˆæƒ API server: subject â€“&gt; action â€“&gt; object è®¤è¯: token,tls,user/password è´¦å·:UserAccount, ServiceAccount æŽˆæƒ:RBAC role,rolebinding clusterrole,clusterrolebinding subject: user group serviceaccount object: resource group resource non-resource url action:get,list,watch,patch,delete,deletecollectionâ€¦ Dashboard1ã€éƒ¨ç½² 1kubectl apply -f https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml 2ã€å°†Service æ”¹ä¸ºNodePort 1kubectl patch svc kubernetes-dashboard -p &apos;&#123;&quot;spec&quot;:&#123;&quot;type&quot;:&quot;NodePort&quot;&#125;&#125;&apos; -n kube-system 3ã€ è®¤è¯: è®¤è¯æ—¶çš„è´¦å·å¿…é¡»ä¸ºServiceAccount: è¢«dashboard podæ‹¿æ¥ç”±kubernetesè¿›è¡Œè®¤è¯çš„; token: (1) åˆ›å»ºServiceAccountï¼Œæ ¹æ®å…¶ç®¡ç†ç›®æ ‡ï¼Œä½¿ç”¨rolebindingæˆ–clusterrolebinding ç»‘å®šè‡³åˆç†roleæˆ–clusterrole; (2) èŽ·å–åˆ°æ­¤ServiceAccountçš„secretï¼ŒæŸ¥çœ‹secretçš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­å°±æœ‰token; kubeconfig:æŠŠServiceAccountçš„tokenå°è£…ä¸ºkubeconfigæ–‡ä»¶ (1) åˆ›å»ºServiceAccountï¼Œæ ¹æ®å…¶ç®¡ç†ç›®æ ‡ï¼Œä½¿ç”¨rolebindingæˆ–clusterrolebinding ç»‘å®šè‡³åˆç†roleæˆ–clusterrole; (2) 12kubectl get secret | awk &apos;/^ServiceAccount/&#123;print $1&#125;&apos;DEF_NS_ADMIN_TOKEN=$(kubectl get secret SERVCIEACCOUNT_SERRET_NAME -o jsonpath=&#123;.data.token&#125; | base64 -d ) (3)ç”Ÿæˆkubeconfig æ–‡ä»¶ 1234kubectl config set-cluster --kuberconfig=/PATH/TO/SOMEFILEkubectl config set-credentials NAME --token=$KUBE_TOKEN --kubeconfig=/PATH/TO/SOMEFILEkubectl config set-contextkubectl config use-context kubernetesé›†ç¾¤çš„ç®¡ç†æ–¹å¼1ã€å‘½ä»¤å¼: create, run, expose, delete, edit, â€¦2ã€å‘½ä»¤å¼é…ç½®æ–‡ä»¶:create -f /PATH/TO/RESOURCE_CONFIGURATION_FILE, delete -f , replace -f3ã€å£°æ˜Žå¼é…ç½®æ–‡ä»¶: apply -f,path, docker å¸¸ç”¨çš„å››ç§ç½‘ç»œæ¨¡åž‹ bridge/joined/open/none Kubernetesç½‘ç»œé€šä¿¡: ï¼ˆ1ï¼‰å®¹å™¨é—´é€šä¿¡: åŒä¸€ä¸ªPodå†…çš„å¤šä¸ªå®¹å™¨é—´çš„é€šä¿¡ï¼Œlo ï¼ˆ2ï¼‰Podé€šä¿¡: Pod IP &lt;â€“&gt; Pod IP ï¼ˆ3ï¼‰Podä¸ŽServiceé€šä¿¡:PodIP &lt;â€“&gt; ClusterIP ï¼ˆ4ï¼‰Serviceä¸Žé›†ç¾¤å¤–éƒ¨å®¢æˆ·ç«¯çš„é€šä¿¡CNI: Container Network Interface flanner calico canel kube-router â€¦è§£å†³æ–¹æ¡ˆ: è™šæ‹Ÿç½‘æ¡¥ å¤šè·¯å¤ç”¨: MacVLAN ç¡¬ä»¶äº¤æ¢: SR-IOVkubelet, /etc/cni/net.d/flannel: æ”¯æŒå¤šç§åŽç«¯: VxLAN ï¼ˆ1ï¼‰vxlan ï¼ˆ2ï¼‰Directrouting host-gw: Host Gateway UDPflannelçš„é…ç½®å‚æ•° Network: flannelä½¿ç”¨çš„CIDRæ ¼å¼çš„ç½‘ç»œåœ°å€ï¼Œç”¨äºŽä¸ºPodçš„é…ç½®ç½‘ç»œåŠŸèƒ½; master:10.244.0.0/24 node01:10.244.1.0/24 â€¦ node255:10.244.255.0/24 SubneteLen:æŠŠNetworkåˆ‡åˆ†å­ç½‘ä¾›å„èŠ‚ç‚¹ä½¿ç”¨æ—¶ï¼Œä½¿ç”¨å¤šé•¿çš„æŽ©ç è¿›è¡Œåˆ‡åˆ†ï¼Œé»˜è®¤ä¸º28ä½; SubnetMin:10.244.10.0/24 å¼€å§‹ SubnetMax:10.244.100.0/24 ç»“æŸ Backend:vxlan, host-gw, udp vxlan:ç½‘ç»œç­–ç•¥: åç§°ç©ºé—´: æ‹’ç»æ‰€æœ‰å‡ºç«™ï¼Œå…¥ç«™; æ”¾è¡Œæ‰€æœ‰å‡ºç«™ç›®æ ‡æœ¬åç§°ç©ºé—´å†…çš„æ‰€æœ‰Pod; è°ƒåº¦å™¨: é¢„é€‰ç­–ç•¥: CheckNodeCondition GeneralPredicates: HostName: æ£€æŸ¥Podå¯¹è±¡æ˜¯å¦å®šä¹‰äº†pod.spec.hostname PodFitsHostPorts:pods.spec.containers.ports.hostPort MatchNodeSelector:pod.spec.nodeSelector PodFitsResources:æ£€æŸ¥Podçš„èµ„æºéœ€æ±‚æ˜¯å¦èƒ½è¢«èŠ‚ç‚¹æ‰€æ»¡è¶³; NoDiskConflict:æ£€æŸ¥Podä¾èµ–çš„å­˜å‚¨å·æ˜¯å¦èƒ½æ»¡è¶³éœ€æ±‚; PodToleratesNodeTaints:æ£€æŸ¥Podçš„specl.tolerationså¯å®¹å®¹å¿çš„æ±¡ç‚¹æ˜¯å¦å®Œå…¨åŒ…å«èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹; PodToleratesNodeNoExecuteTaints: å¯¹åº”çš„è¡Œä¸ºæ˜¯é»˜è®¤ä¸æ£€æŸ¥çš„; CheckNodeLabelPresence: æ£€æŸ¥èŠ‚ç‚¹æŒ‡å®šæ ‡ç­¾çš„å­˜åœ¨æ€§; CheckServiceAffinity: äº²å’Œæ€§ï¼Œå°†åŒä¸€Serviceçš„Podå°½å¯èƒ½æ”¾åœ¨ä¸€å—; MaxEBSVolumeCount MaxGCEPDVolumeCount MaxAzureDiskVolumeCount CheckVolumeBinding NoVolumeZoneConflict CheckNodeMemoryPressure: æ£€æŸ¥å†…å­˜èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨åŽ‹åŠ›; CheckNodePIDPressure: æ£€æŸ¥PIDæ•°é‡æ˜¯å¦è¿‡å¤š; CheckNodeDiskPressure: æ£€æŸ¥ç£ç›˜åŽ‹åŠ›æ˜¯å¦è¿‡å¤§; MatchInterPodAffity: æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æ»¡podè¶³äº²å’Œæ€§ä¸Žåäº²å’Œæ€§ä¼˜é€‰å‡½æ•° LeastRequested:(cpu((capacity-sum(requested))10/capacity)+memory((capacity-sum(requested))10/capacity)) BalancedResourceAllocation: CPUå’Œå†…å­˜èµ„æºè¢«å ç”¨çŽ‡ç›¸è¿‘çš„èƒœå‡º; NodePreferAvoidPods:èŠ‚ç‚¹æ³¨è§£ä¿¡æ¯â€scheduler.alpha.kubernetes.io/perferAvoidPodsâ€ TaintToleration: å°†Podå¯¹è±¡çš„spec.tolerationsåˆ—è¡¨é¡¹ä¸ŽèŠ‚ç‚¹çš„ taintsåˆ—è¡¨é¡¹è¿›è¡ŒåŒ¹é…åº¦æ£€æŸ¥ï¼ŒåŒ¹é…æ¡ç›®è¶Šå¤šï¼Œå¾—åˆ†è¶Šä½Ž; SeletorSpreading:ä¸Žå½“å‰Podå¯¹è±¡åŒå±žçš„æ ‡ç­¾é€‰æ‹©å™¨é€‰æ‹©é€‚é…çš„å…¶å®ƒé€‰æ‹©å…¶Podå¯¹è±¡æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œè¶Šå¤šçš„è¡¨ç¤ºè¶Šä½Žï¼Œå¦åˆ™è¶Šé«˜; NodeAffinity:åŸºäºŽèŠ‚ç‚¹äº²å’Œæ€§çš„; InterPodAffinity:éåŽ†Podå¯¹è±¡çš„äº²å’Œæ€§æ¡ç›®ï¼Œå¹¶å°†èƒ½åŒ¹é…åˆ°ç»™å®šèŠ‚ç‚¹çš„æ¡ç›®çš„æƒé‡ç›¸åŠ ï¼Œç»“æžœå€¼è¶Šå¤§çš„ï¼Œè¡¨ç¤ºè¶Šé«˜; MostRequested:è·ŸLeastRequestedæ­£å¥½ç›¸å;NodeLabel:æ ‡ç­¾è¶Šå¤šï¼Œå¾—åˆ†è¶Šé«˜;ImageLocality: é•œåƒè¶Šå¤šï¼Œå¾—åˆ†è¶Šé«˜ï¼Œæ ¹æ®æ»¡è¶³å½“å‰Podå¯¹è±¡éœ€æ±‚çš„å·²æœ‰é•œåƒä½“ç§¯å¤§å°ä¹‹å’Œ; 1kubectl describe nodes node node01.ssjinyao.com èŠ‚ç‚¹é€‰æ‹©å™¨:nodeSelector, nodeNameèŠ‚ç‚¹äº²å’Œè°ƒåº¦: nodeAffinity taintçš„effectå®šä¹‰å¯¹PodæŽ’æ–¥æ•ˆæžœ: NoSchedule: ä»…å½±å“è°ƒåº¦è¿‡ç¨‹ï¼Œå¯¹çŽ°å­˜çš„Podå¯¹è±¡ä¸äº§ç”Ÿå½±å“; NoExecute: å³å½±å“è°ƒåº¦è¿‡ç¨‹ï¼Œä¹Ÿå½±å“çŽ°å­˜çš„Podå¯¹è±¡;ä¸å®¹å¿çš„Podå¯¹è±¡å°†è¢«é©±é€; PreferNoSchedule:ä¸èƒ½å®¹å¿è¢«è°ƒåº¦è¿‡æ¥ï¼Œä½†æ˜¯å®žåœ¨æ²¡æœ‰åˆ«çš„èŠ‚ç‚¹è¿è¡Œï¼Œä¹Ÿå¯è¢«è°ƒåº¦ï¼Œæ˜¯NoScheduleçš„æŸ”æ€§ç‰ˆ; 12345678910111213141516171819202122232425262728293031apiVersion: apps/v1kind: Deploymentmetadata: name: myapp-deploy namespace: defaultspec: replicas: 3 selector: matchLabels: app: myapp release: canary template: metadata: labels: app:myapp release:canary spec: containers: - name: myapp image: ikubernetes/myapp:v2 ports: - name: myapp image: ikubernetes/myapp: v2 ports: - name: http containerPort: 80 tolerations: - key: &quot;node-type&quot; operator: &quot;Equal&quot; value: &quot;production&quot; effect: &quot;NoSchedule&quot; å®¹å™¨çš„èµ„æºéœ€æ±‚ï¼Œèµ„æºé™åˆ¶ requests: éœ€æ±‚ï¼Œæœ€ä½Žä¿éšœ; limits: é™åˆ¶ï¼Œæœ€é«˜æ¶ˆè€—åŒºé—´ï¼Œç¡¬é™åˆ¶; CPU: 1é¢—é€»è¾‘CPU 1=1000å¾®æ ¸å¿ƒ,millicores 500m=0.5CPU å†…å­˜: Eã€Pã€Tã€Gã€Mã€K Eiã€Piã€Tiã€Giã€Miã€Ki QoS: Guranteed: æ¯ä¸ªå®¹å™¨åŒæ—¶è®¾ç½®CPUå’Œå†…å­˜çš„requestså’Œlimits; cpu.limits=cpu.requests memory.limits=memory.request Burstable:è‡³å°‘ä¸€ä¸ªå®¹å™¨è®¾ç½®CPUæˆ–è€…å†…å­˜èµ„æºçš„requestså±žæ€§; BestEffort:æ²¡æœ‰ä»»ä½•ä¸€ä¸ªå®¹å™¨è®¾ç½®äº†requestsæˆ–limitså±žæ€§;æœ€ä½Žä¼˜å…ˆçº§åˆ«;èµ„æºæŒ‡æ ‡:metrics-serverè‡ªå®šä¹‰æŒ‡æ ‡:prometheusï¼Œk8s-prometheus-adapteræ–°ä¸€ä»£æž¶æž¶æž„: æ ¸å¿ƒæŒ‡æ ‡æµæ°´çº¿: ç”±kubeletã€metrics-serverä»¥åŠç”±API server æä¾›çš„apiç»„æˆ;CPUç´¯ç§¯ä½¿ç”¨çŽ‡ã€å†…å­˜å®žæ—¶ä½¿ç”¨çŽ‡ã€Podçš„èµ„æºå ç”¨çŽ‡åŠå®¹å™¨çš„ç£ç›˜å ç”¨çŽ‡; ç›‘æŽ§æµæ°´çº¿:ç”¨äºŽä»Žç³»ç»Ÿæ”¶é›†å„ç§æŒ‡æ ‡æ•°æ®å¹¶æä¾›ç»ˆç«¯ç”¨æˆ·ã€å­˜å‚¨ç³»ç»Ÿä»¥åŠHPAï¼Œå®ƒä»¬åŒ…å«æ ¸å¿ƒæŒ‡æ ‡åŠè®¸å¤šéžæ ¸å¿ƒæŒ‡æ ‡ã€‚éžæ ¸å¿ƒæŒ‡æ ‡æœ¬èº«ä¸èƒ½è¢«k8sæ‰€è§£æž, metrics-server:API-serverHelm: æ ¸å¿ƒæœ¯è¯­: Chart: ä¸€ä¸ªhelmç¨‹åºåŒ…çš„; Repository: Chartsä»“åº“ï¼Œhttps/httpæœåŠ¡å™¨; Release: ç‰¹å®šçš„Chartéƒ¨ç½²äºŽç›®æ ‡é›†ç¾¤ä¸Šçš„ä¸€ä¸ªå®žä¾‹; Chart â€“&gt; Config â€“&gt; Release ç¨‹åºæž¶æž„: helm:å®¢æˆ·ç«¯ï¼Œç®¡ç†æœ¬åœ°çš„Chartä»“åº“ï¼Œç®¡ç†Chartï¼Œä¸ŽTilleræœåŠ¡å™¨äº¤äº’ï¼Œå‘é€Chartï¼Œå®žä¾‹å®‰è£…ã€æŸ¥è¯¢ã€å¸è½½ç­‰æ“ä½œ; Tiller: æœåŠ¡ç«¯ï¼Œå¯ä»¥è¿è¡Œåœ¨kubernetesä¹‹ä¸Šï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨kubernetesä¹‹å¤–ã€æŽ¥æ”¶helmå‘æ¥çš„Chartsä¸ŽConfigï¼Œåˆå¹¶ç”Ÿæˆrelease; RBACé…ç½®æ–‡ä»¶ç¤ºä¾‹: https://github.com/helm/helm/blob/master/docs/rbac.md å®˜æ–¹å¯ç”¨çš„Chartåˆ—è¡¨: https://hub.kubeapps.com helmå¸¸ç”¨å‘½ä»¤: releaseç®¡ç† 12345678910# helm search jenkins# helm inspect jenkins# helm list # helm install# helm delete# helm upgrade# helm rollback# helm history # releaseçš„éƒ¨ç½²åŽ†å²;# helm status # èŽ·å–releaseçŠ¶æ€ä¿¡æ¯;# helm install --name redis -f ./values.yaml stable/redis chartç®¡ç† 123456# helm create# helm fetch# helm get # helm inspect# helm package æ‰“åŒ…chart æ–‡ä»¶# helm verify 1234567# helm lint ../myapp # æ£€æŸ¥è¯­æ³•é”™è¯­# helm package myapp/# helm delete --purge mapp3 # helm delete --purge mapp2# helm delete --purge mapp1# helm repo add --help # helm repo list Chart â€“&gt; helm,tiller serviceChart â€“&gt; Config â€“&gt;ReleaseConfig:values.yaml ELK: E:elasticsearch L:logstash K: kibanaæ—¥å¿—æ”¶é›†çš„ç»„ä»¶ï¼ˆLogstashã€Filebeatã€Fluentdï¼‰ å½“podå‡ºçŽ°æŒ‚äº†çš„æƒ…å†µï¼ŒæŸ¥çœ‹podæ—¥å¿—æ—¶ä¸æ–¹ä¾¿æŸ¥çœ‹ã€‚å› æ­¤ï¼Œåº”è¯¥å°†æ—¥å¿—æå‰æ”¾åˆ°ä¸€ä¸ªå­˜å‚¨ä¸­ã€‚kubernetesé›†ç¾¤åº”æä¾›ä¸€ä¸ªæ—¥å¿—æ”¶é›†å™¨ã€‚å®Œæ•´çš„kubernetes é›†ç¾¤ (kubdns| kubcurl ,ingress controller,heapster| metrics-server prometheus, dashboard)å››å¤§ç»„ä»¶ç»„æˆéƒ¨åˆ†ï¼Œå¦å¤–é™„åŠ é™„ä»¶efk; /var/log â€“&gt; /var/log/containers/k8sç³»ç»Ÿå…³é”®ç»„ä»¶:Core Infrastructure â€“&gt; Network(SDN) Storage (Provisioning Congfiguration ) â€“&gt; Kubernetes Cluster â€“&gt; Containerzed Worload (image registry)é¢å¤–çš„ç³»ç»Ÿ:Logging Monitoringç¡¬ä»¶åŠè´Ÿè½½ã€è½¯ä»¶åŠè´Ÿè½½:LoadBalancerå­˜å‚¨ä½ç½®:Artifact factoryæž„å»ºè‡ªåŠ¨åŒ–:Build Automation (CI,CD)è‡ªåŠ¨åŒ–å‘å¸ƒ:Rlease Automation]]></content>
      <tags>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[dockerç¬”è®°(äºŒ)]]></title>
    <url>%2F2018%2F10%2F02%2Fdocker%E7%AC%94%E8%AE%B0%E4%BA%8C%2F</url>
    <content type="text"><![CDATA[docker ç¬”è®°(äºŒ) Docker Data Volumeå…³é—­å¹¶é‡å¯å®¹å™¨ï¼Œå…¶æ•°æ®ä¸å—å½±å“; ä½†åˆ é™¤Dockerå®¹å™¨ï¼Œåˆ™å…¶æ›´å°†ä¼šå…¨éƒ¨ä¸¢å¤±;å­˜åœ¨çš„é—®é¢˜å­˜å‚¨äºŽè”åˆæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸æ˜“äºŽå®¿ä¸»æœºè®¿é—®;å®¹å™¨é—´æ•°æ®å…±äº«ä¸ä¾¿;åˆ é™¤å®¹å…¶æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±;è§£å†³æ–¹æ¡ˆ:â€å·(volume)â€ â€œå·â€æ˜¯å®¹å™¨ä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ªâ€ç›®å½•â€ï¼Œæ­¤ç±»ç›®å½•å¯ç»•è¿‡è”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œä¸Žå®¿ä¸»æœºä¸Šçš„æŸç›®å½•â€ç»‘å®š(å…³è”)â€Volume äºŽå®¹å™¨åˆå§‹åŒ–ä¹‹æ—¶å³ä¼šåˆ›å»ºï¼Œç”±base imageæä¾›çš„å·ä¸­çš„æ•°æ®ä¼šäºŽæ­¤æœŸé—´å®Œæˆå¤åˆ¶Volume çš„åˆè¡·æ˜¯ç‹¬ç«‹äºŽå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå®žçŽ°æ•°æ®æŒä¹…åŒ–ï¼Œå› æ­¤åˆ é™¤å®¹å™¨æ—¶å³ä¸ä¼šåˆ é™¤å·ï¼Œä¹Ÿä¸ä¼šå¯¹å“ªæ€•æœªè¢«å¼•ç”¨çš„å·åšåžƒåœ¾å›žæ”¶æ“ä½œ; Dockeræœ‰ä¸¤ç§ç±»åž‹çš„å·ï¼Œæ¯ç§ç±»åž‹éƒ½åœ¨å®¹å™¨ä¸­å­˜åœ¨ä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œä½†å…¶åœ¨å®¿ä¸»æœºä¸Šçš„ä½ç½®æœ‰æ‰€ä¸åŒ; 1# docker run --name b2 -it -v /data busybox æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹Mountä¿¡æ¯ 1234567891011121314# docker inspect b2 &quot;Mounts&quot;: [ &#123; &quot;Type&quot;: &quot;volume&quot;, &quot;Name&quot;: &quot;5d2aaa4a60dd5724bed6011c92d71df8eb093de43bae2038c992f746f97f6e7d&quot;, &quot;Source&quot;: &quot;/var/lib/docker/volumes/5d2aaa4a60dd5724bed6011c92d71df8eb093de43bae2038c992f746f97f6e7d/_data&quot;, &quot;Destination&quot;: &quot;/data&quot;, &quot;Driver&quot;: &quot;local&quot;, &quot;Mode&quot;: &quot;&quot;, &quot;RW&quot;: true, &quot;Propagation&quot;: &quot;&quot; &#125; ],# echo &quot;hello container&quot; &gt;&gt; /var/lib/docker/volumes/5d2aaa4a60dd5724bed6011c92d71df8eb093de43bae2038c992f746f97f6e7d/_data/test.html åœ¨å®¹å™¨ä¸­æŸ¥çœ‹ 123/ # cat data/test.htmlhello container/ # echo &quot;test rj&quot; &gt;&gt; data/test.html åœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹ 123# cat /var/lib/docker/volumes/5d2aaa4a60dd5724bed6011c92d71df8eb093de43bae2038c992f746f97f6e7d/_data/test.htmlhello containertest rj å½“å®¹å™¨é€€å‡ºå¹¶åˆ é™¤åŽï¼Œæ•°æ®ä¾ç„¶å­˜åœ¨ 1234# docker run --name b2 -it --rm -v /data/volumes/b2:/data busybox# docker inspect b2 | grep volume &quot;/data/volumes/b2:/data&quot; &quot;Source&quot;: &quot;/data/volumes/b2&quot;, æŸ¥çœ‹inspectå…ƒç´  12# docker inspect -f &#123;&#123;.Mounts&#125;&#125; b2[&#123;bind /data/volumes/b2 /data true rprivate&#125;] æ³¨: ä¸¤ä¸ªå®¹å™¨å¯ä»¥å…±äº«åŒä¸€ä¸ªå­˜å‚¨å· 12# docker run -it --name c1 -v /docker/volumes/v1:/data busybox# docker run -it --name c2 -v /docker/volumes/v1:/data busybox å¤åˆ¶ä½¿ç”¨å…¶å®ƒå®¹å™¨çš„å·ï¼Œä¸ºdocker run å‘½ä»¤ä½¿ç”¨ â€“volumes-fromé€‰é¡¹ 12# docker run -it --name bbox1 -v /docker/volumes/v1:/data busybox # docker run -it --name bbox2 --volumes-from bbox1 busybox docker fileFROMFROMçš„æŒ‡ä»¤æ˜¯æœ€é‡çš„ä¸€ä¸ªä¸”å¿…é¡»ä¸ºDockefileæ–‡ä»¶å¼€ç¯‡çš„ç¬¬ä¸€ä¸ªéžæ³¨é‡Šè¡Œï¼Œç”¨äºŽä¸ºæ˜ åƒæ–‡ä»¶æž„å»ºè¿‡ç¨‹æŒ‡å®šåŸºå‡†é•œåƒï¼ŒåŽç»­çš„æŒ‡ä»¤è¿è¡ŒäºŽæ­¤åŸºå‡†é•œåƒæ‰€æä¾›çš„è¿è¡ŒçŽ¯å¢ƒã€‚å®žè·µä¸­ï¼ŒåŸºå‡†é•œåƒå¯ä»¥æ˜¯ä»»ä½•å¯ç”¨é•œåƒæ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œdocker buildä¼šåœ¨docker ä¸»æœºä¸ŠæŸ¥æ‰¾æŒ‡å®šçš„é•œåƒæ–‡ä»¶ï¼Œåœ¨å…¶ä¸å­˜åœ¨æ—¶ï¼Œåˆ™ä¼šä»ŽDocker HubRegistryä¸Šæ‹‰å–æ‰€éœ€è¦çš„é•œåƒæ–‡ä»¶å¦‚æžœæ‰¾ä¸åˆ°æŒ‡å®šçš„é•œåƒæ–‡ä»¶ï¼Œdocker buildä¼šè¿”å›žä¸€ä¸ªé”™è¯¯ä¿¡æ¯ã€‚ Syntax FROM [:]æˆ–FROM @ 1234567891011121314151617181920# vim Dockerfile#Deskription: test imageFROM busybox:latestMAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot;# LABEL maintainer=&quot;ssjinyao&quot;COPY index.html /data/web/html# vim index.html &lt;h1&gt; ssjinyao httpd server.&lt;/h1&gt;# docker build -t ssjinyaohttpd-img:v0.1-1 ./Sending build context to Docker daemon 3.072kBStep 1/3 : FROM busybox:latest ---&gt; e1ddd7948a1cStep 2/3 : MAINTAINER &quot;Jinyao &lt;renjin@ssjinyao.com&gt;&quot; ---&gt; Running in aa9838facca1Removing intermediate container aa9838facca1 ---&gt; 71258688ebebStep 3/3 : COPY index.html /data/web/html ---&gt; b23d8149125aSuccessfully built b23d8149125aSuccessfully tagged ssjinyaohttpd-img:v0.1-1 éªŒè¯ 12# docker run --name ssjinyao-web1 --rm ssjinyaohttpd-img:v0.1-1 cat /data/web/html/index.html&lt;h1&gt; ssjinyao httpd server.&lt;/h1&gt; å¤åˆ¶ç›®å½• 123456789101112131415161718192021222324252627282930313233FROM busybox:latestMAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot;# LABEL maintainer=&quot;ssjinyao&quot;COPY index.html /data/web/html/COPY yum.repos.d /etc/yum.repos.d/# lsDockerfile index.html yum.repos.d# docker build -t tinyhttpd:v0.1-2 ./# docker build -t tinyhttpd:v0.1-2 ./Sending build context to Docker daemon 26.11kBStep 1/4 : FROM busybox:latest ---&gt; e1ddd7948a1cStep 2/4 : MAINTAINER &quot;ssjinayo &lt;renjin@ssjinyao.com&gt;&quot; ---&gt; Using cache ---&gt; 708bad816b72Step 3/4 : COPY index.html /data/web/html/ ---&gt; Using cache ---&gt; 758051947b4dStep 4/4 : COPY yum.repos.d /etc/yum.repos.d/ ---&gt; a4c01bf4fe8dSuccessfully built a4c01bf4fe8dSuccessfully tagged tinyhttpd:v0.1-2# docker run --name tinyweb1 --rm tinyhttpd:v0.1-2 ls /etc/yum.repos.d/CentOS-Base.repoCentOS-CR.repoCentOS-Debuginfo.repoCentOS-Media.repoCentOS-Sources.repoCentOS-Vault.repoCentOS-fasttrack.repodocker-ce.repoepel-testing.repoepel.repo ADD æŒ‡ä»¤çš„ä½¿ç”¨ 12345678910111213141516171819202122232425262728# vim Dockerfile#Deskription: test imageFROM busybox:latestMAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot;# LABEL maintainer=&quot;ssjinyao&quot;COPY index.html /data/web/html/COPY yum.repos.d /etc/yum.repos.d/ADD http://nginx.org/download/nginx-1.15.5.tar.gz /usr/local/src/# docker build -t tinyhttpd:v0.1-3 ./Sending build context to Docker daemon 26.11kBStep 1/5 : FROM busybox:latest ---&gt; e1ddd7948a1cStep 2/5 : MAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot; ---&gt; Using cache ---&gt; 708bad816b72Step 3/5 : COPY index.html /data/web/html/ ---&gt; Using cache ---&gt; 758051947b4dStep 4/5 : COPY yum.repos.d /etc/yum.repos.d/ ---&gt; Using cache ---&gt; a4c01bf4fe8dStep 5/5 : ADD http://nginx.org/download/nginx-1.15.5.tar.gz /usr/local/src/Downloading 1.025MB/1.025MB ---&gt; 884e8bf3725fSuccessfully built 884e8bf3725fSuccessfully tagged tinyhttpd:v0.1-3# docker run --name tinyweb1 --rm tinyhttpd:v0.1-3 ls /usr/local/src/nginx-1.15.5.tar.gz 12345678910111213#Deskription: test imageFROM busybox:latestMAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot;# LABEL maintainer=&quot;ssjinyao&quot;COPY index.html /data/web/html/COPY yum.repos.d /etc/yum.repos.d/#ADD http://nginx.org/download/nginx-1.15.5.tar.gz /usr/local/src/ADD nginx-1.15.5.tar.gz /usr/local/src/# lsDockerfile index.html nginx-1.15.5.tar.gz yum.repos.d# docker build -t tinyhttpd:v0.1-4 ./# docker run --name tinyweb --rm tinyhttpd:v0.1-4 ls /usr/local/srcnginx-1.15.5 å¦å¤–ä¸€ç§å†™æ³• 12345678910# vim Dockerfile#Deskription: test imageFROM busybox:latestMAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot;# LABEL maintainer=&quot;ssjinyao&quot;COPY index.html /data/web/html/COPY yum.repos.d /etc/yum.repos.d/#ADD http://nginx.org/download/nginx-1.15.5.tar.gz /usr/local/src/WORKDIR /usr/local/src/ADD nginx-1.15.5.tar.gz ./ #è¿™é‡Œçš„./ç›¸å½“äºŽWORKDIRæŒ‡å®šçš„ç›®å½• 12345678910111213141516171819202122232425262728293031323334353637#Deskription: test imageFROM busybox:latestMAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot;# LABEL maintainer=&quot;ssjinyao&quot;COPY index.html /data/web/html/COPY yum.repos.d /etc/yum.repos.d/#ADD http://nginx.org/download/nginx-1.15.5.tar.gz /usr/local/src/WORKDIR /usr/local/ADD nginx-1.15.5.tar.gz ./src/VOLUME /data/mysql/# docker build -t tinyhttpd:v0.1-5 ./Sending build context to Docker daemon 1.052MBStep 1/7 : FROM busybox:latest ---&gt; e1ddd7948a1cStep 2/7 : MAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot; ---&gt; Running in 206968a461e1Removing intermediate container 206968a461e1 ---&gt; acce38db09a6Step 3/7 : COPY index.html /data/web/html/ ---&gt; cfac93db1094Step 4/7 : COPY yum.repos.d /etc/yum.repos.d/ ---&gt; ccbddff1520bStep 5/7 : WORKDIR /usr/local/ ---&gt; Running in 8bbda4faa5a4Removing intermediate container 8bbda4faa5a4 ---&gt; 1660db5c8614Step 6/7 : ADD nginx-1.15.5.tar.gz ./src/ ---&gt; cfd686660ff8Step 7/7 : VOLUME /data/mysql/ ---&gt; Running in e85008cba000Removing intermediate container e85008cba000 ---&gt; 529be777da05Successfully built 529be777da05Successfully tagged tinyhttpd:v0.1-5# docker run --name tinweb1 --rm tinyhttpd:v0.1-5 mount | grep data/dev/mapper/centos-root on /data/mysql type xfs (rw,seclabel,relatime,attr2,inode64,noquota) EXPOSE æŒ‡ä»¤ä½¿ç”¨ 1EXPOSE 1211/udp 11211/tcp # å¯åŠ¨é•œåƒæ˜¯è¦ä½¿ç”¨-Pé€‰é¡¹ ENV ç”¨äºŽä¸ºé•œåƒå®šä¹‰æ‰€éœ€è¦çš„çŽ¯å¢ƒå˜é‡ï¼Œå¹¶å¯è¢«Dockerfileæ–‡ä»¶ä¸­ä½äºŽå…¶åŽå…¶å®ƒæŒ‡ä»¤(ENV,ADD,COPYç­‰)æ‰€è°ƒç”¨ 123456789101112131415#Deskription: test imageFROM busybox:latestMAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot;# LABEL maintainer=&quot;ssjinyao&quot;ENV DOC_ROOT /data/web/htmlCOPY index.html $DOC_ROOTCOPY yum.repos.d /etc/yum.repos.d/#ADD http://nginx.org/download/nginx-1.15.5.tar.gz /usr/local/src/WORKDIR /usr/local/ADD nginx-1.15.5.tar.gz ./src/VOLUME /data/mysql/EXPOSE 80/tcp 12# docker run --name tinyweb1 --rm -P tinyhttpd:v0.1-7 printenv # æ‰“å°è¾“å‡ºçŽ¯å¢ƒå˜é‡# docker run --name tinyweb --rm -P -e WEB_SERVER_PACKAGE=&quot;nginx-1.15.1&quot; tinyhttpd:v0.1-7 printenv # -e å¯ä»¥å¤–éƒ¨æ›´æ”¹æˆ–æŒ‡å®šçŽ¯å¢ƒå˜é‡çš„ 1234567891011121314151617181920#Deskription: test imageFROM busybox:latestMAINTAINER &quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot;# LABEL maintainer=&quot;ssjinyao&quot;ENV DOC_ROOT=/data/web/html/ \ WEB_SERVER_PACKAGE=&quot;nginx-1.15.5.gz&quot;#å½“æ²¡æœ‰COPY index.html $&#123;DOC_ROOT: -/data/web/html/&#125;COPY yum.repos.d /etc/yum.repos.d/ADD http://nginx.org/download/$&#123;WEB_SERVER_PACKAGE&#125; /usr/local/src/WORKDIR /usr/local/#ADD $&#123;WEB_SERVER_PACKAGE&#125;.tar.gz ./src/VOLUME /data/mysql/EXPOSE 80/tcpRUN cd /usr/local/src &amp;&amp; \ tar xvf $&#123;WEB_SERVER_PACKAGE&#125; 1234567891011FROM busyboxLABEL maintainer=&quot;ssjinyao &lt;renjin@ssjinyao.com&gt;&quot; app=&quot;httpd&quot;ENV WEB_DOC_ROOT=&quot;/data/web/html&quot;RUN mkdir -p $WEB_DOC_ROOT &amp;&amp; \ echo &apos;&lt;h1&gt;Busybox httpd server.&lt;/h1&gt;&apos; &gt; $&#123;WEB_DOC_ROOT&#125;/index.html# COM /bin/httpd -f -h $&#123;WEB_DOC_ROOT&#125;CMD [&quot;/bin/httpd&quot;, &quot;-f&quot;, &quot;-h $&#123;EWB_DOC_ROOT&#125;&quot;]ENTRYPOINT /bin/sh -c Dockerfile Nginxé•œåƒ ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041# mkdir img_nginx# cd img_nginx# vim DockerfileFROM nginx:1.14-alpineARG author=&quot;ssjinyao &lt;rejin@ssjinyao.com&gt;&quot;LABEL maintainer=&quot;$&#123;author&#125;&quot;ENV NGX_DOC_ROOT=&quot;/data/web/html/&quot;ADD index.html $&#123;NGX_DOC_ROOT&#125;ADD entrypoint.sh /bin/EXPOSE 80/tcpHEALTHCHECK --start-period=3s CMD wget -O - -q http://$&#123;IP:-0.0.0.0&#125;:$&#123;PORT:-80&#125;/CMD [&quot;/usr/sbin/nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]ENTRYPOINT [&quot;/bin/entrypoint.sh&quot;]# vim index.html&lt;h1&gt; Dockerfile Nginx Test Page.&lt;/h1&gt;# vim entrypoint.sh#!/bin/sh#cat &gt; /etc/nginx/conf.d/www.conf &lt;&lt;EOFserver &#123; server_name $&#123;HOSTNAME&#125;; listen $&#123;IP:-0.0.0.0&#125;:$&#123;PORT:-80&#125;; root $&#123;NGINX_DOC_ROOT:-/usr/share/nginx/html&#125;;&#125;EOFexec &quot;$@&quot;# docker run --name myweb1 --rm -P -e &quot;PORT=8080&quot; nginx_web:v0.0-1127.0.0.1 - - [03/Oct/2018:07:43:31 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Wget&quot; &quot;-&quot;127.0.0.1 - - [03/Oct/2018:07:44:01 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Wget&quot; &quot;-&quot; è‡ªå»ºdocker-registry123456# yum -y install docker-registry# rpm -ql docker-distribution/etc/docker-distribution/registry/config.yml/usr/bin/registry/usr/lib/systemd/system/docker-distribution.service/var/lib/registry æ³¨: docker push å®¢æˆ·ç«¯é»˜è®¤æ˜¯httpså·¥ä½œçš„ï¼Œå› æ­¤åœ¨å®¢æˆ·ç«¯é…ç½®ä¸åŠ å¯†ä¼ è¾“ 12345678910111213# vim /etc/docker/daemon.json&#123; &quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;], &quot;bip&quot;: &quot;10.0.0.1/16&quot;, &quot;hosts&quot;: [&quot;tcp://0.0.0.0:2375&quot;,&quot;unix:///var/run/docker.sock&quot;], &quot;insecure-registries&quot;: [&quot;node2:5000&quot;]&#125;# docker tag ssjinyao/httpd:v0.1.1.1-2 node2:5000/ssjinayo-web:v0.1.1.1-2# docker push node2:5000/ssjinayo-webThe push refers to repository [node2:5000/ssjinayo-web]e6baf59e35e7: Pushedf9d9e4e6e2f0: Pushedv0.1.1.1-2: digest: sha256:2f3d6d2f468ee189b4b43ff2b9f99a6e3895d9832b606522176f804cba738037 size: 734 æœåŠ¡ç«¯é•œåƒé»˜è®¤ä¿å­˜çš„è·¯å¾„ 12# ls /var/lib/registry/docker/registry/v2/repositories/ssjinayo-web_layers _manifests _uploads ç§æœ‰docker æºpull ä½¿ç”¨, å‰æä¹Ÿè¦é…ç½®ä¸åŠ å¯†ä¼ è¾“ 1234# docker pull node2:5000/ssjinayo-web:v0.1.1.1-2v0.1.1.1-2: Pulling from ssjinayo-webDigest: sha256:2f3d6d2f468ee189b4b43ff2b9f99a6e3895d9832b606522176f804cba738037Status: Downloaded newer image for node2:5000/ssjinayo-web:v0.1.1.1-2 vmware-harborç§æœ‰æºçš„å®‰è£…ä¸Žä½¿ç”¨vmware/harborå®‰è£…vmware/harborä¸‹è½½ Resource Capacity Description CPU minimal 2 CPU 4 CPU is prefered Mem minimal 4GB 8GB is prefered Disk minimal 40GB 160GB is prefered 12345# yum -y install docker-compose# vim harbor.cfg # è¿™é‡Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚æ›´æ”¹é…ç½®æ–‡ä»¶# vim docker-compose.yml # # cd /usr/local/src/harbor# ./install 123456789CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMESf01090bf5ba1 goharbor/nginx-photon:v1.6.0 &quot;nginx -g &apos;daemon ofâ€¦&quot; 3 minutes ago Up 3 minutes (healthy) 0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp nginx7e4849fcb12a goharbor/harbor-jobservice:v1.6.0 &quot;/harbor/start.sh&quot; 3 minutes ago Up 3 minutes harbor-jobservice0d8ceb3ec5c0 goharbor/harbor-ui:v1.6.0 &quot;/harbor/start.sh&quot; 3 minutes ago Up 3 minutes (healthy) harbor-uic5780037bc8f goharbor/harbor-adminserver:v1.6.0 &quot;/harbor/start.sh&quot; 3 minutes ago Up 3 minutes (healthy) harbor-adminserverb184110cfac2 goharbor/registry-photon:v2.6.2-v1.6.0 &quot;/entrypoint.sh /etcâ€¦&quot; 3 minutes ago Up 3 minutes (healthy) 5000/tcp registry83b4b2ea3b2e goharbor/redis-photon:v1.6.0 &quot;docker-entrypoint.sâ€¦&quot; 3 minutes ago Up 3 minutes 6379/tcp redis9055f4dcdaeb goharbor/harbor-db:v1.6.0 &quot;/entrypoint.sh postâ€¦&quot; 3 minutes ago Up 3 minutes (healthy) 5432/tcp harbor-db583dd6d3dc30 goharbor/harbor-log:v1.6.0 &quot;/bin/sh -c /usr/locâ€¦&quot; 3 minutes ago Up 3 minutes (healthy) 127.0.0.1:1514-&gt;10514/tcp harbor-log ç™»å½•ç®¡ç†å‘˜åŽå° åœ¨ docker-vmware-harborä¸­åˆ›å»ºæ™®é€šç”¨æˆ·ï¼Œåœ¨æ™®é€šç”¨æˆ·ä¸­åˆ›å»ºé¡¹ç›® 1234567891011121314151617181920# vim /etc/docker/daemon.json&#123; &quot;insecure-registries&quot;: [&quot;blog.ssjinyao.com&quot;]&#125;# docker login blog.ssjinyao.comUsername: ssjinyaoPassword:WARNING! Your password will be stored unencrypted in /root/.docker/config.json.Configure a credential helper to remove this warning. Seehttps://docs.docker.com/engine/reference/commandline/login/#credentials-storeLogin Succeeded[root@ssjinyao-node2:~]# docker push blog.ssjinyao.com/devel/ssjinyao-httpdThe push refers to repository [blog.ssjinyao.com/devel/ssjinyao-httpd]e6baf59e35e7: Pushedf9d9e4e6e2f0: Pushedv0.1.1.1-1: digest: sha256:7248231aa495c62947519646d25acb453fd2caf3ed6bf778b41e6201bd3e31fc size: 734e6baf59e35e7: Layer already existsf9d9e4e6e2f0: Layer already existsv0.1.1.1-2: digest: sha256:2f3d6d2f468ee189b4b43ff2b9f99a6e3895d9832b606522176f804cba738037 size: 734 push é•œåƒå‰å¯ä»¥æŸ¥çœ‹vmware-harborçš„æ‰“æ ‡ç­¾æç¤º 1234# docker-compose pause æš‚åœ# docker-compose unpause è¿è¡Œ# docker-compose stop åœæ­¢# docker-compose start å¯åŠ¨ docker èµ„æºé™åˆ¶OOMEä¸€æ—¦å‘ç”ŸOOMEï¼Œä»»ä½•è¿›ç¨‹éƒ½æœ‰å¯èƒ½è¢«æ€æ­»ï¼ŒåŒ…æ‹¬docker daemonåœ¨å†…ä¸ºæ­¤ï¼ŒDokcerç‰¹åœ°è°ƒæ•´äº†docker daemonçš„OOMä¼˜å…ˆçº§ï¼Œä»¥åå®ƒè¢«å†…æ ¸â€æ­£æ³•â€ä½†å®¹å™¨çš„ä¼˜å…ˆçº§å¹¶æœªè¢«è°ƒæ•´ â€“memory-swap â€“memory åŠŸèƒ½ æ­£æ•°S æ­£æ•°M å®¹å™¨å¯ç”¨æ€»ç©ºé—´ä¸ºS,å…¶ä¸­ramä¸ºM,swapä¸º(S-M)è‹¥S=M,åˆ™æ— å¯ç”¨swapèµ„æº 0 æ­£æ•°M ç›¸å½“äºŽæœªè®¾ç½® swap(unset) unset æ­£æ•°M è‹¥ä¸»æœº(Docker Host)å¯ç”¨äº†swap,åˆ™å®¹å™¨çš„å¯ç”¨swapä¸º2*M -1 æ­£æ•°M è‹¥ä¸»æœº(Docker Host)å¯ç”¨äº†swap,åˆ™å®¹å™¨å¯ä½¿ç”¨æœ€å¤§è‡³ä¸»æœºä¸Šæ‰€çš„æ‰€æœ‰swapç©ºé—´çš„èµ„æº æ³¨æ„: åœ¨å®¹å™¨ä½¿ç”¨freeå‘½ä»¤å¯ä»¥çœ‹åˆ°çš„swapç©ºé—´å¹¶ä¸æ˜¯å…·æœ‰å…¶æ‰€å±•çŽ°å‡ºçš„ç©ºé—´æŒ‡ç¤ºæ„ä¹‰ pull ä¸€ä¸ªåŽ‹æµ‹é•œåƒ 123# docker pull lorel/docker-stress-ng# docker run --name stress -it --rm lorel/docker-stress-ng:latest stress --help# docker run --name stree -it --rm -m 256m lorel/docker-stress-ng:latest stress --vm 2 æŸ¥çœ‹å¯ç”¨çš„dockerè¿›ç¨‹ æŸ¥çœ‹stress å®¹å™¨çš„åˆ†é…å†…å­˜çŠ¶æ€ åŒæ ·çš„ï¼Œå½“å¯¹cpuåšåŽ‹æµ‹æ—¶ï¼ŒæŒ‡å®šä¸Šé™ä¸ºä¸¤ä¸ªcpuï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨çŽ‡ä¸º200%ï¼Œå½“åŽ‹æµ‹ä¸º8ä¸ªcpuæ—¶ï¼Œcpuæœ€é«˜å ç”¨ä¸º200% 123456# docker run --name stress -it --rm --cpus 2 lorel/docker-stress-ng:latest stress --cpu 8# docker run --name stress -it --cpuset-cpus 0,2 --rm lorel/docker-stress-ng:latest stress --cpu 8 #è®¾å®šåªè¿è¡Œåœ¨ç¬¬0å’Œ2ä¸ªcpuä¸Š# docker run --name stress -it --cpus 2 --rm lorel/docker-stress-ng:latest stresss --cpu8 #è®¾å®šcpus 2 ï¼Œè¯´æ˜Žæ‰€æœ‰æ ¸å¿ƒéƒ½èƒ½ç”¨åˆ°ï¼Œä½†æ˜¯æœ€å¤šåªèƒ½ä½¿ç”¨200%# docker run --name stress -it --cpu-shares 1024 --rm lorel/docker-stress-ng:latest stress --cpu 8 # è®¾å®šé™åˆ¶ä¸ºå°½å¯èƒ½å¤šçš„åˆ†é…cpuèµ„æº,æœ€åŽè¿™ç§æ¨¡å¼ï¼Œå½“å†å¯ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œä¼šå®žæ—¶æŒ‰æ¯”ä¾‹åˆ†é…cpuèµ„æºåˆ†åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼Œ# docker run --name stress2 -it --cpu-shares 512 --rm lorel/docker-stress-ng:latest stress --cpu 8]]></content>
      <tags>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[dockerç¬”è®°(ä¸€)]]></title>
    <url>%2F2018%2F09%2F28%2Fdocker%E7%AC%94%E8%AE%B0%E4%B8%80%2F</url>
    <content type="text"><![CDATA[dockerç¬”è®°(ä¸€) Virtualization And Containerä¸»æœºçº§è™šæ‹ŸåŒ– Type-I ç›´æŽ¥åœ¨ç¡¬ä»¶ä¸Šåšè™šæ‹ŸåŒ–; Type-II å¯åŠ¨ç³»ç»ŸåŽï¼Œå†åšè™šæ‹ŸåŒ–; çœŸæ­£èƒ½äº§ç”Ÿç”Ÿäº§åŠ›çš„ï¼Œæ˜¯åº”ç”¨å±‚é¢; ç³»ç»Ÿè¿è¡Œä¸¤é¢—æ ‘:è¿›ç¨‹æ ‘å’Œæ–‡ä»¶ç³»ç»Ÿæ ‘; åŸºäºŽç”¨æˆ·å±‚é¢çš„éš”ç¦»(UTS,Mount,IPC,PID,User,Net); namespaces:åç§°ç©ºé—´ï¼Œç³»ç»Ÿè°ƒç”¨ï¼Œå‘å¤–è¾“å‡º(clone(),setns()); Linux Namespaces namespace ç³»ç»Ÿè°ƒç”¨å‚æ•° éš”ç¦»å†…å®¹ å†…æ ¸ç‰ˆæœ¬ UTS CLONE_NEWUTS ä¸»æœºåå’ŒåŸŸå 2.6.19 IPC CLONE_NEWIPC ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå…±äº«å†…å­˜ 2.6.19 PID CLONE_NEWPID è¿›ç¨‹ç¼–å· 2.6.24 Network CLONE_NEWNET ç½‘ç»œè®¾å¤‡ã€ç½‘ç»œæ ˆã€ç«¯å£å·ç­‰ 2.6.29 Mount CLONE_NEWNS æŒ‚è½½ç‚¹(æ–‡ä»¶ç³»ç»Ÿ) 2.4.19 User CLONE_NEWUSER ç”¨æˆ·å’Œç”¨æˆ·ç»„ 3.8 Control Groups(cGroups)æŠŠç³»ç»Ÿçº§çš„èµ„æºåˆ†æˆå¤šä¸ªç»„ lxc-create,template nmp machine+swarm+compose mesos+marathon kubernetes -&gt; k8s libcontainer -&gt; runC Moby, CNCF dockerä¸­çš„å®¹å™¨ lxc -&gt; libcontainer -&gt; runC OCI Open Container Initiative æ—¨åœ¨å›´ç»•å®¹å™¨å¼å’Œè¿è¡Œæ—¶åˆ¶å®šä¸€ä¸ªå¼€æ”¾çš„å¼ä¸šåŒ–æ ‡å‡† the Runtime Specification(runtime-spec) the Image Specification(image-spec) runC Open Container Format https:hub.docker.com docker çš„ä¸¤ä¸ªç‰ˆæœ¬docker-eedocker-ce docker architecture The Docker daemon The Docker client Docker registries yum ä¸­çš„ä»“åº“ repository,repo docker ä¸­çš„ä»“åº“ repository, repoé•œåƒåç§° nginx:1.10 ä»¥æ­¤æ¥å‘½ä»¤é•œåƒï¼Œnginx:1.15 nginx:latest è€Œé•œåƒçš„é»˜è®¤ç‰ˆæ˜¯æœ€æ–°ç‰ˆçš„nginx:1.14 nginx:stable æœ€æ–°ç¨³å®šç‰ˆé•œåƒï¼šé™æ€;å®¹å™¨ï¼šåŠ¨æ€ï¼Œæœ‰ç”Ÿå‘½å‘¨æœŸï¼Œç‰¹åˆ«ç±»ä¼¼äºŽç¨‹åº;å®¹å™¨å¸¸ç”¨èµ„æº: images, containers, networks, volumes, plugins, å®‰è£…åŠä½¿ç”¨docker ä¾èµ–çš„çŽ¯å¢ƒ 64 bits CPU Linux Kernel 3.10+ Linux Kernel cgrups and namespace CentOS 7 â€œExtrasâ€ repository Docker Daemon systemctl start docker.service Docker Client docker[OPTIONS] COMMAND [arg â€¦] 123456# cd /etc/yum.repos.d/# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# yum makecache# yum repolist# yum remove docker docker-common container-selinux docker-selinux docker-engine# yum install docker-ce ä»“åº“é…ç½®æ–‡ä»¶: https://dowland.docker.com/linux/centos/docker-ce.repo Dockerç»„ä»¶: dockerç¨‹åºçŽ¯å¢ƒ: 12345678910çŽ¯å¢ƒé…ç½®æ–‡ä»¶: /etc/sysconfig/docker-network /etc/sysconfig/docker-storage /etc/sysconfig/dockerUnit FIle: /usr/lib/systemd/system/docker.serivceDocker Registryé…ç½®æ–‡ä»¶ /etc/contalners/registries.conf docker-ce: é…ç½®æ–‡ä»¶:/etc/docker/daemon.json æ³¨å†Œé˜¿é‡Œäº‘è´¦å·ï¼Œä¸“ç”¨åŠ é€Ÿå™¨åœ°å€èŽ·å¾—è·¯å¾„: https://cr.console.aliyun.com/#/accelerator Dockeré•œåƒåŠ é€Ÿ 123456 docker cn é˜¿é‡Œäº‘åŠ é€Ÿå™¨ ä¸­å›½ç§‘æŠ€å¤§å­¦&#123; &quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;]&#125; 123456# mkdir /etc/docker# vim /etc/docker/daemon.json&#123; &quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;]&#125;# systemctl start docker æŸ¥çœ‹docker ç‰ˆæœ¬ä¿¡æ¯ 1234567891011121314151617181920# docker versionClient: Version: 18.06.1-ce API version: 1.38 Go version: go1.10.3 Git commit: e68fc7a Built: Tue Aug 21 17:23:03 2018 OS/Arch: linux/amd64 Experimental: falseServer: Engine: Version: 18.06.1-ce API version: 1.38 (minimum version 1.12) Go version: go1.10.3 Git commit: e68fc7a Built: Tue Aug 21 17:25:29 2018 OS/Arch: linux/amd64 Experimental: false# docker info å¸¸ç”¨æ“ä½œ12345678910111213141516171819202122232425262728docker search : æœç´¢é•œåƒ# docker search nginxdocker pull: ä¸‹è½½é•œåƒåˆ°æœ¬åœ°# docker pull nginx:1.14-alpine-perl# docker pull busybox:latest# docker image pull nginx:1.14-alpine-perl# docker docker images: åˆ—å‡ºæœ¬åœ°é•œåƒ # docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEnginx 1.14-alpine-perl a47b6006585d 2 weeks ago 51.6MBbusybox latest e1ddd7948a1c 8 weeks ago 1.16MB# docker image rm a47b6006585d # åˆ é™¤é•œåƒ# docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEbusybox latest e1ddd7948a1c 8 weeks ago 1.16MB# docker image ls --no-trunc # åˆ—å‡ºå®Œæ•´image idä¿¡æ¯REPOSITORY TAG IMAGE ID CREATED SIZEnginx 1.14-alpine-perl sha256:a47b6006585d03b999ee55c6eec4331430fb2bcddb5ce8f76f294cc997482ca2 2 weeks ago 51.6MBbusybox latest sha256:e1ddd7948a1c31709a23cc5b7dfe96e55fc364f90e1cebcde0773a1b5a30dcda 8 weeks ago 1.16MB# docker container ls # åˆ—å‡ºæ‰€æœ‰å®¹å™¨# docker ps: åˆ—å‡ºæ‰€æœ‰å®¹å™¨# docker images: åˆ—å‡ºæ‰€æœ‰é•œåƒ# docker create: åˆ›å»ºæ–°çš„container# docker start: Start one or more stopped contaners# docker run: Run a command in a new container# docker attacth: Attach to a running container# docker ps: List containers apline: èƒ½å¤Ÿèƒ½ç¨‹åºæä¾›åŸºç¡€çŽ¯å¢ƒï¼Œä½†æ˜¯ä½“ç§¯éžå¸¸å°ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä¸å»ºè®®ä½¿ç”¨aplineç‰ˆ;busybox: èƒ½å¤Ÿç”¨ä¸€ä¸ªbusyboxå®žçŽ°linuxç³»ç»Ÿçš„å¤šä¸ªå‘½ä»¤ï¼Œå½“é“¾æŽ¥busyboxä¸ºls æ—¶ï¼Œå®ƒå¯ä»¥æ‰§è¡Œlså‘½ä»¤; é“¾æŽ¥æˆpwdæ—¶ï¼Œå¯ä»¥å®žçŽ°pwdå‘½ä»¤ã€‚kernel+busyboxå¯ä»¥å®žçŽ°ä¸€ä¸ªå¾®linuxç³»ç»Ÿ; æ‰€ç•çš„androidç³»ç»Ÿä¹Ÿæ˜¯linux+busybox+jvmæ‰€è¿è¡Œçš„ç³»ç»Ÿ; å®¹å™¨ä½¿ç”¨12345678910# docker run --name b2 -it busybox:latest/ ## docker run --name b1 -it busybox:latest/ # mkdir /data/www -p/ # vi /data/www/index.html&lt;h1&gt;www.ssjinyao.com&lt;/h1&gt;/ # httpd -f -h /data/www/# docker inspect b1 # æŸ¥çœ‹ docker å®¹å™¨çš„å¯åŠ¨ä¿¡æ¯ # åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è®¿é—® curl 172.17.0.2&lt;h1&gt;www.ssjinyao.com&lt;/h1&gt; docker å†å¯åŠ¨ 1234# docker ps -aCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES57c80d23f0e5 busybox:latest &quot;sh&quot; 6 minutes ago Exited (130) 4 minutes ago b1# docker container start -i -a b1 docker å®¹å™¨ç»ˆæ­¢ 12# docker kill b1# docker stop b1 docker å¯åŠ¨nginxé•œåƒ 12345678910111213141516171819202122232425262728# docker run --name web1 -d nginx:1.14-alpine-perl # docker inspect web1# [root@ssjinyao-node1:~]# curl 172.17.0.2&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;style&gt; body &#123; width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&lt;p&gt;If you see this page, the nginx web server is successfully installed andworking. Further configuration is required.&lt;/p&gt;&lt;p&gt;For online documentation and support please refer to&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;Commercial support is available at&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; æ³¨: ä¸€ä¸ªå®¹å™¨å°±æ˜¯ä¸ºäº†è¿è¡Œä¸€ä¸ªç¨‹åºï¼Œå¦‚æžœç¨‹åºè·‘åŽå°è¿è¡Œï¼Œé‚£ä¹ˆå®¹å™¨è®¤ä¸ºç¨‹åºç»ˆæ­¢äº†ã€‚å› ä¸ºï¼Œå¦‚æžœç¨‹åºåœ¨å®¹å™¨è¿è¡Œåœ¨åŽå°ï¼Œé‚£ä¹ˆç¨‹åºä¸€å¯åŠ¨ï¼Œå®¹å™¨å°±ä¼šç»ˆæ­¢ã€‚ç›´æŽ¥æœç´¢ä¸‹è½½é•œåƒå¹¶è¿è¡Œ 1# docker run --name kvstor1 -d redis:4-alpine ç»•è¿‡å®¹å™¨çš„è¾¹ç•Œï¼Œäº¤äº’å¼æŽ¥å…¥è¿›åŽ» 123456# docker exec -it kvstor1 /bin/sh/data # psPID USER TIME COMMAND 1 redis 0:00 redis-server 12 root 0:00 /bin/sh 16 root 0:00 ps æŸ¥çœ‹dockerå¯åŠ¨å®¹å™¨åŽçš„æ—¥å¿—ä¿¡æ¯ 1# docker logs web1 docker event state Docker é•œåƒçš„ä½¿ç”¨ä¸Žç®¡ç†Docker:ç å¤´å·¥äººä¸€èˆ¬æˆ‘ä»¬éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯æ•£è£…çš„ã€‚è€Œdockerå¯ä»¥è¿›è¡Œé›†è£…çš„; Docker é•œåƒå«æœ‰å¯åŠ¨å®¹å™¨æ‰€éœ€è¦çš„æ–‡ä»¶ç³»ç»ŸåŠå…¶å†…å®¹ï¼Œå› æ­¤ï¼Œå…¶ç”¨äºŽåˆ›å»ºå¹¶å¯åŠ¨dockerå®¹å™¨ 1234567é‡‡ç”¨åˆ†å±‚æž„å»ºæœºåˆ¶ï¼Œæœ€åº•å±‚ä¸ºbootfs,å…¶ä¹‹ä¸ºrootfs bootfs: ç”¨äºŽç³»ç»Ÿå¼•å¯¼çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬bootloaderå’Œkernelï¼Œ å®¹å™¨å¯åŠ¨å®ŒæˆåŽä¼šè¢«å¸è½½ä»¥èŠ‚çº¦å†…åœ¨èµ„æº rootfs: ä½äºŽbootfsä¹‹ä¸Šï¼Œè¡¨çŽ°ä¸ºdockerå®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ: ä¼ ç»Ÿæ¨¡å¼ä¸­ï¼Œç³»ç»Ÿå¯åŠ¨ä¹‹æ—¶ï¼Œå†…æ ¸æŒ‚è½½rootfsæ—¶ä¼šé¦–å…ˆå°†å…¶æŒ‚è½½ä¸º&quot;åªè¯»&quot;æ¨¡å¼, å®Œæ•´æ€§è‡ªæ£€åŽå°†å…¶é‡æ–°æŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼; dockerä¸­,rootfsç”±å†…æ ¸æŒ‚è½½ä¸º&quot;åªè¯»&quot;æ¨¡å¼ï¼Œè€ŒåŽé€šè¿‡&quot;è”åˆæŒ‚è½½&quot;æŠ€æœ¯é¢å¤–æä¾›ä¸€ä¸ªå¯å†™å±‚; Aufs: advnaced multi-layered unification filesystem: é«˜çº§å¤šå±‚ç»Ÿä¸€æ–‡ä»¶ç³»ç»ŸCentOS ä¸ºæ±‚ç¨³å®šï¼Œä¸æ•´åˆæ­¤æ–‡ä»¶ç³»ç»Ÿoverlayfs ä»Ž3.18ç‰ˆæœ¬å¼€å§‹è¢«åˆå¹¶åˆ°Linuxå†…æ ¸; 123# docker info # å¯ä»¥çœ‹å‡ºå‰ç«¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯overlay2ï¼Œè€ŒåŽç«¯ç”¨çš„æ˜¯xfs Storage Driver: overlay2 Backing Filesystem: xfs Docker Registryå¯åŠ¨å®¹å™¨æ—¶ï¼Œdocker daemon ä¼šè¯•å›¾ä»Žæœ¬åœ°èŽ·å–é•œåƒ; æœ¬åœ°é•œåƒä¸å­˜åœ¨æ—¶ å°†Registry ä¸­çš„é•œåƒä¸‹è½½ä¿å­˜åˆ°æœ¬åœ°; Docker Registry åˆ†ç±»Registryç”¨äºŽä¿å­˜dockeré•œåƒï¼ŒåŒ…æ‹¬é•œåƒçš„å±‚æ¬¡ç»“æž„å’Œå…ƒæ•°æ®;ç”¨æˆ·å¯è‡ªå»ºRegistryï¼Œä¹Ÿå¯ä»¥ç”¨å®˜æ–¹çš„Docker Hub åˆ†ç±»Sponsor Registry: ç¬¬ä¸‰æ–¹çš„registry, ä¾›å®¢æˆ·å’ŒDockerç¤¾åŒºä½¿ç”¨Mirror Registry: ç¬¬ä¸‰æ–¹çš„registry,åªè®©å®¢æˆ·ä½¿ç”¨Vendor Registry: ç”±å‘å¸ƒDockeré•œåƒçš„ä¾›åº”å•†æä¾›çš„registryPrivate Rgeistry: é€šè¿‡è®¾æœ‰é˜²ç«å¢™å’Œå®¢å¤–çš„å®‰å…¨å±‚çš„ç§æœ‰å®žä½“æä¾›çš„registry Repository 12345ç”±æŸç‰¹å®šçš„dockeré•œåƒçš„æ‰€æœ‰è¿­ä»£ç‰ˆæœ¬ç»„æˆçš„é•œåƒä»“åº“ä¸€ä¸ªRegistryä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªRepository Repository å¯åˆ†ä¸º&quot;é¡¶å±‚ä»“åº“&quot; å’Œ &quot;ç”¨æˆ·ä»“åº“&quot; ç”¨æˆ·ä»“åº“åç§°æ ¼å¼ä¸º&quot;ç”¨æˆ·å/ä»“åº“å&quot;æ¯ä¸ªä»“åº“å¯ä»¥åŒ…å«å¤šä¸ªTag(æ ‡ç­¾)ï¼Œæ¯ä¸ªæ ‡ç­¾å¯¹åº”ä¸€ä¸ªé•œåƒ Index 12ç»´æŠ¤ç”¨æˆ·å¸æˆ·ã€é•œåƒçš„æ ¡éªŒä»¥åŠå…¬å…±å‘½åç©ºé—´çš„ä¿¡æ¯; ç›¸å½“äºŽä¸ºRegistryæ ç›¸å½“äºŽä¸ºRegistryæä¾›äº†ä¸€ä¸ªå®Œæˆç”¨æˆ·è®¤è¯ç­‰åŠŸèƒ½ Docker Registryä¸­çš„é•œåƒé€šå¸¸ç”±å¼€å‘äººå‘˜åˆ¶ä½œï¼Œè€ŒåŽæŽ¨é€è‡³â€å…¬å…±â€æˆ–â€ç§æœ‰â€Registryä¸Šä¿å­˜;ä¾›å…¶ä»–äººå‘˜ä½¿ç”¨ï¼Œä¾‹å¦‚â€éƒ¨ç½²â€åˆ°ç”Ÿäº§çŽ¯å¢ƒ; 1# docker pull registry&gt;[:&lt;prot&gt;]/[&lt;namespace&gt;/]&lt;name&gt;:&lt;tag&gt; quay.io ä¹Ÿå¯ä»¥ä¸‹è½½å¤šç§é•œåƒ 1# docker pull quay.io/coreos/flannel:v0.10.0-amd64 #æŒ‡å®šç«™ç‚¹pullé•œåƒ é•œåƒåˆ¶ä½œé•œåƒçš„ç”Ÿæˆé€”å¾„DockerfileåŸºäºŽå®¹å™¨åˆ¶ä½œDocker Hub automated builds Namespace Example(/) organization redhat/kubernets login(user name) alice/application, bob/application role devel/database, test/database, prod/database 123456# docker container run --name busybox1 -it busyboxWARNING: IPv4 forwarding is disabled. Networking will not work./ #/ #/ # mkdir -p /data/html/ # echo &quot;&lt;h1&gt;www.ssjinyao.com&lt;/h1&gt;&quot; &gt; /data/html/index.html æš‚æ—¶ä¸å…³é—­å®¹å™¨ï¼Œå†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯æ¥åˆ¶ä½œé•œåƒ 12345678910111213141516171819202122# docker commit -p busybox1# docker image lsREPOSITORY TAG IMAGE ID CREATED SIZE&lt;none&gt; &lt;none&gt; d5ab408117c0 8 seconds ago 1.16MBredis 4-alpine db23f46600bc 2 weeks ago 30MBnginx 1.14-alpine-perl a47b6006585d 2 weeks ago 51.6MBbusybox latest e1ddd7948a1c 2 months ago 1.16MBquay.io/coreos/flannel v0.10.0-amd64 f0fad859c909 8 months ago 44.6MB# å†ç»™æ ‡ç­¾æ‰“æ ‡ç­¾# docker tag d5ab408117c0 ssjinyao/httpd:v0.1.1-1# docker image lsREPOSITORY TAG IMAGE ID CREATED SIZEssjinyao/httpd v0.1.1-1 d5ab408117c0 About a minute ago 1.16MBredis 4-alpine db23f46600bc 2 weeks ago 30MBnginx 1.14-alpine-perl a47b6006585d 2 weeks ago 51.6MBbusybox latest e1ddd7948a1c 2 months ago 1.16MBquay.io/coreos/flannel v0.10.0-amd64 f0fad859c909 8 months ago 44.6MB# docker tag ssjinyao/httpd:v0.1.1-1 ssjinyao/httpd:latest# docker image lsREPOSITORY TAG IMAGE ID CREATED SIZEssjinyao/httpd latest d5ab408117c0 3 minutes ago 1.16MBssjinyao/httpd v0.1.1-1 d5ab408117c0 3 minutes ago 1.16MB ä¸€ä¸ªIMAGE ID å¯¹åº”å¤šä¸ªTagæ—¶ï¼Œåˆ é™¤ Tag ä¸ä¼šåˆ é™¤é•œåƒï¼Œè€Œåƒè½¯é“¾ä¸€ä¸‹ï¼Œåˆ é™¤é“¾æŽ¥ 123456789101112131415161718# docker image rm ssjinyao/httpd:latestUntagged: ssjinyao/httpd:latest# docker image lsREPOSITORY TAG IMAGE ID CREATED SIZEssjinyao/httpd v0.1.1-1 d5ab408117c0 5 minutes ago 1.16MBredis 4-alpine db23f46600bc 2 weeks ago 30MBnginx 1.14-alpine-perl a47b6006585d 2 weeks ago 51.6MBbusybox latest e1ddd7948a1c 2 months ago 1.16MBquay.io/coreos/flannel v0.10.0-amd64 f0fad859c909 8 months ago 44.6MB# docker tag ssjinyao/httpd:v0.1.1-1 ssjinyao/httpd:latest# docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEssjinyao/httpd latest d5ab408117c0 6 minutes ago 1.16MBssjinyao/httpd v0.1.1-1 d5ab408117c0 6 minutes ago 1.16MBredis 4-alpine db23f46600bc 2 weeks ago 30MBnginx 1.14-alpine-perl a47b6006585d 2 weeks ago 51.6MBbusybox latest e1ddd7948a1c 2 months ago 1.16MBquay.io/coreos/flannel v0.10.0-amd64 f0fad859c909 8 months ago 44.6MB åˆ¶ä½œé•œåƒåŠ å…¥CommandæŒ‡ä»¤ 1234567891011121314# docker commit -a &quot;ssjinyao&quot; -c &apos;CMD [&quot;/bin/httpd&quot;, &quot;-f&quot;, &quot;-h&quot;,&quot;/data/html&quot;]&apos; -p busybox1 ssjinyao/httpd:v0.1.1.1-2# docker image lsREPOSITORY TAG IMAGE ID CREATED SIZEssjinyao/httpd v0.1.1.1-2 0ec8103a1bb2 53 seconds ago 1.16MB# docker run --name busybox2 ssjinyao/httpd:v0.1.1.1-2 # è‚¯æ®åˆ›å»ºçš„é•œåƒå¯åŠ¨å®¹å™¨# docker container lsCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES27403687efa0 ssjinyao/httpd:v0.1.1.1-2 &quot;/bin/httpd -f -h /dâ€¦&quot; 30 seconds ago Up 29 seconds busybox26373ae374a7a redis:4-alpine &quot;docker-entrypoint.sâ€¦&quot; 4 days ago Up 4 days 6379/tcp kvstor1a5ffdd373b90 nginx:1.14-alpine-perl &quot;nginx -g &apos;daemon ofâ€¦&quot; 4 days ago Up 4 days 80/tcp web1# docker inspect # æŸ¥çœ‹å®¹å™¨ä¿¡æ¯# curl 172.17.0.4&lt;h1&gt;www.ssjinyao.com&lt;/h1&gt; åœ¨ docker hub å»ºç«‹å¸å·ï¼Œå¹¶åˆ›å»ºREPOSITORY 1234567# docker login -u ssjinyaoPassword:WARNING! Your password will be stored unencrypted in /root/.docker/config.json.Configure a credential helper to remove this warning. Seehttps://docs.docker.com/engine/reference/commandline/login/#credentials-storeLogin Succeeded å¾€ hub.docker.com ä¸Šé¢æŽ¨é•œåƒ 1# docker push ssjinyao/httpd å¯ä»¥çœ‹åˆ°ï¼Œä¸Šä¼ çš„é•œåƒ å›½å†…æ¯”è¾ƒå¸¸ç”¨çš„é•œåƒåœ°å€åœ¨é˜¿é‡Œäº‘docker é•œåƒç«™ç‚¹ä¸­åˆ›å»ºREPOSITORYä¸Šä¼ æœ¬åœ°çš„é•œåƒ 123456789101112# docker tag ssjinyao/httpd:v0.1.1.1-2 registry.cn-qingdao.aliyuncs.com/ssjinyao/httpd# docker logoutRemoving login credentials for https://index.docker.io/v1/# docker login --username=ssjinyao registry.cn-qingdao.aliyuncs.comPassword:WARNING! Your password will be stored unencrypted in /root/.docker/config.json.Configure a credential helper to remove this warning. Seehttps://docs.docker.com/engine/reference/commandline/login/#credentials-storeLogin Succeeded# docker push registry.cn-qingdao.aliyuncs.com/ssjinyao/httpd docker é•œåƒçš„å¯¼å…¥å’Œå¯¼å‡º 1234# docker save -o ssjinyao-busybox-image.gz ssjinyao/httpd:v0.1.1.1-3 ssjinyao/httpd:v0.1.1.1-2# å°†é•œåƒå¤åˆ¶åˆ°å¦ä¸€å°æœåŠ¡å™¨# scp ssjinyao-busybox-image.gz root@node2:/root/ssjinyao-busybox-image.gz 100% 1370KB 23.8MB/s 00:00 åœ¨å¦ä¸€å°æœåŠ¡å™¨ä¸Šå¯¼å…¥é•œåƒ 123456789101112131415# docker load -i ssjinyao-busybox-image.gzf9d9e4e6e2f0: Loading layer 1.378MB/1.378MBe6baf59e35e7: Loading layer 4.608kB/4.608kB# docker image lsREPOSITORY TAG IMAGE ID CREATED SIZEssjinyao/httpd v0.1.1.1-3 cfa66f44c384 About an hour ago 1.16MBssjinyao/httpd v0.1.1.1-2 3dc1b07020fd About an hour ago 1.16MB# docker run --name busybox ssjinyao/httpd:v0.1.1.1-2# å†å¼€å¯ä¸€ä¸ªç»ˆç«¯# # docker inspect busybox | grep &quot;IPAddress&quot; &quot;SecondaryIPAddresses&quot;: null, &quot;IPAddress&quot;: &quot;172.17.0.2&quot;, &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,# curl 172.17.0.2&lt;h1&gt;www.ssjinyao.com&lt;/h1&gt; è™šæ‹ŸåŒ–ç½‘ç»œç®¡ç†6ç§åç§°ç©ºé—´: UTS, User, Mount, IPC, Pid, Net;Linux å†…æ ¸æ”¯æŒäºŒå±‚å’Œä¸‰å±‚è®¾å¤‡çš„æ¨¡æ‹Ÿ;OVS: Open VSwitch; 12345# yum -y install bridge-utils# brctl showbridge name bridge id STP enabled interfacesdocker0 8000.024288c640ef no veth5097b16# ip link show #å¯ä»¥çœ‹åˆ°dockerè™šæ‹Ÿç½‘å¡ä¿¡ åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸¤ä¸ªå®¹å™¨ 123456# docker start 27403687efa0# docker container run --name busybox3 -it ssjinyao/httpd:v0.1.1.1-3# æŸ¥çœ‹ä¸¤ä¸ªå®¹å™¨é—´åŸºäºŽnatçš„é€šä¿¡ # docker exec -it busybox2 /bin/sh/ # wget -O - -q http://172.17.0.5&lt;h1&gt;www.ssjinyao.com&lt;/h1&gt; {User,Mount,Pid}, {User,Mount,Pid} â€“&gt; å…±äº«{UTS,Net,IPC} è®©å®¹å™¨ä½¿ç”¨ç®¡ç†å®¿ä¸»æœºçš„ç½‘ç»œåç§°ç©ºé—´ 1# docker network inspect bridge ip åç§°ç©ºé—´ç®¡ç† 1234567891011# yum -y install iproute# ip netns helpUsage: ip netns list ip netns add NAME ip netns set NAME NETNSID ip [-all] netns delete [NAME] ip netns identify [PID] ip netns pids NAME ip [-all] netns exec [NAME] cmd ... ip netns monitor ip netns list-id 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182# ip netns add r1# ip netns add r2# ip netns exec r1 ifconfig -a# ip link add name veth1.1 type veth peer name veth1.2# ip link show | grep veth134: veth1.2@veth1.1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 100035: veth1.1@veth1.2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000# ip link set dev veth1.2 netns r1 # å°†è®¾veth1.2 ç§°åˆ°åç§°ç©ºé—´r1 ä¸­# ip netns exec r1 ifconfig -alo: flags=8&lt;LOOPBACK&gt; mtu 65536 loop txqueuelen 1 (Local Loopback) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0veth1.2: flags=4098&lt;BROADCAST,MULTICAST&gt; mtu 1500 ether da:2a:32:c9:1e:e2 txqueuelen 1000 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0# ip netns exec r1 ip link set dev veth1.2 name eth0 # å°†åç§°ç©ºé—´ä¸­çš„veth1.2æ›´åä¸ºeth0# ip netns exec r1 ifconfig -aeth0: flags=4098&lt;BROADCAST,MULTICAST&gt; mtu 1500 ether da:2a:32:c9:1e:e2 txqueuelen 1000 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0lo: flags=8&lt;LOOPBACK&gt; mtu 65536 loop txqueuelen 1 (Local Loopback) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0# ifconfig veth1.1 10.1.0.1/24 up # æ¿€æ´»ç½‘å¡veth1.1# ip netns exec r1 ifconfig eth0 10.1.0.2/24 up # æ¿€æ´»r1åç§°ç©ºé—´ä¸­çš„ eth0# ip netns exec r1 ifconfigeth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 10.1.0.2 netmask 255.255.255.0 broadcast 10.1.0.255 inet6 fe80::d82a:32ff:fec9:1ee2 prefixlen 64 scopeid 0x20&lt;link&gt; ether da:2a:32:c9:1e:e2 txqueuelen 1000 (Ethernet) RX packets 8 bytes 648 (648.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 8 bytes 648 (648.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0# ping 10.1.0.2PING 10.1.0.2 (10.1.0.2) 56(84) bytes of data.64 bytes from 10.1.0.2: icmp_seq=1 ttl=64 time=0.945 ms64 bytes from 10.1.0.2: icmp_seq=2 ttl=64 time=0.061 ms# ip link set dev veth1.1 netns r2 # å°† veth1.1 ç§»åˆ°åç§°ç©ºé—´r2ä¸­# ip netns exec r2 ifconfig veth1.1 10.1.0.3/24 up # å¯ç”¨r2åç§°ç©ºé—´ä¸­çš„veth1.1# ip netns exec r2 ping 10.1.0.2 # åœ¨åç§°ç©ºé—´r2ä¸­ping åç§°ç©ºé—´r1çš„eth0ç»‘å®šçš„ipåœ°å€PING 10.1.0.2 (10.1.0.2) 56(84) bytes of data.64 bytes from 10.1.0.2: icmp_seq=1 ttl=64 time=0.214 ms64 bytes from 10.1.0.2: icmp_seq=2 ttl=64 time=0.080 ms--rm å®¹å™¨åœæ­¢åŽï¼Œå°†å®¹å™¨åˆ é™¤# docker run --name t1 -it --network bridge -h www.ssjinyao.com --rm busybox:latest/ # hostnamewww.ssjinyao.com/ # ping www.ssjinyao.comPING www.ssjinyao.com (172.17.0.6): 56 data bytes64 bytes from 172.17.0.6: seq=0 ttl=64 time=0.094 ms--- www.ssjinyao.com ping statistics ---1 packets transmitted, 1 packets received, 0% packet lossround-trip min/avg/max = 0.094/0.094/0.094 ms/ # cat /etc/hosts127.0.0.1 localhost::1 localhost ip6-localhost ip6-loopbackfe00::0 ip6-localnetff00::0 ip6-mcastprefixff02::1 ip6-allnodesff02::2 ip6-allrouters172.17.0.6 www.ssjinyao.com www/ # cat /etc/resolv.conf# Generated by NetworkManagersearch localdomainnameserver 10.180.66.2 åªè¦é…ç½®äº†æ­£ç¡®çš„åŸŸåæœåŠ¡å™¨ï¼Œå¯ä»¥æ­£è§£çš„è§£æž 1234567/ # nslookup -type=A nas.ssjinyao.comServer: 10.180.66.2Address: 10.180.66.2:53Non-authoritative answer:Name: nas.ssjinyao.comAddress: 47.104.201.165 1234567891011121314151617# docker run --name t1 -it --network bridge -h www.ssjinyao.com --dns 114.114.114.114 --dns 8.8.8.8 --rm busybox:latest/ # cat /etc/resolv.confsearch localdomainnameserver 114.114.114.114nameserver 8.8.8.8/ # hostnamewww.ssjinyao.com# docker run --name t1 -it --network bridge -h t1.ssjinyao.com --dns 114.114.114.114 --dns-search ssjinyao.com --add-host www.ssjinyao.com:1.1.1.1 --rm busybox:latest/ # cat /etc/hosts127.0.0.1 localhost::1 localhost ip6-localhost ip6-loopbackfe00::0 ip6-localnetff00::0 ip6-mcastprefixff02::1 ip6-allnodesff02::2 ip6-allrouters1.1.1.1 www.ssjinyao.com172.17.0.6 t1.ssjinyao.com t1 å°†å®¹å™¨çš„ç«¯å£è¿›è¡Œæš´éœ² 1234# docker run --name myweb --rm -p 80 ssjinyao/httpd:v0.1.1.1-2# docker container psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES97212485437e ssjinyao/httpd:v0.1.1.1-3 &quot;/bin/httpd -f -h /dâ€¦&quot; 4 minutes ago Up 4 minutes 0.0.0.0:32773-&gt;80/tcp myweb Opening inbound communication 1234567-p é€‰é¡¹çš„ä½¿ç”¨æ ¼å¼ -p &lt;containerPort&gt; å°†æŒ‡å®šçš„å®¹å™¨ç«¯å£æ˜ å°„è‡³ä¸»æœºæ‰€æœ‰åœ°å€çš„ä¸€ä¸ªåŠ¨æ€ç«¯å£; -p &lt;hostPort&gt;:&lt;containerPort&gt; å°†å®¹å™¨ç«¯å£&lt;containerPort&gt;æ˜ å°„è‡³æŒ‡å®šçš„ä¸»æœºç«¯å£&lt;hostPort&gt; -p &lt;ip&gt;::&lt;containerPort&gt; å°†æŒ‡å®šçš„å®¹å™¨ç«¯å£&lt;containerPort&gt;æ˜ å°„è‡³ä¸»æœºæŒ‡å®š&lt;ip&gt;çš„ç«¯å£&lt;hostPort&gt; 123# docker run --name myweb --rm -p 10.180.66.11:8080:80 ssjinyao/httpd:v0.1.1.1-3# docker port myweb80/tcp -&gt; 10.180.66.11:8080 Joined container(è”ç›Ÿå¼å®¹å™¨) å…±äº«b1å®¹å™¨çš„ç½‘ç»œ 123456789101112131415161718192021222324252627# docker run --name b1 -it --rm busybox# docker run --name b2 --network container:b1 -it --rm busybox/ # ifconfigeth0 Link encap:Ethernet HWaddr 02:42:AC:11:00:02 inet addr:172.17.0.2 Bcast:172.17.255.255 Mask:255.255.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:8 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:648 (648.0 B) TX bytes:0 (0.0 B)lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)/ # echo &quot;Joined container&quot; &gt; /tmp/index.html/ # httpd -h /tmp// # netstat -tnlActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address Statetcp 0 0 :::80 :::* LISTEN/ # wget -O - -q 127.0.0.1Joined container å…±äº«å®¿ä¸»æœºç½‘ç»œ 1234567891011121314151617181920212223242526272829# docker run --name b2 --network host -it --rm busybox/ #/ # ifconfigdocker0 Link encap:Ethernet HWaddr 02:42:88:C6:40:EF inet addr:172.17.0.1 Bcast:172.17.255.255 Mask:255.255.0.0 inet6 addr: fe80::42:88ff:fec6:40ef/64 Scope:Link UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:347 errors:0 dropped:0 overruns:0 frame:0 TX packets:371 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:35796 (34.9 KiB) TX bytes:40247 (39.3 KiB)ens33 Link encap:Ethernet HWaddr 00:0C:29:F8:70:D5 inet addr:10.180.66.11 Bcast:10.180.66.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fef8:70d5/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:123421 errors:0 dropped:0 overruns:0 frame:0 TX packets:39524 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:81346864 (77.5 MiB) TX bytes:8253033 (7.8 MiB)lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:80 errors:0 dropped:0 overruns:0 frame:0 TX packets:80 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1 RX bytes:6944 (6.7 KiB) TX bytes:6944 (6.7 KiB) æ›´æ”¹docker0 æ¡¥çš„ipåœ°å€ 12345678910111213141516# vim /etc/docker/daemon.json&#123; &quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;], &quot;bip&quot;: &quot;10.0.0.1/16&quot;, &quot;hosts&quot;: [&quot;tcp://0.0.0.0:2375&quot;,&quot;unix:///var/run/docker.sock&quot;]&#125;# ifconfigdocker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt; mtu 1500 inet 10.0.0.1 netmask 255.255.0.0 broadcast 10.0.255.255 inet6 fe80::42:88ff:fec6:40ef prefixlen 64 scopeid 0x20&lt;link&gt; ether 02:42:88:c6:40:ef txqueuelen 0 (Ethernet) RX packets 347 bytes 35796 (34.9 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 371 bytes 40247 (39.3 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0# docker -H 10.180.66.11:2375 image ls åˆ›å»ºç½‘æ¡¥ 123456789101112131415161718192021222324# docker network create -d bridge --subnet &quot;172.26.0.0/16&quot; --gateway &quot;172.26.0.1&quot; mbr0# ifconfigbr-76b59a5dfce3: flags=4099&lt;UP,BROADCAST,MULTICAST&gt; mtu 1500 inet 172.26.0.1 netmask 255.255.0.0 broadcast 172.26.255.255 ether 02:42:ea:15:d6:9e txqueuelen 0 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0# ip link set dev br-76b59a5dfce3 name docker1RTNETLINK answers: Device or resource busy# ifconfig br-76b59a5dfce3 down# ifconfig docker1 up # ifconfig docker1 down # æ›´æ”¹åç§°åŽé»˜è®¤docker è°ƒç”¨æ—¶ä¼šæ‰¾ä¸åˆ°docker1è¿™ä¸ªè™šæ‹Ÿç½‘å¡# ip link set dev docker1 name br-76b59a5dfce3# docker run --name t1 -it --net mbr0 busybox:latest/ # ifconfigeth0 Link encap:Ethernet HWaddr 02:42:AC:1A:00:02 inet addr:172.26.0.2 Bcast:172.26.255.255 Mask:255.255.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:3 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:258 (258.0 B) TX bytes:0 (0.0 B) è‡ªå®šä¹‰docker0æ¡¥çš„ç½‘ç»œå±žæ€§ä¿¡æ¯: /etc/docker/daemon.jsonæ–‡ä»¶ 12345678&#123; &quot;bip&quot;: &quot;192.168.1.5/24&quot;, &quot;fixed-cidr&quot;: &quot;10.20.0.0/16&quot;, &quot;fixed-cidr-v6&quot;: &quot;2001:db8::/64&quot;, &quot;mtu&quot;: 1500, &quot;default-gateway&quot;: &quot;10.20.1.1&quot;, &quot;default-gateway-v6&quot;: &quot;2001:db8:abcd::89&quot;, &quot;dns&quot;: [&quot;10.20.1.2&quot;, &quot;10.20.1.3&quot;] dockerå®ˆæŠ¤è¿›ç¨‹çš„C/Sï¼Œå…¶é»˜è®¤ç›‘å¬Unix SOcketæ ¼å¼çš„åœ°å€ï¼Œ/var/run/docker.sock;å¦‚æžœä½¿ç”¨TCPå¥—æŽ¥å­—ï¼Œ /etc/docker/daemon.json:â€œhostsâ€: [â€œtcp://0.0.0.0:2375â€, â€œunix:///var/run/docker.sockâ€]]]></content>
      <tags>
        <tag>linux</tag>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux ç³»ç»Ÿå®šåˆ¶]]></title>
    <url>%2F2018%2F09%2F01%2Flinux%E7%B3%BB%E7%BB%9F%E5%AE%9A%E5%88%B6%2F</url>
    <content type="text"><![CDATA[linuxç³»ç»Ÿä¸Žåº”ç”¨å®šåˆ¶linux ç³»ç»Ÿå±‚é¢å·¥ä½œåŽŸç»“æž„ å¿…éœ€è¦ç†Ÿæ‚‰ç³»ç»Ÿå¯åŠ¨æµç¨‹ CentOS 6 ç³»ç»Ÿå¯åŠ¨æµç¨‹ CentOS 7 ç³»ç»Ÿå¯åŠ¨æµç¨‹ çŽ¯å¢ƒå‡†å¤‡ æœåŠ¡å™¨ ç³»ç»ŸçŽ¯å¢ƒ ä¸»æœºå å†…æ ¸ç‰ˆæœ¬ å¿…è£…çŽ¯å¢ƒ å®¿ä¸»æœº CentOS 6.9 Node11 Kernel 2.6.32-696.el6.x86_64 Development Tools åˆ¶ä½œæœº ssjinyao Linux Node21 Kernel linux-4.18.4 Busybox 1.29 å°†ä¸‹è½½çš„åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­ 12~ âž¤ scp ~/Downloads/linux-4.18.4.tar.xz root@node11:/usr/local/src/ ~ âž¤ scp ~/Downloads/busybox-1.29.2.tar.bz2 root@node11:/usr/local/src/ å®‰è£…å®¿ä¸»æœºæ‰€éœ€è¦ç¼–è¯‘çŽ¯å¢ƒ 1[root@ssjinyao-node11:~]# yum groupinstall &quot;Development tools&quot; &quot;Desktop Platform Development&quot; -y å†…æ ¸ç¼–è¯‘è§£åŽ‹æ–‡ä»¶123456[root@ssjinyao-node11:~]# cd /usr/local/src/[root@ssjinyao-node11:~]# ln -s linux-4.18.4 linux[root@ssjinyao-node11:~]# cd linux[root@ssjinyao-node11:~]# make help # æŸ¥çœ‹makeå¸®åŠ©# å¦‚æžœåœ¨centosä¸èƒ½è§£åŽ‹æ—¶ï¼Œéœ€è¦æ‰§è¡Œ# yum -y install xz å› ä¸ºåœ¨CentOS 6 çš„çŽ¯å¢ƒä¸­ tar è§£åŽ‹xzæ–‡ä»¶è°ƒç”¨çš„æ˜¯xzå‘½ä»¤ 1234[root@ssjinyao-node11:/usr/local/src/linux]# make allnoconfig# æŠŠåŽŸé»˜è®¤é…ç½®éƒ½æ¸…ç©ºï¼Œæ ¹æ®æˆ‘ä»¬çš„éœ€è¦é€‰åˆ™ç¼–è¯‘[root@ssjinyao-node11:/usr/local/src/linux]# make menuconfig# æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œé€‰åˆ™å†…æ ¸éœ€è¦æ”¯æŒæ¨¡å— é»˜è®¤é…ç½® å…¨å±€é…ç½® kernel-config-general-setup kernel-config-enable-loadble-module kernel-config-device-drivers kernel-config-file-systems è¯¦ç»†é…ç½®ä¸Žæ“ä½œè¿‡ç¨‹å¦‚ä¸‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061* å¯ç”¨ 64-bit kernel # è®©å†…æ ¸æ”¯æŒ 64ä½æž¶æž„* å¯ç”¨ Enable loadable module support # æ”¯æŒå†…æ ¸æ¨¡å—è£…è½½* ç‚¹è¿› Enable loadable module support --&gt; Module unloading # è®©å†…æ ¸æ”¯æŒåŠ¨æ€è£…å¸è½½* ç‚¹è¿› Enable loadable module support --&gt; Module signature verification # è®©å†…æ ¸æ ¡éªŒè£…è½½çš„æ¨¡å—æ˜¯å¦æ˜¯å·²ç»è®¤è¯çš„å…¬å¸ï¼Œé¿å…å†…æ ¸è¢«æ±¡æŸ“ï¼Œä»¥ç¡®ä¿å†…æ ¸å±‚é¢çš„å®‰å…¨* ç‚¹è¿› Processor type and features --&gt; processor family(Generic-x86-64) ---&gt; Generic-x86-64 # æ”¯æŒé€šç”¨cpuï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¯¹åº”é€‰åˆ™é€‚åˆè‡ªå·±çš„* ç‚¹è¿› Processor type and features --&gt; Symmetric multi-processing support # æ”¯æŒå¤šæ ¸cpu* ç‚¹è¿› Bus options (PCI etc.) --&gt; PCI support # é€‰ä¸­æ”¯æŒ* å¯ç”¨ Enable the block layer # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; SCSI device support # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; SCSI disk support # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; Fusion MPT device supportï¼ˆå¯ç”¨ï¼‰ ---&gt; Fusion MPT ScsiHost drivers for SPI # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; Fusion MPT device supportï¼ˆå¯ç”¨ï¼‰ ---&gt; Fusion MPT ScsiHost drivers for SAS # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; Fusion MPT device supportï¼ˆå¯ç”¨ï¼‰ ---&gt; Fusion MPT misc device (ioctl) driver # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; Fusion MPT device supportï¼ˆå¯ç”¨ï¼‰ ---&gt; Fusion MPT logging facility # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; Input device support ---&gt; Keyboards (NEW) (å¯ç”¨ ) ----&gt; &lt;*&gt; AT keyboard (NEW) # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› Device Drivers --&gt; Input device support ---&gt; Mouse interface # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; Input device support ---&gt; Provide legacy /dev/psaux device # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; Support for Host-side USB # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; Enable USB persist by default (NEW) # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; xHCI HCD (USB 3.0) support # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; Generic xHCI driver for a platform device # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; EHCI HCD (USB 2.0) support # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; Root Hub Transaction Translators # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; Improved Transaction Translator scheduling (NEW) # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; OHCI HCD (USB 1.1) support # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› Device Drivers --&gt; USB support ---&gt; OHCI support for PCI-bus USB controllers (NEW) # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› Device Drivers --&gt; Generic Driver Options ---&gt; Maintain a devtmpfs filesystem to mount at /dev # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Device Drivers --&gt; Generic Driver Options ---&gt; Automount devtmpfs at /dev, after the kernel mounted the rootfs # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› File systems --&gt; Second extended fs support # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› File systems --&gt; Ext2 extended attributes # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› File systems --&gt; Ext2 POSIX Access Control Lists # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; Ext2 Security Labels # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; The Extended 3 (ext3) filesystem # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› File systems --&gt; Ext3 POSIX Access Control Lists # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; Ext3 Security Labels # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› File systems --&gt; The Extended 4 (ext4) filesystem # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; Ext4 POSIX Access Control Lists # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; Ext4 Security Labels # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; Ext4 Encryption # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; XFS filesystem support # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; XFS Quota support # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; XFS POSIX ACL support # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; XFS Realtime subvolume support # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› File systems --&gt; XFS online metadata check support # é€‰ä¸­æ”¯æŒ * ç‚¹è¿› File systems --&gt; XFS online metadata repair support # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› File systems --&gt; XFS Debugging support # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› File systems --&gt; XFS fatal asserts (NEW) # é€‰ä¸­æ”¯æŒ # æ³¨ï¼šè¿™é‡Œé€‰æ‹©æ–‡ä»¶ç³»ç»Ÿæ—¶å¯ä»¥é€‰æ‹©è‡ªå·±å¸¸ç”¨çš„ä¸€ç§å°±å¥½ï¼Œæˆ‘è¿™é‡Œä¸ºæ–¹ä¾¿ä»¥åŽä½¿ç”¨ï¼Œéƒ½åŠ å…¥è¿›åŽ»äº†# ä¸€èˆ¬xfs æ–‡ä»¶ç³»ç»Ÿç±»åž‹æ˜¯ç›®å‰æ€§èƒ½æœ€å¥½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œext3 ext4 åˆ™æœ‰è¾ƒæˆç†Ÿçš„æ•°æ®æ¢å¤æŠ€æœ¯ï¼Œå¦‚ext3grep* ç‚¹è¿› Executable file formats / Emulations --&gt; Kernel support for ELF binaries # é€‰ä¸­æ”¯æŒ* ç‚¹è¿› Executable file formats / Emulations --&gt; Kernel support for scripts starting with #! # é€‰ä¸­æ”¯æŒï¼Œå³æ–‡ä»¶ç³»ç»Ÿshellæ”¯æŒæœºåˆ¶ * ç‚¹è¿› Executable file formats / Emulations --&gt; Kernel support for MISC binaries # é€‰ä¸­æ”¯æŒ* Networking support (å¯ç”¨) --&gt; Networking options ---&gt; TCP/IP networking # é€‰ä¸­æ”¯æŒï¼Œä¸ºä»¥åŽåšå®žéªŒæˆ–è€…ä½¿ç”¨æ–¹ä¾¿ã€‚å°†TCP/IP networking ä¸‹é¢çš„æ ¸å¿ƒé¡¹å³tcp/ip ä¸Ždevelé¡¹å®‰è£…* Device Drivers --&gt; Network device support ---&gt; Ethernet driver support (NEW) ----&gt; (å¯ç”¨) ----&gt; Intel devices (NEW)(å¯ç”¨) -----&gt; Intel(R) PRO/1000 Gigabit * * Device Drivers --&gt; Network device support ---&gt; Ethernet driver support (NEW) ----&gt; (å¯ç”¨) ----&gt; AMD devices(å¯ç”¨) -----&gt; AMDç›¸å…³çš„æˆ‘è¿™é‡Œå…¨éƒ¨å‹¾é€‰ Ethernet support # æ·»åŠ æ¨¡å— , å…¶å®ƒçš„æ‰€æœ‰ Ethernet driver support å¯ä»¥å–æ¶ˆï¼Œä¾æ®è‡ªå·±çš„éœ€æ±‚é€‰åˆ™* ç‚¹è¿› General setup --&gt; (huatu-ssjinyao-kernel) Local version - append to kernel release # ç‚¹åŠ Kernel release * ç‚¹è¿› General setup --&gt; (huatu-ssjinyao) Default hostname ç¼–è¯‘å†…æ ¸æ˜¯ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œè¿™é‡Œçš„å¤§å®¶å¦‚æžœä¸€ç›´ç¼–è¯‘ä¸æˆåŠŸï¼Œæˆ–è€…ç¼–è¯‘å®Œå†…æ ¸åŽä¸æœ‰æˆåŠŸå¯åŠ¨ç³»ç»Ÿå¯ä»¥ä½¿ç”¨æˆ‘è¿™é‡Œç»™å¤§å®¶å»ºç«‹çš„æ¨¡æ¿ å»ºç«‹å¯ä»¥ä½¿ç”¨çš„å†…æ ¸é…ç½®æ¨¡æ¿ 1# cp kernel-config-ok-net-all-ok /usr/local/src/linux/.config # å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿æ¥è¿›è¡Œç¼–è¯‘ç”Ÿæˆå†…æ ¸æ–‡ä»¶ 123456789101112131415161718192021222324252627[root@ssjinyao-node11:/usr/local/src/linux-4.18.4]# cat init/main.c | grep -C 8 ' !try_to_run_init_process("/etc/init")' if (execute_command) &#123; ret = run_init_process(execute_command); if (!ret) return 0; panic("Requested init %s failed (error %d).", execute_command, ret); &#125; if (!try_to_run_init_process("/sbin/init") || !try_to_run_init_process("/etc/init") || !try_to_run_init_process("/bin/init") || !try_to_run_init_process("/bin/sh")) return 0; panic("No working init found. Try passing init= option to kernel. " "See Linux Documentation/admin-guide/init.rst for guidance.");&#125;[root@ssjinyao-node11:/usr/local/src/linux-4.18.4]# pwd/usr/local/src/linux-4.18.4# æ³¨: é€šè¿‡æŸ¥çœ‹è¿™æ®µå†…æ ¸æºç ï¼Œåˆ™å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå¯åŠ¨æ—¶æŸ¥åˆ°initçš„æµç¨‹ å…ˆæ‰¾ /sbin/init --&gt; è‹¥ä¸å­˜åœ¨ å†æ‰¾ /etc/init --&gt; è‹¥ä¸å­˜åœ¨ å†æ‰¾ /bin/init --&gt; è‹¥ä¸å­˜åœ¨ å†æ‰¾ /bin/sh --&gt; è‹¥ä¸å­˜åœ¨ å¯åŠ¨æŠ¥å†…æ ¸ææ…Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨grub çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š init= æ¥æŒ‡å®šinitçš„ä½ç½® 123[root@ssjinyao-node11:/usr/local/src/linux]# make -j 4 bzImage[root@ssjinyao-node11:/usr/local/src/linux]# du -sh arch/x86/boot/bzImage3.0M arch/x86/boot/bzImage ç¼–è¯‘å•ä¸ªç½‘å¡æ¨¡å—12345[root@ssjinyao-node11:/usr/local/src/linux]# ls drivers/net/ethernet/intel/e1000/e1000_ethtool.c e1000.h e1000_hw.c e1000_hw.h e1000_main.c e1000_osdep.h e1000_param.c Makefileroot@ssjinyao-node11:/usr/local/src/linux]# ls drivers/net/ethernet/intel/e1000/e1000.kodrivers/net/ethernet/intel/e1000/e1000.ko# insmod /lib64/modules/e1000.ko å®‰è£… ç¼–è¯‘å®‰è£…busyboxå› é™æ€ç¼–è¯‘ä¾èµ–äºŽè½¯ä»¶åŒ… glibc-static, å› æ­¤åœ¨ç¼–è¯‘busyboxæ—¶éœ€è¦å®‰è£… glibc-static 1234[root@ssjinyao-node11:/usr/local/src]# tar -xvf busybox-1.29.2.tar.bz2[root@ssjinyao-node11:/usr/local/src]# cd busybox-1.29.2[root@ssjinyao-node11:/usr/local/src]# yum -y install glibc-static[root@ssjinyao-node11:/usr/local/src/busybox-1.29.2]# make menuconfig 123Settings --&gt; --- Build Options æ ‡é¢˜æ ä¸­ Build static binary (no shared libs) # é€‰ä¸­æ”¯æŒSettings --&gt; --- Installation Options (&quot;make install&quot; behavior) What kind of applet links to install (as soft-links) ---&gt; è¿™ä¸ªé»˜è®¤çš„ as soft-links å°±å¯ä»¥äº† Settings --&gt; --- Installation Options (&quot;make install&quot; behavior) (./_install) Destination path for &apos;make install&apos; ---&gt; è¿™ä¸ªä¹Ÿé€‰ç”¨é»˜è®¤çš„ç¼–è¯‘å®‰è£…å®Œåˆ°é»˜è®¤å½“å‰è·¯å¾„ 1make install # æ³¨ç¼–è¯‘å‡ºé”™çš„æ—¶å€™è¦åŽ»äº† Coreutils --&gt; sync åŽé¢éœ€è¦å†åŒæ­¥è¿‡åŽ» åˆ©ç”¨busybox åˆ¶ä½œinitrd123456789101112131415161718192021[root@ssjinyao-node11:/usr/local/src/busybox-1.29.2]# mkdir /tmp/busybox[root@ssjinyao-node11:/usr/local/src/busybox-1.29.2]# cp -a ./_install/*bin/ linuxrc sbin/ usr/[root@ssjinyao-node11:/usr/local/src/busybox-1.29.2]# cp -a ./_install/* /tmp/busybox/[root@ssjinyao-node11:/usr/local/src/busybox-1.29.2]# cd /tmp/busybox/[root@ssjinyao-node11:/tmp/busybox]#[root@ssjinyao-node11:/tmp/busybox]# mkdir -pv proc sys etc/init.d tmp dev mnt/sysroot [root@ssjinyao-node11:/tmp/busybox]# vim init#!/bin/ashecho -e &quot;\t\033[32m Now start init and switch root ! \033[0m &quot;mount -t proc proc /procmount -t sysfs sysfs /sysmdev -smount -t xfs /dev/sda2 /mnt/sysrootexec switch_root /mnt/sysroot /sbin/init[root@ssjinyao-node11:/tmp/busybox]# chmod +x init[root@ssjinyao-node11:/tmp/busybox]# mknod dev/console c 5 1[root@ssjinyao-node11:/tmp/busybox]# mknod dev/null c 1 3[root@ssjinyao-node11:/tmp/busybox]# find . | cpio --quiet -H newc -o | gzip -9 -n &gt; ./huatu-ssjinyao-initrd.gz[root@ssjinyao-node11:/tmp/busybox]# du -sh huatu-ssjinyao-initrd.gz1.3M huatu-ssjinyao-initrd.gz å®‰è£…grub,æ•´åˆå†…æ ¸ä¸Žinitrdæ­¤æ—¶å°†å®¿ä¸»æœºå…³æŽ‰ï¼ŒæŒ‚è½½ä¸€å—scsiç£ç›˜ï¼Œç”¨äºŽå°†grub,å†…æ ¸,initrdå†™åµŒå…¥æˆ‘è¿™é‡Œç”¨çš„æ˜¯vmware fusion è™šæ‹Ÿå·¥å…·ï¼Œwindowså¤§å®¶ä¹ æƒ¯ç”¨vmware workstationåªè¦ç»™è™šæ‹Ÿæœºæ·»åŠ ä¸€å—ç£ç›˜å³å¯,å¦‚ä¸‹å›¾ æ³¨æ„: çŽ°åœ¨æŒ‚è½½ç£ç›˜ä¸€å®šæ˜¯è¦å’Œå®¿ä¸»æœºå…±äº«ç£ç›˜ï¼Œä¸ç„¶çš„è¯ä¿¡æ¯ä¸ä¼šå®žæ—¶åŒæ­¥ ;ä¹Ÿæ˜¯è¯´ï¼Œæ·»åŠ çš„è¿™å—ç£ç›˜æ˜¯ä¸ºå®¿ä¸»æœºå’Œåˆ¶ä½œæœºä¹‹é—´åŒæ­¥æ•°æ®ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å…±ç”¨ä¸€å—è™šæ‹Ÿç£ç›˜;æ·»åŠ å®ŒåŽå°†å®¿ä¸»æœåŠ¡å™¨å¯åŠ¨ 12345678[root@ssjinyao-node11:~]# lsblkNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTsda 8:0 0 20G 0 diskâ”œâ”€sda1 8:1 0 500M 0 part /bootâ””â”€sda2 8:2 0 19.5G 0 part â”œâ”€vg_ssjinyaonode11-lv_root (dm-0) 253:0 0 17.6G 0 lvm / â””â”€vg_ssjinyaonode11-lv_swap (dm-1) 253:1 0 2G 0 lvm [SWAP]sdb 8:16 0 38G 0 disk ç”±ä¸Šå¯ä»¥çœ‹å‡ºï¼Œå·²ç»æ·»åŠ äº†ä¸€å—ç£ç›˜ sdb,å°†ç£ç›˜åˆ†åŒºå¹¶æŒ‚è½½è‡³/mntç›®å½•ä¸‹boot,ä¸Žsysroot 1234567891011121314151617181920212223242526272829303132333435363738[root@ssjinyao-node11:~]# mkdir /mnt/&#123;boot,sysroot&#125;[root@ssjinyao-node11:~]# fdisk /dev/sdbDevice contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabelBuilding a new DOS disklabel with disk identifier 0x42ed0c1e.Changes will remain in memory only, until you decide to write them.After that, of course, the previous content won&apos;t be recoverable.Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to switch off the mode (command &apos;c&apos;) and change display units to sectors (command &apos;u&apos;).Command (m for help): nCommand action e extended p primary partition (1-4)pPartition number (1-4): 1First cylinder (1-4960, default 1): 1Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-4960, default 4960): +300MCommand (m for help): nCommand action e extended p primary partition (1-4)pPartition number (1-4): 2First cylinder (40-4960, default 40): 40Last cylinder, +cylinders or +size&#123;K,M,G&#125; (40-4960, default 4960): 4960Command (m for help): wThe partition table has been altered!Calling ioctl() to re-read partition table.Syncing disks.[root@ssjinyao-node11:~]# mkfs.xfs /dev/sdb1[root@ssjinyao-node11:~]# mkfs.xfs /dev/sdb2 123456# mkdir /mnt/&#123;boot,sysroot&#125;# mount /dev/sdb1 /mnt/boot# mount /dev/sdb2 /mnt/sysroot[root@ssjinyao-node11:~]# mount /dev/sdb1 /mnt/boot/[root@ssjinyao-node11:~]# mount /dev/sdb2 /mnt/sysroot/[root@ssjinyao-node11:~]# cd /tmp/busybox/ å°†ç¼–è¯‘å¥½çš„å†…æ ¸ä¸Žåˆ¶ä½œå¥½çš„initrdå…¥åˆ°bootå¯åŠ¨ç›®å½• 12[root@ssjinyao-node11:/tmp/busybox]# cp huatu-ssjinyao-initrd.gz /mnt/boot/[root@ssjinyao-node11:~]# cp /usr/local/src/linux/arch/x86/boot/bzImage /mnt/boot/huatu-ssjinyao-kernel å®‰è£… grub è‡³æ–°æ·»åŠ çš„ç¡¬ç›˜ 1[root@ssjinyao-node11:/tmp/busybox]# grub-install --root-directory=/mnt/ /dev/sdb æä¾› grub é…ç½®æ–‡ä»¶ 12345678[root@ssjinyao-node11:/mnt/sysroot]# vim /mnt/boot/grub/grub.confdefault 0timeout 3color light-green/black light-magenta/blacktitle huatu-ssinyao-kernel 4.18.5 root (hd0,0) kernel /huatu-ssjinyao-kernel ro root=/dev/sda2 vga=877 quiet initrd /huatu-ssjinyao-initrd.gz vga=877 è¿™é‡Œæ˜¯æ ¹æ®æˆ‘çš„å±ç›®åˆ†è¾¨çŽ‡è€Œè°ƒæ•´çš„é€‚åº”çš„;è¿™é‡Œå¯ä»¥åœ¨å¯åŠ¨ vga=ask grubå¼€æœºæ—¶ä¼šç»™ä½ ä¸€ä¸ªåˆ—è¡¨ï¼Œè®©ä½ é€‰æ‹©è‡ªå·±çš„åˆ†è¾¨çŽ‡;æœ€åŽå¯ä»¥é€‰æ‹©è‡ªå·±å±å¹•çš„åˆ†è¾¨çŽ‡å¤§å°; å¦‚ï¼Œè¿™é‡Œçš„æˆ‘çš„åˆ†è¾¨çŽ‡æ˜¯ 1400x900ï¼Œè¿™é‡Œé€‰çš„æ˜¯36Dï¼Œå†å°†16è¿›åˆ¶36Dè½¬æ¢ä¸ºåè¿›åˆ¶æ•°ï¼Œå³æ˜¯æˆ‘åœ¨grub.confä¸­é…ç½®çš„vga=877 å…¶å®ƒé¡¹é…ç½®é¡¹ 1234567default é…ç½®è¿™ä¸ªé¡¹ç›®ä¸º0é»˜è®¤å¯åŠ¨é¡¹;timeout é…ç½®è¶…è¿‡3ç§’ä¸é€‰åˆ™ï¼Œåˆ™è‡ªåŠ¨é€‰åˆ™ç¬¬ä¸€ä¸ªtitleå¯åŠ¨;color é…ç½®grubèœå•æ é¢œè‰²;title é…ç½®å¯åŠ¨é¡¹æ ‡é¢˜;root (hd0,0) é…ç½®rootå…ˆè¯†åˆ«ç¬¬ä¸€å—ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒº;kernel é…ç½®æŒ‡å®šå¯åŠ¨å†…æ ¸ï¼Œè¿™é‡Œå³æ˜¯æˆ‘ä»¬ç¼–è¯‘å¥½çš„å†…æ ¸ï¼Œroot æŒ‡å®šå¯åŠ¨åŽçš„æ ¹åˆ†åŒº;initrd é…ç½®å¯åŠ¨è™šæ ¹ï¼Œä¸Žç¬¬ä¸€ä¸ªè¿›ç¨‹; å»ºç«‹çœŸå®žæ–‡ä»¶ç³»ç»Ÿ123[root@ssjinyao-node11:/mnt/sysroot]# cp /usr/local/src/busybox-1.29.2/_install/* . -a[root@ssjinyao-node11:/mnt/sysroot]# rm -f linuxrc[root@ssjinyao-node11:/mnt/sysroot]# mkdir -pv etc dev proc sys bin sbin usr/&#123;bin,sbin,lib,lib64,local&#125; lib64 lib/modules home var/&#123;log,run,lock&#125; tmp mnt media root boot 12345678910111213141516[root@ssjinyao-node11:/mnt/sysroot]# vim etc/inittab# console:respawn:-/bin/ash# tty1::askfirst:/bin/ash# tty2::askfirst:/bin/ash# tty3::askfirst:/bin/ash::sysinit:/etc/rc.d/rc.sysinit::respawn:/sbin/getty 9600 tty1::respawn:/sbin/getty 9600 tty2::respawn:/sbin/getty 9600 tty3::respawn:/sbin/getty 9600 tty4::respawn:/sbin/getty 9600 tty5::respawn:/sbin/getty 9600 tty6::respawn:/sbin/getty 9600 tty7::ctrlaltdel:/sbin/reboot::shutdown:/bin/umount -a -r &amp;&gt; /dev/null[root@ssjinyao-node11:/mnt/sysroot]# chmod +x etc/inittab 123456789101112131415161718192021222324252627282930313233343536373839404142#[root@ssjinyao-node11:/mnt/sysroot]# mkdir etc/rc.d/#[root@ssjinyao-node11:/mnt/sysroot]# vim etc/rc.d/rc.sysinit#!/bin/shecho -e "\t welcome to \033[31m HuaTu SSJinYao \033[0m Linux"mount -t proc proc /procmount -t sysfs sysfs /sysecho "scan /sys and to populate to /dev..."mdev -smount -o remount,rw /dev/sda2 /echo "mounting all filesystems..."mount -aifconfig eth0 10.180.66.31 netmask 255.255.255.0ifconfig lo 127.0.0.1route add default gw 10.180.66.2echo -e "\033[31m Start Network Manager.........................\033[0m \033[32m [OK] \033[0m"/usr/local/sbin/dropbear -E -F &amp;&gt; /var/log/dropbear/sshd.log &amp;echo -e "\033[31m Start dropbear sshd ..........................\033[0m \033[32m [OK] \033[0m"/usr/local/nginx/sbin/nginxecho -e "\033[31m Start Nginx Service ..........................\033[0m \033[32m [OK] \033[0m"/usr/local/keepalived/sbin/keepalived -D -S 0 -f /usr/local/keepalived/etc/keepalived/keepalived.confecho -e "\033[31m Start Keepalived Service .....................\033[0m \033[32m [OK] \033[0m"rsync.sh &amp;&gt; /dev/null &amp;echo -e "\033[31m Start Rsync Service ..........................\033[0m \033[32m [OK] \033[0m"echo -e "\033[31m \ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \ ** ** // // ** ** ****** ****** ** ** ******* //** ** ****** ****** **//// **//// /**/**//**///** //*** //////** **////** //***** //***** /**/** /** /** /** ******* /** /** /////** /////** **/**/** /** /** ** **////** /** /** ****** ****** //*** /** *** /** ** //********//****** ////// ////// /// // /// // // //////// ////// \\ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \\\033[0m"# chmod +x etc/rc.d/rc.sysinit å»ºç³»ç»Ÿç³»ç»ŸæŒ‚è½½ç›®å½• fstab 12345678[root@ssjinyao-node11:/mnt/sysroot]# mkdir /dev/pts# æ³¨: åœ¨æ­¤ä¹‹å‰ä¸€å®šè¦æœ‰ dev/pts ç›®å½• [root@ssjinyao-node11:/mnt/sysroot]# vim etc/fstab sysfs /sys sysfs defaults 0 0 proc /proc proc defaults 0 0 devpts /dev/pts devpts mode=620 0 0 /dev/sda1 /boot xfs defaults 0 0 /dev/sda2 / xfs defaults 0 0 æ·»åŠ ç™»å½•åŽè„šæœ¬/etc/profile 12export PS1='[\[\033[01;36m\]\u\[\033[00m\]@\[\033[01;34m\]\h\[\033[00m\]:\[\033[01;32m\]\w\[\033[00m\]]\[\033[01;34m\]\$\[\033[00m\] 'export PATH=/usr/local/bin:/usr/local/sbin/:/sbin:/bin:/usr/bin:/usr/sbin 123456[root@ssjinyao-node11:/mnt/sysroot]# vim etc/shells /bin/sh/bin/ash/bin/hush/bin/bash/sbin/nologin 12345[root@ssjinyao-node11:/mnt/sysroot]# etc/nsswitch.confpasswd: filesgrup: filesshadow: fileshosts: files dns ç¼–è¯‘å®‰è£…dropbearæ³¨ dropbear å¯ä»¥åœ¨dropbearå®˜ç½‘ä¸‹è½½ 12345678[root@ssjinyao-node11:/usr/local/src]# tar -xvf dropbear-2018.76.tar.bz2[root@ssjinyao-node11:/usr/local/src]# cd dropbear-2018.76[root@ssjinyao-node11:/usr/local/src/dropbear-2018.76]# make PROGRAMS=&quot;dropbear dbclient dropbearkey dropbearconvert scp&quot; install[root@ssjinyao-node11:/mnt/sysroot]# cd /mnt/sysroot/etc/dropbear/[root@ssjinyao-node11:/mnt/sysroot/etc/dropbear/]# openssl passwd -1 -salt $(openssl rand -hex 4)[root@ssjinyao-node11:/mnt/sysroot/etc/dropbear/]# dropbearkey -t rsa -s 2048 -f dropbear_rsa_host_key[root@ssjinyao-node11:/mnt/sysroot/etc/dropbear/]# dropbearkey -t dss -f dropbear_dss_host_key[root@ssjinyao-node11:/mnt/sysroot/etc/dropbear/]# dropbear -E -F å¯åŠ¨ ç§»æ¤ç³»ç»Ÿè®¤è¯ã€ç™»å½•ã€è§£æžç›¸å…³çš„ä¾èµ–åº“123456[root@ssjinyao-node11:/mnt/sysroot] mkdir usr/lib64/[root@ssjinyao-node11:/mnt/sysroot] cp -d /lib64/libnss_files* lib64/[root@ssjinyao-node11:/mnt/sysroot] cp -d /usr/lib64/libnss3.so usr/lib64/[root@ssjinyao-node11:/mnt/sysroot] cp -d /usr/lib64/libnss_files.so* usr/lib64/[root@ssjinyao-node11:/mnt/sysroot] cp -d /lib64/libresolv* lib64/[root@ssjinyao-node11:/mnt/sysroot] cp -d /lib64/libnss_dns* lib64/ ç¼–è¯‘å®‰è£…nginx12345[root@ssjinyao-node11:/usr/local/src]# cd /usr/local/src/[root@ssjinyao-node11:/usr/local/src]# tar -xvf nginx-1.14.0.tar.gz./configure --prefix=/usr/local/nginx --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --with-http_gzip_static_module --with-http_stub_status_module --with-http_ssl_module --user=root --group=root[root@ssjinyao-node11:/usr/local/src]# cp -a /usr/local/nginx/sbin/nginx /usr/sbin/[root@ssjinyao-node11:/usr/local/src]# cp -a /usr/local/nginx/ /mnt/sysroot/usr/local/ ç¼–è¯‘å®‰è£…inotifyå¹¶ç§»æ¤12345[root@ssjinyao-node11:/usr/local]# cd /usr/local/src/[root@ssjinyao-node11:/usr/local/src]# tar -xvf inotify-tools-3.14.tar.gz[root@ssjinyao-node11:/usr/local/src]# cd inotify-tools-3.14[root@ssjinyao-node11:/usr/local/src/inotify-tools-3.14]# ./configure --prefix=/usr/local/inotify/[root@ssjinyao-node11:/usr/local/src/inotify-tools-3.14]# cp -a /usr/local/inotify/ /mnt/sysroot/usr/local ç¼–è¯‘å®‰è£…keepalivedæ³¨: keepalived ä¾èµ–net-tools psmisc ä¸¤ä¸ªå·¥å…·åŒ…ï¼Œå› æ­¤éœ€è¦å°†è¿™ä¸¤ä¸ªå·¥å…·åŒ…çš„å‘½ä»¤ç§»æ¤ 12345678910111213141516171819[root@laoba-10-17:/usr/local/src/linux-4.18.5]# rpm -ql net-tools | grep bin &amp;&amp; rpm -ql psmisc | grep bin/bin/netstat/sbin/arp/sbin/ether-wake/sbin/ifconfig/sbin/ipmaddr/sbin/iptunnel/sbin/mii-diag/sbin/mii-tool/sbin/nameif/sbin/plipconfig/sbin/route/sbin/slattach/usr/bin/killall/usr/bin/peekfd/usr/bin/prtstat/usr/bin/pstree/usr/bin/pstree.x11/usr/sbin/fuser 12345[root@ssjinyao-node11:/usr/local/src]# tar -xvf keepalived-2.0.6.tar.gz[root@ssjinyao-node11:/usr/local/src]# cd keepalived-2.0.6[root@ssjinyao-node11:/usr/local/src]# cp /usr/local/keepalived/sbin/keepalived /usr/sbin/[root@ssjinyao-node11:/usr/local/src/keepalived-2.0.6]# ./configure --prefix=/usr/local/keepalived/[root@ssjinyao-node11:/usr/local/src]# cp -a /usr/local/keepalived/ /mnt/sysroot/usr/local ç¼–å†™bincp è„šæœ¬ldd å‘½ä»¤å¯ä»¥æŸ¥çœ‹å‘½ä»¤æ‰€ä¾èµ–çš„åº“çš„ä½ç½® 1[root@ssjinyao-node11:/mnt/sysroot]# ldd /bin/cp ç¼–å†™è„šæœ¬ï¼Œå°†éœ€è¦çš„å‘½ä»¤åŒæ­¥åˆ°/mnt/sysroot ç›®å½• 1234567891011121314151617181920212223242526272829303132333435363738[root@ssjinyao-node11:/mnt/sysroot]# mkdir /root/bin[root@ssjinyao-node11:/mnt/sysroot]# vim /root/bin/bincp.sh[root@ssjinyao-node11:/mnt/sysroot]# chmod +x /root/bin/bincp.sh#!/bin/bash#The scripts can copy bin file and that bin libs#author renjin#date 2016 11 19#version 3.0echo "acquiesce copy bin file in /mnt/sysroot!! "MNT="/mnt/sysroot"BIN_FILE() &#123; bindir=`dirname $file` [ -e $MNT ] || mkdir -p $MNT [ -e $MNT$bindir ] || mkdir -p $MNT$bindir if [ -e $MNT$file ] ; then echo "you will copy bin file exsit !" else cp $file $MNT$bindir fi &#125;LIB_FILE() &#123; lib=`ldd $file | grep -Eo "/.*lib(64)&#123;0,1&#125;/[^[:space:]]&#123;1,&#125;"` for lib64 in $lib; do libdir=`dirname $lib64` if [ ! -e $MNT$libdir ]; then mkdir -p $MNT$libdir elif [ -e $MNT$lib64 ] ; then echo "you will copy lib file exsit " &amp;&amp; continue else cp $lib $MNT$libdir fi done &#125;read -p "please input your will copy bin file name,or input quit quitng: " BINuntil [ $BIN == 'quit' -o $BIN == 'q' ]; do! which $BIN 2&gt; /dev/null &amp;&amp; read -p "you input command no exsit,please again input or input quit ,quiting " BIN &amp;&amp; continuefile=`which --skip-alias $BIN 2&gt; /dev/null | grep "/.*[^[:space:]]" ` BIN_FILE $BIN &amp;&amp; LIB_FILE $BINread -p "continue!,or input quit ,quting: " BINdone 1234# chmod +x /root/bincp.sh &amp;&amp; cp /root/bincp.sh /bin[root@ssjinyao-node11:/usr/local/src]# bincp.shacquiesce copy bin file in /mnt/sysroot!!please input your will copy bin file name,or input quit quitng: éœ€è¦ç§»æ¤çš„å‘½ä»¤æœ‰ 1bash dropbear ssh scp rysnc dbclient dropbearconvert dropbearkey genhash nginx ç­‰ç­‰ åˆ©ä¸Šè¿™ä¸ªè„šæœ¬å°†è‡ªå·±éœ€è¦çš„å‘½ä»¤æ‹·è´åˆ°/mnt/sysrootä¸­ æ·»åŠ rootç”¨æˆ· 1234# adduser root # passwd rootè¿™é‡Œè¦æ³¨æ„æŠŠ root id åœ¨ /etc/passwd ä¸­æ”¹0åœ¨Linuxå†…æ ¸ä¸­ï¼Œç³»ç»Ÿæƒé™åªå¯¹åº”id å¾®ç³»ç»Ÿ keepaived+nginx+rsync+inotifyçš„å®žçŽ°keepalived+nginx+rsync+intofity åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰å®žçŽ°å¤§å®¶å¯ä»¥å†å…‹éš†ä¸€ä¸ªå°ç³»ç»Ÿï¼Œæ¥å®žçŽ°keepalivedçš„åŒä¸» ç³»ç»Ÿå¯åŠ¨åŽå¦‚ä¸‹å›¾]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonæ—¥å¸¸ç»ƒä¹ ]]></title>
    <url>%2F2018%2F08%2F23%2Fpython%20%E6%97%A5%E5%B8%B8%E7%BB%83%E4%B9%A008-23%2F</url>
    <content type="text"><![CDATA[python æ—¥å¸¸ç»ƒä¹  å’Œå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨ï¼Œå¹¶ä¸”ä¿æŒåˆå¹¶åŽçš„ä¸¤ä¸ªåˆ—è¡¨æœ‰åº123456789101112131415161718In [11]: l1 = [1,2,3,4]In [12]: l2 = [2,3,7,9]In [13]: l3 = []In [14]: for x in l1: ...: while len(l2) &gt; 0 : ...: if x &gt; l2[0]: ...: l3.append(l2.pop(0)) ...: else: ...: l3.append(x) ...: break ...: if len(l2) &lt;= 0: ...: l3.append(x) ...: l3.append(l2) ...: ...:In [15]:In [15]: l3Out[15]: [1, 2, 2, 3, 3, 4, [7, 9]] æŒ‰å•è¯åè½¬å­—ç¬¦ä¸²ï¼Œ å¦‚â€™I love Linuxâ€™ åè½¬ä¸º â€˜Linux love Iâ€™1234567In [30]: ' '.join(s.split()[::-1])Out[30]: 'Linux love I'In [31]: s = "I love Linux"In [32]: ' '.join(s.split()[::-1])Out[32]: 'Linux love I'In [33]: s.split()[::-1]Out[33]: ['Linux', 'love', 'I'] æ‰¾å‡ºä¸€ä¸ªåˆ—è¡¨ä¸­åªå‡ºçŽ°äº†ä¸€æ¬¡çš„æ•°å­—ï¼Œå¹¶ä¸”ä¿æŒåŽŸæ¥çš„æ¬¡åºï¼Œä¾‹å¦‚[1,2,1,3,2,5]ï¼Œç»“æžœä¸º[3,5]123456Numberï¼ˆæ•°å­—ï¼‰Stringï¼ˆå­—ç¬¦ä¸²ï¼‰Listï¼ˆåˆ—è¡¨ï¼‰Tupleï¼ˆå…ƒç»„ï¼‰Setï¼ˆé›†åˆï¼‰Dictionaryï¼ˆå­—å…¸ï¼‰ æœ‰bugçš„ä»£ç  1234567891011121314# ä¾‹å¦‚ï¼Œå½“1 å‡ºçŽ°ä¸‰æ¬¡æ—¶ï¼Œä¼šæŠŠ1ä¹Ÿè®°å½•ä¸‹æ¥In [59]: lst_setOut[59]: [1, 2, 3, 5]In [60]: lst = [1,1,2,1,3,2,5]In [61]: ret = []In [62]: for x in lst: ...: if x in ret: ...: ret.remove(x) ...: else: ...: ret.append(x) ...:In [63]: retOut[63]: [1, 3, 5] 123456789# åŽ»é™¤bugåŽIn [51]: lst = [1,1,2,1,3,2,5]In [52]: ret = []In [53]: for x in lst: ...: if lst.count(x) == 1: ...: ret.append(x) ...:In [54]: retOut[54]: [3, 5] 1234567891011121314# å½“é‡å¤çš„æ•°è¿‡å¤§çš„æ—¶ï¼Œä¸ä¾¿é‡å¤çš„å…ƒç´ æ¯ä¸ªéƒ½éåŽ†ï¼Œå¦‚10wä¸ª1é‡å¤In [77]: lst = [1,1,1,1,1,1,2,1,3,2,5]In [78]: lst_set = list(set(lst))In [79]: lst_setOut[79]: [1, 2, 3, 5]In [80]: ret = []In [81]: retOut[81]: []In [84]: for x in lst_set: ...: if lst.count(x) == 1: ...: ret.append(x) ...:In [85]: retOut[85]: [3, 5] å–å‡ºä¸€ä¸ªåˆ—è¡¨ä¸­çš„æœ€å¤§å€¼123In [86]: lst = [1,3,5,8,10,101,301]In [87]: max(lst)Out[87]: 301 12345678In [93]: lst = [1,3,5,8,10,101,301]In [94]: m = lst[0]In [96]: for x in lst: ...: if x &gt; m: ...: m = x ...:In [97]: mOut[97]: 301 å†™ä¸€ä¸ªç¨‹åºï¼ŒæŠŠå­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­—ï¼Œä¸å…è®¸ä½¿ç”¨å‡½æ•°å’Œæ¨¡å—123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354In [138]: s = '123.456'In [139]: integer, decimals=s.split('.')In [140]: list(enumerate(integer))Out[140]: [(0, '1'), (1, '2'), (2, '3')]In [141]: integer_length = len(integer)In [142]: result = 0 ...: for i, x in enumerate(integer): ...: if x == '0': ...: result += 0 * 10 ** (integer_length -i -1) ...: if x == '1': ...: result += 1 * 10 ** (integer_length -i -1) ...: if x == '2': ...: result += 2 * 10 ** (integer_length -i -1) ...: if x == '3': ...: result += 3 * 10 ** (integer_length -i -1) ...: if x == '4': ...: result += 4 * 10 ** (integer_length -i -1) ...: if x == '5': ...: result += 5 * 10 ** (integer_length -i -1) ...: if x == '6': ...: result += 6 * 10 ** (integer_length -i -1) ...: if x == '7': ...: result += 7 * 10 ** (integer_length -i -1) ...: if x == '8': ...: result += 8 * 10 ** (integer_length -i -1) ...: if x == '9': ...: result += 9 * 10 ** (integer_length -i -1) ...:In [143]: for i, x in enumerate(decimals): ...: if x == '0': ...: result += 0 * 10 ** (-1 * (i+1)) ...: if x == '1': ...: result += 1 * 10 ** (-1 * (i+1)) ...: if x == '2': ...: result += 2 * 10 ** (-1 * (i+1)) ...: if x == '3': ...: result += 3 * 10 ** (-1 * (i+1)) ...: if x == '4': ...: result += 4 * 10 ** (-1 * (i+1)) ...: if x == '5': ...: result += 5 * 10 ** (-1 * (i+1)) ...: if x == '6': ...: result += 6 * 10 ** (-1 * (i+1)) ...: if x == '7': ...: result += 7 * 10 ** (-1 * (i+1)) ...: if x == '8': ...: result += 8 * 10 ** (-1 * (i+1)) ...: if x == '9': ...: result += 9 * 10 ** (-1 * (i+1)) ...:In [144]: resultOut[144]: 123.456In [145]: type(result)Out[145]: float]]></content>
      <tags>
        <tag>linux</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonè¾“å‡ºæ ¼å¼]]></title>
    <url>%2F2018%2F08%2F20%2Fpython%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[åˆ—è¡¨çš„å°è£…ä¸Žè§£åŽ‹12345678910In [10]: lst = [1,[2,3,6,7,8,10],4]In [11]: a, (b, *_, c),d = lstIn [12]: aOut[12]: 1In [13]: bOut[13]: 2In [14]: cOut[14]: 10In [15]: dOut[15]: 4 è¾“å‡ºæ ¼å¼ç»ƒä¹ 123456In [18]: 'i am %s' %('renjin')Out[18]: 'i am renjin'In [24]: 'i am %(name)s' %&#123;'name':'renjin'&#125;Out[24]: 'i am renjin'In [29]: 'i am %s my name is %s' %('ssjinyao','renjin')Out[29]: 'i am ssjinyao my name is renjin' format è¾“å‡ºæ ¼å¼123456789101112In [3]: 'I am &#123;&#125;'.format('ssjinyao')Out[3]: 'I am ssjinyao'In [4]: 'I am &#123;&#125; my age is &#123;&#125;'.format('ssjinyao',23)Out[4]: 'I am ssjinyao my age is 23'In [5]: 'I am &#123;1&#125; my age is &#123;0&#125;'.format(23,'ssjinyao')Out[5]: 'I am ssjinyao my age is 23'In [6]: 'I am &#123;name&#125; my age is &#123;age&#125;'.format(age='23',name='ssjinyao')Out[6]: 'I am ssjinyao my age is 23'In [8]: 'I am &#123;0&#125; my name is &#123;0&#125;'.format('ssjinyao')Out[8]: 'I am ssjinyao my name is ssjinyao'In [15]: '&#123;&#125; name &#123;&#125; and age is &#123;age&#125;'.format('renjin','ssjinyao',age='23')Out[15]: 'renjin name ssjinyao and age is 23' 1234567891011121314In [16]: class A(): ...: def __init__(self): ...: self.x=1 ...: self.y=2 ...:In [17]: a = A()In [18]: a.xOut[18]: 1In [19]: a.yOut[19]: 2In [24]: '&#123;inst.x&#125;'.format(inst=a)Out[24]: '1'In [20]: '&#123;0.x&#125; &#123;0.y&#125;'.format(a)Out[20]: '1 2' 1234567891011121314In [26]: '&#123;0!a&#125;'.format('é€æ°´é”¦é¥')Out[26]: "'\\u901d\\u6c34\\u9526\\u9065'"In [27]: '&#123;0:^80&#125;'.format('é€æ°´é”¦é¥')Out[27]: ' é€æ°´é”¦é¥ 'In [29]: '&#123;0:&lt;80&#125;'.format('é€æ°´é”¦é¥')Out[29]: 'é€æ°´é”¦é¥ 'In [30]: '&#123;0:&gt;80&#125;'.format('é€æ°´é”¦é¥')Out[30]: ' é€æ°´é”¦é¥'In [34]: '&#123;0:&#123;fill&#125;^&#123;width&#125;&#125;'.format('é€æ°´é”¦é¥',width='80',fill='*')Out[34]: '**************************************é€æ°´é”¦é¥**************************************'In [35]: '&#123;message:&#123;fill&#125;^&#123;width&#125;&#125;'.format(message='é€æ°´é”¦é¥',width='80',fill='*')Out[35]: '**************************************é€æ°´é”¦é¥**************************************' 123456789101112131415161718192021222324252627282930313233343536373839404142In [41]: s = 'é€æ°´é”¦é¥'In [42]: b = s.encode()In [43]: for x in s: ...: print (x) ...:é€æ°´é”¦é¥In [44]: for x in b: ...: print (x) ...:233128157230176180233148166233129165In [44]: for x in b: ...: print (x) ...:233128157230176180233148166233129165In [45]: b.decode()Out[45]: 'é€æ°´é”¦é¥' python3 æ ¼å¼è½¬æ¢123456789101112131415(py3_env) [root@laoba-10-17:~/mypython/python3]# cat &lt;&lt;EOF &gt;&gt; utf-8.txté€æ°´é”¦é¥EOF(py3_env) [root@laoba-10-17:~/mypython/python3]# iconv -f UTF-8 -f UTF-8 -t GBK utf-8.txtï¿½ï¿½Ë®ï¿½ï¿½Ò£(py3_env) [root@laoba-10-17:~/mypython/python3]# iconv -f UTF-8 -f UTF-8 -t GBK utf-8.txt &gt; gbk.txt(py3_env) [root@laoba-10-17:~/mypython/python3]# cat gbk.txtï¿½ï¿½Ë®ï¿½ï¿½Ò£In [6]: f = open('/root/mypython/python3/gbk.txt','rb')In [7]: buf = f.read()In [8]: buf.decode('GBK')Out[8]: 'é€æ°´é”¦é¥\n'In [9]: name = buf.decode('GBK')In [10]: print (name)é€æ°´é”¦é¥ åŸºäºŽsocket ä¹‹é—´çš„ç¼–ç æ ¼å¼è½¬æ¢123456# æœåŠ¡ç«¯In [14]: import socketIn [15]: s = socket.socket(family=socket.AF_INET, type=socket.SOCK_STREAM)In [16]: s.bind(('0.0.0.0',3000))In [17]: s.listen()In [18]: fd, addr = s.accept() 123456# å®¢æˆ·ç«¯In [1]: import socketIn [2]: s = socket.socket(family=socket.AF_INET, type=socket.SOCK_STREAM)In [4]: so = s.connect(('127.0.0.1',3000))In [5]: s.send('é€æ°´é”¦é¥'.encode())Out[5]: 12 123# æœåŠ¡ç«¯In [33]: fd.recv(1024)Out[33]: b'\xe9\x80\x9d\xe6\xb0\xb4\xe9\x94\xa6\xe9\x81\xa5' 123# å®¢æˆ·ç«¯In [22]: s.send('é€æ°´é”¦é¥'.encode())Out[22]: 12 1234# æœåŠ¡ç«¯In [40]: buf = fd.recv(1024)In [41]: buf.decode()Out[41]: 'é€æ°´é”¦é¥' 123# å®¢æˆ·ç«¯In [23]: s.send('ä¹ä¹åœ¨çº¿'.encode())Out[23]: 12 1234# æœåŠ¡ç«¯In [42]: buf = fd.recv(1024)In [43]: buf.decode()Out[43]: 'ä¹ä¹åœ¨çº¿' 123# å®¢æˆ·ç«¯In [24]: s.send('é€æ°´é”¦é¥ï¼Œä¹ä¹åœ¨çº¿'.encode())Out[24]: 27 1234# æœåŠ¡ç«¯In [45]: buf = fd.recv(1024)In [46]: buf.decode()Out[46]: 'é€æ°´é”¦é¥ï¼Œä¹ä¹åœ¨çº¿' åŸºäºŽ socket ä¹‹é—´çš„jsonæ ¼å¼ä¼ è¾“ 123456789# å®¢æˆ·ç«¯ç”Ÿæˆjsonæ ¼å¼çš„æ•°æ®å¹¶å‘é€In [26]: import jsonIn [27]: data = &#123;'name':'ssjinyao',&#125;In [28]: data = &#123;'name':'ssjinyao','owner':'renjin'&#125;In [30]: json.dumps(data)Out[30]: '&#123;"name": "ssjinyao", "owner": "renjin"&#125;'In [31]: js = json.dumps(data)In [32]: s.send(js.encode())Out[32]: 39 1234# æœåŠ¡ç«¯æŽ¥æ”¶å‘é€è¿‡æ¥çš„jsonæ•°æ®In [47]: buf = fd.recv(1024)In [48]: buf.decode()Out[48]: '&#123;"name": "ssjinyao", "owner": "renjin"&#125;' 123# ä¸€èˆ¬å‘é€ç«¯ä¼šæŒ‡å®šç¼–ç In [34]: s.send(js.encode('UTF-8'))Out[34]: 39 123# æŽ¥æ”¶ç«¯ä¹Ÿä¼šæŒ‡å®šç¼–ç ï¼Œè¿™æ ·ä¸ä¼šå‡ºçŽ°ä¹±ç ã€In [50]: buf.decode('UTF-8')Out[50]: '&#123;"name": "ssjinyao", "owner": "renjin"&#125;']]></content>
      <tags>
        <tag>linux</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[keepalived+nginx+inotify+rsyncçš„å®žçŽ°]]></title>
    <url>%2F2018%2F08%2F08%2Fkeepalived%2Bnginx%2Binotify%2Brsync%E7%9A%84%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[çŽ¯å¢ƒæž¶æž„ä¸Žå®žçŽ°å®žéªŒçŽ¯å¢ƒä»‹ç» æœåŠ¡å™¨ip æ“ä½œç³»ç»Ÿ ä¸»æœºå ç”¨é€” 10.180.66.11 CentOS7.4 node1 ansibleè‡ªåŠ¨æŽ¨é€ 10.180.66.12 CentOS7.4 node2 keepalived+nginx+rsyncå®¢æˆ·ç«¯ 10.180.66.13 CentOS7.4 node3 keepalived+nginx+rsyncæœåŠ¡ç«¯ å®žçŽ°é€»è¾‘æž¶æž„å›¾æ³¨: ä¸Šå›¾node{1..7}æ˜¯æŒ‡nginx upstream çš„å„èŠ‚ç‚¹ ansible çŽ¯å¢ƒå‡†å¤‡node1 ansible çŽ¯å¢ƒçš„å‡†å¤‡ 1234567891011# vim /etc/hosts10.180.66.11 node1 node1.ssjinyao.com10.180.66.12 node2 node2.ssjinyao.com10.180.66.13 node3 node3.ssjinyao.com# for i in &#123;1..3&#125;; do ssh-copy-id -i ~/.ssh/id_rsa.pub root@node$i ; done # åŒæœºäº’ä¿¡# yum -y install epel-release# yum -y install ansible# vim /etc/ansible/hosts[keepalived]10.180.66.1210.180.66.13 keepalived æ‰‹åŠ¨å®‰è£…node2 ä¸Ž node3 keepalivedæ‰‹åŠ¨å®‰è£… 123456789101112131415# yum -y install gcc \ openssl-devel \ libnl3-devel \ ipset-devel \ iptables-devel \ libnfnetlink-devel \ net-snmp-devel \ procps-ng \ psmisc \ lsof \ grep# ntpdate ntp.aliyun.com# timedatectl set-timezone Asia/Shanghai# cd /usr/local/src# ä¸Šä¼ keepalived-2.0.6.tar.gz æ²¡æœ‰keepavliedåŒ…çš„å½“ç„¶ä¹Ÿå¯ä»¥åœ¨keepalived å®˜ç½‘ä¸‹è½½ 12345678910# cd /usr/local/src/keepalived-2.0.6# ./configure --prefix=/usr/local/keepalived # make &amp;&amp; make install# mkdir /var/log/keepalived/# vim /etc/rsyslog.conf # æœ€åŽåŠ å…¥local0.* /var/log/keepalived/keepalived.log# # systemctl restart rsyslog# vim /usr/local/keepalived/etc/sysconfig/keepalived # å°†æœ€åŽä¸€è¡Œæ”¹ä¸ºKEEPALIVED_OPTIONS=&quot;-D -S 0 -f /usr/local/keepalived/etc/keepalived/keepalived.conf&quot; node2 keepalived çš„é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445# vim /usr/local/keepalived/etc/keepalived/keepalived.conf! Configuration File for keepalivedglobal_defs &#123; notification_email &#123; root@localhost &#125; notification_email_from Alexandre.Cassen@firewall.loc smtp_server 127.0.0.1 smtp_connect_timeout 30 router_id node2 &#125;vrrp_script chk_nginx &#123; script &quot;/bin/bash /usr/local/keepalived/etc/keepalived/nginx_check.sh&quot; interval 5 weight -20&#125;vrrp_instance VI_1 &#123; state BACKUP interface ens33 virtual_router_id 55 priority 80 nopreempt advert_int 1 notify_master &quot;/usr/local/keepalived/etc/keepalived/message.sh master&quot; notify_backup &quot;/usr/local/keepalived/etc/keepalived/message.sh backup&quot; notify_fault &quot;/usr/local/keepalived/etc/keepalived/message.sh fault&quot; unicast_src_ip 10.180.66.12 unicast_peer &#123; 10.180.66.13 &#125; track_script &#123; chk_nginx &#125; authentication &#123; auth_type PASS auth_pass testLLb &#125; virtual_ipaddress &#123; 10.180.66.100 &#125;&#125; node3 keepalived çš„é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445# vim /usr/local/keepalived/etc/keepalived/keepalived.conf! Configuration File for keepalivedglobal_defs &#123; notification_email &#123; root@localhost &#125; notification_email_from Alexandre.Cassen@firewall.loc smtp_server 127.0.0.1 smtp_connect_timeout 30 router_id node2 &#125;vrrp_script chk_nginx &#123; script &quot;/bin/bash /usr/local/keepalived/etc/keepalived/nginx_check.sh&quot; interval 5 weight -20&#125;vrrp_instance VI_1 &#123; state BACKUP interface ens33 virtual_router_id 55 priority 80 nopreempt advert_int 1 notify_master &quot;/usr/local/keepalived/etc/keepalived/message.sh master&quot; notify_backup &quot;/usr/local/keepalived/etc/keepalived/message.sh backup&quot; notify_fault &quot;/usr/local/keepalived/etc/keepalived/message.sh fault&quot; unicast_src_ip 10.180.66.13 unicast_peer &#123; 10.180.66.12 &#125; track_script &#123; chk_nginx &#125; authentication &#123; auth_type PASS auth_pass testLLb &#125; virtual_ipaddress &#123; 10.180.66.100 &#125;&#125; å®‰è£…å¯ç”¨nginx 123456# yum -y install nginx # systemctl start nginx # systemctl enable nginx node2 # echo &quot;node2.ssjinyao.com&quot; &gt; /usr/share/nginx/html/index.htmlnode3 # echo &quot;node3.ssjinyao.com&quot; &gt; /usr/share/nginx/html/index.html# è‡³äºŽé…ç½®nginxçš„è´Ÿè½½å‡è¡¡ä¹‹å‰å†™çš„æ–‡ç« æœ‰æåˆ°è¿‡ node2,node3 ç¼©å†™keepalived nginxæœåŠ¡ç›‘æµ‹è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041# vim /usr/local/keepalived/etc/keepalived/nginx_check.sh#!/bin/bashpackage() &#123; rpm -qf /bin/ps &amp;&gt; /dev/null || yum -y install procps-ng &amp;&gt; /dev/null rpm -qf /bin/grep &amp;&gt; /dev/null || yum -y install grep &amp;&gt; /dev/null rpm -qf /usr/bin/killall &amp; &gt; /dev/null || yum -y install psmisc &amp;&gt; /dev/null&#125;packagenginx_state () &#123; ps aux | grep nginx &amp;&gt; /dev/null &amp;&amp; ps -C nginx --no-header &amp;&gt; /dev/null&#125;nginx_state ; nginx_state_num=$? ; echo $nginx_state_numnginx_port () &#123; netstat -tnlup | egrep ":80\&gt;" &amp;&gt; /dev/null&#125;kill_keepalived () &#123; kill -9 `cat /var/run/keepalived.pid`&#125;if [ $nginx_state_num -ne 0 ] ; then echo "`date +"%Y-%m-%d-%H-%M-%S"` nginx_status_one_check problem " &gt;&gt; /var/log/keepalived/check_nginx.log nginx_port ; nginx_port_num=$? ; echo $nginx_port_num if [ $nginx_port_num -ne 0 ] ; then echo "`date +"%Y-%m-%d-%H-%M-%S"` nginx_port_one_check problem" &gt;&gt; /var/log/keepalived/check_nginx.log systemctl restart nginx sleep 2 fifinginx_state ; nginx_state_num=$? ; echo $nginx_state_numif [ $nginx_state_num -ne 0 ] ; then echo "`date +"%Y-%m-%d-%H-%M-%S"` restart nginx and nginx_status_two_check problem " &gt;&gt; /var/log/keepalived/check_nginx.log nginx_port ; nginx_port_num=$? ; echo $nginx_port_num if [ $nginx_port_num -ne 0 ] ; then echo "`date +"%Y-%m-%d-%H-%M-%S"` restart nginx and nginx_port_two_check problem " &gt;&gt; /var/log/keepalived/check_nginx.log kill_keepalived fifi æ³¨: keepalived ä¸­è°ƒç”¨å‘½ä»¤æ—¶ä¸è¦ç”¨lsof;å½“è®¿é—®é‡è¾ƒé«˜æ—¶ï¼Œlsof æŸ¥è¯¢è¿›ç¨‹å¾ˆæ…¢ï¼Œä¼šé€ æˆkeepalivedé¢‘ç¹åˆ‡æ¢; node2,node3 ä¸Šçš„keepalived çŽ°åœ¨å¯ä»¥å¯åŠ¨äº† 12345# systemctl start keepalived# systemctl stop keepalivedæ³¨:éœ€è¦å…³é—­selinux å’Œiptables # iptables -F# setenforce 0 æµ‹è¯•æ•ˆæžœç›®å‰ip åœ¨node2ä¸Š tcmpdump ç›‘æµ‹å•æ’­å¿ƒè·³ä¿¡æ¯å½“æŠŠnode2ä¸Šçš„nginxåœæ­¢æ—¶å½“node2ä¸Šçš„nginxç”¨ç›‘æµ‹è„šæœ¬æ— æ³•è‡ªåŠ¨æ¢å¤æ—¶å½“node2 nginxæ¢å¤æ—¶å¯ä»¥å¤šæ¬¡æœåŠ¡å®•äº†æ—¶ï¼Œè§„èŒƒåˆ’çš„æ£€æŸ¥nginxçš„å¯åŠ¨æ—¥å¿— ansible ç¼–å†™keepalived è‡ªåŠ¨åŒ–rolesåœ¨ node1 ä¸Šç¼–å†™ keepalived è‡ªåŠ¨åŒ–è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136# tree.â”œâ”€â”€ keepalived.ymlâ””â”€â”€ roles â””â”€â”€ keepalived â”œâ”€â”€ files â”‚ â”œâ”€â”€ keepalived â”‚ â”œâ”€â”€ keepalived-2.0.6.tar.gz â”‚ â”œâ”€â”€ keepalived.conf.bak â”‚ â”œâ”€â”€ message.sh â”‚ â”œâ”€â”€ nginx_check.sh â”‚ â””â”€â”€ rsyslog.conf â”œâ”€â”€ tasks â”‚ â””â”€â”€ main.yml â”œâ”€â”€ templates â”‚ â””â”€â”€ keepalived.conf â””â”€â”€ vars â””â”€â”€ main.yml6 directories, 10 files# vim keepalived.yml---- hosts: "&#123;&#123; keepalivedhosts &#125;&#125;" remote_user: root roles: - keepalived# vim roles/keepalived/tasks/main.yml--- - name: set off selinux shell: setenforce 0 - name: set of iptables shell: iptables -F - name: install required packges yum: name=&#123;&#123; item &#125;&#125; state=present with_items: - gcc - openssl-devel - libnl3-devel - ipset-devel - iptables-devel - libnfnetlink-devel - net-snmp-devel - procps-ng - psmisc - lsof - grep - name: ntpdate time to keepavlied hosts shell: ntpdate ntp.aliyun.com - name: site time zone to Asia/Shanghai shell: timedatectl set-timezone Asia/Shanghai - name: copy keepalived_file to remote servers copy: src=keepalived-&#123;&#123; keepalivedversion &#125;&#125;.tar.gz dest=&#123;&#123; keepalivedsrc &#125;&#125; - name: decompression keepalived Source code package shell: cd /usr/local/src/ &amp;&amp; tar -xvf keepalived-2.0.6.tar.gz - name: make install keepalived shell: cd /usr/local/src/keepalived-&#123;&#123; keepalivedversion &#125;&#125; &amp;&amp; ./configure --prefix=/usr/local/keepalived &amp;&amp; make &amp;&amp; make install - name: mkdir keepalived log floder shell: mkdir &#123;&#123; keepalivedlogpath &#125;&#125; -pv - name: copy rsyslog config to keepalived copy: src=rsyslog.conf dest=/etc - name: restart rsyslog service: name=rsyslog state=restarted - name: copy keepalived sysconfig file to remote server copy: src=keepalived dest=/usr/local/keepalived/etc/sysconfig - name: copy keepalived nginx monitor bash script to remote server copy: src=nginx_check.sh dest=&#123;&#123; keepalivedpath &#125;&#125;etc/keepalived/ - name: copy keepalived nginx messge bash script to remote server copy: src=message.sh dest=&#123;&#123; keepalivedpath &#125;&#125;etc/keepalived/ mode=755 - name: copy keepalived config file to remote server template: src=keepalived.conf dest=&#123;&#123; keepalivedpath &#125;&#125;etc/keepalived/# vim roles/keepalived/vars/main.yml---keepalivedhosts: keepalivedkeepalivedversion: 2.0.6keepalivedpath: /usr/local/keepalived/keepalivedsrc: /usr/local/src/keepalivedlogpath: /var/log/keepalived/priority: 100unicast_src_ip: keepalivedunicast_peer1: 10.180.66.13unicast_peer2: 10.180.66.12virtual_ipaddress: 10.180.66.100# vim roles/keepalived/templates/keepalived.conf ! Configuration File for keepalivedglobal_defs &#123; notification_email &#123; root@localhost &#125; notification_email_from Alexandre.Cassen@firewall.loc smtp_server 127.0.0.1 smtp_connect_timeout 30 router_id node2 &#125;vrrp_script chk_nginx &#123; script "/bin/bash /usr/local/keepalived/etc/keepalived/nginx_check.sh" interval 5 weight -20&#125;vrrp_instance VI_1 &#123; state MASTER interface eth0 virtual_router_id 55 priority &#123;&#123; priority &#125;&#125; nopreempt advert_int 1 notify_master "/usr/local/keepalived/etc/keepalived/message.sh master" notify_backup "/usr/local/keepalived/etc/keepalived/message.sh backup" notify_fault "/usr/local/keepalived/etc/keepalived/message.sh fault" unicast_src_ip xxx.xx.xxx.xx unicast_peer &#123; xxx.xx.xxx.xx &#125; track_script &#123; chk_nginx &#125; authentication &#123; auth_type PASS auth_pass zE2kNsRQ &#125; virtual_ipaddress &#123; xxx.xx.xxx.xxx &#125;&#125;# æ³¨ï¼šä¸ºé¿å…æ„å¤–åœæ­¢ç”Ÿäº§ä¸­çš„nginxæœåŠ¡ï¼Œåœ¨ç”Ÿäº§ä¸­ï¼Œæœ€å¥½å…ˆæŠŠæœ‰å…³nginxç›‘æµ‹é…ç½®çš„æ³¨é‡Šäº†# vim roles/keepalived/files/message.sh#!/bin/bash/usr/bin/echo "`date +"%Y-%m-%d-%H-%M-%S"` node2 notify $1 " &gt;&gt; /var/log/keepalived/shell-message.log# å…¶ä½™æ–‡keepalivedã€keepalived-2.0.6.tar.gzã€keepalived.conf.bakã€message.shã€nginx_check.shã€rsyslog.confä»¶ä¸Žä»¥ä¸Šçš„ä½¿ç”¨çš„ä¸€æ · æŽ¥ä¸‹æ¥æŠŠnode2,node3æ¢å¤å¿«ç…§åˆ°åˆå§‹çŠ¶æ€è·‘ä¸€æ¬¡è¯•è¯•ä¸ºé¿å…ç”Ÿäº§ä¸­å‡ºçŽ°çªå‘æƒ…å†µï¼Œæ£€æŸ¥å˜æ›´å®Œkeepalived ä¸»é…ç½®æ–‡ä»¶åŽæ‰‹åŠ¨å¯åŠ¨æœåŠ¡ rsync+inotify nginxé…ç½®æ–‡ä»¶å®žæ—¶åŒæ­¥ä¸»æœåŠ¡å™¨é…ç½®10.180.66.131ã€ å®‰è£…rsync 1234567# cd /usr/local/src# ä¸Šä¼ rsyncæºç åŒ…# tar -xvf rsync-3.0.9.tar.gz# cd /usr/local/src/rsync-3.0.9# ./configure --prefix=/usr/local/rsync# make # make install 2ã€ å»ºç«‹å¯†ç è®¤è¯æ–‡ä»¶ 12345# echo &apos;Tpz99YJV1p&apos; &gt;&gt; /usr/local/rsync/rsync.passwd# cd /usr/local/rsync/# chown root.root rsync.passwd# chmod 600 rsync.passwd# ll rsync.passwd # æŸ¥çœ‹æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡® 3ã€ å®‰è£… inotify 1234567# cd /usr/local/src/# ä¸Šä¼ inotify æºç åŒ…# tar -xvf inotify-tools-3.14.tar.gz# cd /usr/local/src/inotify-tools-3.14# ./configure --prefix=/usr/local/inotify# make# make install 4ã€åˆ›å»º rsyncå¤åˆ¶è„šæœ¬(è¦æ³¨æ„åŒæ­¥çš„æ–¹å‘ä¸Žæ“ä½œ) 12345678910111213#!/bin/bashhost=10.180.66.13src=/etc/nginx/des=webuser=usernodesrc_ssl=/tmp/des_ssl=ssl/usr/local/inotify/bin/inotifywait -mrq --timefmt '%d/%m/%y %H:%M' --format '%T %w%f%e' -e modify,delete,create,attrib $src $src_ssl | while read filesdo/usr/local/rsync/bin/rsync -vzrtopg --delete --progress --password-file=/usr/local/rsync/rsync.passwd $src $user@$host::$des/usr/local/rsync/bin/rsync -vzrtopg --delete --progress --password-file=/usr/local/rsync/rsync.passwd $src_ssl $user@$host::$des_sslecho "$&#123;files&#125; was rsynced" &amp;&gt;&gt; /var/log/rsync.logdone 12# echo &apos;bash /root/rsync.sh &amp;&gt; /dev/null &amp;&apos; &gt;&gt; /etc/rc.local# chmod +x /etc/rc.d/rc.local å¤‡æœåŠ¡å™¨åŒæ­¥é…ç½®10.180.66.13 1ã€ å®‰è£…rsync(å¤‡æœåŠ¡å™¨åªå®‰è£…rsyncï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ­¥æ–‡ä»¶çš„ç›®æ ‡æœåŠ¡) 1234567# cd /usr/local/src# ä¸Šä¼ rsyncæºç åŒ…# tar -xvf rsync-3.0.9.tar.gz# cd /usr/local/src/rsync-3.0.9# ./configure --prefix=/usr/local/rsync# make # make install 2ã€ å»ºç«‹ç”¨æˆ·ä¸Žå¯†ç è®¤è¯æ–‡ä»¶ 12345# cd /usr/local/rsync/# echo &apos;usernode:Tpz99YJV1p&apos; &gt;&gt; rsync.passwd# chown root.root rsync.passwd# chmod 600 rsync.passwd# ll # æŸ¥çœ‹æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡® 3ã€ å»ºç«‹rsyncçš„å¯åŠ¨é…ç½®æ–‡ä»¶ 12# cd /usr/local/rsync# vim rsync.conf 1234567891011121314151617181920212223242526272829303132333435uid = rootgid = rootuse chroot = nomax connections = 10strict modes = yespid file = /var/run/rsyncd.pidlock file = /var/run/rsync.locklog file = /var/log/rsyncd.log[web]path = /etc/nginx/comment = web fileignore errorsread only = nowrite only = nohosts allow = 10.180.66.12hosts deny = *list = falseuid = rootgid = rootauth users = usernodesecrets file = /usr/local/rsync/rsync.passwd[ssl]path = /tmp/comment = ssl fileignore errorsread only = nowrite only = nohosts allow = 10.180.66.12hosts deny = *list = falseuid = rootgid = rootauth users = usernodesecrets file = /usr/local/rsync/rsync.passwd 1# /usr/local/rsync/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf 12# echo &apos;/usr/local/rsync/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf&apos; &gt;&gt; /etc/rc.d/rc.local# chmod +x /etc/rc.d/rc.local åœ¨10.180.66.12 å¼€å§‹å¾€ 10.180.66.13ä¸Šé¢åŒæ­¥1# bash /root/rsync.sh &amp;&gt; /dev/null &amp; æ³¨: shell é…ç½®åŒæ­¥ç»“æžœå¦‚ä¸‹ æ³¨æ„:nginx åŒæ­¥é…ç½®çš„æºåœ°å€ä¸Žç›®æ ‡åœ°å€ä¸€å®šè¦æ³¨æ„ï¼Œå¦‚æžœå¯¹ä»¥ä¸Šé…ç½®ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä¸€å®šè¦æµ‹è¯•æ— è¯¯åŽ å†ä¸Šç”Ÿäº§çŽ¯å¢ƒï¼Œ ä¸è¦æŠŠç”Ÿäº§ä¸­çš„é…ç½®æ›¿æ¢äº†keepalived åœ¨è‡ªåŠ¨åŒ–åˆå§‹åŒ–æ—¶ï¼Œä¸è¦å¯ç”¨nginxç›‘æµ‹ï¼Œå¦å¤–æ³¨æ„åœ¨ç”Ÿäº§ä¸­çš„è™šæ‹Ÿipå†²çª;]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hadoopå­¦ä¹ ç¬”è®°]]></title>
    <url>%2F2018%2F07%2F29%2Fhadoop%2F</url>
    <content type="text"><![CDATA[hadoopå­¦ä¹ ç¬”è®° Bigdata ç»“æž„åŒ–æ•°æ®: çº¦æŸ åŠç»“æž„åŒ–æ•°æ®: éžç»“æž„åŒ–æ•°æ®: æ²¡æœ‰å…ƒæ•°æ®ï¼› æœç´¢å¼•æ“Žï¼šæœç´¢ç»„ä»¶ã€ç´¢å¼•ç»„ä»¶å…±åŒç»„æˆ èœ˜è››ç¨‹åº: å­˜å‚¨ï¼š åˆ†æžå¤„ç†ï¼š 2003å¹´: The Google File System 2004å¹´: MapReduce: Simplified Data Processing On large Cluster 2006å¹´: BigTable: A Distributed Strorage System for Structure Data HDFS + MapReduce = Hadoop HBase Nutch MapRduce æ˜¯æ‰¹å¤„ç†ç¨‹åº: DN: Data Node NN: Name Node SNN: Secondary Name Node å‡½æ•°å¼ç¼–ç¨‹: Lisp, MLå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼›é«˜é˜¶å‡½æ•°ï¼› map, fold map: ä¸€ä¸ªä»»åŠ¡æ˜ å°„ä¸ºå¤šä¸ªmap(f()) map: æŽ¥å—ä¸€ä¸ªå‡½æ•°ä¸ºå‚æ•°ï¼Œå¹¶å°†å…¶åº”ç”¨äºŽåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œä»Žè€Œç”Ÿæˆä¸€ä¸ªç»“æžœåˆ—è¡¨; fold: æŽ¥å—ä¸¤ä¸ªèƒ½æ•°ï¼šå‡½æ•°ï¼Œåˆå§‹å€¼fold(g(), init) mapreduce: mapper, reducer mapper:ç»Ÿè®¡ã€æŽ’åº k-v(é”®å€¼æ•°æ®) ç»Ÿè®¡ä¸€æœ¬ä¹¦æ¯ä¸ªå•è¯å‡ºçŽ°çš„æ¬¡æ•°: mapper:æ¯100é¡µä¸€ä¸ªå•ä½ï¼Œ 5 mappers ç”¨äºŽæ‹†åˆ†æˆä¸ºå•è¯:10000000 reducer: reducer1, reducer2 mapper: this 1, is 1 ,this1 ,how1 åŒä¸€ä¸ªé”®çš„æ•°æ®åªèƒ½å‘å¾€åŒä¸€ä¸ªreducer reducer: this 500 is MRv1(Hadoop2) --&gt; MRv2(Hadoop2) MRv1: Cluster resource manager,Data processing MRv2: YARN: Cluster resource manager MRv2: Data processing MR: batch Tez: execution engine RM: Resource Manager NM: Node Manager AM: Application Master container: mrä»»åŠ¡ Ambari Hadoop Distribution: Cloudera: CDH Hortonworks: HDP Intel: IDH MapR: å®‰è£…ä½¿ç”¨Hadoopå•æœºæ¨¡åž‹: æµ‹è¯•ä½¿ç”¨;ä¼ªåˆ†å¸ƒå¼æ¨¡åž‹: è¿è¡ŒäºŽå•æœº;åˆ†å¸ƒå¼æ¨¡åž‹: é›†ç¾¤æ¨¡åž‹;Hadoopï¼ŒåŸºäºŽJavaè¯­è¨€;éœ€è¦é…ç½®jvmå’Œjvm homeçŽ¯å¢ƒ; jdk: 1.6, 1.7, 1.8 hadoop-2.6.2 jdk 1.6+ 123456# yum -y install java-1.7.0-openjdk.x86_64# vim /etc/profile.d/java.shexport JAVA_HOME=/usr# chmod +x /etc/profile.d/java.sh# source /etc/profile.d/java.sh# yum -y install java-1.7.0-openjdk-devel 12# cd /usr/local/src &amp;&amp; # wget https://archive.apache.org/dist/hadoop/core/hadoop-2.6.1/hadoop-2.6.1.tar.gz#]]></content>
      <tags>
        <tag>linux</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hyperledger Fabric 1.0éƒ¨ç½²ä¸Žä½¿ç”¨]]></title>
    <url>%2F2018%2F07%2F19%2FHyperledger%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Hyperledger Fabric 1.0éƒ¨ç½²ä¸Žä½¿ç”¨ 1.çŽ¯å¢ƒæž„å»ºä¸Žæµ‹è¯•æœ¬æ–‡ä¸­ç”¨åˆ°çš„å®¿ä¸»çŽ¯å¢ƒæ˜¯CentOSï¼Œç‰ˆæœ¬ä¸ºCentOS.x86_64(7.4);é€šè¿‡Dcokerå®¹å™¨æ¥è¿è¡ŒFabricçš„èŠ‚ç‚¹ï¼Œç‰ˆæœ¬ä¸ºv1.0;å› æ­¤ï¼Œå¯åŠ¨Fabricç½‘ç»œçš„èŠ‚ç‚¹éœ€è¦å…ˆå®‰è£… Dockerã€Docker-composeå’ŒGoè¯­è¨€çŽ¯å¢ƒ;ç„¶åŽåœ¨ç½‘ä¸Šæ‘˜å–ç›¸å…³çš„Dockeré•œåƒï¼Œå†èƒ½è¿‡é…ç½®composeæ–‡ä»¶æ¥å¯åŠ¨å„ä¸ªèŠ‚ç‚¹; 1.1: CentOS yumæºçš„é…ç½®å…¬å¸å†…ç½‘ï¼Œå¯ä»¥è®©æœåŠ¡å™¨ä»¥æ¡¥æŽ¥æ–¹å¼æŽ¥å…¥ç½‘ç»œ; aã€å¤‡ä»½åŽŸæœ‰çš„yumæºé…ç½® 1234# æ³¨:è‹¥ç³»ç»ŸçŽ¯å¢ƒæ˜¯åˆå§‹åŒ–å®‰è£…çš„ï¼Œæœ€å¥½å…ˆå®‰è£…ä»¥ä¸‹è½¯ä»¶åŒ…# yum -y install wget screen vim# cd /etc/yum.repos.d/ &amp;&amp; mkdir bak# mv *repo bak bã€è®¾ç½®é˜¿é‡Œyumæº 1# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo cã€æ¸…ç†ç¼“å­˜å¹¶ç”Ÿæˆæ–°çš„ç¼“å­˜ 12# yum clean all # yum makecache dã€æ›´æ–°yumåº“ 1# yum update æ­¤æ“ä½œçš„ç›®çš„æ˜¯ä¸ºæ›´æ–°æ‰€æœ‰çš„å†…ç½®åº“åˆ°æœ€æ–°ç‰ˆ;å› ä¸ºdockeræœ€æ–°ç‰ˆçš„å®‰è£…éœ€è¦æ‰€å¯¹åº”çš„ä¾èµ–éƒ½æ˜¯æœ€æ–°ç‰ˆ;ä¸ºäº†é¿å…å®‰è£…æ—¶è½¯ä»¶åŒ…ä¾èµ–çš„å‘ï¼Œæ•…å¦‚æ­¤æ“ä½œ; 1.2: Dockerå®‰è£…è¿›å…¥dockerå®˜ç½‘ aã€GetDockerâ€“&gt; CentOS â€“&gt; Get CE ç¤¾åŒºç‰ˆ â€“&gt; Get Docker CE on CentOS â€“&gt; Install Docker CE on CentOS. bã€è‹¥æœåŠ¡å™¨ä¸Šå­˜åœ¨æ—§çš„dockerç‰ˆæœ¬ï¼Œéœ€è¦å…ˆæ‰§è¡Œä»¥ä¸‹æ“ä½œ: 1# yum -y remove docker docker-common docker-selinux docker-engine cã€éšåŽå¼€å§‹å®‰è£…Docker CEç›®å‰Dockerå®˜æ–¹æœ€æ–°ç‰ˆä¸ºdocker-ce-17.12.1.ce-1.el7.centos.x86_64.rpm;å¯ä»¥åœ¨docker rpmåŒ…ä¸­ä¸‹è½½å¹¶å®‰è£… 1234# mkdir -p /tmp/rpm/docker# cd /tmp/rpm/docker # wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-17.12.1.ce-1.el7.centos.x86_64.rpm# yum -y install *docker*rpm dã€æ£€æŸ¥dockeræ˜¯å¦å®‰è£…æˆåŠŸ 12# docker --versionDocker version 17.12.1-ce, build 7390fc6 eã€å¯åŠ¨dockeræœåŠ¡ 1# systemctl start docker fã€è®¾ç½®dockerä¸ºå¼€æœºè‡ªå¯ 1# systemctl enable docker 1.3: Docker-Composeå®‰è£… Docker-Composeçš„ç¦»çº¿å®‰è£…ç›¸å¯¹äºŽcurlå®‰è£…æ¯”è¾ƒéº»çƒ¦ï¼›éœ€è¦åœ¨å®˜ç½‘æä¾›çš„githubä¸­ä¸‹è½½æœ€æ–°çš„docker-compose;å°†å…¶clone /tmp/rpm/docker/ä¸‹ï¼› aã€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åŽå®Œæˆå®‰è£… 1# curl -L https://github.com/docker/compose/releases/download/1.20.0-rc1/docker-compose-`uname -s`-`uname -m` -o /tmp/rpm/docker/docker-compose bã€ç§»æ¤docker-composeåˆ°PATHå˜é‡çŽ¯å¢ƒä¸­ 12# chmod +x docker-compose # cp -a docker-compose /usr/bin/ cã€ç§»æ¤åŽæŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬ä¿¡æ¯ 12# docker-compose --versiondocker-compose version 1.20.0-rc1, build 86428af åˆ°æ­¤dockerçŽ¯å¢ƒå·²å‡†å¤‡å®Œæ¯• 1.4 GoçŽ¯å¢ƒå‡†å¤‡aã€å‚ç…§goå®˜ç½‘ï¼Œä¸‹è½½æœ€æ–°çš„Goè¯­è¨€åŒ…;bã€ç›´æŽ¥é€šè¿‡é“¾æŽ¥ä¸‹è½½ Goå®˜ç½‘è¿žæŽ¥ 12345# mkdir -p /tmp/rpm/go &amp;&amp; cd /tmp/rpm/go# wget https://test-inner.transfereasy.com/go1.8.3.linux-amd64.tar.gz# æ³¨: ç›®å‰è¿™ä¸ªåŒ…å·²ç»ç½®äºŽå†…ç½‘çŽ¯å¢ƒä¸­# æ³¨: å¯ä»¥é€šè¿‡ssjinyaoç½‘ç«™ä¸‹è½½# wget https://rjyy.ssjinyao.com/go1.8.3.linux-amd64.tar.gz cã€è§£åŽ‹äºŒè¿›åˆ¶ç¨‹åºåˆ°/usr/localç›®å½•ä¸‹; 123456789101112131415161718192021# tar -xvf go1.8.3.linux-amd64.tar.gz -C /usr/local/ # ll /usr/local/go/æ€»ç”¨é‡ 136drwxr-xr-x. 2 root root 205 5æœˆ 25 2017 api-rw-r--r--. 1 root root 33243 5æœˆ 25 2017 AUTHORSdrwxr-xr-x. 2 root root 42 5æœˆ 25 2017 bindrwxr-xr-x. 4 root root 37 5æœˆ 25 2017 blog-rw-r--r--. 1 root root 1366 5æœˆ 25 2017 CONTRIBUTING.md-rw-r--r--. 1 root root 45710 5æœˆ 25 2017 CONTRIBUTORSdrwxr-xr-x. 8 root root 4096 5æœˆ 25 2017 doc-rw-r--r--. 1 root root 5686 5æœˆ 25 2017 favicon.icodrwxr-xr-x. 3 root root 18 5æœˆ 25 2017 lib-rw-r--r--. 1 root root 1479 5æœˆ 25 2017 LICENSEdrwxr-xr-x. 14 root root 190 5æœˆ 25 2017 misc-rw-r--r--. 1 root root 1303 5æœˆ 25 2017 PATENTSdrwxr-xr-x. 7 root root 87 5æœˆ 25 2017 pkg-rw-r--r--. 1 root root 1399 5æœˆ 25 2017 README.md-rw-r--r--. 1 root root 26 5æœˆ 25 2017 robots.txtdrwxr-xr-x. 46 root root 4096 5æœˆ 25 2017 srcdrwxr-xr-x. 17 root root 8192 5æœˆ 25 2017 test-rw-r--r--. 1 root root 7 5æœˆ 25 2017 VERSION dã€é…ç½®goçŽ¯å¢ƒå˜é‡ 12345678# echo &quot;export PATH=$PATH:/usr/local/go/bin&quot; &gt; /etc/profile.d/go.sh# echo &quot;export GOPATH=/opt/gopath&quot; &gt;&gt; /etc/profile.d/go.sh# chmod +x /etc/profile.d/go.sh# source /etc/profile.d/go.sh# echo $PATH/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/srv/jdk1.8.0_66/bin:/root/bin:/usr/local/go/bin# go versiongo version go1.8.3 linux/amd64 è‡³æ­¤goçŽ¯å¢ƒå˜é‡å·²ç»é…ç½®å®Œæ¯• 2.Fabricæºç åŠé•œåƒæ–‡ä»¶å¤„ç†2.1ä¸‹è½½Fabricæºç  ä¸‹è½½Fabricæºæ˜¯å› ä¸ºè¦ç”¨åˆ°æºç ä¸­æåˆ°çš„ä¾‹å­å’Œå·¥å…·;å·¥å…·ç¼–è¯‘éœ€è¦ç”¨åˆ°goè¯­è¨€çŽ¯å¢ƒ;å› æ­¤éœ€è¦æŠŠæºç ç›®å½•æ”¾åˆ°$GOPATHçŽ¯å¢ƒå˜é‡ä¸‹;é€šè¿‡1.4ä¸­çš„å®‰è£…é…ç½® $GOPATHè®¾ç½®ä¸º/opt/gopath; è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨git cloneæºç ä¹Ÿå¯ä»¥ä½¿ç”¨go get å‘½ä»¤ 12345# go get github.com/hyperledger/fabricæˆ–è€…æ˜¯# mkdir -p /opt/gopath/src/github.com/hyperledger/ # cd /opt/gopath/src/github.com/hyperledger/ &amp;&amp; git clone https://github.com/hyperledger/fabric.git# cd /opt/gopath/src/github.com/hyperledger/fabric &amp;&amp; git checkout -b v1.0.0 1234567891011121314151617181920212223242526272829303132333435363738# æœ€åŽçš„å·¥ç¨‹ç»“æž„å¦‚ä¸‹# cd /opt/gopath/src/github.com/hyperledger# tree -L 1 fabric/fabric/â”œâ”€â”€ bccspâ”œâ”€â”€ bddtestsâ”œâ”€â”€ CHANGELOG.mdâ”œâ”€â”€ ci.propertiesâ”œâ”€â”€ commonâ”œâ”€â”€ CONTRIBUTING.mdâ”œâ”€â”€ coreâ”œâ”€â”€ devenvâ”œâ”€â”€ docker-env.mkâ”œâ”€â”€ docsâ”œâ”€â”€ eventsâ”œâ”€â”€ examplesâ”œâ”€â”€ gossipâ”œâ”€â”€ gotoolsâ”œâ”€â”€ imagesâ”œâ”€â”€ LICENSEâ”œâ”€â”€ Makefileâ”œâ”€â”€ mkdocs.ymlâ”œâ”€â”€ mspâ”œâ”€â”€ ordererâ”œâ”€â”€ peerâ”œâ”€â”€ proposalsâ”œâ”€â”€ protosâ”œâ”€â”€ README.mdâ”œâ”€â”€ releaseâ”œâ”€â”€ release_notesâ”œâ”€â”€ sampleconfigâ”œâ”€â”€ scriptsâ”œâ”€â”€ settings.gradleâ”œâ”€â”€ testâ”œâ”€â”€ unit-testâ””â”€â”€ vendor23 directories, 9 files 2.2ä¸‹è½½Fabricç›¸å…³é•œåƒæ–‡ä»¶ è¯¥æ“ä½œæœ‰å¤šç§æ–¹å¼è¿›è¡Œï¼Œå¦‚æžœæ˜¯æµ‹è¯•Fabricé›†ç¾¤æ–¹æ¡ˆ;ç›´æŽ¥è¿›å…¥fabric/examples/e2e_cliç›®å½•ä¸‹ï¼Œè¿è¡Œ./dowload-dockerimages.sh;å³å¯ä¸‹è½½è¯¥å·¥ç¨‹å¿…è¦çš„é•œåƒæ–‡ä»¶;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯é•œåƒä¸Žä¸‹è½½åˆ°hyperledgerä¸­çš„æºç demoç‰ˆæœ¬å·ç›¸å¯¹åº”;è¯¥å¤„æ–¹æ³•å±žäºŽè¾ƒä¸ºå¦¥å½“çš„æ–¹æ¡ˆ; æ£€ç´¢ HyperLedger,ä»¥hyperledger/fabric-peerä¸ºä¾‹ï¼Œè¿›å…¥ä¸‹è½½é¡µé¢;å®˜æ–¹ç»™å‡ºçš„ä¸‹è½½æ–¹å¼å¦‚ä¸‹: 1# docker pull hyperledger/fabric-peer ä½†ç”±äºŽdockeré•œåƒä¸‹è½½åœ¨æ²¡æœ‰ç»™å‡ºtagçš„æƒ…å†µä¸‹ä¼šé»˜è®¤ä½¿ç”¨latest;æ‰€ä»¥è¯¥æ–¹æ¡ˆæœ€ç»ˆå¯èƒ½ä¼šä¸‹è½½å¤±è´¥,å› æ­¤éœ€åœ¨fabric-peerä¸‹è½½é¡µé€‰ä¸­å…¶tagsæ ‡ç­¾;æŸ¥çœ‹å½“å‰fabric-peeræœ€æ–°ç‰ˆæœ¬å·ï¼Œæ ¹æ®æˆ‘ä»¬æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæƒ…å†µï¼Œé€‰æ‹©x86_64-1.0.0ç‰ˆæœ¬ï¼›æ•…æœ€ç»ˆæ‰§è¡Œçš„dockerä¸‹è½½å‘½ä»¤å¦‚ä¸‹: 1234567891011121314# docker pull hyperledger/fabric-peer:x86_64-1.0.0x86_64-1.0.0: Pulling from hyperledger/fabric-peeraafe6b5e13de: Pull complete 0a2b43a72660: Pull complete 18bdd1e546d2: Pull complete 8198342c3e05: Pull complete f56970a44fd4: Pull complete e32b597e7839: Pull complete a6e362fc71c4: Pull complete f107ea6d90f4: Pull complete 72c8e84de237: Pull complete 776cc74c9f73: Pull complete Digest: sha256:b7c1c2a6b356996c3dbe2b9554055cd2b63194cd7a492a83de2dbabf7f7e3c65Status: Downloaded newer image for hyperledger/fabric-peer:x86_64-1.0.0 æ ¹æ®ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯ä»¥å°†è¿™äº›å¿…è¦çš„é•œåƒç”±dockeræœåŠ¡å…¨éƒ¨ä¸‹è½½è‡³æœ¬åœ°;å¹¶æœ€ç»ˆä½¿ç”¨docker-composeæ¥å¯åŠ¨å¯¹åº”çš„é•œåƒæœåŠ¡;ä¸ºäº†æ–¹ä¾¿docker-composeçš„é…ç½®ï¼Œå°†ç”©çš„é•œåƒtagéƒ½æ”¹ä¸ºlatestï¼Œæ‰§è¡Œå¦‚ä¸‹æ ¼å¼; 1# docker tag IMAGEID(é•œåƒid) REPOSITORY:TAG(ä»“åº“:æ ‡ç­¾) 1234567891011121314151617181920212223# cd /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/# bash download-dockerimages.sh æ³¨:ä¹Ÿå¯ä»¥ç”¨åŽé¢æ‰€æåˆ°shellå»ºç«‹# docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEhyperledger/fabric-peer x86_64-1.0.0 6830dcd7b9b5 8 months ago 182MBhyperledger/fabric-tools latest ae6b0f53cb70 9 months ago 1.32GBhyperledger/fabric-tools x86_64-1.0.0-beta ae6b0f53cb70 9 months ago 1.32GBhyperledger/fabric-couchdb latest 31bbbec3d853 9 months ago 1.48GBhyperledger/fabric-couchdb x86_64-1.0.0-beta 31bbbec3d853 9 months ago 1.48GBhyperledger/fabric-kafka latest c4ac1c9a4797 9 months ago 1.3GBhyperledger/fabric-kafka x86_64-1.0.0-beta c4ac1c9a4797 9 months ago 1.3GBhyperledger/fabric-zookeeper latest 2c4ebacb6f00 9 months ago 1.31GBhyperledger/fabric-zookeeper x86_64-1.0.0-beta 2c4ebacb6f00 9 months ago 1.31GBhyperledger/fabric-orderer latest 11ff350dd297 9 months ago 179MBhyperledger/fabric-orderer x86_64-1.0.0-beta 11ff350dd297 9 months ago 179MBhyperledger/fabric-peer latest e01c2b645f11 9 months ago 182MBhyperledger/fabric-peer x86_64-1.0.0-beta e01c2b645f11 9 months ago 182MBhyperledger/fabric-javaenv latest 61c188dca542 9 months ago 1.42GBhyperledger/fabric-javaenv x86_64-1.0.0-beta 61c188dca542 9 months ago 1.42GBhyperledger/fabric-ccenv latest 7034cca1918d 9 months ago 1.29GBhyperledger/fabric-ccenv x86_64-1.0.0-beta 7034cca1918d 9 months ago 1.29GBhyperledger/fabric-ca latest e549e8c53c2e 9 months ago 238MBhyperledger/fabric-ca x86_64-1.0.0-beta e549e8c53c2e 9 months ago 238MB 2.3è¡¥å……é•œåƒå¤‡ä»½å’Œè¿ç§»ä¸Šè¿°HperLedger/Fabric é•œåƒæ•°é‡è¾ƒå¤šä¸”å®¹é‡éœ€æ±‚å¤§ï¼Œä¸€å¥—åŸºæœ¬çš„æœåŠ¡é•œåƒå¯è¾¾10Gå·¦å³;å¦‚æžœåœ¨å¤šå°æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œä¼šè€½è¯¯å¾ˆå¤šæ—¶é—´ã€‚å› æ­¤ï¼Œå¯¹äºŽä¸Šè¿°å·²ä¸‹è½½çš„é•œåƒ;æˆ‘ä»¬éœ€è¦ä½¿ç”¨docker saveå‘½ä»¤æ¥å¤‡ä»½ï¼Œå¹¶é€šè¿‡scpå‘½ä»¤æ¥æŠŠè¿™äº›æ–‡ä»¶æ‹·è´è‡³å…¶å®ƒæœåŠ¡å™¨ï¼› 123456789101112131415# cat dk_image_bak.sh #!/bin/bash## å¼€å§‹è‡ªåŠ¨å¤‡ä»½é•œåƒim=`docker images | grep latest | wc -l` for i in `seq $im` ;do id=` docker images | grep latest | grep fabric | awk '&#123;print $3&#125;' | sed -n $i\p` fn=` docker images | grep latest | grep fabric | awk -F "/" '&#123;print $2&#125;' | awk '&#123;print $1&#125;' | sed -n $i\p ` dir=` docker images | grep latest | grep fabric | awk -F "/" '&#123;print $1&#125;'` mkdir -p /tmp/images/docker/$dir/ docker save $id &gt; /tmp/images/docker/$dir/$fn.gz done ## è‡³æ­¤idå·²ç»ä¿å­˜é•œåƒå®Œæ¯•## å¼€å§‹è¿œç¨‹åŒæ­¥ä¸Žè¿ç§» ssh root@10.180.55.126 "mkdir -p /tmp/images/docker/$dir/"scp /tmp/images/docker/$fn/*gz root@10.180.55.126:/tmp/images/docker/$dir/ å½“è¿œç«¯æœåŠ¡å™¨æŽ¥æ”¶åˆ°æ‰€æœ‰çš„é•œåƒä¹‹åŽï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥åŠ è½½è¿™äº›é•œåƒæ–‡ä»¶ 1# docker load &lt; /tmp/images/docker/hyperledger/fabric-ccenv.gz ä»¥ä¸Š2.3é•œåƒçš„å¤‡ä»½å’Œè¿ç§»æ˜¯å¯é€‰æ–¹æ¡ˆ; 3.è¿è¡Œæµ‹è¯•e2e3.1 è¿è¡Œfabric-sampleçš„é—®é¢˜ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå‚ç…§å®˜ç½‘æ¥å®Œæˆç¬¬ä¸€ä¸ªç½‘ç»œæµ‹è¯•;åœ¨è¯¥åœ¨çº¿æ–‡æ¡£ä¸­ä¼šè®©æˆ‘ä»¬åŽ»ä¸‹è½½ä¸€ä¸ªfabric-sample;ä¸‹è½½åœ°å€åœ¨githubä¸Š;æˆ‘ä»¬éœ€è¦å°†å…¶ä¸‹è½½è‡³æœ¬åœ°æ˜¯ä¸€ä¸ªfabric-sample-releaseçš„æ–‡ä»¶,å°†å…¶æ›´åä¸ºfabric-sampleséšåŽå°†å…¶ç§»åˆ°opt/gopath/srcç›®å½•ä¸‹; æŒ‰ç…§å®˜ç½‘æç¤ºæ‰§è¡Œçš„å‘½ä»¤æ˜¯æ— æ³•è¿è¡Œèµ·first-networkè¿™ä¸ªé¡¹ç›®;è¯¥demoéœ€è¦å…ˆä¸‹è½½Platform-specific Binaries(ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶);æŒ‰ç…§å®˜æ–‡æ¡£ä¸­çš„æè¿°ï¼Œéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤; å®˜æ–¹æä¾›bashè„šæœ¬å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576# cd /root/ &amp;&amp; vim dk_bin.shåŠ å…¥ä»¥ä¸‹æ‰§è¡Œç¨‹åº#!/bin/bash## Copyright IBM Corp. All Rights Reserved.## SPDX-License-Identifier: Apache-2.0## current version of fabric releasedexport VERSION=$&#123;1:-1.0.4&#125;# current version of fabric-ca releasedexport CA_VERSION=$&#123;2:-$VERSION&#125;# current version of thirdparty images (couchdb, kafka and zookeeper) releasedexport THIRDPARTY_IMAGE_VERSION=0.4.6export ARCH=$(echo "$(uname -s|tr '[:upper:]' '[:lower:]'|sed 's/mingw64_nt.*/windows/')-$(uname -m | sed 's/x86_64/amd64/g')" | awk '&#123;print tolower($0)&#125;')#Set MARCH variable i.e ppc64le,s390x,x86_64,i386MARCH=`uname -m`dockerFabricPull() &#123; local FABRIC_TAG=$1 for IMAGES in peer orderer ccenv javaenv tools; do echo "==&gt; FABRIC IMAGE: $IMAGES" echo docker pull hyperledger/fabric-$IMAGES:$FABRIC_TAG docker tag hyperledger/fabric-$IMAGES:$FABRIC_TAG hyperledger/fabric-$IMAGES done&#125;dockerThirdPartyImagesPull() &#123; local THIRDPARTY_TAG=$1 for IMAGES in couchdb kafka zookeeper; do echo "==&gt; THIRDPARTY DOCKER IMAGE: $IMAGES" echo docker pull hyperledger/fabric-$IMAGES:$THIRDPARTY_TAG docker tag hyperledger/fabric-$IMAGES:$THIRDPARTY_TAG hyperledger/fabric-$IMAGES done&#125;dockerCaPull() &#123; local CA_TAG=$1 echo "==&gt; FABRIC CA IMAGE" echo docker pull hyperledger/fabric-ca:$CA_TAG docker tag hyperledger/fabric-ca:$CA_TAG hyperledger/fabric-ca&#125;: $&#123;CA_TAG:="$MARCH-$CA_VERSION"&#125;: $&#123;FABRIC_TAG:="$MARCH-$VERSION"&#125;: $&#123;THIRDPARTY_TAG:="$MARCH-$THIRDPARTY_IMAGE_VERSION"&#125;echo "===&gt; Downloading platform specific fabric binaries"curl https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/$&#123;ARCH&#125;-$&#123;VERSION&#125;/hyperledger-fabric-$&#123;ARCH&#125;-$&#123;VERSION&#125;.tar.gz | tar xzecho "===&gt; Downloading platform specific fabric-ca-client binary"curl https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/$&#123;ARCH&#125;-$&#123;VERSION&#125;/hyperledger-fabric-ca-$&#123;ARCH&#125;-$&#123;VERSION&#125;.tar.gz | tar xzif [ $? != 0 ]; then echo echo "------&gt; $VERSION fabric-ca-client binary is not available to download (Avaialble from 1.1.0-rc1) &lt;----" echofiecho "===&gt; Pulling fabric Images"dockerFabricPull $&#123;FABRIC_TAG&#125;echo "===&gt; Pulling fabric ca Image"dockerCaPull $&#123;CA_TAG&#125;echo "===&gt; Pulling thirdparty docker images"dockerThirdPartyImagesPull $&#123;THIRDPARTY_TAG&#125;echoecho "===&gt; List out hyperledger docker images"docker images | grep hyperledger*# chmod + x /root/dk_bin.sh# bash /root/dk_bin.sh è¿è¡Œæ—¶æ•ˆæžœå¦‚ä¸‹; æ³¨:è‹¥æ˜¯å†…ç½‘çŽ¯å¢ƒï¼Œåˆ™å¯èƒ½æ‰§è¡Œæ—¶é—´è¾ƒé•¿;12345# bash /root/dk_bin.sh ===&gt; Downloading platform specific fabric binaries % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 18 22.6M 18 4312k 0 0 6860 0 0:57:45 0:10:43 0:47:02 5364 3.2è¿è¡Œe2e_clié¡¹ç›®è¿›å…¥åˆ°/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/ç›®å½•; aã€ç›®å½•ç»“æž„å¦‚ä¸‹å›¾; 12345678910111213141516171819202122232425# tree ../e2e_cli/../e2e_cli/â”œâ”€â”€ baseâ”‚ â”œâ”€â”€ docker-compose-base.yamlâ”‚ â””â”€â”€ peer-base.yamlâ”œâ”€â”€ channel-artifactsâ”œâ”€â”€ configtx.yamlâ”œâ”€â”€ crypto-config.yamlâ”œâ”€â”€ docker-compose-cli.yamlâ”œâ”€â”€ docker-compose-couch.yamlâ”œâ”€â”€ docker-compose-e2e-template.yamlâ”œâ”€â”€ docker-compose-e2e.yamlâ”œâ”€â”€ download-dockerimages.shâ”œâ”€â”€ end-to-end.rstâ”œâ”€â”€ examplesâ”‚ â””â”€â”€ chaincodeâ”‚ â””â”€â”€ goâ”‚ â””â”€â”€ chaincode_example02â”‚ â””â”€â”€ chaincode_example02.goâ”œâ”€â”€ generateArtifacts.shâ”œâ”€â”€ network_setup.shâ””â”€â”€ scripts â””â”€â”€ script.sh7 directories, 14 files network_setup.shæ˜¯ä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼Œè¯¥è„šæœ¬å¯åŠ¨5ä¸ªdockerå®¹å™¨;å…¶ä¸­4ä¸ªå®¹å™¨è¿è¡ŒpeerèŠ‚ç‚¹å’Œ1ä¸ªå®¹å™¨è¿è¡ŒordererèŠ‚ç‚¹ï¼Œå®ƒç»„æˆä¸€ä¸ªfabricé›†ç¾¤;å¦å¤–è¿˜æœ‰ä¸€ä¸ªcliå®¹å™¨ç”¨äºŽåˆ›å»ºchannleã€åŠ å…¥channelã€å®‰è£…å’Œæ‰§è¡Œchaincodeç­‰æ“ä½œ;æµ‹è¯•ç”¨çš„chaincodeå®šä¹‰äº†ä¸¤ä¸ªå˜é‡ï¼Œåœ¨å®žä¾‹åŒ–çš„æ—¶å€™ä¼šç»™è¿™ä¸¤ä¸ªå˜é‡èµ‹äºˆäº†åˆå§‹å€¼;å¹¶èƒ½è¿‡invokeæ“ä½œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå˜é‡çš„å€¼å‘ç”Ÿå˜åŒ–; bã€é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæµ‹è¯•; 12# cd /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/# bash network_setup.sh up cã€å½“å‡ºçŽ°ä»¥ä¸‹ç•Œé¢æ—¶ï¼Œè¯´æ˜Žå·²ç»æµ‹è¯•é€šäº† 12345678910112018-03-13 09:38:21.185 UTC [main] main -&gt; INFO 008 Exiting.....===================== Query on PEER3 on channel &apos;mychannel&apos; is successful ===================== ===================== All GOOD, End-2-End execution completed ===================== _____ _ _ ____ _____ ____ _____ | ____| | \ | | | _ \ | ____| |___ \ | ____|| _| | \| | | | | | _____ | _| __) | | _| | |___ | |\ | | |_| | |_____| | |___ / __/ | |___ |_____| |_| \_| |____/ |_____| |_____| |_____| dã€å¦‚æžœä¸Šä¸€æ­¥æœ‰æŠ¥é”™ï¼Œè‹¥æ²¡æœ‰éƒ¨ç½²å…¶å®ƒåº”ç”¨ï¼Œå¯ä»¥è€ƒè™‘å°†å†…æ ¸å‡çº§; 12345678910111213# rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm# yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; list available# yum --enablerepo=elrepo-kernel install kernel-ml# vim /etc/default/grubGRUB_TIMEOUT=5GRUB_DISTRIBUTOR=&quot;$(sed &apos;s, release .*$,,g&apos; /etc/system-release)&quot;GRUB_DEFAULT=0GRUB_DISABLE_SUBMENU=trueGRUB_TERMINAL_OUTPUT=&quot;console&quot;GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet&quot;GRUB_DISABLE_RECOVERY=&quot;true&quot;# grub2-mkconfig -o /boot/grub2/grub.cfg 4.åˆ›å»ºFabricå¤šèŠ‚ç‚¹é›†ç¾¤4.1é…ç½®è¯´æ˜Ž é¦–å…ˆå¯ä»¥æ ¹æ®å®˜æ–¹Fabricè‡ªå¸¦çš„e2e_cliä¾‹å­ä¸­çš„é›†ç¾¤æ–¹æ¡ˆæ¥ç”Ÿæˆé›†ç¾¤;ä¸Žæ¡ˆä¾‹ä¸åŒçš„æ˜¯æˆ‘ä»¬éœ€è¦æŠŠå®¹å™¨åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼›å„å®¹å™¨ä¹‹é—´é€šè¿‡ç½‘ç»œæ¥è¿›è¡Œé€šä¿¡ï¼Œç½‘ç»œæž„å»ºå®ŒæˆåŽè¿›è¡Œç›¸å…³çš„channelå’Œchanincodeæ“ä½œ;ç›®å‰ç”¨æœ‰äº”å°æœåŠ¡å™¨ï¼Œ æ‰€æœ‰çš„æœåŠ¡å™¨å‡æ˜¯æŒ‰ç…§ä¸Šè¿°e2e_cliçŽ¯å¢ƒä¸Žæµ‹è¯•æ­¥éª¤é…ç½®;è®¡åˆ’å…¶ä¸­çš„å››å°æœåŠ¡å™¨è¿è¡ŒpeerèŠ‚ç‚¹ï¼Œå¦å¤–ä¸€å°æœåŠ¡å™¨è¿è¡ŒordererèŠ‚ç‚¹;ä¸ºå…¶å®ƒå››ä¸ªèŠ‚ç‚¹æä¾›orderæœåŠ¡; åç§° ip èŠ‚ç‚¹æ ‡è¯† èŠ‚ç‚¹Hostname Organization Hyperledger 10.180.55.123 orderer orderer.example.com Orderer Fabric1 10.180.55.124 sp0 peer0.org1.example.com Org1 Fabric2 10.180.55.125 sp1 peer1.org1.example.com Org1 Fabric3 10.180.55.126 sp2 peer0.org2.example.com Org2 Fabric4 10.180.55.128 sp3 peer0.org3.example.com Org2 çŽ¯å¢ƒå¦‚ä¸‹ 4.2 ç”Ÿæˆå…¬ç§é’¥ã€è¯ä¹¦ã€åˆ›å·¨åŒºå—å…¬/ç§é’¥å’Œè¯ä¹¦æ˜¯ç”¨äºŽServerä¸ŽServerä¹‹é—´çš„å®‰å…¨é€šä¿¡;å¦å¤–è¦åˆ›å»ºchannelå¹¶è®©å…¶å®ƒèŠ‚ç‚¹åŠ å…¥channleå°±éœ€è¦åˆ›ä¸–åŒºå—;è¿™äº›å¿…è¦æ–‡ä»¶éƒ½å¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤ç”Ÿ,å¹¶ä¸”å®˜æ–¹å·²ç»ç»™å‡ºè„šæœ¬; è„šæœ¬åœ¨ä»¥ä¸‹ç›®å½•ä¸­; 12# cd /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/# ls generateArtifacts.sh ä½¿generateArtifacts.shç”Ÿæˆè¯ä¹¦å’Œconfig.txï¼Œå…·ä½“æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹; 1# bash generateArtifacts.sh mychannel è¿™é‡Œåˆ›å»ºäº†3å°æœåŠ¡å™¨ï¼Œåœ¨ä»»æ„ä¸€å°æœåŠ¡å™¨çš„è¯¥ç›®å½•ä¸‹æ‰§è¡Œæ­¤é¡¹å‘½ä»¤å³å¯ï¼›å°†ä¼šç”Ÿæˆä¸¤ä¸ªç›®å½•ï¼Œåˆ†åˆ«ä¸ºchannel-artifacsã€crypto-config 1234567channel-artifacts/â”œâ”€â”€ channel.txâ”œâ”€â”€ genesis.blockâ”œâ”€â”€ Org1MSPanchors.txâ””â”€â”€ Org2MSPanchors.tx0 directories, 4 files åœ¨ä¸Šè¿°ç›®å½•é‡Œçš„æ–‡ä»¶ç”¨äºŽordereråˆ›å»ºchannleï¼Œå®ƒä»¬æ ¹æ®configex.yamlçš„é…ç½®ç”Ÿæˆ; 12345crypto-configâ”œâ”€â”€ ordererOrganizationsâ””â”€â”€ peerOrganizations2 directories, 0 files åœ¨ä¸Šè¿°ç›®å½•é‡Œæœ‰ordererå’Œpeerçš„è¯ä¹¦ã€ç§é’¥å’Œç”¨äºŽé€šä¿¡çš„åŠ å¯†çš„tlsè¯ä¹¦æ–‡ä»¶;å®ƒé€šè¿‡configex.yamlé…ç½®æ–‡ä»¶ç”Ÿæˆ; 4.3 é…ç½®å¤šæœåŠ¡å™¨æ ¹æ®4.2çš„æ–¹æ¡ˆï¼Œä»¥åŠä¹‹å‰æ‰€è¿°çš„gopathç›®å½•ç­‰é…ç½®æ–¹æ¡ˆ;æˆ‘ä»¬å‡å®šæ‰€æœ‰çš„æœåŠ¡å™¨éƒ½æŒ‰ç…§è¯¥æ–‡æ¡£çš„é…ç½®æ¥æ“ä½œ;æ‰€æœ‰æœåŠ¡å™¨éƒ½æœ‰Fabricæºç ,ä¸”ç›®å½•ä¸º å¦‚4.2æ‰€è¿°,è¯¥å‘½ä»¤åªéœ€è¦åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€æ¬¡å³å¯ï¼Œå…¶å®ƒæœåŠ¡å™¨æ— éœ€å†æ¬¡è¿è¡Œ; åœ¨è¿è¡Œè¯¥å‘½ä»¤çš„æœåŠ¡å™¨/opt/gopath/src/github.com/hyperledger/fabric/example/e2e_cli;è¯¥ç›®å½•ä¸‹ä¼šç”Ÿæˆchannel-artifactså’Œcrypto-configç›®å½•;éœ€è¦æŠŠå®ƒä»¬æ‹·è´è‡³å…¶å®ƒæœåŠ¡å™¨ç›¸åŒçš„e2e_cliç›®å½•ä¸‹ï¼Œå¦‚æžœåœ¨å…¶å®ƒæœåŠ¡å™¨ä¸­å·²ç»åœ¨è¯¥ç›®å½•,åˆ™éœ€è¦å…ˆæŠŠå®ƒåˆ é™¤; å½“æ‰€æœ‰æœåŠ¡å™¨éƒ½æœ‰åŒä¸€ä¸ªchannel-artifactså’Œcrypto-configç›®å½•åŽ;å¼€å§‹é…ç½®composeæ–‡ä»¶; 1234567å¼€å§‹å‘å…¶å®ƒä¸¤ä¸ªæœåŠ¡å™¨åŒæ­¥ä»¥ä¸Šä¸¤ä¸ªç›®å½•;# cd /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/# tar -cvf ctfile.tar.gz channel-artifacts crypto-config# scp ctfile.tar.gz root@10.180.55.124:/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli# scp ctfile.tar.gz root@10.180.55.125:/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli# ssh root@10.180.55.124 &quot;cd /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli &amp;&amp; tar -xvf ctfile.tar.gz&quot;# ssh root@10.180.55.125 &quot;cd /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli &amp;&amp; tar -xvf ctfile.tar.gz&quot; 4.4 è®¾ç½®peer0.arg1.example.comèŠ‚ç‚¹çš„docker-composeæ–‡ä»¶ e2e_cliä¸­æä¾›äº†å¤šä¸ªyamlæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºŽdocker-compose-cli.yamlæ–‡ä»¶åˆ›å»º; ä¿®æ”¹docker-compose-peer.yamlï¼ŒåŽ»æŽ‰ordererçš„é…ç½®ï¼›åªä¿ç•™ä¸€ä¸ªpeerå’Œcliï¼Œå› ä¸ºéœ€è¦å¤šçº§éƒ¨ç½²ï¼ŒèŠ‚ç‚¹ä¸ŽèŠ‚ç‚¹ä¹‹é—´åˆæ˜¯é€šè¿‡ä¸»æœºåé€šè®¯;æ‰€ä»¥éœ€è¦ä¿®æ”¹å®¹å™¨ä¸­çš„hostæ–‡ä»¶,ä¹Ÿå°±æ˜¯xtra_hostsè®¾ç½®;ä¿®æ”¹åŽçš„peeré…ç½®å¦‚ä¸‹ï¼› åŒæ ·çš„,cliä¹Ÿéœ€è¦èƒ½å¤Ÿå’Œå„ä¸ªèŠ‚ç‚¹é€šè®¯ï¼Œæ‰€ä»¥cliä¸‹é¢ä¹Ÿéœ€è¦æ·»åŠ extra_hostsè®¾ç½®;åŽ»æŽ‰æ— æ•ˆçš„ä¾èµ–ï¼Œå¹¶ä¸”åŽ»æŽ‰commandè¿™ä¸€è¡Œï¼Œå› ä¸ºæ¯ä¸ªpeeréƒ½ä¼šæœ‰ä¸ªå¯¹åº”çš„å®¢æˆ·ç«¯;ä¹Ÿæ˜¯å°±æ˜¯cliï¼› æ‰€ä»¥åªéœ€è¦åŽ»æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œè€Œä¸æ˜¯è‡ªåŠ¨æ‰§è¡Œ; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152# cd base/# cp docker-compose-base.yaml&#123;,.bak&#125;# vim base/docker-compose-base.yaml# Copyright IBM Corp. All Rights Reserved.## SPDX-License-Identifier: Apache-2.0#version: '2'services: peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: base/docker-compose-base.yaml service: peer0.org1.example.com extra_hosts: - "orderer.example.com:10.180.55.123" cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org1.example.com extra_hosts: - "orderer.example.com:10.180.55.123" - "peer0.org1.example.com:10.180.55.124" - "peer1.org1.example.com:10.180.55.125" - "peer0.org2.example.com:10.180.55.126" - "peer1.org2.example.com:10.180.55.128" åœ¨3.2ç¤ºä¾‹å•æœºæ¨¡å¼ä¸‹ï¼Œ4ä¸ªpeeræ”¯æ˜ å°„ä¸»æœºä¸åŒçš„ç«¯å£;ä½†æ˜¯åœ¨å¤šæœºéƒ¨ç½²çš„æ—¶å€™ä¸éœ€è¦æ˜ å°„ä¸åŒç«¯å£çš„;æ‰€ä»¥éœ€è¦ä¿®æ”¹base/docker-compose-base.yamlæ–‡ä»¶ï¼Œå°†æ‰€æœ‰peerçš„ç«¯å£æ˜ å°„éƒ½æ”¹ä¸ºç›¸åŒçš„; 1234567# cd base/# cp docker-compose-base.yaml&#123;,.bak&#125;# vim base/docker-compose-base.yaml ports: - 7051:7051 - 7052:7052 - 7053:7053 4.5ã€ è®¾ç½®peer1.org1.example.comèŠ‚ç‚¹çš„docker-composeæ–‡ä»¶ä¸Žpeer0.org1.example.comèŠ‚ç‚¹composeæ–‡ä»¶é…ç½®ä¸€æ ·;ä¸è¿‡åŽ‹å²è¦å°†å¯åŠ¨çš„å®¹å™¨æ”¹ä¸ºpeer1.org1.example.com;å¹¶ä¸”æ·»åŠ peer0.org1.example.comçš„IPæ˜ å°„;å¯¹åº”çš„cliä¸­æ”¹æˆå¯¹peer1.org1.example.comçš„ä¾èµ–;ä¿®æ”¹å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354# cd /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/# cp docker-compose-cli.yaml docker-compose-peer.yaml# vim docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved.## SPDX-License-Identifier: Apache-2.0#version: '2'services: peer1.org1.example.com: container_name: peer1.org1.example.com extends: file: base/docker-compose-base.yaml service: peer1.org1.example.com extra_hosts: - "orderer.example.com:10.180.55.123" - "peer0.org1.example.com:10.180.55.124" cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer1.org1.example.com extra_hosts: - "orderer.example.com:10.180.55.123" - "peer0.org1.example.com:10.180.55.124" - "peer1.org1.example.com:10.180.55.125" - "peer0.org2.example.com:10.180.55.126" - "peer1.org2.example.com:10.180.55.128" 1234567# cd base/# cp docker-compose-base.yaml&#123;,.bak&#125;# vim base/docker-compose-base.yaml ports: - 7051:7051 - 7052:7052 - 7053:7053 org2çš„ä¸¤ä¸ªç»“ç‚¹é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950# cat docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved.## SPDX-License-Identifier: Apache-2.0#version: '2'services: peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: base/docker-compose-base.yaml service: peer0.org2.example.com extra_hosts: - "orderer.example.com:10.180.55.123" - "peer0.org1.example.com:10.180.55.124" cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org2.example.com extra_hosts: - "orderer.example.com:10.180.55.123" - "peer0.org1.example.com:10.180.55.124" - "peer1.org1.example.com:10.180.55.125" - "peer0.org2.example.com:10.180.55.126" - "peer1.org2.example.com:10.180.55.128" 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950# cat docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved.## SPDX-License-Identifier: Apache-2.0#version: '2'services: peer1.org2.example.com: container_name: peer1.org2.example.com extends: file: base/docker-compose-base.yaml service: peer1.org2.example.com extra_hosts: - "orderer.example.com:10.180.55.123" - "peer0.org1.example.com:10.180.55.124" cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer1.org2.example.com extra_hosts: - "orderer.example.com:10.180.55.123" - "peer0.org1.example.com:10.180.55.124" - "peer1.org1.example.com:10.180.55.125" - "peer0.org2.example.com:10.180.55.126" - "peer1.org2.example.com:10.180.55.128" 4.6 è®¾ç½®orderèŠ‚ç‚¹çš„docker-composeæ–‡ä»¶ä¸Žåˆ›å»ºpeerçš„é…ç½®æ–‡ä»¶ç±»ä¼¼ï¼Œéœ€è¦å¤åˆ¶ä¸€ä¸ªyamlæ–‡ä»¶å‡ºæ¥ä¿®æ”¹; 12# cd /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli# cp docker-compose-cli.yaml docker-compose-orderer.yaml ordereræœåŠ¡å™¨ä¸Šæˆ‘ä»¬åªéœ€è¦ä¿ç•™orderè®¾ç½®;å…¶ä»–peerå’Œcliè®¾ç½®éƒ½å¯ä»¥åˆ é™¤ã€‚orderå¯ä»¥ä¸è®¾ç½®extra_hosts; 12345orderer.example.com: extends: file: base/docker-compose-base.yaml service: orderer.example.com container_name: orderer.example.com 12#å¯åŠ¨æŠ¥é”™ï¼Œå•çº¯çš„æŠ¥å‘½ä»¤è°ƒç”¨ç”¨æ³•é”™è¯¯docker rm -f $(docker ps -aq) è‹¥éƒ¨ç½²çŽ¯å¢ƒåœ¨å†…ç½‘ï¼Œåˆ™éœ€è¦ä¿®æ”¹5å°æœåŠ¡å™¨çš„/etc/hostsæ–‡ä»¶;ç¡®ä¿æœåŠ¡å™¨ä¹‹é—´å¯ä»¥åŸºäºŽä¸»æœºåäº’ç›¸é€šä¿¡ï¼› 123456# vim /etc/hosts 10.180.55.123 orderer.example.com10.180.55.124 peer0.org1.example.com10.180.55.125 peer1.org1.example.com10.180.55.126 peer0.org2.example.com10.180.55.128 peer1.org2.example.com 5.å¯åŠ¨Fabricå¤šèŠ‚ç‚¹é›†ç¾¤5.1å¯åŠ¨orderereèŠ‚ç‚¹æœåŠ¡æ“ä½œå®ŒæˆåŽï¼Œæ­¤æ—¶èŠ‚ç‚¹çš„composeé…ç½®æ–‡ä»¶åŠè¯ä¹¦éš¾ç›®å½•éƒ½å·²ç»å‡†å¤‡å®Œæˆ;å¯ä»¥å¼€å§‹å°è¯•å¯åŠ¨å¤šæœºFabricé›†ç¾¤;é¦–å…ˆè¦å¯ordererèŠ‚ç‚¹ï¼Œåˆ‡æ¢è‡³orderer.example.comæœåŠ¡å™¨;å³å‰æ–‡æŒ‡å®šçš„10.180.55.123çš„æœåŠ¡å™¨ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›å…¥å¯dockerè¿›ç¨‹; 1# docker-compose -f docker-compose-orderer.yaml up -d è¿è¡Œå®Œæ¯•åŽæˆ‘ä»¬å¯ä»¥ä½¿ç”¨docker psçœ‹åˆ°è¿è¡Œäº†ä¸€ä¸ªåå­—ä¸ºorderer.example.comçš„èŠ‚ç‚¹; 123# docker psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMESf188590553b7 hyperledger/fabric-orderer &quot;orderer&quot; 25 seconds ago Up 22 seconds 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 5.2å¯åŠ¨peerèŠ‚ç‚¹æœåŠ¡åˆ‡æ¢åˆ°peer0.org1.example.comæœåŠ¡å™¨ï¼Œå³å‰æ–‡æŒ‡å®šçš„10.180.55.124æœåŠ¡å™¨;å¯åŠ¨æœ¬æœåŠ¡å™¨çš„peerèŠ‚ç‚¹å’Œcli; 1# docker-compose -f docker-compose-peer.yaml up -d 1234# docker psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES2f49281a48c9 hyperledger/fabric-tools &quot;/bin/bash&quot; 38 minutes ago Up 38 minutes cli8ef009a57457 hyperledger/fabric-peer &quot;peer node start&quot; 38 minutes ago Up 38 minutes 0.0.0.0:7051-7053-&gt;7051-7053/tcp peer0.org1.example.com æ³¨: å…¶å®ƒä¸‰ä¸ªpeerç»“ç‚¹ä¸Žä»¥ä¸Šç»“ç‚¹çš„å¯åŠ¨/éªŒè¯æ–¹å¼ç›¸åŒé‡åˆ°çš„å‘:åœ¨CentOSä¸­è¦æŠŠiptableså…³é—­;selinuxä¸ºå¼€æœºå…³é—­ç¡®ä¿5ä¸ªç»“ç‚¹é—´åŸŸåå’Œç«¯å£éƒ½èƒ½telnet é€š; ä¾‹telnet peer1.org2.example.com 7051; çŽ°åœ¨æ•´ä¸ªFabric4+1æœåŠ¡å™¨ç½‘ç»œå·²ç»æˆåž‹; 5.3åˆ›å»ºchannleå’Œè¿è¡Œchaincodeåˆ‡æ¢åˆ°peer0.org1.example.comæœåŠ¡å™¨ä¸Š;ä½¿ç”¨è¯¥æœåŠ¡å™¨çš„cliæ¥è¿è¡Œåˆ›å»ºChannelå’Œè¿è¡ŒChainCodeçš„æ“ä½œ; 1# docker exec -it cli bash è¿›å…¥å®¹å™¨åŽ 1root@078471f17d9a:/opt/gopath/src/github.com/hyperledger/fabric/peer# ./scripts/script.sh mychannel è¯¥è„šæœ¬ä¼šä¸€æ­¥æ­¥çš„å®Œæˆåˆ›å»ºé€šé“,å°†å…¶ä»–èŠ‚ç‚¹åŠ å…¥é€šé“ï¼Œæ›´æ–°é”šèŠ‚ç‚¹;åˆ›å»ºChainCodeï¼Œåˆå§‹åŒ–å¸æˆ·ï¼ŒæŸ¥è¯¢ï¼Œè½¬å¸ï¼Œå†æ¬¡æŸ¥è¯¢ç­‰é“¾ä¸Šæ“ä½œçš„è‡ªåŠ¨åŒ–; 12345678910112018-03-19 03:00:03.146 UTC [main] main -&gt; INFO 007 Exiting.....===================== Query on PEER3 on channel &apos;mychannel&apos; is successful ===================== ===================== All GOOD, End-2-End execution completed ===================== _____ _ _ ____ _____ ____ _____ | ____| | \ | | | _ \ | ____| |___ \ | ____|| _| | \| | | | | | _____ | _| __) | | _| | |___ | |\ | | |_| | |_____| | |___ / __/ | |___ |_____| |_| \_| |____/ |_____| |_____| |_____| å‡ºçŽ°ä»¥ä¸Šç»“æžœå‡ºæ˜Ž4+1çš„Fabricå¤šçº§éƒ¨ç½²å·²ç»æˆåŠŸ;åœ¨peer0.org1.example.comçš„cliå®¹å™¨å†…;ä¹‹å‰çš„2ä¸ªå®¹å™¨ï¼Œå·²ç»å› ChainCodeåˆ›å»ºäº†3ä¸ªå®¹å™¨; E2E è¿è¡ŒåŽæŸ¥è¯¢ä¸Žè½¬å¸æµ‹è¯•123# æŸ¥è¯¢# docker exec -it cli bashroot@078471f17d9a:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos; 12# è½¬å¸20åˆ°b# peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;20&quot;]&#125;&apos;]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonæ—¥å¸¸ç»ƒä¹ ]]></title>
    <url>%2F2018%2F07%2F19%2Fpython%20%E6%97%A5%E5%B8%B8%E7%BB%83%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[python æ—¥å¸¸ç»ƒä¹  è§£åŽ‹åºèµ‹å€¼ç»™å¤šä¸ªå˜é‡çŽ°æœ‰ä¸€ä¸ªåŒ…å«Nä¸ªå…ƒç´ çš„å…ƒç»„æˆ–è€…æ˜¯åºåˆ—ï¼Œå°†å®ƒé‡Œé¢çš„å€¼è§£åŽ‹åŽåŒæ—¶èµ‹å€¼ç»™Nä¸ªå˜é‡ 1234567891011121314151617181920212223242526272829303132In [22]: p = (1,2)In [23]: a,b = pIn [24]: aOut[24]: 1In [25]: bOut[25]: 2In [26]: date = [&apos;test&apos;,&apos;frum&apos;,&apos;bind&apos;,&apos;lance&apos;,(201,202,203)]In [27]: te,fr,bi,la,data = dateIn [28]: teOut[28]: &apos;test&apos;In [29]: frOut[29]: &apos;frum&apos;In [30]: biOut[30]: &apos;bind&apos;In [31]: dateOut[31]: [&apos;test&apos;, &apos;frum&apos;, &apos;bind&apos;, &apos;lance&apos;, (201, 202, 203)]In [32]: dataOut[32]: (201, 202, 203)In [41]: a = &apos;Hello&apos;In [42]: b,c,d,e,f = aIn [43]: bOut[43]: &apos;H&apos;In [44]: cOut[44]: &apos;e&apos;In [45]: dOut[45]: &apos;l&apos;In [46]: fOut[46]: &apos;o&apos; åˆçº§ç»ƒä¹ é¢˜ç»™ä¸€ä¸ªåŠå¾„ï¼Œæ±‚åœ†çš„é¢ç§¯å’Œå‘¨é•¿ã€‚åœ†å‘¨çŽ‡3.14123456789from math import pir=int(input(&apos;r=&apos;))print(&apos;area=&apos;+str(pi*r*r))print(&apos;circumference=&apos;+str(2*pi*r))(py3_env) kernel âž¤ python test.py r=10area=314.1592653589793circumference=62.83185307179586 è¾“å…¥ä¸¤ä¸ªæ•°ï¼Œæ¯”è¾ƒå¤§å°åŽï¼Œä»Žå°åˆ°å¤§å‡åºæ‰“å°123456789101112a = input(&apos;first: &apos;)b = input(&apos;second: &apos;)if a &gt; b: print(b,a)else: print(a,b)(py3_env) kernel âž¤ python test.py first: 10second: 1110 11 è¾“å…¥nä¸ªæ•°ï¼Œæ±‚æ¯æ¬¡è¾“å…¥åŽçš„ç®—æ•°å¹³å‡æ•°123456789101112n = 0sum = 0while True: i = input(&quot;&gt;&gt;&gt;&quot;) if i == &apos;quit&apos;: break n += 1 sum += int(i) avg = sum/n print(avg) æ‰“å°ä¹ä¹ä¹˜æ³•è¡¨123456789101112131415for i in range(1,10): for j in range(1,i+1): print(str(j)+&apos;x&apos;+ str(i) +&quot;=&quot; +str(i*j),end=&apos; &apos;)for i in range(1,10): for j in range(1,i+1): product = i*j if j &gt; 1 and product &lt;10: product = str(product) + &apos; &apos; else: product = str(product) print(str(j)+&apos;x&apos;+str(i)+&quot;=&quot;+str(product),end=&apos; &apos;) print() æ‰“å°è±å½¢1234567for i in range(-3,4): if i&lt;0: prespace = -i else: prespace = i print(&apos; &apos;*prespace + &apos;*&apos;*(7-prespace*2)) æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œ100ä»¥å†…123456789101112131415161718192021222324252627æ–æ³¢é‚£å¥‘æ•°åˆ—:1,1,2,3,5,8,13,21,34,55,89,144,...a = 0b = 1while True: c = a+b if c &gt; 100: break a=b b=c print(c)a = 1b = 1index = 2print(&apos;&#123;0&#125;,&#123;1&#125;&apos;.format(0,0))print(&apos;&#123;0&#125;,&#123;1&#125;&apos;.format(1,1))print(&apos;&#123;0&#125;,&#123;1&#125;&apos;.format(2,1))while True: c = a + b a = b b = c index +=1 print(&apos;&#123;0&#125;,&#123;1&#125;&apos;.format(index,c)) if index == 101: break pip ç®€å•ä½¿ç”¨123456789101112131415# é…ç½®å›½å†…çš„æº~ âž¤ cat ~/.pip/pip.conf[global]index-url=http://mirrors.aliyun.com/pypi/simpletrusted-host=mirrors.aliyun.com# pip å¸¸ç”¨å‘½ä»¤# pip install xxx yyy# pip list # pip search keyword æˆ–è€… pypi# pip help install # pip install jupyter # pip -V # pip freeze &gt; requirement# pip install -r requirement# virtualenv ~/Desktop/MyPython/py3_env --python=python3 çŒœæ•°å­—çš„æ¸¸æˆ12345678910111213141516NUM = 35count = 0while count &lt; 3: user_input = int(input(&apos;è¯·ä½ è¾“å…¥ä¸€ä¸ªæ•°å­—: &apos;)) if user_input == NUM : print(&apos;ä½ çŒœå¯¹äº†&apos;) break elif user_input &lt; NUM: print(&apos;ä½ è¾“å…¥çš„æ•°æ¯”è¿™ä¸ªæ•°è¦å°&apos;) else: print(&apos;ä½ è¾“å…¥çš„æ•°æ¯”è¿™ä¸ªè¦å¤§&apos;) count +=1else: print(&apos;ä½ å·²ç»è¶…è¿‡äº†ä¸‰æ¬¡æœºä¼š&apos;) ä¸ç”¨å˜é‡æ—¶ï¼ŒæŠŠå˜é‡æ”¾ç©º 123456789101112for _ in range(0,3): user_input = int(input(&apos;è¯·ä½ è¾“å…¥ä¸€ä¸ªæ•°å­—: &apos;)) if user_input == NUM : print(&apos;ä½ çŒœå¯¹äº†&apos;) break elif user_input &lt; NUM: print(&apos;ä½ è¾“å…¥çš„æ•°æ¯”è¿™ä¸ªæ•°è¦å°&apos;) else: print(&apos;ä½ è¾“å…¥çš„æ•°æ¯”è¿™ä¸ªè¦å¤§&apos;) count +=1else: print(&apos;ä½ å·²ç»è¶…è¿‡äº†ä¸‰æ¬¡æœºä¼š&apos;) æ‰“å°æ‰¬è¾‰ä¸‰è§’python ä¸­æ±‚é˜¶ä¹˜çš„æ–¹æ³• 12import math math.factorial(5) # 5 çš„é˜¶ä¹˜ 1234567891011121314151617import mathlines = 10for n in range(0,lines): if n == 0: for _ in range(0, lines // 2): print(&apos; &apos;,end=&apos; &apos;) print(1) else: for _ in range(0,lines //2): print(&apos; &apos;,end=&apos; &apos;) for m in range(0, n+1): num = math.factorial(n) //(math.factorial(m) * math.factorial(n-m)) print(num, end=&apos; &apos;) print() 1234567host = &#123;&quot;host%d&quot;%i: &quot;192.168.1.%d&quot;%i for i in range(2,11)&#125;for i in host.values(): print (i) lst = list(range(1,101))lst[0::2] [::-1]lst[1::2] [::-1] python ä¸Žç”¨æˆ·äº¤äº’è¾“å…¥ä½æ•°ç”Ÿæˆè‹¥å¹²éšæœºæ•°ï¼Œæ±‚è‹¥å¹²éšæœºæ•°çš„æœ€å¤§å€¼ï¼Œæœ€å°å€¼12345678910111213141516#!/usr/bin/env python3from fabric.colors import red,blue,green,cyanimport randoma=int(input(red(&apos;æ‚¨è¦èŽ·å–å¤šå°‘ä¸ªéšæœºæ•°: &apos;)))b=int(input(red(&apos;æ‚¨è¦èŽ·å–çš„éšæœºæ•°ä½æ•°: &apos;))) + 1num_two = []for i in range(int(a)): num = random.randrange(0,b) print(cyan(&apos;ç¬¬&apos;) + blue(i + 1) + cyan(&apos;ä¸ªéšæœºæ•°ä¸º&apos;),blue(num)) num_two.append(num)print(cyan(&apos;æ‚¨èŽ·å–äº†&apos;) + blue(i + 1) + cyan(&apos;ä¸ªéšæœºæ•°&apos;))print(cyan(&apos;æ‚¨çš„ç¬¬&apos;) + blue(num_two.index(max(num_two)) +1 ) + cyan(&apos;ä¸ªéšæœºæ•°ä¸ºæœ€å¤§å€¼:&apos;), green(max(num_two)))print(cyan(&apos;æ‚¨çš„ç¬¬&apos;) + blue(num_two.index(min(num_two)) +1 ) + cyan(&apos;ä¸ªéšæœºæ•°ä¸ºæœ€å°å€¼:&apos;), green(min(num_two))) æ–¹æ³•äºŒ 123456789101112131415161718#!/usr/bin/env python3# -*- coding: utf-8 -*-from fabric.colors import red,blue,green,cyanimport randoma=int(input(red(&apos;æ‚¨è¦èŽ·å–å¤šå°‘ä¸ªéšæœºæ•°: &apos;)))b=int(input(red(&apos;æ‚¨è¦ç²å–çš„éš¨æ©Ÿæ•¸ç¯„åœ: &apos;))) + 1range_init = list(range(1,int(a)+1))print (range_init)num_two = []for i in range_init: num = random.randrange(0,b) num = random.randrange(0,b) print(cyan(&apos;ç¬¬&apos;) + blue(i) + cyan(&apos;ä¸ªéšæœºæ•°ä¸º&apos;),blue(num)) num_two.append(num)print(cyan(&apos;æ‚¨èŽ·å–äº†&apos;) + blue(i) + cyan(&apos;ä¸ªéšæœºæ•°&apos;))print(cyan(&apos;æ‚¨çš„ç¬¬&apos;) + blue(num_two.index(max(num_two))+1) + cyan(&apos;ä¸ªéšæœºæ•°ä¸ºæœ€å¤§å€¼:&apos;), green(max(num_two)))print(cyan(&apos;æ‚¨çš„ç¬¬&apos;) + blue(num_two.index(min(num_two))+1) + cyan(&apos;ä¸ªéšæœºæ•°ä¸ºæœ€å°å€¼:&apos;), green(min(num_two)))]]></content>
      <tags>
        <tag>linux</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[awk çš„ç»ƒä¹ ]]></title>
    <url>%2F2018%2F06%2F18%2Fawk%E7%9A%84%E7%BB%83%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[awkæ¯æ—¥ç»ƒ å…ˆç†Ÿç»ƒä¸€äº›æ“ä½œ1ã€ ä»¥ç©ºæ ¼åšä¸ºåˆ†æ ¼ç¬¦ï¼Œæ‰“å°passwd æ–‡ä»¶çš„ç¬¬ä¸€åˆ—1# awk &apos;&#123;print $1&#125;&apos; /etc/passwd 2ã€ ä»¥å†’å·åšåˆ†æ ¼ç¬¦ï¼Œæ‰“å°passwd æ–‡ä»¶çš„ç¬¬ä¸€åˆ—,å³èŽ·å–å½“å‰ç³»ç»Ÿä¸­å­˜åœ¨çš„æ‰€æœ‰ç”¨æˆ·1# awk -F: &apos;&#123;print $1&#125;&apos; /etc/passwd 3ã€ ä»¥ç®¡é“æ–¹å¼ï¼Œæ‰“å°passwd æ–‡ä»¶çš„ç¬¬ä¸‰åˆ—ï¼Œå³å…±èŽ·å–å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„idå·1# cat /etc/passwd | awk -F : &apos;&#123;print $3&#125;&apos; 4ã€ ä»¥è¾“å…¥é‡å®šå‘æ–¹å¼ï¼Œæ‰“å° passwd æ–‡ä»¶çš„ç¬¬1åˆ—ï¼Œå³èŽ·å–å½“å‰ç³»ç»Ÿä¸­å­˜åœ¨çš„æ‰€æœ‰ç”¨æˆ·1# awk -F: &apos;&#123;print $1&#125;&apos; &lt; /etc/passwd 5ã€ç”¨awk è‡ªå¸¦BEGINæ‰“å° hello awk å­—ç¬¦ä¸²1# awk &apos;BEGIN&#123;print &quot;hello awk&quot;&#125;&apos; æ‰§è¡ŒåªåŠžè¾“å‡ºhello awk 6ã€ ç”¨awk èŽ·å–df å‘½ä»¤çš„filesystem ä¸Žuserd %12345678910111213141516171819202122232425# df | awk &apos;&#123;print $1,$5&#125;&apos; # df | awk &apos;&#123;print $1 $5&#125;&apos; # æ³¨æ„è¿™æ ·è¾“å‡ºä¿¡æ¯å°±è¿žæŽ¥åˆ°ä¸€å—äº† FilesystemUse% /dev/vda113% devtmpfs0% tmpfs0% tmpfs1% tmpfs0% tmpfs0%# df | awk &apos;&#123;print $1&quot;===&quot;$5&#125;&apos; # åœ¨ä¸¤ä¸ªä½ç½®å˜é‡çš„ä¸­é—´åŠ å…¥ä¸‰ä¸ª=== å· Filesystem===Use% /dev/vda1===13% devtmpfs===0% tmpfs===0% tmpfs===1% tmpfs===0% tmpfs===0% # df | awk &apos;&#123;print $1&quot;\t&quot;$5&#125;&apos; # åœ¨ä¸¤ä¸ªä½ç½®å˜é‡çš„ä¸­é—´åŠ å…¥ä¸€ä¸ªtab é”® Filesystem Use% /dev/vda1 13% devtmpfs 0% tmpfs 0% tmpfs 1% tmpfs 0% tmpfs 0% 7ã€ ç»“åˆtail å‘½ä»¤æ¥è¿›è¡Œå­—ç¬¦ä¸²åˆ‡å‰²1# tail -4 /etc/fstab | awk &apos;&#123;print $3,$4&#125;&apos; 8ã€ æ‰‹åŠ¨æŒ‡å®šåˆ†éš”ç¬¦ä¸º: ï¼Œæ‰“å°ç¬¬ä¸€åˆ—:ç¬¬ä¸‰åˆ—ï¼ŒFS å³æŒ‡å®šåˆ†éš”ç¬¦1# awk -v FS=&quot;:&quot; &apos;&#123;print $1,FS,$3&#125;&apos; /etc/passwd 9ã€å°†åˆ—å‡ºåˆ†ç¬¦ï¼Œæ”¹ä¸ºå…¶å®ƒçš„å­—ç¬¦1# awk -v FS=&quot;:&quot; -v OFS=&quot;uid is &quot; &apos;&#123;print $1,FS,$3&#125;&apos; /etc/passwd 10 ã€ä»¥ç©ºæ ¼åšä¸ºæ¢è¡Œç¬¦ï¼Œå–å…¶ç¬¬ä¸€ä¸ªå­—æ®µ1# awk -v RS=&quot; &quot; &apos;&#123;print $1&#125;&apos; text.txt 11ã€ å°†è®°å½•è¾“å‡ºåˆ†éš”ç¬¦é»˜è®¤å€¼â€\nâ€ï¼Œæ¢æˆâ€===â€1# awk -v FS=&quot;:&quot; -v ORS&quot;===&quot; &apos;&#123;print $1&#125;&apos; /etc/passwd 12ã€ æˆªå–/etc/passwd çš„ç™»å½•shell1# awk -v FS=&quot;:&quot; &apos;&#123;print $NF-1&#125;&apos; /etc/passwd 13ã€ æˆªå– /etc/passwd çš„å®¶ç›®å½•1# awk -v FS=&quot;:&quot; &apos;&#123;print $(NF-1)&#125;&apos; /etc/passwd 14ã€æˆªå–æŒ‡å®šå­—æ®µå¹¶æ‰“å°awk å†…ç½®å˜é‡1# awk -v RS=&quot;:&quot; &apos;&#123;print RS,NR,$0&#125;&apos; /etc/passwd 15ã€ ä»¥å†’å·åˆ†éš”è®°å½•å½“å‰å­—æ®µä¸ªæ•°å¹¶è¿›è¡Œè®¡ç®—1# awk -v FS=&quot;:&quot; &apos;&#123;print NF*5&#125;&apos; /etc/passwd 16ã€ç»Ÿè®¡å½“å‰è¾“å…¥æ–‡ä»¶çš„ä¸ªæ•°1# awk -F: &apos;&#123;print FNR&#125;&apos; /etc/passwd /etc/shadow 17ã€ æ‰“å°ä¸¤æ–‡ä»¶è¾“å‡ºçš„è¡Œæ•°1# awk -F: &apos;&#123;print FNR,$1&#125;&apos; /etc/passwd /etc/shadow 18ã€è¾“å‡ºä¸¤æ–‡ä»¶çš„æ–‡ä»¶åè¡Œå·åŠå¯¹åº”ç”¨çš„ç”¨æˆ·å1# awk -F: &apos;&#123;print FILENAME,FNR,$1&#125;&apos; /etc/passwd /etc/shadow 19ã€ ç»Ÿè®¡å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°12# awk -F: &apos;BEGIN&#123;print ARGC&#125;&apos; /etc/passwd /etc/group 3 20ã€ æ‰“å°å‘½ä»¤è¡Œå‚æ•°çš„å†…å®¹12# awk -F: &apos;BEGIN&#123;print ARGV[2]&#125;&apos; /etc/passwd /etc/group /etc/group awkå˜é‡ è‡ªå®šä¹‰å˜é‡åŒºåˆ†å¤§å°å†™ 21ã€ æŒ‡å®šå˜é‡è°ƒç”¨æ‰“å°1# awk -F: -v name=&quot;username&quot; &apos;&#123;print name&quot;:&quot;$1&#125;&apos; /etc/passwd 22 ã€ æŒ‡å®šå¤šä¸ªå˜é‡è°ƒç”¨æ‰“å°ï¼Œå¹¶åŠ å…¥åˆ¶è¡¨ç¬¦12# awk -F: -v name=&quot;username&quot; -v uid=&quot;uid &quot; &apos;&#123;print name&quot;:&quot;$1&quot;\t&quot;uid&quot;:&quot;$3&#125;&apos; /etc/passwd# awk -F: &apos;&#123;n=&quot;username&quot;;uid=&quot;userid&quot;; print n &quot;:&quot;$1&quot;\t&quot;uid&quot;:&quot;$3&#125;&apos; /etc/passwd äº†è§£ä¸€ä¸‹ä»¥ä¸‹çš„ç»ƒä¹ awk -F: â€˜{n=â€hahaâ€; print n,m;m=â€xixiâ€}â€™ /etc/passwd å˜é‡åŽå®šä¹‰ä¹Ÿè¡Œï¼ˆè¡¨é¢ä¸Šå¯ç”¨ï¼Œä½†å®žé™…ä¸Šæœ‰é—®é¢˜ï¼šç¬¬ä¸€æ¬¡å¾ªçŽ¯ï¼‰awk -F: â€˜BEGIN{n=â€hahaâ€;hehe=100;m=200;print n,m}â€™ /etc/passwd 23ã€ printf æŒ‡å®šè¾“å‡ºæ ¼å¼1234567# awk -F: &apos;&#123;printf &quot;%s == %d\n&quot;,$1,$3&#125;&apos; /etc/passwd %æ ¼å¼ä¸Ž$å­—ç¬¦å¿…é¡»ä¸€ä¸€å¯¹åº”# awk -F: &apos;&#123;printf &quot;%s20s == %d\n&quot;,$1,$3&#125;&apos; /etc/passwd å³å¯¹é½# awk -F: &apos;&#123;printf &quot;%s-20s == %d\n&quot;,$1,$3&#125;&apos; /etc/passwd å·¦å¯¹é½# awk -F: &apos;&#123;printf &quot;%s-20s == %10.3f\n&quot;,$1,$3&#125;&apos; /etc/passwd å°æ•°ä½çš„å®½åº¦# awk -F: &apos;&#123;printf &quot;%s-20s == %+df\n&quot;,$1,$3&#125;&apos; /etc/passwd# awk -F : &apos;&#123;printf &quot;%s\n&quot;,$1&#125;&apos; /etc/passwd # awk -F : &apos;&#123;printf &quot;Username: %s\n&quot;,$1&#125;&apos; /etc/passwd 24ã€awk æ•°æœ¯è¿ç®—æ“ä½œ1234567891011# awk &apos;BEGIN&#123;print 2^10&#125;&apos;# awk &apos;BEGIN&#123;n=1;m=2;print m+=n&#125;&apos; # awk &apos;BEGIN&#123;n=1;m=2;print m++;print m&#125;&apos; # awk &apos;BEGIN&#123;n=1;m=2;print ++m;print m&#125;&apos; # awk -F: &apos;$3 &gt; 1000&#123;print $1,$3&#125;&apos; /etc/passwd # awk -F: &apos;$3==0&#123;print $1,$3&#125;&apos; /etc/passwd # awk -F: &apos;$0~&quot;root&quot;&#123;print $1,$3&#125;&apos; /etc/passwd ~åŒ…æ¶µ# awk -F: &apos;$0~/root/&#123;print $0&#125;&apos; /etc/passwd # awk -F: &apos;$0~/^root/&#123;print $0&#125;&apos; /etc/passwd # awk -F: &apos;$0 !~/^root/&#123;print $0&#125;&apos; /etc/passwd # awk -F : &apos;$0 ~ /root/&apos; /etc/passwd 25ã€æ“ä½œç¬¦ &amp;&amp; ä¸¤éƒ½æ‰§è¡Œ ||123# awk -F: &apos;$3==0 || $3 &gt;=1000 &#123;print $1&#125;&apos; /etc/passwd # awk -F: !(&apos;$3==0 || $3 &gt;=1000) &#123;print $1&#125;&apos; /etc/passwd or # awk -F : &apos;$3&gt;1 &amp;&amp; $3 &lt;1000 &#123;print $1&#125;&apos; /etc/passwd 26ã€æ¡ä»¶è¡¨è¾¾å¼ä¸‰ç›®1# awk -F: &apos;$3&lt;1000?var=&quot;sysuser&quot;: var=&quot;commonuser&quot;&#123;print var&quot;:&quot;$1,$3&#125;&apos; /etc/passwd 27ã€å¸¸ç”¨è¯­æ³•ç»ƒä¹ 12345678910111213141516# awk -F: &apos;&#123;print $1&#125;&apos; /etc/passwd # awk -F: &apos;/^root/&#123;print $0&#125;&apos; /etc/passwd # awk &apos;/^U/&#123;print $1&#125;&apos; /etc/fstab # awk &apos;!/^U/&#123;print $1&#125;&apos; /etc/fstab # awk &apos;&quot; &quot;&#123;print $0&#125;&apos; /etc/fstab # awk &apos;i=1;j=1&#123;print i,j&#125;&apos; /etc/fstab æŠŠæ–‡ä»¶æ‰“å°ä¸¤æ¬¡# awk â€˜i=1;j=0&#123;print i,j&#125;â€™ /etc/fstab # awk &apos;i=1;j=1&#123;print i,j&#125;&apos; /etc/fstab # awk &apos;!2&apos; /etc/fstab # awk &apos;&quot;abc&quot;&apos; /etc/fstab # awk -F: &apos;$NF==&quot;/bin/bash&quot;&apos; /etc/passwd # awk -F: &apos;$NF~&quot;/bin/bash&quot; /etc/passwd # awk -F: &apos;$NF!~&quot;/bin/bash&quot; /etc/passwd # awk -F: &apos;/^root/,/^ftp/&apos; /etc/passwd # awk -F: &apos;/^root\&gt;/,/^ftp/&apos; /etc/passwd æ³¨ï¼š\b ä¸è¡Œ# awk -F: &apos;NR&gt;=10&amp;&amp;NR&lt;=30&#123;print NR&#125;&apos; /etc/passwd 28ã€æ¯”è¾ƒç»•çš„ç»ƒä¹ 123456789# awk -F: &apos;NR&gt;=10&amp;&amp;NR&lt;=30&#123;print NR,$0&#125;&apos; /etc/passswd # awk -F: &apos;BEGIN&#123;print &quot;linenumber usernmae&quot;&#125;NR&gt;=10&amp;&amp;NR&lt;=30&#123;print NR,$1&#125;&apos; /etc/passwd # awk -F: &apos;BEGIN&#123;print &quot;linenumber username&quot;&#125;NR&gt;=10&amp;&amp;NR&lt;=30&#123;print NR,$1&#125; END print &quot;end&quot;&#125;&apos; /etc/passwd # awk -F: &apos;&#123;print &quot;linenumber username&quot;;print NR,$1&#125;END&#123;print &quot;end&quot;&#125;&apos; /etc/passwd# awk -F: &apos;&#123;print &quot;linenumber username\n-------------&quot;;print $1&#125;END&#123;print &quot;end&quot;&#125;&apos; /etc/passwd # seq 10 | awk &apos;&#123;i=!i;print i&#125;&apos;# seq 10 | awk &apos;i=!i&apos;# seq 10 | awk &apos;!(i=!i)&apos;# seq 10 | awk -v -i=1 &apos;i=!i&apos; 29ã€å¸¸è§å¾ªçŽ¯ä¸Žç”¨æ³•12345678910111213141516# awk &apos;BEGIN&#123;for(i=1;i&lt;=100;i++)sum+=i;print sum&#125;&apos;# echo &#123;1..100&#125;|sed &apos;s/ /+/g&apos;|bc# echo &#123;1..100&#125;| tr &quot; &quot; &quot;+&quot; |bc #!/bin/bashnum=0for i in `seq 100`; do num=$[$num+$i] echo $idoneecho $num#!/usr/bin/env python2.7num=0for i in range(1,101): print i num = num + iprint num AWK åŸºç¡€ awkï¼šAho, Weinberger, Kernighanï¼ŒæŠ¥å‘Šç”Ÿæˆå™¨ï¼Œæ ¼å¼åŒ–æ–‡æœ¬è¾“å‡º æœ‰å¤šç§ç‰ˆæœ¬ï¼šNew awkï¼ˆnawkï¼‰,GNU awkï¼ˆgawkï¼‰ gawkï¼šæ¨¡å¼æ‰«æå’Œå¤„ç†è¯­è¨€ åŸºæœ¬ç”¨æ³•123# awk [options] &apos;program&apos; var=value fileâ€¦# awk [options] -f programfile var=value fileâ€¦# awk [options] &apos;BEGIN&#123; action;â€¦ &#125; pattern&#123; action;â€¦ &#125; END&#123; action;â€¦ &#125;&apos; file ... awkç¨‹åºé€šå¸¸ç”±ï¼šBEGINè¯­å¥å—ã€èƒ½å¤Ÿä½¿ç”¨æ¨¡å¼åŒ¹é…çš„é€šç”¨è¯­å¥å—ã€ENDè¯­å¥å—ï¼Œå…±3éƒ¨åˆ†ç»„æˆ programé€šå¸¸æ˜¯è¢«å•å¼•å·æˆ–åŒå¼•å·ä¸­ é€‰é¡¹ï¼š -F:æŒ‡æ˜Žè¾“å…¥æ—¶ç”¨åˆ°çš„å­—æ®µåˆ†éš”ç¬¦ -v var=value:è‡ªå®šä¹‰å˜é‡ awkè¯­è¨€ åŸºæœ¬æ ¼å¼ï¼šawk [options] â€˜programâ€™ fileâ€¦ program:pattern{action statements;..} patternå’Œactionï¼špatternéƒ¨åˆ†å†³å®šåŠ¨ä½œè¯­å¥ä½•æ—¶è§¦å‘åŠè§¦å‘äº‹ä»¶BEGIN,END action statements å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæ”¾åœ¨{}å†…æŒ‡æ˜Žprint, printf åˆ†å‰²ç¬¦ã€åŸŸå’Œè®°å½• awkæ‰§è¡Œæ—¶ï¼Œç”±åˆ†éš”ç¬¦åˆ†éš”çš„å­—æ®µï¼ˆåŸŸï¼‰æ ‡è®°$1,$2..$nç§°ä¸ºåŸŸæ ‡è¯†ã€‚$0ä¸ºæ‰€æœ‰åŸŸï¼Œæ³¨æ„ï¼šå’Œshellä¸­å˜é‡$ç¬¦å«ä¹‰ä¸åŒ æ–‡ä»¶çš„æ¯ä¸€è¡Œç§°ä¸ºè®°å½• çœç•¥actionè¡Œï¼Œåˆ™é»˜è®¤æ‰§è¡Œprint $0çš„æ“ä½œ awkå·¥ä½œåŽŸç†ç¬¬ä¸€æ­¥ï¼šæ‰§è¡ŒBEGIN{action;â€¦ } è¯­å¥å—ä¸­çš„è¯­å¥ç¬¬äºŒæ­¥ï¼šä»Žæ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥(stdin)è¯»å–ä¸€è¡Œï¼Œç„¶åŽæ‰§è¡Œpattern{ action;â€¦ } è¯­å¥å—ï¼Œå®ƒé€è¡Œæ‰«ææ–‡ä»¶ï¼Œä»Žç¬¬ä¸€è¡Œåˆ°æœ€åŽä¸€è¡Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ–‡ä»¶å…¨éƒ¨è¢«è¯»å–å®Œæ¯•ã€‚ ç¬¬ä¸‰æ­¥ï¼šå½“è¯»è‡³è¾“å…¥æµæœ«å°¾æ—¶ï¼Œæ‰§è¡ŒEND{action;â€¦}è¯­å¥å— BEGINè¯­å¥å—åœ¨awkå¼€å§‹ä»Žè¾“å…¥æµä¸­è¯»å–è¡Œä¹‹å‰è¢«æ‰§è¡Œï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„è¯­å¥å—ï¼Œæ¯”å¦‚å˜é‡åˆå§‹åŒ–ã€æ‰“å°è¾“å‡ºè¡¨æ ¼çš„è¡¨å¤´ç­‰è¯­å¥é€šå¸¸å¯ä»¥å†™åœ¨BEGINè¯­å¥å—ä¸­ ENDè¯­å¥å—åœ¨awkä»Žè¾“å…¥æµä¸­è¯»å–å®Œæ‰€æœ‰çš„è¡Œä¹‹åŽå³è¢«æ‰§è¡Œï¼Œæ¯”å¦‚æ‰“å°æ‰€æœ‰è¡Œçš„åˆ†æžç»“æžœè¿™ç±»ä¿¡æ¯æ±‡æ€»éƒ½æ˜¯åœ¨ENDè¯­å¥å—ä¸­å®Œæˆï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰è¯­å¥å— patternè¯­å¥å—ä¸­çš„é€šç”¨å‘½ä»¤æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯å¯é€‰çš„ã€‚å¦‚æžœæ²¡æœ‰æä¾›patternè¯­å¥å—ï¼Œåˆ™é»˜è®¤æ‰§è¡Œ{ print }ï¼Œå³æ‰“å°æ¯ä¸€ä¸ªè¯»å–åˆ°çš„è¡Œï¼Œawkè¯»å–çš„æ¯ä¸€è¡Œéƒ½ä¼šæ‰§è¡Œè¯¥è¯­å¥å— awk æ ¼å¼ è¦ç‚¹ï¼š (1)é€—å·åˆ†éš”ç¬¦ (2)è¾“å‡ºçš„å„itemå¯ä»¥å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°å€¼ï¼›å½“å‰è®°å½•çš„å­—æ®µã€å˜é‡æˆ–awkçš„è¡¨è¾¾å¼ (3)å¦‚çœç•¥itemï¼Œç›¸å½“äºŽprint $0 ç¤ºä¾‹: 1234567# awk &apos;&#123;print &quot;hello,awk&quot;&#125;&apos;# awk -F: &apos;&#123;print&#125;&apos; /etc/passwd# awk -F: &apos;&#123;print &quot;wang&quot;&#125;&apos; /etc/passwd# awk -F: &apos;&#123;print $1&#125;&apos; /etc/passwd# awk -F: &apos;&#123;print $0&#125;&apos; /etc/passwd# awk -F: &apos;&#123;print $1&quot;\t&quot;$3&#125;&apos; /etc/passwd# tail -3 /etc/fstab |awk &apos;&#123;print $2,$4&#125;&apos; awk å˜é‡ å˜é‡ï¼šå†…ç½®å’Œè‡ªå®šä¹‰å˜é‡ æ¨¡å¼ ä¾‹å­ åŒ¹é… BEGIN BEGIN è¾“å…¥è¢«è¯»å–ä¹‹å‰ END END æ‰€æœ‰è¾“å…¥è¢«è¯»å–ä¹‹åŽ expression $3&gt;100 ç¬¬ä¸‰ä¸ªå­—æ®µå¤§äºŽ100 string-matching /Asia/ å«æœ‰Asiaçš„è¡Œ compound \$3&lt;100 &amp;&amp; $4 ==â€Asiaâ€ ç¬¬ä¸‰ä¸ªå­—æ®µå°äºŽ100ä¸”ç¬¬å››ä¸ªå­—æ®µå«æœ‰Asiaçš„è¡Œ range NR == 10,NR==20 è¾“å…¥çš„ç¬¬10è¡Œåˆ°20è¡Œ å˜é‡ æ„ä¹‰ é»˜è®¤å€¼ FS æŽ§åˆ¶è¾“å…¥è¡Œçš„å­—æ®µåˆ†éš”ç¬¦ â€œ â€œ OFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ â€œ â€œ RS æŽ§åˆ¶ç€è¾“å…¥è¡Œçš„è®°å½•åˆ†éš”ç¬¦ â€œ\nâ€ NF å½“å‰è®°å½•çš„å­—æ®µä¸ªæ•° - NR åˆ°ç›®å‰ä¸ºæ­¢è¯»çš„è®°å½•æ•°é‡ - FNR å½“å‰è¾“å…¥æ–‡ä»¶çš„è®°å½•ä¸ªæ•° - ARGC å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•° - ARGV å‘½ä»¤è¡Œå‚æ•°æ•°ç»„ - FILENAME å½“å‰è¾“å…¥æ–‡ä»¶å - OFMT æ•°å€¼çš„è¾“å‡ºæ ¼å¼ â€œ%.6gâ€ RLENGTE è¢«å‡½æ•°matchåŒ¹é…çš„å­—ç¬¦ä¸²çš„é•¿åº¦ - RSTART è¢«å‡½æ•°matchåŒ¹é…çš„å­—ç¬¦ä¸²çš„å¼€å§‹ - SUBSEP ä¸‹æ ‡åˆ†éš”ç¬¦ â€œ\034â€ FSï¼šè¾“å…¥å­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºç™½å­—ç¬¦ 123# awk -v FS=&apos;:&apos; &apos;&#123;print $1,FS,$3&#125;&apos; /etc/passwd# awk -F: &apos;&#123;print $1,$3,$7&#125;&apos; /etc/passwd# s=:;awk -v FS=$s &apos;&#123;print $1 FS $3&#125;&apos; /etc/passwd OFSï¼šè¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºç™½å­—ç¬¦ 1# awk -v FS=&apos;:&apos; -v OFS=&apos;:&apos; &apos;&#123;print $1,$3,$7&#125;&apos; /etc/passwd RSï¼šè¾“å…¥è®°å½•åˆ†éš”ç¬¦ï¼ŒæŒ‡å®šè¾“å…¥æ—¶çš„æ¢è¡Œç¬¦ï¼ŒåŽŸæ¢è¡Œç¬¦ä»æœ‰æ•ˆ 1# awk -v RS=&apos; &apos; &apos;&#123;print &#125;&apos; /etc/passwd ORSï¼šè¾“å‡ºè®°å½•åˆ†éš”ç¬¦ï¼Œè¾“å‡ºæ—¶ç”¨æŒ‡å®šç¬¦å·ä»£æ›¿æ¢è¡Œç¬¦ 1# awk -v RS=&apos; &apos; -v ORS=&apos;###&apos;â€˜&#123;print&#125;â€™ /etc/passwd NFï¼šå­—æ®µæ•°é‡ 12# awk -F:&apos;&#123;print NF&#125;&apos; /etc/fstab, å¼•ç”¨å†…ç½®å˜é‡ä¸ç”¨$# awk -F: &apos;&#123;print $(NF-1)&#125;&apos; /etc/passwd NRï¼šè¡Œå· 1# awk &apos;&#123;print NR&#125;&apos; /etc/fstab; awk END&apos;&#123;print NR&#125;&apos; /etc/fstab FNRï¼šå„æ–‡ä»¶åˆ†åˆ«è®¡æ•°, è¡Œå· 1# awk &apos;&#123;print FNR&#125;&apos; /etc/fstab /etc/inittab FILENAMEï¼šå½“å‰æ–‡ä»¶å 1# awk &apos;&#123;print FILENAME&#125;&apos; /etc/fstab ARGCï¼šå‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•° 12# awk &apos;&#123;print ARGC&#125;&apos; /etc/fstab /etc/inittab# awk &apos;BEGIN &#123;print ARGC&#125;&apos; /etc/fstab /etc/inittab ARGVï¼šæ•°ç»„ï¼Œä¿å­˜çš„æ˜¯å‘½ä»¤è¡Œæ‰€ç»™å®šçš„å„å‚æ•° 12# awk &apos;BEGIN &#123;print ARGV[0]&#125;&apos; /etc/fstab /etc/inittab# awk &apos;BEGIN &#123;print ARGV[1]&#125;&apos; /etc/fstab /etc/inittab è‡ªå®šä¹‰å˜é‡(åŒºåˆ†å­—ç¬¦å¤§å°å†™) (1) -v var=value (2) åœ¨programä¸­ç›´æŽ¥å®šä¹‰ ç¤ºä¾‹: 1234567# awk -v test=&apos;hello gawk&apos; &apos;&#123;print test&#125;&apos; /etc/fstab# awk -v test=&apos;hello gawk&apos; &apos;BEGIN&#123;print test&#125;&apos;# awk &apos;BEGIN&#123;test=&quot;hello,gawk&quot;;print test&#125;&apos;# awk -F:â€˜&#123;sex=â€œmaleâ€;print $1,sex,age;age=18&#125;â€™ /etc/passwd# cat awkscript &#123;print script,$1,$2&#125; awk -F: -f awkscript script=â€œawkâ€ /etc/passwd printf å‚æ•° æ ¼å¼åŒ–è¾“å‡ºï¼šprintf â€œFORMATâ€, item1, item2, â€¦ (1)å¿…é¡»æŒ‡å®šFORMAT (2)ä¸ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œéœ€è¦æ˜¾å¼ç»™å‡ºæ¢è¡ŒæŽ§åˆ¶ç¬¦ï¼Œ\n (3)FORMATä¸­éœ€è¦åˆ†åˆ«ä¸ºåŽé¢æ¯ä¸ªitemæŒ‡å®šæ ¼å¼ç¬¦ æ ¼å¼ç¬¦ï¼šä¸Žitemä¸€ä¸€å¯¹åº” æ ¼å¼ç¬¦ æ„ä¹‰ %c æ˜¾ç¤ºå­—ç¬¦çš„ASCIIç  %d,%i æ˜¾ç¤ºåè¿›åˆ¶æ•´æ•° %e,%E æ˜¾ç¤ºç§‘å­¦è®¡æ•°æ³•æ•°å€¼ %f æ˜¾ç¤ºä¸ºæµ®ç‚¹æ•° %g,%G ä»¥ç§‘å­¦è®¡æ•°æ³•æˆ–æµ®ç‚¹å½¢å¼æ˜¾ç¤ºæ•°å€¼ %s æ˜¾ç¤ºå­—ç¬¦ä¸² %u æ— ç¬¦å·æ•´æ•° %% æ˜¾ç¤º%è‡ªèº« ä¿®é¥°ç¬¦ï¼š[.#]ï¼šç¬¬ä¸€ä¸ªæ•°å­—æŽ§åˆ¶æ˜¾ç¤ºçš„å®½åº¦ï¼›ç¬¬äºŒä¸ª#è¡¨ç¤ºå°æ•°ç‚¹åŽç²¾åº¦ï¼Œ%3.1f-: å·¦å¯¹é½ï¼ˆé»˜è®¤å³å¯¹é½ï¼‰ %-15s+ï¼šæ˜¾ç¤ºæ•°å€¼çš„æ­£è´Ÿç¬¦å· %+d printfç¤ºä¾‹1234567# awk -F: '&#123;printf "%s",$1&#125;' /etc/passwd# awk -F: '&#123;printf "%s\n",$1&#125;' /etc/passwd# awk -F: '&#123;printf "%-20s %10d\n",$1,$3&#125;' /etc/passwd# awk -F: '&#123;printf "Username: %s\n",$1&#125;' /etc/passwd# awk -F: '&#123;printf â€œUsername: %s,UID:%d\n",$1,$3&#125;â€™ /etc/passwd# awk -F: '&#123;printf "Username: %15s,UID:%d\n",$1,$3&#125;' /etc/passwd# awk -F: '&#123;printf "Username: %-15s,UID:%d\n",$1,$3&#125;' /etc/passwd æ“ä½œç¬¦è¡¨è¾¾å¼ åˆç­‰è¡¨è¾¾å¼åŒ…æ‹¬ æ•°å€¼ä¸Žå­—ç¬¦ä¸²å¸¸é‡, å˜é‡, å­—æ®µ, å‡½æ•°è°ƒç”¨, æ•°ç»„å…ƒç´ . å¯ä»¥æŠŠè¡¨è¾¾å¼ç»„åˆèµ·æ¥çš„è¿ç®—ç¬¦åŒ…æ‹¬ èµ‹å€¼è¿ç®—ç¬¦ = += -= = /= %= ^= æ¡ä»¶è¡¨è¾¾å¼ ?: é€»è¾‘è¿ç®—ç¬¦ || (OR), &amp;&amp; (AND), ! (NOT) åŒ¹é…è¿ç®—ç¬¦ ~ å’Œ!~ å…³ç³»è¿ç®—ç¬¦ &lt; &lt;= == != &gt; &gt;= æ‹¼æŽ¥è¿ç®—ç¬¦ (æ²¡æœ‰æ˜¾å¼çš„æ‹¼æŽ¥è¿ç®—ç¬¦) ç®—æœ¯è¿ç®—ç¬¦ + - / % ^ å•ç›®è¿ç®—ç¬¦ +å’Œ- è‡ªå¢žä¸Žè‡ªå‡è¿ç®—ç¬¦++å’Œâ€“(åŒ…æ‹¬å‰ç¼€ä¸ŽåŽç¼€)æ‹¬å· (ç”¨äºŽåˆ†ç»„) æ“ä½œ è¿ç®—ç¬¦ ä¾‹å­ ä¾‹å­çš„å«ä¹‰ èµ‹å€¼ = += -= *= /= %= ^= x *= 2 x = x * 2 æ¡ä»¶è¡¨è¾¾å¼ ?: x ? y : z è‹¥xä¸ºçœŸ,åˆ™ y,å¦åˆ™z é€»è¾‘ä¸Ž &amp;&amp; x &amp;&amp; y è‹¥xä¸Žyéƒ½ä¸ºçœŸ, åˆ™ä¸º1,å¦åˆ™ä¸º0 æ•°ç»„æˆå‘˜ in i in a å¦‚æžœa[i]å­˜åœ¨, åˆ™ä¸º1,å¦åˆ™ä¸º0 åŒ¹é… ~ !~ $1 ~ /x/ å¦‚æžœç¬¬ä¸€ä¸ªå­—æ®µåŒ…å«x,åˆ™ä¸º1,å¦åˆ™ä¸º0 å…³ç³»è¿ç®— &lt; &lt;= == != &gt;= &gt; x == y å¦‚æžœxç­‰äºŽy,åˆ™ä¸º1, å¦åˆ™ä¸º0 æ‹¼æŽ¥ â€œaâ€ â€œbcâ€ â€œabcâ€ ä¸å­˜åœ¨æ˜¾å¼çš„æ‹¼æŽ¥è¿ç®—ç¬¦ å‡æ³•, åŠ æ³• + - x + y xä¸Žyçš„å’Œ ä¹˜æ³•, é™¤æ³•, å–æ¨¡ * / % x % y xé™¤ä»¥yçš„ä½™æ•° å•ç›®åŠ , å•ç›®å‡ + - -x xçš„ç›¸åæ•° é€»è¾‘éž ! !$1 è‹¥$1ä¸ºç©ºæˆ–ä¸º0, åˆ™ä¸º1,å¦åˆ™ä¸º0 æŒ‡æ•°è¿ç®— ^ x ^ y xçš„yæ¬¡æ–¹ è‡ªå¢ž, è‡ªå‡ ++ â€“ ++x, x++ ä¸ºxåŠ 1 å­—æ®µ $ $i+1 1åŠ ä¸Šç¬¬iä¸ªå­—æ®µçš„å€¼ ç»„ ( ) ($i)++ ç»™ç¬¬iä¸ªå­—æ®µçš„å€¼åŠ 1 ç®—æœ¯æ“ä½œç¬¦ï¼š x+y, x-y, x*y, x/y, x^y, x%y -x:è½¬æ¢ä¸ºè´Ÿæ•° +x:è½¬æ¢ä¸ºæ•°å€¼ å­—ç¬¦ä¸²æ“ä½œç¬¦ï¼šæ²¡æœ‰ç¬¦å·çš„æ“ä½œç¬¦ï¼Œå­—ç¬¦ä¸²è¿žæŽ¥ èµ‹å€¼æ“ä½œç¬¦ï¼š =, +=, -=, *=, /=, %=, ^= ++, â€“ æ¯”è¾ƒæ“ä½œç¬¦ï¼š ==, !=, &gt;, &gt;=, &lt;, &lt;= æ¨¡å¼åŒ¹é…ç¬¦ ~ï¼šå·¦è¾¹æ˜¯å¦å’Œå³è¾¹åŒ¹é…åŒ…å« !~ ï¼šæ˜¯å¦ä¸åŒ¹é… ç¤ºä¾‹ï¼š 1234# awk â€“F: &apos;$0 ~ /root/&#123;print $1&#125;â€˜ /etc/passwd# awk &apos;$0~&quot;^root&quot;&apos; /etc/passwd# awk &apos;$0 !~ /root/&apos; /etc/passwd# awk -F: &apos;$3==0&apos; /etc/passwd é€»è¾‘æ“ä½œç¬¦ï¼š &amp;&amp; ä¸Ž || æˆ– ï¼ éž ç¤ºä¾‹ï¼š 12345# awk -F: &apos;$3&gt;=0 &amp;&amp; $3&lt;=1000 &#123;print $1&#125;&apos; /etc/passwd# awk -F: &apos;$3==0 || $3&gt;=1000 &#123;print $1&#125;&apos; /etc/passwd# awk -F: â€˜!($3==0) &#123;print $1&#125;&apos; /etc/passwd# awk -F: â€˜!($3&gt;=500) &#123;print $3&#125;&apos; /etc/passwd# awk -F: &apos;$3 &gt; 100 &amp;&amp; $3&lt;1000 &#123;print $1,$3&#125;&apos; passwd å‡½æ•°è°ƒç”¨123function_name(argu1, argu2, ...)æ¡ä»¶è¡¨è¾¾å¼ï¼ˆä¸‰ç›®è¡¨è¾¾å¼ï¼‰ selector?if-true-expression:if-false-expression ç¤ºä¾‹ï¼š 123awk -F: &apos;&#123;$3&gt;=1000?usertype=&quot;Common User&quot;:usertype=&quot;Sysadmin or SysUser&quot;;printf &quot;%15s:%-s\n&quot;,$1,usertype&#125;&apos; /etc/passwdawk -F: &apos;&#123;$3&gt;1000?username=&quot;common user:&quot;:username=&quot;sysuser:&quot;;printf &quot;%s %-30s %d\n&quot;,username,$1,$3&#125;&apos; passwd æ­£åˆ™è¡¨è¾¾å¼ æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦åŒ…æ‹¬ï¼š \ ^ $ . [] | () * + ? ä¸€ä¸ªåŸºæœ¬çš„æ­£åˆ™è¡¨è¾¾å¼åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š ä¸€ä¸ªä¸æ˜¯å…ƒå­—ç¬¦çš„å­—ç¬¦ï¼Œä¾‹å¦‚Aï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å°±æ˜¯å®ƒæœ¬èº«ï¼› ä¸€ä¸ªåŒ¹é…ç‰¹æ®Šå­—ç¬¦çš„è½¬ä¹‰å­—ç¬¦ï¼š\tåŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ ä¸€ä¸ªè¢«å¼•ç”¨çš„å…ƒå­—ç¬¦ï¼Œä¾‹å¦‚*ï¼ŒæŒ‰å­—é¢æ„ä¹‰åŒ¹é…å…ƒå­—ç¬¦ ^ åŒ¹é…ä¸€è¡Œçš„å¼€å§‹ $ åŒ¹é…ä¸€è¡Œçš„ç»“æŸ . åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ ä¸€ä¸ªå­—ç¬¦ç±»:[ABC]åŒ¹é…å­—ç¬¦Aã€Bæˆ–C å­—ç¬¦ç±»å¯èƒ½åŒ…èƒ½åŒ…å«ç¼©å†™æ ¼å¼ï¼š[A-Za-z]åŒ¹é…å•ä¸ªå­—æ¯ ä¸€ä¸ªäº’è¡¥çš„å­—ç¬¦ç±»:[^0-9] åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œä½†é™¤äº†æ•°å­— è¿ç®—ç¬¦ç»„åˆèµ·æ¥ä½¿ç”¨ é€‰æ‹©ï¼šA|B åŒ¹é…Aæˆ–B æ‹¼æŽ¥ï¼šABåŒ¹é…åŽé¢ç´§è·Ÿç€Bçš„A é—­åŒ…ï¼šA*åŒ¹é…0ä¸ªæˆ–å¤šä¸ªA æ­£å¿…åŒ…ï¼šA+åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªA é›¶æˆ–ä¸€ï¼šAï¼ŸåŒ¹é…ç©ºå­—ç¬¦ä¸²æˆ–A æ‹¬å·ï¼šè¢«(r)åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œä¸Žræ‰€åŒ¹é…çš„å­—ç¬¦ä¸²ç›¸åŒ ä¼˜å…ˆçº§ é€‰æ‹©è¿ç®—ç¬¦|ä¼˜å…ˆçº§æœ€ä½Žï¼Œç„¶åŽæ˜¯æ‹¼æŽ¥è¿ç®—ï¼Œæœ€åŽæ˜¯é‡å¤è¿ç®—+ï¼Œ*ä¸Žï¼Ÿï¼› è½¬ä¹‰åºåˆ— åºåˆ— æ„ä¹‰ \b é€€æ ¼ \f æ¢é¡µ \n æ¢è¡Œ \r å›žè½¦ \t åˆ¶è¡¨ç¬¦ \ddd å…«è¿›åˆ¶æ•°ddd.dddå«æœ‰1åˆ°3ä¸ªæ•°å­—ï¼Œæ¯ä¸ªæ•°å­—çš„å€¼åœ¨0-7ä¹‹é—´ \c å…¶ä»–å­—é¢æ„ä¹‰ä¸Šçš„cï¼ˆå¦‚\è¡¨ç¤º,â€è¡¨ç¤ºåŒå¼•å·ï¼‰ ###ç¤ºä¾‹ 123456789^[^^] åŒ¹é…ä¸ä»¥è„±å­—ç¬¦å¼€å§‹çš„å­—ç¬¦ä¸²/^[0-9]+$/ åŒ¹é…å«æœ‰ä¸”åªå«æœ‰æ•°å­—çš„è¾“å…¥è¡Œ/^[0-9][0-9][0-9]$/ è¾“å…¥è¡Œæœ‰ä¸”ä»…æœ‰ 3 ä¸ªæ•°å­—./^(\+|-)?[0-9]+\.?[0-9]*$/ åè¿›åˆ¶å°æ•°, ç¬¦å·ä¸Žå°æ•°éƒ¨åˆ†æ˜¯å¯é€‰çš„./^[+-]?[0-9]+[.]?[0-9]*$/ ä¹Ÿæ˜¯åŒ¹é…åè¿›åˆ¶å°æ•°, å¸¦æœ‰å¯é€‰çš„ç¬¦å·ä¸Žå°æ•°éƒ¨åˆ†./^[+-]?([0-9]+[.]?[0-9]*|[.][0-9]+)([eE][+-]?[0-9]+)?$/ æµ®ç‚¹æ•°, ç¬¦å·ä¸ŽæŒ‡æ•°éƒ¨åˆ†æ˜¯å¯é€‰çš„./^[A-Za-z][A-Za-z0-9]*$/ ä¸€ä¸ªå­—æ¯, åŽé¢å†è·Ÿç€ä»»æ„å¤šä¸ªå­—æ¯æˆ–æ•°å­— (æ¯”å¦‚awkçš„å˜é‡å)./^[A-Za-z]$|^[A-Za-z][0-9]$/ ä¸€ä¸ªå­—æ¯, åˆæˆ–è€…æ˜¯ä¸€ä¸ªåŽé¢è·Ÿç€ä¸€ä¸ªæ•°å­—çš„å­—æ¯ (æ¯”å¦‚ Basic çš„å˜é‡å)./^[A-Za-z][0-9]?$/ åŒæ ·æ˜¯ä¸€ä¸ªå­—æ¯, åˆæˆ–è€…æ˜¯ä¸€ä¸ªåŽé¢è·Ÿç€ä¸€ä¸ªæ•°å­—çš„å­—æ¯ awk PATTERN PATTERN: æ ¹æ®patternæ¡ä»¶ï¼Œè¿‡æ»¤åŒ¹é…çš„è¡Œï¼Œå†åšå¤„ç† (1) å¦‚æžœæœªæŒ‡å®šï¼šç©ºæ¨¡å¼ï¼ŒåŒ¹é…æ¯ä¸€è¡Œ (2) /regular expression/ ï¼šä»…å¤„ç†èƒ½å¤Ÿæ¨¡å¼åŒ¹é…åˆ°çš„è¡Œï¼Œéœ€è¦ç”¨/ / æ‹¬èµ·æ¥awk &apos;/^UUID/{print $1}&apos; /etc/fstab awk &apos;!/^UUID/{print $1}&apos; /etc/fstab (3) relational expression: å…³ç³»è¡¨è¾¾å¼ï¼Œç»“æžœä¸ºâ€œçœŸâ€æ‰ä¼šè¢«å¤„ç†çœŸï¼šç»“æžœä¸ºéž0å€¼ï¼Œéžç©ºå­—ç¬¦ä¸² å‡ï¼šç»“æžœä¸ºç©ºå­—ç¬¦ä¸²æˆ–0å€¼ ç¤ºä¾‹ 123456# awk -F: &apos;i=1;j=1&#123;print i,j&#125;&apos; /etc/passwd# awk â€˜!0â€™ /etc/passwd ; awk â€˜!1â€™ /etc/passwd# awk â€“F: &apos;$3&gt;=1000&#123;print $1,$3&#125;&apos; /etc/passwd# awk -F: &apos;$3&lt;1000&#123;print $1,$3&#125;&apos; /etc/passwd# awk -F: &apos;$NF==&quot;/bin/bash&quot;&#123;print $1,$NF&#125;&apos; /etc/passwd# awk -F: &apos;$NF ~ /bash$/&#123;print $1,$NF&#125;&apos; /etc/passwd (4) line rangesï¼šè¡ŒèŒƒå›´ 12345startline,endline /pat1/,/pat2/# awk -F: &apos;/^root\&gt;/,/^nobody\&gt;/&#123;print $1&#125;&apos; /etc/passwdæ³¨æ„ï¼šä¸æ”¯æŒç›´æŽ¥ç»™å‡ºæ•°å­—æ ¼å¼# awk -F: &apos;(NR&gt;=10&amp;&amp;NR&lt;=20)&#123;print NR,$1&#125;&apos; /etc/passwd (5) BEGIN/END æ¨¡å¼ BEGIN{}: ä»…åœ¨å¼€å§‹å¤„ç†æ–‡ä»¶ä¸­çš„æ–‡æœ¬ä¹‹å‰æ‰§è¡Œä¸€æ¬¡ END{}ï¼š ä»…åœ¨æ–‡æœ¬å¤„ç†å®Œæˆä¹‹åŽæ‰§è¡Œä¸€æ¬¡ ç¤ºä¾‹ 12345678910# awk -F : &apos;BEGIN &#123;print &quot;USER USERID&quot;&#125; &#123;print $1&quot;:&quot;$3&#125; END&#123;print &quot;end file&quot;&#125;&apos; /etc/passwd# awk -F : &apos;&#123;print &quot;USER USERIDâ€œ;print $1&quot;:&quot;$3&#125; END&#123;print &quot;end file&quot;&#125;&apos; /etc/passwd# awk -F: &apos;BEGIN&#123;print &quot; USER UID \n--------------- &quot;&#125;&#123;print $1,$3&#125;&apos; /etc/passwd# awk -F: &apos;BEGIN&#123;print &quot; USER UID \n--------------- &quot;&#125;&#123;print $1,$3&#125;&apos;END&#123;print &quot;==============&quot;&#125; /etc/passwd # seq 10 |awk â€˜i=0â€™# seq 10 |awk â€˜i=1â€™# seq 10 | awk &apos;i=!iâ€˜# seq 10 | awk &apos;&#123;i=!i;print i&#125;â€˜# seq 10 | awk â€˜!(i=!i)â€™# seq 10 |awk -v i=1 &apos;i=!i&apos; æ¨¡å¼æ€»ç»“ æ¨¡å¼ ä¾‹å­ åŒ¹é… BEGIN BEGIN è¾“å…¥è¢«è¯»å–ä¹‹å‰ END END æ‰€æœ‰è¾“å…¥è¢«è¯»å–ä¹‹åŽ expression $3&gt;100 ç¬¬ä¸‰ä¸ªå­—æ®µå¤§äºŽ100 string-matching /Asia/ å«æœ‰Asiaçš„è¡Œ compound $3&lt;100 &amp;&amp; $4 ==â€Asiaâ€ ç¬¬ä¸‰ä¸ªå­—æ®µå°äºŽ100ä¸”ç¬¬å››ä¸ªå­—æ®µå«æœ‰Asiaçš„è¡Œ range NR == 10,NR==20 è¾“å…¥çš„ç¬¬10è¡Œåˆ°20è¡Œ awk action123456å¸¸ç”¨çš„actionåˆ†ç±» (1) Expressions: ç®—æœ¯ï¼Œæ¯”è¾ƒè¡¨è¾¾å¼ç­‰ (2) Control statementsï¼šif,whileç­‰ (3) Compound statementsï¼šç»„åˆè¯­å¥ (4) input statements (5) output statementsï¼šprintç­‰ awkæŽ§åˆ¶è¯­å¥12345678910111213&#123; statements;â€¦ &#125; ç»„åˆè¯­å¥ if(condition) &#123;statements;â€¦&#125; if(condition) &#123;statements;â€¦&#125; else &#123;statements;â€¦&#125; while(conditon) &#123;statments;â€¦&#125; do &#123;statements;â€¦&#125; while(condition) for(expr1;expr2;expr3) &#123;statements;â€¦&#125; break continue next å¼€å§‹è¾“å…¥ä¸»å¾ªçŽ¯çš„ä¸‹ä¸€æ¬¡è¿­ä»£ delete array[index] delete array exit exit expression é©¬ä¸Šæ‰§è¡ŒEND åŠ¨ä½œ; å¦‚æžœå·²ç»åœ¨ENDåŠ¨ä½œå†…, é‚£å°±é€€å‡ºç¨‹åº. å°†expressionä½œä¸ºç¨‹åºçš„é€€å‡ºçŠ¶æ€è¿”å›ž. if-else123456789101112131415è¯­æ³•ï¼š if(condition)&#123;statement;â€¦&#125;[else statement] if(condition1)&#123;statement1&#125;else if(condition2)&#123;statement2&#125; else&#123;statement3&#125; ä½¿ç”¨åœºæ™¯ï¼šå¯¹awkå–å¾—çš„æ•´è¡Œæˆ–æŸä¸ªå­—æ®µåšæ¡ä»¶åˆ¤æ–­ ç¤ºä¾‹ï¼š # awk -F: &apos;&#123;if($3&gt;=1000)print $1,$3&#125;&apos; /etc/passwd # awk -F: &apos;&#123;if($NF==&quot;/bin/bash&quot;) print $1&#125;&apos; /etc/passwd # awk &apos;&#123;if(NF&gt;5) print $0&#125;&apos; /etc/fstab # awk -F: &apos;&#123;if($3&gt;=1000) &#123;printf &quot;Common user: %s\n&quot;,$1&#125; else &#123;printf &quot;root or Sysuser: %s\n&quot;,$1&#125;&#125;&apos; /etc/passwd # awk -F: &apos;&#123;if($3&gt;=1000) printf &quot;Common user: %s\n&quot;,$1; else printf &quot;root or Sysuser: %s\n&quot;,$1&#125;&apos; /etc/passwd df -h|awk -F% &apos;/^\/dev/&#123;print $1&#125;&apos;|awk &apos;$NF&gt;=80&#123;print $1,$5&#125;â€˜ # awk &apos;BEGIN&#123; test=100;if(test&gt;90)&#123;print &quot;very good&quot;&#125; else if(test&gt;60)&#123; print &quot;good&quot;&#125;else&#123;print &quot;no pass&quot;&#125;&#125;&apos; whileå¾ªçŽ¯12345678è¯­æ³•ï¼š while(condition)&#123;statement;â€¦&#125; æ¡ä»¶â€œçœŸâ€ï¼Œè¿›å…¥å¾ªçŽ¯ï¼›æ¡ä»¶â€œå‡â€ï¼Œ é€€å‡ºå¾ªçŽ¯ ä½¿ç”¨åœºæ™¯ï¼š å¯¹ä¸€è¡Œå†…çš„å¤šä¸ªå­—æ®µé€ä¸€ç±»ä¼¼å¤„ç†æ—¶ä½¿ç”¨ å¯¹æ•°ç»„ä¸­çš„å„å…ƒç´ é€ä¸€å¤„ç†æ—¶ä½¿ç”¨ ç¤ºä¾‹ï¼š awk &apos;/^[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF) &#123;print $i,length($i); i++&#125;&#125;&apos; /etc/grub2.cfg do-whileå¾ªçŽ¯12345678è¯­æ³•ï¼š do &#123;statement;â€¦&#125;while(condition) æ„ä¹‰ï¼šæ— è®ºçœŸå‡ï¼Œè‡³å°‘æ‰§è¡Œä¸€æ¬¡å¾ªçŽ¯ä½“ ç¤ºä¾‹ï¼š # awk &apos;BEGIN&#123; total=0;i=0;do&#123; total+=i;i++;&#125;while(i&lt;=100);print total&#125;&apos; æ€è€ƒï¼šä¸‹é¢ä¸¤è¯­å¥æœ‰ä½•ä¸åŒï¼Ÿ # awk &apos;BEGIN&#123;i=0;print ++i,i&#125;&apos; # awk &apos;BEGIN&#123;i=0;print i++,i&#125;&apos; forå¾ªçŽ¯12345678910111213141516171819è¯­æ³•ï¼š for(expr1;expr2;expr3) &#123;statement;â€¦&#125; å¸¸è§ç”¨æ³•ï¼š for(variable assignment;condition;iteration process) &#123;for-body&#125; ç‰¹æ®Šç”¨æ³•ï¼šèƒ½å¤ŸéåŽ†æ•°ç»„ä¸­çš„å…ƒç´  è¯­æ³•ï¼šfor(var in array) &#123;for-body&#125; ç¤ºä¾‹ï¼š awk &apos;/^[[:space:]]*linux16/&#123;for(i=1;i&lt;=NF;i++) &#123;print $i,length($i)&#125;&#125;&apos; /etc/grub2.cfgç©ºè¯­å¥ å•ç‹¬ä¸€ä¸ªåˆ†å·è¡¨ç¤ºä¸€ä¸ªç©ºè¯­å¥ åœ¨ä¸‹é¢è¿™ä¸ªç¨‹åºé‡Œ, forçš„å¾ªçŽ¯ä½“æ˜¯ä¸€ä¸ªç©ºè¯­å¥. BEGIN &#123; FS = &quot;\t&quot; &#125; &#123; for (i = 1; i &lt;= NF &amp;&amp; $i != &quot;&quot;; i++); if (i &lt;= NF) print &#125; è¿™ä¸ªç¨‹åºæ‰“å°æ‰€æœ‰çš„, åŒ…å«ç©ºå­—æ®µçš„è¡Œ. å¾ªçŽ¯æ€§èƒ½æ¯”è¾ƒ1234time (awk &apos;BEGIN&#123;total=0;for(i=0;i&lt;=10000;i++)&#123;total+=i;&#125;;print total;&#125;&apos;)time(total=0;for i in &#123;1..10000&#125;;do total=$(($total+i));done;echo $total)time(for ((i=0;i&lt;=10000;i++));do let total+=i;done;echo $total)time(seq -s â€+â€ 10000|bc) switchè¯­å¥12è¯­æ³•ï¼š switch(expression) &#123;case VALUE1 or /REGEXP/: statement1; case VALUE2 or /REGEXP2/: statement2; ...; default: statementn&#125; break å’Œcontinue 12# awk â€˜BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++) &#123;if(i%2==0)continue;sum+=i&#125;print sum&#125;â€˜# awk â€˜BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++) &#123;if(i==66)break;sum+=i&#125;print sum&#125;â€˜ break [n] continue [n] next:æå‰ç»“æŸå¯¹æœ¬è¡Œå¤„ç†è€Œç›´æŽ¥è¿›å…¥ä¸‹ä¸€è¡Œå¤„ç†ï¼ˆawkè‡ªèº«å¾ªçŽ¯ï¼‰ 1# awk -F: &apos;&#123;if($3%2!=0) next; print $1,$3&#125;&apos; /etc/passwd awkæ•°ç»„ å…³è”æ•°ç»„ï¼šarray[index-expression]index-expression: (1)å¯ä½¿ç”¨ä»»æ„å­—ç¬¦ä¸²ï¼›å­—ç¬¦ä¸²è¦ä½¿ç”¨åŒå¼•å·æ‹¬èµ·æ¥ (2)å¦‚æžœæŸæ•°ç»„å…ƒç´ äº‹å…ˆä¸å­˜åœ¨ï¼Œåœ¨å¼•ç”¨æ—¶ï¼Œawkä¼šè‡ªåŠ¨åˆ›å»ºæ­¤å…ƒç´ ï¼Œå¹¶å°†å…¶å€¼åˆå§‹åŒ–ä¸ºâ€œç©ºä¸²â€ è‹¥è¦åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸå…ƒç´ ï¼Œè¦ä½¿ç”¨â€œindex in arrayâ€æ ¼å¼è¿›è¡ŒéåŽ† ç¤ºä¾‹ï¼š 12345weekdays[â€œmonâ€]=&quot;Mondayâ€œ# awk &apos;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;print weekdays[&quot;mon&quot;]&#125;&apos;&apos;# awk &apos;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;tuesday&quot;;for(i in weekdays) print weekdays[i]&#125;&apos; # awk â€˜!arr[$0]++â€™ dupfile é‡å¤çš„è¡Œåªæ˜¾ç¤ºä¸€æ¬¡# awk &apos;&#123;!arr[$0]++;print $0, arr[$0]&#125;&apos; dupfile è‹¥è¦éåŽ†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œè¦ä½¿ç”¨forå¾ªçŽ¯ for(var in array) {for-body} æ³¨æ„ï¼švarä¼šéåŽ†arrayçš„æ¯ä¸ªç´¢å¼•ç¤ºä¾‹ï¼š 1234# awk &apos;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;] =&quot;Tuesday&quot;;for(i in weekdays) &#123;print weekdays[i]&#125;&#125;&apos;# netstat -tan | awk &apos;/^tcp/&#123;state[$NF]++&#125;END &#123;for(i in state) &#123; print i,state[i]&#125;&#125;&apos;# awk &apos;&#123;ip[$1]++&#125;END&#123;for(i in ip) &#123;print i,ip[i]&#125;&#125;&apos; /var/log/httpd/access_log awkå‡½æ•°æ•°å€¼å¤„ç†:rand()ï¼šè¿”å›ž0å’Œ1ä¹‹é—´ä¸€ä¸ªéšæœºæ•° awk â€˜BEGIN{rand(); for (i=1;i&lt;=10;i++)print int(rand()*100) }â€™ å†…å»ºç®—æœ¯å‡½æ•° å‡½æ•° è¿”å›žå€¼ atan2(y,x) y/xçš„åæ­£åˆ‡å€¼, å®šä¹‰åŸŸåœ¨ âˆ’Ï€åˆ°Ï€ä¹‹é—´ cos(x) xçš„ä½™å¼¦å€¼, xä»¥å¼§åº¦ä¸ºå•ä½ exp(x) xçš„æŒ‡æ•°å‡½æ•°,e x int(x) xçš„æ•´æ•°éƒ¨åˆ†; å½“xå¤§äºŽ0æ—¶, å‘ 0å–æ•´ log(x) xçš„è‡ªç„¶å¯¹æ•°(ä»¥eä¸ºåº•) rand() è¿”å›žä¸€ä¸ªéšæœºæ•°r, 0 â‰¤ r &lt; 1 sin(x) xçš„æ­£å¼¦å€¼, xä»¥å¼§åº¦ä¸ºå•ä½. sqrt(x) xçš„æ–¹æ ¹ srand(x) xæ˜¯rand() çš„æ–°çš„éšæœºæ•°ç§å­ è‡ªå®šä¹‰å‡½æ•°12345678910111213æ ¼å¼ï¼š function name ( parameter, parameter, ... ) &#123; statements return expression &#125; ç¤ºä¾‹ï¼š cat fun.awk function max(v1,v2) &#123; v1&gt;v2?var=v1:var=v2 return var &#125; BEGIN&#123;a=3;b=2;print max(a,b)&#125; awk -f fun.awk awkä¸­è°ƒç”¨shellå‘½ä»¤1234systemå‘½ä»¤ç©ºæ ¼æ˜¯awkä¸­çš„å­—ç¬¦ä¸²è¿žæŽ¥ç¬¦ï¼Œå¦‚æžœsystemä¸­éœ€è¦ä½¿ç”¨awkä¸­çš„å˜é‡å¯ä»¥ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼Œæˆ–è€…è¯´é™¤äº†awkçš„å˜é‡å¤–å…¶ä»–ä¸€å¾‹ç”¨&quot;&quot;å¼•ç”¨èµ·æ¥ã€‚# awk BEGIN&apos;&#123;system(&quot;hostname&quot;) &#125;&apos;# awk &apos;BEGIN&#123;score=100; system(&quot;echo your score is &quot; score) &#125;&apos; awkè„šæœ¬1234567891011å°†awkç¨‹åºå†™æˆè„šæœ¬ï¼Œç›´æŽ¥è°ƒç”¨æˆ–æ‰§è¡Œç¤ºä¾‹ï¼š# cat f1.awk&#123;if($3&gt;=1000)print $1,$3&#125;# awk -F: -f f1.awk /etc/passwd# cat f2.awk #!/bin/awk -f #this is a awk script &#123;if($3&gt;=1000)print $1,$3&#125;#chmod +x f2.awk# f2.awk -F: /etc/passwd å‘awkè„šæœ¬ä¼ é€’å‚æ•°123æ ¼å¼ï¼š awkfile var=value var2=value2... Inputfile æ³¨æ„ï¼šåœ¨BEGINè¿‡ç¨‹ä¸­ä¸å¯ç”¨ã€‚ç›´åˆ°é¦–è¡Œè¾“å…¥å®Œæˆä»¥åŽï¼Œå˜é‡æ‰å¯ç”¨ã€‚å¯ä»¥é€šè¿‡-vå‚æ•°ï¼Œè®©awkåœ¨æ‰§è¡ŒBEGINä¹‹å‰å¾—åˆ°å˜é‡çš„å€¼ã€‚å‘½ä»¤è¡Œä¸­æ¯ä¸€ä¸ªæŒ‡å®šçš„å˜é‡éƒ½éœ€è¦ä¸€ä¸ª-vå‚æ•° ç¤ºä¾‹12345# cat test.awk #!/bin/awk -f &#123;if($3 &gt;=min &amp;&amp; $3&lt;=max)print $1,$3&#125; chmod +x test.awk# test.awk -F: min=100 max=200 /etc/passwd]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[redis å¸¸ç”¨åŠŸèƒ½]]></title>
    <url>%2F2018%2F04%2F27%2Fredis%2F</url>
    <content type="text"><![CDATA[redis å¸¸ç”¨åŠŸèƒ½KV cache and storeREmote DIctionary Server(è¿œç¨‹å­—å…¸æœåŠ¡å™¨)redis è¿è¡Œéƒ½åœ¨å†…å­˜ä¸­æ¥å®žçŽ°ï¼Œå‘¨æœŸæ€§çš„å†™å…¥ç£ç›˜ï¼Œæ¥å®žçŽ°æŒä¹…åŠŸèƒ½; åŸºæœ¬çŸ¥è¯†123456789101112131415161718192021222324252627282930KV cache and store in-memory; æŒä¹…åŒ– ; ä¸»ä»Ž(å€ŸåŠ©äºŽsentinalå®žçŽ°ä¸€å®šæ„ä¹‰ä¸Šçš„HA); Clustering(åˆ†å¸ƒå¼);æ•°æ®ç»“æž„æœåŠ¡å™¨: String, List, Hash, Set, Sorted Set, Bitmap,HperLoglogs;Memcached ä¸Ž Redisçš„åŒºåˆ«: 1ã€Memcached æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿ; 2ã€Reis å¯ä»¥å®žçŽ°æŒä¹…å­˜å‚¨çš„; 3ã€Mecached æ˜¯ä¸€ä¸ªLUR ç¼“å­˜ï¼Œå°†è¿‡æœŸæ•°æ®æ¸…ç†å‡ºåŽ»; 4ã€Redisæ”¯æŒæ›´å¤šçš„æ•°æ®ç±»åž‹; 5ã€Memcached æ˜¯å¤šçº¿ç¨‹; 6ã€Redisæ˜¯å•çº¿ç¨‹; 7ã€äºŒè€…çš„æ€§èƒ½ä¸ç›¸ä¸Šä¸‹;Redis 3.0çš„LRUç®—æ³•çš„æ”¹è¿›: é¢„è®¾éšæœºå–5ä¸ªæ ·æœ¬ï¼Œæ’å…¥å¹¶æŽ’åºè‡³ä¸€ä¸ªpoolï¼Œ ç§»é™¤æœ€ä½³è€…ï¼Œå¦‚æ­¤åå¤; èµ°åˆ°å†…å­˜ç”¨ç†å°äºŽmaxmemoryçš„è®¾å®š; æ ·æœ¬5æ¯”å…ˆå‰çš„3å¤š; ä»Žå±€éƒ¨æœ€ä¼˜è¶‹å‘å…¨å±€æœ€ä¼˜;å­˜å‚¨ç³»ç»Ÿä¸‰ç±»: RDBMS NoSQL: KV NoSQL: redis Column Family NoSQL: HBase Documentation NoSQL: MongoDB Graph NoSQL: Neo4j NewSQL(æ”¯æŒåˆ†å¸ƒå¼)Redisçš„ç»„ä»¶: redis.io(å®˜æ–¹ç«™ç‚¹) Commands1234567redis-serverredis-cli Command line interface redis-benchmark Benchmarking utilityredis-check-dump &amp; redis-check-aof Corrupted RDB/AOF files utilities Rediså®ˆæŠ¤è¿›ç¨‹12345678910111213141516171819202122232425262728# vim /etc/redis.confç›‘å¬6379ç«¯å£;tcp-backlog 511 #æ˜¯rediså®ˆæŠ¤è¿›ç¨‹çš„ç­‰é˜Ÿåˆ—,å½“å¹¶å‘è¾ƒé«˜æ—¶ï¼Œå†æ‰¾ä½ç½®æ¥ç¼“å­˜æ–°è¯·æ±‚;bind # æ˜¯æŒ‡ç›‘å¬çš„åœ°å€;bind 127.0.0.1 172.16.55.128unixsocket /tmp/redis.sock # å½“æœåŠ¡å’Œredisåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šä½¿ç”¨socketæ¥é€šä¿¡ï¼Œæé«˜æ•ˆçŽ‡;unixsocketperm 700timeout #å½“ä¸€ä¸ªå®¢ç«¯è¿žæŽ¥å¤šä¹…åŽï¼Œè®¤ä¸ºè¶…æ—¶ï¼Œ0è¡¨ç¤ºç¦ç”¨ï¼Œè®¤ä¸ºä¸€ç›´å­˜åœ¨;tcp-keepaoive 0loglevel noticelogfile /var/log/redis/redis.logdatabases 16 # è¡¨ç¤ºå¯ä»¥ä½¿ç”¨å¤šå°‘ä¸ªæ•°æ®åº“;save &lt;sencods&gt; &lt;changes&gt; # å¦‚æžœå¤šå°‘ç§’å‘ç”Ÿå¤šå°‘å˜åŒ–åˆ™å­˜å‚¨ï¼Œå› æ­¤è¿™å–å†³äºŽä¸šåŠ¡æ¨¡åž‹;save &quot;&quot; #è¿™æ ·å†™è¡¨ç¤ºç¦ç”¨redisæŒä¹…åŒ–åŠŸèƒ½;save 900 1save 300 10save 60 10000stop-writes-on-bgsave-error yes rdbcompression yesdbcheksum yesdbfilename dump.rdbdir /var/lib/redis# é…ç½®ä»¥ä¸ºæˆä¸ºä»ŽæœåŠ¡å™¨salveof ip # è¿™é‡ŒæŒ‡å®šä¸»æœåŠ¡å™¨çš„ipå³å¯;maxclients 100000appendonly yes # å¼€å¯appendonly æŒä¹…åŒ–åŠŸèƒ½;appendfsync everysec # æ˜¯å¦ä½¿ç”¨fsyncæ¥æŒä¹…åŒ–;# redisæœåŠ¡ç«¯çš„å‚æ•°ï¼Œå¤§å¤šå¯ä»¥åœ¨redis-cliè¿žæŽ¥åˆ°æœåŠ¡å™¨åŽè¿›è¡ŒåŠ¨æ€ä¿®å¤æˆ–ä¿®æ”¹çš„; redis-cli å¸¸ç”¨å‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112# redis-cli -p 25612 127.0.0.1:25612&gt; AUTH xxxxxxx127.0.0.1:25612&gt; HELP APPEND # help ç”¨æ¥æŸ¥çœ‹å¸®åŠ©127.0.0.1:25612&gt; CLIENT LISTid=3 addr=127.0.0.1:25666 fd=5 name= age=275 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=client127.0.0.1:25612&gt; SELECT 1 # ç¬¬å¼€ç¬¬å‡ ä¸ªæ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥ç†è§£æˆä¸ºåç§°ç©ºé—´;127.0.0.1:25612&gt; SELECT 1OK127.0.0.1:25612[1]&gt; SET disto fedoraOK127.0.0.1:25612[1]&gt; GET disto&quot;fedora&quot;127.0.0.1:25612[1]&gt; SET disto centosOK127.0.0.1:25612[1]&gt; STRLEN disto(integer) 6127.0.0.1:25612[1]&gt; DECR count(integer) -1127.0.0.1:25612[1]&gt; DECR count(integer) -2127.0.0.1:25612[1]&gt; DECR count(integer) -3127.0.0.1:25612[1]&gt; SET disto gentoo NX # æ˜¾ç¤ºä¸ºæœªèƒ½æ‰§è¡Œçš„æ“ä½œ,è¯¥å€¼ä¸å­˜åœ¨åˆ™è®¾å®š;(nil)127.0.0.1:25612[1]&gt; SET foo bar XX # è¯¥å€¼åˆ™åœ¨åˆ™è®¾å®š;(nil)127.0.0.1:25612[1]&gt; SADD w1 mon tue wed thu sat sun(integer) 6127.0.0.1:25612[1]&gt; SADD w1 mon tue wed thu fre sat sun(integer) 1127.0.0.1:25612[1]&gt; 127.0.0.1:25612[1]&gt; SADD w2 tue thu day127.0.0.1:25612[1]&gt; ZADD weekday1 1 mon 2 tue 3 wed(integer) 3127.0.0.1:25612[1]&gt; ZCARD weekday1(integer) 3127.0.0.1:25612[1]&gt; ZRANK weekday1 tue(integer) 1127.0.0.1:25612[1]&gt; ZRANK weekday1 mon(integer) 0 (integer) 3127.0.0.1:25612[1]&gt; SINTER w1 w2 # æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†;1) &quot;thu&quot;2) &quot;tue&quot;127.0.0.1:25612[1]&gt; SUNION w1 w2 # æ±‚ä¸¤ä¸ªé›†åˆçš„å¹¶é›†;1) &quot;sun&quot;2) &quot;wed&quot;3) &quot;sat&quot;4) &quot;day&quot;5) &quot;tue&quot;6) &quot;thu&quot;7) &quot;mon&quot;8) &quot;fre&quot;127.0.0.1:25612[1]&gt; SPOP w1 # å¼¹å‡ºä¸€ä¸ªå…ƒç´  ;&quot;tue&quot;127.0.0.1:25612[1]&gt; SPOP w1&quot;sun&quot;127.0.0.1:25612[1]&gt; SISMEMBER w1 day # è¡¨ç¤ºå·²ç»æ²¡æœ‰è¿™ä¸ªå…ƒç´ ;(integer) 0127.0.0.1:25612[1]&gt; SISMEMBER w1 sat(integer) 1127.0.0.1:25612[1]&gt; ZRANGE weekday1 0 11) &quot;mon&quot;2) &quot;tue&quot;127.0.0.1:25612[1]&gt; HSET h1 a mon(integer) 0127.0.0.1:25612[1]&gt; HGET h1 a&quot;mon&quot;127.0.0.1:25612[1]&gt; HSET h1 b tue(integer) 1127.0.0.1:25612[1]&gt; HGET h1 a &quot;mon&quot;127.0.0.1:25612[1]&gt; HGET h1 b &quot;tue&quot;127.0.0.1:25612[1]&gt; HVALS h11) &quot;mon&quot;2) &quot;tue&quot;127.0.0.1:25612[1]&gt; HKEYS h11) &quot;a&quot;2) &quot;b&quot;Strings: å­—ä¸² SET key value [EX #] [NX|XX] GET INCR DECR EXISTLists: åˆ—è¡¨ LPUSH RPUSH LDROP RPOP LINDEX LSETSets: é›†åˆ SADD SINTER SUNTON SPOP SISMEMBERSorted Sets æœ‰åºé›†åˆï¼Œ å…¶å‘½ä»¤éƒ½ä»¥Zå¼€å¤´ ZADD ZRANGE ZCARD ZRANKHashesï¼š ä¸€ç»„å…³è”æ•°çš„é›†åˆ HSET HSETNX HGET HKEYS HVALS HDEL è®¤è¯å®žçŽ°æ–¹æ³•1234(1) redis.conf requirepass PASSWORD(2) redis-cli AUTH PASSWD æ¸…ç©ºæ•°æ®åº“12# FLUSHDB: æ¸…ç©ºå½“å‰åº“# FLUSHALL: æ¸…ç©ºæ‰€æœ‰åº“ äº‹åŠ¡1234567891011121314151617181920212223242526272829303132333435363738394041424344# é€šè¿‡MULTI, EXEC, WATCHç­‰å‘½ä»¤å®žçŽ°äº‹åŠ¡åŠŸèƒ½;# å°†ä¸€ä¸ªæˆ–å¤šä¸ªå‘½ä»¤å½’å¹¶ä¸ºä¸€ä¸ªæ“ä½œæè¯·æœåŠ¡å™¨æŒ‰é¡ºåºæ‰§è¡Œçš„æœºåˆ¶;# Redisæ•°æ®ä¸æ”¯æŒå›žæ»šæ“ä½œ;# MULTI: å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œä¸­é—´çš„æ‰€æœ‰å‘½ä»¤ä¼šæ”¾ç½®åœ¨é˜Ÿåˆ—ä¸­;# EXEC: æ‰§è¡Œäº‹åŠ¡;# ä¸€æ¬¡æ€§å°†äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œæ‰§è¡Œå®ŒæˆåŽè¿”å›žç»™å®¢æˆ·ç«¯;127.0.0.1:25612&gt; MULTIOK127.0.0.1:25612&gt; SET ip 172.16.55.123QUEUED127.0.0.1:25612&gt; GET ip QUEUED127.0.0.1:25612&gt; SET port 8080QUEUED127.0.0.1:25612&gt; GET port QUEUED127.0.0.1:25612&gt; EXEC1) OK2) &quot;172.16.55.123&quot;3) OK4) &quot;8080&quot;# WATCH: ä¹è§‚é”ï¼Œ åœ¨EXECå‘½ä»¤æ‰§è¡Œä¹‹é—´æœ‰ç”¨äºŽç›‘è§†æŒ‡å®šæ•°é‡é”®; #å¦‚æžœç›‘è§†ä¸­çš„æŸä»»æ„é”®æ•°æ®è¢«ä¿®æ”¹ï¼Œåˆ™æœåŠ¡å™¨æ‹’ç»æ‰§è¡Œäº‹åŠ¡;# æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯term1127.0.0.1:25612&gt; WATCH ipOK127.0.0.1:25612&gt; MULTIOK127.0.0.1:25612&gt; SET ip 10.0.0.1QUEUED127.0.0.1:25612&gt; GET ipQUEUEDterm2 127.0.0.1:25612&gt; GET ip &quot;172.16.55.123&quot;127.0.0.1:25612&gt; SET ip 172.16.55.123OK127.0.0.1:25612&gt; GET ip &quot;172.16.55.123&quot;term1127.0.0.1:25612&gt; EXEC(nil)# ç›‘æŽ§çš„ä¸€ä¸ªé”®ï¼ŒEXECä¹‹å‰é”®å‘ç”Ÿäº†æ”¹åŠ¨ï¼ŒEXECå°†æ‹’ç»æäº¤; Connectionç›¸å…³çš„å‘½ä»¤:123456789101112131415AUTH127.0.0.1:25612&gt; HELP PING PING [message] summary: Ping the server since: 1.0.0 group: connection127.0.0.1:25612&gt; PINGPONG127.0.0.1:25612&gt; ECHO &quot;hello redis&quot;&quot;hello redis&quot;127.0.0.1:25612&gt; QUIT127.0.0.1:25612&gt; HELP @connection Serverç›¸å…³çš„å‘½ä»¤123456789101112131415161718192021222324252627CLIENT GETNAMECLIENT KILL ip:port127.0.0.1:25612&gt; CLIENT SETNAME localconnOK127.0.0.1:25612&gt; CLIENT GETNAME&quot;localconn&quot;127.0.0.1:25612&gt; HELP INFO # èŽ·å–å½“å‰æœåŠ¡å™¨çš„çŠ¶æ€åŠä¿¡æ¯; INFO [section] summary: Get information and statistics about the server since: 1.0.0 group: server127.0.0.1:25612&gt; INFO CPU# CPUused_cpu_sys:474.20used_cpu_user:258.88used_cpu_sys_children:0.01used_cpu_user_children:0.00CONFIG RESETSTATCONFIG SET PARAMETER valueCONFIG REWRITE DBSIZE# è·ŸæŒä¹…åŒ–ç›¸å…³çš„æ•°æ® BGSAVE SAVELASTSAVEmonitor # å®žæ—¶ç›‘æŽ§å¯¹æ•°æ®çš„è¯·æ±‚SHUTDOWN SAVE #å°†æ•°æ®å®‰å…¨çš„åŒæ­¥åˆ°ç£ç›˜åŽå…³é—­redis-server redis å‘å¸ƒä¸Žè®¢é˜…åŠŸèƒ½(publish/subscribe)12345678910111213141516171819202122232425262728293031323334353637383940414243# é¢‘é“: æ¶ˆæ¯é˜Ÿåˆ—# SUBSCRIBE: è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—;# PUBLISH: å‘é¢‘é“å‘å¸ƒæ¶ˆæ¯;# UNSUBSCRIBE: é€€è®¢æ­¤å‰è®¢é˜…çš„é¢‘é“;# PSUBSCRIBE: æ¨¡å¼è®¢é˜…;# term1 ä¸­å¼€å§‹ä¸€ä¸ªé¢‘é“; 127.0.0.1:25612&gt; SUBSCRIBE newsReading messages... (press Ctrl-C to quit)1) &quot;subscribe&quot;2) &quot;news&quot;3) (integer) 1# term2 ä¸­å‘ä¸€ä¸ªé¢‘é“ä¸­å‘å¸ƒæ¶ˆæ¯;127.0.0.1:25612&gt; PUBLISH news &quot;hello renjin&quot;(integer) 1# term1 ä¸­å¯ä»¥æ”¶åˆ°æ¶ˆæ¯;1) &quot;message&quot;2) &quot;news&quot;3) &quot;hello renjin&quot;# term1 ä¸­ä½¿ç”¨æ‰©å±•æ¨¡å¼å¼€å¯ä¸¤ä¸ªé¢‘é“;127.0.0.1:25612&gt; PSUBSCRIBE &quot;rj.i[to]&quot;Reading messages... (press Ctrl-C to quit)1) &quot;psubscribe&quot;2) &quot;rj.i[to]&quot;3) (integer) 1# term2 ä¸­å‘ä¸¤ä¸ªé¢‘é“å‘å¸ƒæ¶ˆæ¯;127.0.0.1:25612&gt; PUBLISH rj.io &quot;hello RenJin&quot;(integer) 1127.0.0.1:25612&gt; PUBLISH rj.it &quot;hello SSJinYao&quot;(integer) 1# term1 ä¸­å¯ä»¥æ”¶åˆ°ä¸¤æ¡æ¶ˆæ¯;1) &quot;pmessage&quot;2) &quot;rj.i[to]&quot;3) &quot;rj.io&quot;4) &quot;hello RenJin&quot;1) &quot;pmessage&quot;2) &quot;rj.i[to]&quot;3) &quot;rj.it&quot;4) &quot;hello SSJinYao&quot; Redis çš„æŒä¹…åŒ–:1234567891011121314151617181920212223242526272829303132333435363738394041424344# æä¾›äº†RDBå’ŒAOFä¸¤ç§æœºåˆ¶; RDB: snapshot: äºŒè¿›åˆ¶æ ¼å¼; æŒ‰äº‹å…ˆå®šåˆ¶çš„ç­–ç•¥ï¼Œå‘¨æœŸæ€§åœ°å°†æ•°æ®ä¿å­˜è‡³ç£ç›˜:æ•°æ®æ–‡ä»¶é»˜è®¤ä¸ºdump.rdb; å®¢æˆ·ç«¯ ä¹Ÿå¯ä»¥ä½¿ç”¨SAVEæˆ–BGSAVEå‘½ä»¤å¯å¿«ç…§ä¿å­˜æœºåˆ¶; SAVEï¼šåŒæ­¥,åœ¨ä¸»çº¿ç¨‹ä¸­ä¿å­˜å¿«ç…§; æ­¤æ—¶ä¼šé˜»å¡žæ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚; BGSAVE: å¼‚æ­¥ï¼Œ AOF:Aappend Only Fil è®°å½•æ¯ä¸€æ¬¡å†™æ“ä½œè‡³æŒ‡å®š çš„æ–‡ä»¶å°¾éƒ¨å®žçŽ°æŒä¹…åŒ–; å½“redisé‡å¯æ—¶ï¼Œå¯é€šè¿‡é‡æ–°æ‰§è¡Œæ–‡ä»¶ä¸­çš„å‘½ä»¤åœ¨å†…å­˜é‡å»ºæ•°æ®åº“; BGREWRITEAOF: AOFæ–‡ä»¶é‡å†™: ä¸ä¼šè¯»å–æ­£åœ¨ä½¿ç”¨çš„AOFæ–‡ä»¶ï¼Œè€Œé€šè¿‡å°†å†…å­˜ä¸­çš„æ•°æ®ä»¥å‘½ä»¤çš„æ–¹å¼ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå®Œä¹‹åŽæ›¿æ¢åŽŸæ¥çš„AOFæ–‡ä»¶; RDB:é»˜è®¤ä¿å­˜ç­–ç•¥ï¼Œå–å†³äºŽç£ç›˜IOèƒ½åŠ›ï¼Œä¸Žå®¢æˆ·ç«¯å¯¹redisçš„è¯»å†™; SAVE 900 1 SAVE 300 10 SAVE 60 1000 stop-writes-on-bgsave-error yes # åœ¨è¿›è¡Œå¿«ç…§å¤‡ä»½æ—¶ï¼Œç›‘æŽ§åˆ°æŒä¹…åŒ–å‘çŽ°é”™è¯¯æ—¶ï¼Œæ˜¯å¦åœæ­¢ä¸‹æ¥; ä¼šæŠ¥å‘Šä¸€ä¸ªè®¿é—®é”™è¯¯;rdbcompression yes # æ˜¯å¦é‡‡ç”¨åŽ‹ç¼©æ¥èŠ‚çœä½¿æœ‰ç©ºé—´ï¼Œå½“ç„¶æ¶ˆè€—cpuä½¿ç”¨å‘¨æœŸ;rdbchecksum yes # æ˜¯å¦å¯¹rdbåšæ ¡éªŒç æ“ä½œ;dbfilename dump.rdb # æŒ‡æ˜Žæ–‡ä»¶å;dir /var/lib/redis #æŒ‡æ˜Žä¿å­˜æ–‡ä»¶çš„ä½ç½®;127.0.0.1:25612&gt; CONFIG GET dir1) &quot;dir&quot;2) &quot;/var/lib/redis&quot; AOF: é‡å†™è¿‡ç¨‹: (1) redis ä¸»è¿›ç¨‹é€šè¿‡forkåˆ›å»ºå­è¿›ç¨‹; (2) å­è¿›ç¨‹æ ¹æ®rediså†…å­˜ä¸­çš„æ•°æ®åˆ›å»ºæ•°æ®åº“é‡å»ºå‘½ä»¤åºåˆ—äºŽä¸´æ—¶æ–‡ä»¶ä¸­; (3) çˆ¶è¿›ç¨‹ç»§æ‰¿clientçš„è¯·æ±‚æ—¶ï¼Œå¹¶ä¼šæŠŠè¿™äº›è¯·æ±‚ä¸­çš„å†™æ“ä½œç»§ç»­è¿½åŠ è‡³åŽŸæ¥çš„AOFæ–‡ä»¶; é¢å¤–åœ°ï¼Œè¿™äº›æ–°çš„å†™è¯·æ±‚è¿˜ä¼šè¢«æ”¾ç½®äºŽä¸€ä¸ªç¼“å†²é˜Ÿåˆ—ä¸­; (4) å­è¿›ç¨‹é‡å†™å®Œæˆï¼Œä¼šé€šçŸ¥çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹æŠŠç¼“å†²ä¸­çš„å‘½ä»¤å†™åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­; (5) çˆ¶è¿›ç¨‹ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢è€çš„aofæ–‡ä»¶; appenonly no #æ²¡æœ‰å¼€å¯AOF åŠŸèƒ½; appendfilename &quot;appendonly.aof&quot; # æ–‡ä»¶å appendfsync eversec # æ¯ç§’ä¸­å†™ä¸€æ¬¡ no-appedfsync-no-rewrite no # å¯¹æ–°çš„æ“ä½œä¸åšfsyncï¼Œè€Œæ˜¯æ”¾åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­çš„; auto-aof-rewrite-percentage 100 # å½“å‰afo æ–‡ä»¶æ˜¯ä¸Šæ¬¡çš„ä¸¤å€æ—¶ï¼Œå†é‡æ–°è§¦å‘é‡å†™æ“ä½œ; auto-aof-rewrite-min-size 64mb # 127.0.0.1:25612&gt; CONFIG SET appendonly yesOK# æ³¨æ„: æŒä¹…æœ¬èº«ä¸èƒ½å–ä»£å¤‡ä»½: è¿˜åº”è¯¥åˆ¶å®šå¤‡ä»½ç­–ç•¥,å¯¹redisæ•°æ®åº“è¿›è¡Œå®šæœŸå¤‡ä»½;# RDBä¸ŽAOFåŒæ—¶å¯ç”¨: (1) BGSAVEå’ŒBGREWRITEAOF ä¸ä¼šåŒæ˜¯æ‰§è¡Œ; (2) åœ¨RedisæœåŠ¡å™¨å¯ç”¨äºŽæ¢å¤æ•°æ®æ—¶ï¼Œä¼šä¼˜å…ˆä½¿ç”¨AOF; Rediså¤åˆ¶:12345678910111213ç‰¹ç‚¹: ä¸€ä¸ªMaster å¯ä»¥æœ‰å¤šä¸ªSlave; æ”¯æŒé“¾å¼å¤åˆ¶; Masterä»¥éžé˜»å¡žæ–¹å¼åŒæ­¥æ•°æ®è‡³slave; æ³¨:ä¸»æœåŠ¡å™¨ä¸å»ºè®®å…³é—­æŒä¹…åŒ–;slave: &gt; SLAVEOF MASTER_IP MASTER_PORT min-salves-to-write 3 # è‡³å°‘åº”è¯¥æœ‰ä¸‰ä¸ªä»ŽèŠ‚ç‚¹ï¼Œå°äºŽä¸‰ä¸ªï¼Œç¦æ­¢ä¸»æœåŠ¡å™¨å†™æ“ä½œ; min-salves-max-lag # ä»ŽæœåŠ¡å™¨å¿…éœ€ä¸èƒ½æ»žåŽäºŽæœåŠ¡å™¨10ç§’ä»¥ä¸Š;æ³¨æ„: å¦‚æžœmasterä½¿ç”¨requirespasså¼€å¯äº†è®¤è¯åŠŸèƒ½ï¼Œä»ŽæœåŠ¡å™¨è¦ä½¿ç”¨masterauth &lt;PASSWORD&gt;; æ¥è¿žå…¥æœåŠ¡è¯·æ±‚ä½¿ç”¨æ­¤å¯†ç è¿›è¡Œè®¤è¯; sentinal: ä¸‡ä¸€ä¸»æœåŠ¡å™¨å²©äº†ï¼Œé‚£ä¹ˆå®ƒä¼šä»Žä»ŽæœåŠ¡å™¨èŠ‚ç‚¹ä¸­é€‰åˆ™ä¸€å°æœåŠ¡å™¨æˆä¸ºä¸»èŠ‚ç‚¹; ä¸‡sentinal æ•…éšœï¼Œæˆ–è€…è¿žæŽ¥ä¸ä¸Šä¸»èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦sentinalé…ç½®å¤šä¸ªèŠ‚ç‚¹; sentinel:1234567891011121314151617181920212223242526272829303132333435ç”¨äºŽç®¡ç†å¤šä¸ªredisæœåŠ¡å®žçŽ°HA; ç›‘æŽ§; é€šçŸ¥; è‡ªåŠ¨æ•…éšœè½¬ç§»; æœ¬è´¨ä¸Šï¼Œsentinelä¹Ÿæ˜¯redisçš„åˆ†å¸ƒå¼åŠŸèƒ½; ä½¿ç”¨æµè¨€åè®®ã€æŠ•ç¥¨åè®®;ç¨‹åº: redis-sentinel /path/to/file.conf redis-server /path/to/file.conf(1) æœåŠ¡å™¨è‡ªèº«åˆå§‹åŒ–ï¼Œè¿è¡Œredis-serverä¸­ä¸“ç”¨äºŽsentinelåŠŸèƒ½çš„ä»£ç ;(2) åˆå§‹åŒ–sentinelçŠ¶æ€ï¼Œæ ¹æ®ç»™å®šçš„é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–ç›‘æŽ§çš„masteræœåŠ¡å™¨åˆ—è¡¨;(3) åˆ›å»ºè¿žå‘masterçš„è¿žæŽ¥ï¼›ä¸“ç”¨é…ç½®æ–‡ä»¶: /etc/redis-sentinel.conf(1) # sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt; sentinel monitor mymaster 127.0.0.1 6379 2(2) # sentinel down-after-millisenconds &lt;master-name&gt; &lt;millisends&gt; sentinel down-afer-millisenconds mymaster 3000(3) # sentinel parellel-syncs &lt;master-name&gt; &lt;numslaves&gt; seninel parallel-syncs mymaster 1 (4) # sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt; sentinel failover-timeout mymaster 180000ä¸»è§‚ä¸‹çº¿,å®¢è§‚ä¸‹çº¿: ä¸»è§‚ä¸‹çº¿: ä¸€ä¸ªsentinelå®žä¾‹åˆ¤æ–­å‡ºæŸèŠ‚ç‚¹ä¸‹çº¿: å®¢è§‚ä¸‹çº¿:å¤šä¸ªseninel èŠ‚ç‚¹åå•†åŽåˆ¤æ–­å‡ºæŸèŠ‚ç‚¹ä¸‹çº¿:ä¸“ç”¨å‘½ä»¤: SENTINEL masters SENTINEL slaves &lt;master name&gt; SENTINEL get-master-addr-by-name &lt;master name&gt; SENTINEL reset SENTINEL failover &lt;master name&gt;Clustering: åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œé€šè¿‡åˆ†ç‰‡æœºåˆ¶è¿›è¡Œæ•°æ®åˆ†å¸ƒï¼Œclusteringå†…çš„æ¯ä¸ªå­èŠ‚ç‚¹ä»…æ•°æ®åº“çš„ä¸€éƒ¨åˆ†æ•°æ®;]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginxçš„å¸¸ç”¨æž¶æž„]]></title>
    <url>%2F2018%2F04%2F26%2Fnginx%E5%B8%B8%E7%94%A8%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[Nginx å¸¸ç”¨æž¶æž„ LB Cluster12345678910æå‡ç³»ç»Ÿå®¹é‡çš„æ–¹å¼: scale up: scale out:sessionä¿æŒæ–¹æ³•: sessionç»‘å®š:sh sessionå¤åˆ¶: sessionæœåŠ¡å™¨: memchached redis (key-value,kv store) å¯¹url åšhash è®¡ç®—åŽï¼Œåšä¸ºkey å¯¹url å¯¹åº”çš„å†…å®¹åšä¸ºvalue I/Oï¼š12345678910111213141516åŒæ­¥/å¼‚æ­¥:è¢«è°ƒç”¨è€…ï¼Œåœ¨æ”¶åˆ°è°ƒç”¨è¯·æ±‚åŽï¼Œæ˜¯å¦ç«‹å³è¿”å›žã€‚è¿˜æ˜¯å¾—åˆ°æœ€ç»ˆç»“æžœåŽæ‰è¿”å›žï¼› é˜»å¡ž/éžé˜»å¡ž:è°ƒç”¨è€…å‘èµ·è°ƒç”¨ä¹‹åŽï¼Œåœ¨æ”¶åˆ°å“åº”ç»“æžœä¹‹å‰ï¼Œæ˜¯å¦ä¼šè¢«æŒ‚èµ·ï¼Œè¢«æŒ‚èµ·ï¼Œè¢«ç§°ä¸ºé˜»å¡žï¼ŒéžæŒ‚èµ·ä¸ºéžé˜»å¡ž;I/Oç½‘ç»œç¼–ç¨‹æ¨¡åž‹ä¸­ï¼Œå¸¸ç”¨ç½‘ç»œæ¨¡åž‹æœ‰5ç§;1ã€åŒæ­¥é˜»å¡ž 2ã€åŒæ­¥éžé˜»å¡ž3ã€å¤ç”¨åž‹I/O4ã€(Event Driver) äº‹ä»¶é©±åŠ¨5ã€å¼‚æ­¥I/Olibevent: é¡¹ç›® epoll()å¯ä»¥å¯¹nginxè¿›ç¨‹å¯¹CPUçš„æ ¸å¿ƒæ•°æ¥è¿›è¡Œç»‘å®š;LRU:æœ€è¿‘æœ€å°‘ç¼“å­˜æ¡ç›®ç®—æ³•;å¹³æ»‘å‡çº§ï¼Œå¹³æ»‘æ•…éšœå¤„ç†ï¼Œæˆ–è€…ç°åº¦å‘å¸ƒ;å¯¹äºŽwebæœåŠ¡å™¨æ¥è¯´ï¼Œæ—¥å¿—è‡³å…³é‡è¦ï¼Œéœ€è¦å¯¹æ—¥å¿—è¿›è¡Œåˆ†æž;CacheManager: ç¼“å­˜çš„å¤±æ•ˆï¼Œè¿‡æœŸæ£€éªŒåŠæ¸…ç†æ“ä½œ; Nginx é…ç½®123456789101112131415main, event, http åŸºäºŽcè¯­è¨€é£Žæ ¼ï¼›httpd&#123; drective server&#123; listen server_name location&#123; if &#123; &#125; &#125; &#125; server &#123; &#125;&#125; nginx çš„å®‰è£…åŒ…1234567891011# è¿™é‡Œé‡‡ç”¨çš„é‡‡ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„epelæº# cd /etc/yum.repos.d/epel.repo[epel]name=Extra Packages for Enterprise Linux 7 - $basearchenabled=1failovermethod=prioritybaseurl=http://mirrors.cloud.aliyuncs.com/epel/7/$basearchgpgcheck=0gpgkey=http://mirrors.cloud.aliyuncs.com/epel/RPM-GPG-KEY-EPEL-7# yum -y install nginx# rpm -q --scripts nginx # æŸ¥çœ‹nginx çš„å®‰è£…å‰è„šæœ¬ï¼Œå¸è½½åŽè„šæœ¬; ngx_http_proxy_module æ¨¡å—1234567891011121314server &#123; listen server_name location /&#123; proxy_pass http://172.16.55.180:80/ proxy_set_header Host $host # è®¾å®šè¯·æ±‚æŠ¥æ–‡çš„ï¼ŒHosté¦–éƒ¨ï¼Œä¸€èˆ¬apacheåŸºäºŽä¸»æœºåè§£æžçš„é‡è¦é¦–éƒ¨ä¿¡æ¯; proxy_set_header X-Real-IP $remote_addr; &#125;&#125;# è¯·æ±‚åˆ°ä»£ç†æœåŠ¡å™¨çš„è¿‡ç¨‹ï¼ŒNingxæŠŠæŠ¥æ–‡æ‹†é™¤ï¼Œäº†è§£è¯·æ±‚çš„å†…å®¹æ˜¯ä»€ä¹ˆ;# äºŽæ˜¯Nginxéœ€è¦é‡æ–°æž„å»ºè¯·æ±‚æŠ¥æ–‡ ï¼Œæ¥é€åˆ°çš„åŽç«¯æœåŠ¡å™¨;# cipï¼ˆå®¢æˆ·ç«¯ ipï¼‰ --&gt; pip(ä»£ç†ip) --&gt; lip(æœ¬åœ°ip) --&gt; uip(åŽç«¯æœåŠ¡å™¨ip);http://www.ssjinyao.comhttp://mysql.ssjinyao.com 12345678910111213141516171819202122232425262728293031# åœ¨node1ä¸­é…ç½®ä¸€å°httpdæœåŠ¡# echo &quot;&lt;h1&gt;node1&lt;/h1&gt;&quot; &gt; /var/www/html/index.html# systemctl start httpd # åœ¨node2ä¸­ é…ç½®ä¸€å°httpd æœåŠ¡echo &quot;&lt;h1&gt;node2&lt;/h1&gt;&quot; &gt; /var/www/html/index.html# systemctl start httpd æ ¼å¼: localtion /uri &#123; proxy_pass http://back_server:port/newuri; &#125; # è¿™æ ·çš„é…ç½® uri å°†è¡¥åˆ°newuriçš„åŽé¢ location /uri &#123; rewrite http://back_server:port/newuri # proxy_pass http://back_server:port/newuri &#125; # è¿™æ ·çš„é…ç½® uri å°†é‡å†™åˆ°newuri /uri --&gt; /newuri# cd /etc/nginx/conf.d/# cp defalt.conf&#123;,.bak&#125;# vim default.confserver_name www.ssjinyao.com;location / &#123; proxy_ass http://172.16.55.128/; index index.htm index.html ;&#125;# systemctl restart nginx# tial -f /var/log/nginx/access.log 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152# åœ¨node2 apache ç«¯è¿›è¡Œç¼–è¾‘# mkdir /var/www/html/bbs# echo &quot;&lt;h1&gt; bbs on node2 &lt;/h1&gt;&quot; /var/www/html/bbs/index.html# å¯¹åº”çš„åœ¨nginx ç«¯location /bbs/ &#123; proxy_pass http://172.16.55.128/bbs/;&#125;# nginx -t or # sevice nginx configtest # systemctl rsload nginx # æˆ–è€…å¯ä»¥ä½¿ç”¨forumlocation /forum/ &#123; proxy_cache mycache; proxy_cache_valid 200 1h; proxy_cache_valid 301 302 10m; proxy_cache_valid any 1m; proxy_cache_use_statle error timeout invalid_header http_500 http_502 http_503 http504; # ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨è¿‡æœŸç¼“å­˜ proxy_pass http://172.16.55.128/bbs/; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr;&#125;# nginx -t # systemctl reload nginxlocation ~* \.(jpg|png|gif)$ &#123; proxy_pass http://172.16.55.128; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr;&#125;# nginx -t # systemctl reload nginx # æ³¨æ„ åœ¨location è¿›è¡Œæ­£åˆ™åŒ¹é…çš„æ¨¡å¼åŒ¹é…æ—¶# proxy_pass åŠ http://172.16.55.128; è¿™ä¸ªä½ç½®è¿™åŽä»€ä¹ˆéƒ½ä¸èƒ½å¸¦çš„ï¼Œ/ ä¹Ÿä¸èƒ½å¸¦çš„ï¼Œå¦åˆ™ä¼šæŠ¥è¯­æ³•é”™è¯¯; # apache è®°å½•å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¥å¿—,å‘åŽç«¯å‘é€ç‰¹å®šé¦–éƒ¨;éœ€è¦åœ¨Logformatä¸­åŠ å…¥ å°†ç¬¬ä¸€ä¸ªå€¼ %h æ¢æˆ%&#123;X-Real-IP&#125;i# systemctl restart httpd # å®šä¹‰proxyç¼“å­˜ # åœ¨nginx httpd æ®µä¸­é…ç½®cache path;# vim /etc/nginx/nginx.confproxy_cache_path /cache/nginx/ level=1:1:1 keys_zone=mycache:32m;# mkdir -pv /cache/nginx# chown -R nginx.nginx /cache/nginxproxy_connect_timeout: nginx proxy è¯·æ±‚è¿žæŽ¥åˆ°åŽç«¯è¿žæŽ¥è¯·æ±‚çš„è¶…æ—¶æ—¶é•¿;proxy_hide_header: è®¾å®šå“åº”åˆ°å®¢æˆ·ç«¯æ—¶éœ€è¦éšè—çš„é¦–éƒ¨ä¿¡æ¯;â€˜proxy_buffers 8k; æŒ‡å®šç¼“å†²å¤§å° upstream(è´Ÿè½½å‡è¡¡) æ¨¡å—upstream æ¨¡å—åªèƒ½ä½¿ç”¨åœ¨httpæ®µä¸­ ä¾‹å­ 1234567891011121314151617181920212223# æ³¨ å¯ç”¨è´Ÿè½½å‡è¡¡æ—¶è¦æŠŠç¼“å­˜å…³äº†upstream backend &#123; server www.ssjinyao.com weight=5 server 127.0.0.1:8080 max_fails=3 fail_timeout=30s; server unix:/tmp/backend3; server backup1.ssjinyao.com backup;&#125; upstream upservers &#123; ip hash; server 172.16.55.127 max_fail=2 fail_timeout=2 # è‡ªå¸¦å¥åº·çŠ¶æ€æ£€æµ‹åŠŸèƒ½; # server 172.16.55.128 weight=2; server 172.16.55.129 bakup;&#125;server_name www.ssjinyao.com;location / &#123; proxy_pass http://upservers/;&#125;# nginx -t # systemctl reload nginx SNATæ¨¡å¼çš„å¤§é‡çš„Client1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253åŸºäºŽstickyå®žçŽ°sessionç»‘å®š: cookie è€Œæˆ‘ä»¬ä¸€èˆ¬å¸¸ç”¨çš„æ˜¯åŸºäºŽcookieçš„ç»‘å®š; route learn() éœ€è¦Nginx åœ¨ 1.8 ç‰ˆæœ¬ä»¥ä¸Š;example:upstream backend &#123; server backend1.example.com; server backend2.example.com; sticky cookie srv_id expires=1h domain=.example.com path=/;&#125;least_conn:è°ƒåº¦æ–¹æ³•ï¼Œæœ€å°‘è¿žæŽ¥;upstream memcached_backend &#123; server 127.0.0.1:11211; server 172.16.55.121:11211; keepavlie 32;&#125;server &#123; ... location /memcached/ &#123; set $memcached_key $uri; memcached_pass memcached_backend; &#125; &#125;location / &#123; proxy_pass http://backend; health_check;&#125; helth_check; å³å¥åº·çŠ¶æ€æ£€æŸ¥; å»ºè®®: å…³é—­è®¿é—®æ—¥å¿—; http &#123; server &#123; ... location / &#123; proxy_pass http://backend; health_check match=welcome; # åšå­—ç¬¦ä¸²åŒ¹é…; &#125; &#125; metch welcome &#123; status 200; header Content-Type = text/html; body ~ &quot;Welcome to nginx&quot;; &#125;&#125; Nginx è‡ªå®šä¹‰é¦–éƒ¨ç»™å®¢æˆ·ç«¯123456789101112131415161718192021222324# ä»£ç†æœåŠ¡å™¨å“åº”ç»™å®¢æˆ·ç«¯æ—¶ï¼Œå¦‚ä½•è‡ªå®šä¹‰å“åº”é¦–éƒ¨; listen 443; server_name www.ssjinyao.com; add_header SSJinYao-Server &apos;Next-SSJinYao&apos;; add_header SSJinYao-IP $server_addr; add_header X-Cache $upstream_cache_status; add_header Name &apos;ssjinyao&apos;; # curl -I https://www.ssjinyao.com # å®šä¹‰å®Œå“åº”é¦–éƒ¨åŽï¼Œè¿›è¡ŒéªŒè¯;HTTP/1.1 200 OKServer: nginxDate: Tue, 24 Apr 2018 07:24:37 GMTContent-Type: text/html; charset=UTF-8Content-Length: 39777Connection: keep-aliveVary: Accept-EncodingLast-Modified: Thu, 19 Apr 2018 09:14:18 GMTETag: &quot;9b61-56a2fff0c14a1&quot;SSJinYao-Server: Next-SSJinYaoSSJinYao-IP: 172.31.253.156X-Cache: HITName: ssjinyaoAccept-Ranges: bytes fast-cgi ä½¿ç”¨1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374LNMP# yum -y install php-fpm# rpm -ql php-fpm # vim /etc/php-fpm.d/www.conf# systemctl start php-fpm # vim /etc/nginx.conf.d/default.conflocation / &#123; root /usr/share/nginx/html; index index.php index.html index.htm;&#125;location ~\.php$ &#123; fastcgi_cache fcgicache; fastcgi_cache_valid 200 10m; fastcgi_cache_valid 302 3m; fastcgi_cache_valid any 1m; root /usr/share/nginx/html; fastcgi_pass 127.0.0.1:9000; fastcgi_index indexphp; fastcgi_param SCRIPT_FILENAME /scripts$fastcgi-script_naame; indclude fastcgi_paramgs;&#125;# systemctl restart nginx# è‹¥è°ƒç”¨fastcgi å¤±è´¥ # ç¼–è¾‘/etc/nginx/fastcgi_paramsï¼Œå°†å…¶å†…å®¹æ›´æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼šfastcgi_param GATEWAY_INTERFACE CGI/1.1;fastcgi_param SERVER_SOFTWARE nginx;fastcgi_param QUERY_STRING $query_string;fastcgi_param REQUEST_METHOD $request_method;fastcgi_param CONTENT_TYPE $content_type;fastcgi_param CONTENT_LENGTH $content_length;fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;fastcgi_param SCRIPT_NAME $fastcgi_script_name;fastcgi_param REQUEST_URI $request_uri;fastcgi_param DOCUMENT_URI $document_uri;fastcgi_param DOCUMENT_ROOT $document_root;fastcgi_param SERVER_PROTOCOL $server_protocol;fastcgi_param REMOTE_ADDR $remote_addr;fastcgi_param REMOTE_PORT $remote_port;fastcgi_param SERVER_ADDR $server_addr;fastcgi_param SERVER_PORT $server_port;fastcgi_param SERVER_NAME $server_name;# nginx -s reload# yum -y install php-mysql mariadb maraidb-server# cd /usr/share/nginx/html# vim index.php&lt;?php $conn = mysql_connect(&apos;127.0.0.1&apos;,&apos;root&apos;,&apos;&apos;); if ($conn) echo succ else echo fail; mysql_close();?&gt;# å½“LNMP çŽ¯å¢ƒè·‘èµ·æ¥æ—¶ï¼Œå¯ä»¥é€šåŒ¹é…ååƒä»£ç†æ¥å®žçŽ°åŠ¨é™åˆ†ç¦»;(1) rootä¸ºåŒä¸€è·¯å¾„;(2) rootä¸ºä¸åŒè·¯å¾„; location \.php$&#123; root /web/app/wp; &#125; location / &#123; root /web/htdocs; &#125; (3) fpm server ä¸ºå¦ä¸€ä¸»æœº ; location \.php$&#123; fastcgi_pass fastcgi://172.16.55.129:9000; &#125; location / &#123; root /web/htdocs; &#125;# æ³¨: å¦‚æžœåŠ¨æ€å†…å®¹èƒ½è¿‡ç¼“å­˜æ¥è¿›è¡ŒåŠ é€Ÿçš„è¯ï¼ŒåŠ é€Ÿæ•ˆæžœæ˜¯éžå¸¸æ˜Žæ˜¾ç¤ºçš„;]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDB NOSQLçš„ä½¿ç”¨ã€åˆ†å¸ƒå¼æ­å»ºã€åˆ‡ç‰‡å­˜å‚¨]]></title>
    <url>%2F2018%2F04%2F17%2FMongoDB%20NoSQL%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[MongoDB NoSQLä½¿ç”¨NoSQL: Not Only SQL å¸¸ç”¨éœ€æ±‚åŠå®žçŽ°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980å¤§æ•°æ®é—®é¢˜: BigData å¹¶è¡Œæ•°æ®åº“ç³»ç»Ÿï¼Œæ— å…±äº«ä½“ç³»ç»“æž„ä¸­ï¼Œé‡‡ç”¨å…³ç³»ç»“æž„æ¨¡åž‹ï¼ŒåƒMySQLçš„æ°´å¹³åˆ‡ç‰‡æŠ€æœ¯,åˆ†åŒºæŸ¥è¯¢; NoSQLæ•°æ®åº“ç®¡ç†ç³»ç»Ÿ: ä¸æ˜¯ä¸€ç§å•ä¸€å•çº¯çš„æŠ€æœ¯ï¼Œéžå…³ç³»æ¨¡åž‹ã€åˆ†å¸ƒå¼ã€ä¸æ”¯æŒACIDæ•°æ®åº“è®¾è®¡èŒƒå¼; ç®€å•æ•°æ®æ¨¡åž‹; å…ƒæ•°æ®å’Œæ•°æ®åˆ†ç¦»; å¼±ä¸€è‡´æ€§; é«˜åžåé‡; é«˜æ°´å¹³æ‰©å±•èƒ½åŠ›å’Œä½Žç«¯ç¡¬ä»¶é›†ç¾¤; NewSQLæ•°æ®åº“ç®¡ç†ç³»ç»Ÿ ç›¸å…³äº§å“: Clustrixã€ GenleDB ã€ScaleBaseã€NimbusDBã€mysql(NDBClusterã€Drizzle) äº‘æ•°æ®ç®¡ç†ç³»ç»Ÿ: ç›¸å…³äº§å“: DBAAS,RDSå¤§æ•°æ®çš„åˆ†æžå¤„ç†: å¸¸è§çš„æœ‰MapReduceæœºåˆ¶:å°†å¤§çš„æ•°æ®æ˜ å°„æˆé”®å€¼å¯¹ï¼Œè€ŒåŽå¯¹å„å„é”®å€¼å¯¹å¤„ç†åŽè¿›è¡Œèšåˆ; è€Œhadoop å°±æ˜¯ç±»ä¼¼äºŽè¿™ç§ç³»ç»Ÿ; habaseä¹Ÿæ˜¯NoSQLçš„ä¸€ç§; CAP: å¼ºä¸€è‡´æ€§;å¯ç”¨æ€§;åˆ†åŒºå®¹é”™æ€§(å‡ºçŽ°è„‘è£‚çš„æ—¶å€™å¯å¦å¤„ç†ä¸šåŠ¡éœ€æ±‚); æœ€ç»ˆä¸€è‡´æ€§ç»†åˆ†: å›°æžœä¸€è‡´æ€§; è¯»è‡ªå·±å†™ä¸€è‡´æ€§; ä¼šè¯ä¸€è‡´æ€§; å•è°ƒè¯»ä¸€è‡´æ€§; æ—¶é—´è½´ä¸€è‡´æ€§; ACID &amp; BASE Atomicity åŽŸå­æ€§; Consistency ä¸€è‡´æ€§; Isolation éš”ç¦»æ€§ ; Durability æŒä¹…æ€§; BASE åŸºæœ¬å¯ç”¨; ACIDç‰¹æ€§: å¼ºä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€é‡‡ç”¨æ‚²è§‚ä¿å®ˆçš„æ–¹æ³•ã€éš¾ä»¥å˜åŒ–; BASEç‰¹æ€§: å¼±ä¸€è‡´æ€§ã€å¯ç”¨æ€§ä¼˜å…ˆã€é‡‡ç”¨ä¹è§‚çš„æ–¹æ³•ã€æ›´ç®€å•ã€æ›´å¿«; æ•°æ®ä¸€è‡´æ€§çš„å®žçŽ°æŠ€æœ¯: NRW 2PC Paxos Vecotr Clock æ•°æ®å­˜å‚¨æ¨¡åž‹: www.nosql-databases.org åˆ—å¼å­˜å‚¨æ¨¡åž‹ æ–‡æ¡£å­˜å‚¨æ¨¡åž‹ é”®å€¼æ•°æ®æ¨¡åž‹ å›¾å¼æ•°æ®æ¨¡åž‹ åˆ—å¼æ¨¡åž‹: åº”ç”¨åœºæ™¯: åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šæä¾›æ”¯æŒéšæœºè¯»å†™åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨; å…¸åž‹äº§å“: HBaseã€Hypertableã€Cassandra æ•°æ®æ¨¡åž‹: ä»¥&quot;åˆ—&quot;ä¸ºä¸­å¿ƒè¿›è¡Œå­˜å‚¨ ï¼Œå°†åŒä¸€åˆ—æ•°æ®å­˜å‚¨åœ¨ä¸€èµ·; ä¼˜ç‚¹: å¿«é€ŸæŸ¥è¯¢ã€é«˜å¯æ‰©å±•æ€§ã€æ˜“äºŽå®žçŽ°åˆ†å¸ƒå¼æ‰©å±•; æ–‡æ¡£æ¨¡åž‹: åº”ç”¨åœºæ™¯:éžå¼ºäº‹åŠ¡éœ€æ±‚çš„webåº”ç”¨; å…¸åž‹äº§å“:MongoDBã€ElasticSearch(æž„å»ºçš„æœç´¢å¼•æ“Žå·¥å…·)ã€CouchDBã€CouchBase Server æ•°æ®æ¨¡åž‹: é”®å€¼æ¨¡åž‹ï¼Œå­˜å‚¨ä¸ºæ–‡æ¡£; ä¼˜ç‚¹: æ•°æ®æ¨¡åž‹æ— éœ€äº‹å…ˆå®šä¹‰ é”®å€¼æ¨¡åž‹: åº”ç”¨åœºæ™¯: å†…å®¹ç¼“å­˜ï¼Œç”¨äºŽå¤§é‡å¹¶è¡Œæ•°æ®è®¿é—®é«˜è½½åœºæ™¯; å…¸åž‹äº§å“: Redisã€DynamoDBã€Riakã€Redis; æ•°æ®æ¨¡åž‹: åŸºäºŽå“ˆå¸Œè¡¨å®žçŽ°çš„key-valueæ¨¡åž‹; ä¼˜ç‚¹: æŸ¥è¯¢è¿…é€Ÿï¼Œ ç¼ºç‚¹ï¼šæ•°æ®æ²¡æœ‰ç»“æž„; å›¾å¼æ¨¡åž‹: åº”ç”¨åœºæ™¯: ç¤¾äº¤ç½‘ç»œã€æŽ¨èç³»ç»Ÿã€å…³ç³»å›¾æ™® å…¸åž‹äº§å“: Neo4J ã€TITAN ã€ Infinite Graph æ•°æ®æ¨¡åž‹: å›¾å¼ç»“æž„ ä¼˜ç‚¹: é€‚åº”äºŽå›¾å¼è®¡ç®—åœºæ™¯MongoDB: NoSQLã€æ–‡æ¡£å­˜å‚¨ã€Jsonæ•°æ®æ¨¡åž‹ é€‚ç”¨åœºæ™¯: Websites Caching High volume, low value High scalability Storage of program objects and json ä¸é€‚ç”¨åœºæ™¯: Hightly transactional Ad-hoc business intelligence Problems requiring SQL mongo çš„å®‰è£…ä¸Žä½¿ç”¨12345678910 # vim /etc/yum.repos.d/mongodb.repo [mongodb-org-3.4] name=MongoDB Repository baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.4/x86_64/ gpgcheck=1 enabled=1 gpgkey=https://www.mongodb.org/static/pgp/server-3.4.asc# yum clean all# yum makeacahe# yum -y install mongodb-org serveråŒ…ç”Ÿæˆçš„å…³é”®æ–‡ä»¶12345678# rpm -ql mongodb-org-server/etc/mongod.conf/lib/systemd/system/mongod.service/usr/bin/mongod/var/lib/mongo/var/log/mongodb/var/log/mongodb/mongod.log/var/run/mongodb shellåŒ…ç”Ÿæˆçš„å…³é”®æ–‡ä»¶12# rpm -ql mongodb-org-shell/usr/bin/mongo toolsåŒ…ç”Ÿæˆçš„å…³é”®æ–‡ä»¶1234567891011# rpm -ql mongodb-org-tools/usr/bin/bsondump/usr/bin/mongodump/usr/bin/mongoexport/usr/bin/mongofiles/usr/bin/mongoimport/usr/bin/mongooplog/usr/bin/mongoperf/usr/bin/mongorestore/usr/bin/mongostat/usr/bin/mongotop serverç«¯é…ç½®é¡¹1# vim /etc/mongod.conf MongoåŸºæœ¬æ“ä½œ123456789101112131415help # æŸ¥çœ‹å¸¸ç”¨çš„ä½¿ç”¨å¸®åŠ©å‘½ä»¤;db.help() # æŸ¥çœ‹å¯¹åº“æ“ä½œçš„ä½¿ç”¨å¸®åŠ©;db.mycoll.cind().help()db.mycoll.help()show dbs # æŸ¥çœ‹ç›®å‰å­˜åœ¨å“ªäº›åº“;show collections # åˆ—å‡ºåˆ—è¡¨;use testdb # åˆ‡æ¢è‡³å“ªä¸ªåº“ï¼Œæˆ–è€…æ–°å»ºå“ªä¸ªåº“ db.status() #æŸ¥çœ‹å½“å‰åº“çš„çŠ¶æ€;db.version() # æŸ¥çœ‹å½“å‰åº“çš„ç‰ˆæœ¬;db.serverStatus() # æŸ¥çœ‹å½“å‰MongoDBæœåŠ¡çš„çŠ¶æ€;show users # æŸ¥çœ‹å½“å‰å­˜åœ¨å“ªäº›ç”¨æˆ·;show logs # æŸ¥çœ‹Mongoå¼€å¯äº†å“ªäº›æ—¥å¿—è®°å½•;user db.help() # æŸ¥å¯»å¸®åŠ©;db.getCollectionNames() # æŸ¥çœ‹åˆ—è¡¨åç§°;db.students.status() #æŸ¥çœ‹æŸä¸ªåº“ï¼ŒæŸå¼ è¡¨çš„çŠ¶æ€; 12# Collection Query Criteria Modifierdb.users.find( &#123;age: &#123;$gt: 18&#125; &#125; ).sort( &#123;age: 1&#125; ) 123JSON: JavaScript Object Notation åç§°/å€¼å¯¹è±¡çš„é›†åˆ; å€¼çš„æœ‰åºåˆ—è¡¨; 123456789db.students.inert( &#123;name:&quot;tome&quot;, age:23&#125; )show clollectionsshow dbsdb.statusdb.students.stats()db.getCollectionNames()db.students.insert([name:&apos;&apos;renjin&quot;,age:23,gender:&quot;M&quot;])db.students.find() db.students.insert([name:&quot;ssjinyao&quot;,Age:23,Course:&quot;PieXieJianFa&quot;]) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546find() çš„é«˜çº§ç”¨æ³•: æ¯”è¾ƒæ“ä½œ: $gt, è¯­æ³•æ ¼å¼&#123;filed: &#123;$gt VALUE&#125;&#125;db.statuents.find(&#123;Age:&#123;$gt 23&#125;&#125;) $gte $lt $lte $ne $in,è¯­æ³•æ ¼å¼&#123;filed: &#123;$in: [&apos;value&apos;]&#125;&#125;db.students.find&#123;Age:&#123;$in: [20,23]&#125;&#125;ç»„åˆæ¡ä»¶: é€»è¾‘è¿ç®— $or: æˆ–è¿ç®—ï¼Œè¯­æ³•æ ¼å¼&#123;$or: &#123;&lt;expression1&gt;,...&#125;&#125;db.students.find(&#123;$or: &#123;Age: &#123;$nin: [20,40], age &#123;$nin:[20,40]&#125;&#125;&#125;)db.students.find(&#123;$or: [&#123;Age: &#123;$nin: [20,40]&#125;&#125;, &#123;age: &#123;$nin: [20,40]&#125;&#125;]&#125;) $and: ä¸Žè¿ç®— $not: éžè¿ç®— $nor: åè¿ç®—,è¿”å›žä¸ç¬¦æŒ‡å®šä»¶çš„æ‰€æœ‰æ–‡æ¡£å…ƒç´ æŸ¥è¯¢: æ ¹æ®æ–‡æ¡£ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„å­—æ®µè¿›è¡ŒæŸ¥è¯¢; $exists: è¯­æ³•æ ¼å¼&#123;$filed:&#123;$exists:&lt;boolean&gt;&#125;&#125; db.students.find(&#123;gender: &#123;$exits: false&#125;&#125;) $mod: $type: è¿”å›žæŒ‡å®šçš„å­—æ®µçš„å€¼çš„ç±»åž‹ä¸ºæŒ‡å®šç±»åž‹çš„æ–‡æ¡£,è¯­æ³•æ ¼å¼&#123;field:&#123;$type: &lt;BSON type&gt;&#125;&#125; Double,String,Object, Arrary, Binary data, Undefined, Boolean,Data ,Null, Regular Expression, JavaScript, Timestampæ›´æ–°æ“ä½œ: db.mycoll.update() $set: ä¿®æ”¹å­—æ®µçš„å€¼ä¸ºæ–°æŒ‡å®šçš„å€¼: è¯­æ³•æ ¼å¼&#123;filed: value&#125;, &#123;$set: &#123;filed: new_value&#125;&#125;) $unset: åˆ é™¤æŒ‡å®šå­—æ®µ;è¯­æ³•æ ¼å¼(&#123;filed: value&#125;, &#123;$unset:&#123;filed1, field2,....&#125;&#125;) db.students.update(&#123;name: &quot;renjin&quot;&#125;, &#123;$set: &#123;age: 22&#125;&#125;) $rename: æ›´æ”¹å­—æ®µå,è¯­æ³•æ ¼å¼(&#123;$rename: &#123;oldname: newname, oldname: newname&#125;&#125;) db.students.update(&#123;$rename: &#123;age:Age&#125;) $incåˆ é™¤æ“ä½œ: db.mycoll.remove(&lt;query&gt;,&lt;justOne&gt;) db.students.remove(&#123;age:21&#125;) db.students.findOne(&#123;Age: &#123;$gt:10&#125;&#125;)åˆ é™¤collection: db.mycoll.drop() db.studetns.drop()åˆ é™¤database: db.dropDatabase()php+mongodb phpçš„mongoæ‰©å±• MongoDB Indexes and Administrationç´¢å¼•ç±»åž‹: B+ Treeã€hashã€ç©ºé—´ç´¢å¼•ã€å…¨æ–‡ç´¢å¼• 1234567891011121314151617MongoDBç´¢å¼•ç±»åž‹ å•å­—æ®µç´¢å¼• ç»„åˆç´¢å¼•(å¤šå­—æ®µç´¢å¼•) å¤šé”®ç´¢å¼• ç©ºé—´ç´¢å¼• æ–‡æœ¬ç´¢å¼• hashç´¢å¼• hash ç´¢å¼•åªæ”¯æŒç²¾ç¡®å€¼æŸ¥æ‰¾ db.people.ensureIndex(&#123; zipcode:1&#125;, &#123;background: ture&#125;) db.account.ensureIndex( &#123; username: 1 &#125; , &#123;unique: ture, dropDups: true &#125;) MongoDBä¸Žç´¢å¼•ç›¸å…³çš„æ–¹æ³•: db.mycoll.ensureIndex(field[,options]) nameã€uniqueã€dropDupsã€sparse db.mycoll.dropIndex(index_name) db.mycoll.dropIndexes() db.mycoll.getIndexes() db.mycoll.reIndex() mongodb ç”¨for å¾ªçŽ¯æ¥è¿žç»­æ’å…¥æ•°æ®12345678910111213141516171819202122232425use testdbfor (i=1; i&lt;=1000;i++) db.students.insert(&#123;name:&quot;student&quot;+i, age:(i%120), address:&quot;#85 Wenhua Road, Zhengzhou, China&quot;&#125;)&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d56c&quot;), &quot;name&quot; : &quot;student1&quot;, &quot;age&quot; : 1, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d56d&quot;), &quot;name&quot; : &quot;student2&quot;, &quot;age&quot; : 2, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d56e&quot;), &quot;name&quot; : &quot;student3&quot;, &quot;age&quot; : 3, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d56f&quot;), &quot;name&quot; : &quot;student4&quot;, &quot;age&quot; : 4, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d570&quot;), &quot;name&quot; : &quot;student5&quot;, &quot;age&quot; : 5, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d571&quot;), &quot;name&quot; : &quot;student6&quot;, &quot;age&quot; : 6, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d572&quot;), &quot;name&quot; : &quot;student7&quot;, &quot;age&quot; : 7, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d573&quot;), &quot;name&quot; : &quot;student8&quot;, &quot;age&quot; : 8, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d574&quot;), &quot;name&quot; : &quot;student9&quot;, &quot;age&quot; : 9, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d575&quot;), &quot;name&quot; : &quot;student10&quot;, &quot;age&quot; : 10, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d576&quot;), &quot;name&quot; : &quot;student11&quot;, &quot;age&quot; : 11, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d577&quot;), &quot;name&quot; : &quot;student12&quot;, &quot;age&quot; : 12, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d578&quot;), &quot;name&quot; : &quot;student13&quot;, &quot;age&quot; : 13, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d579&quot;), &quot;name&quot; : &quot;student14&quot;, &quot;age&quot; : 14, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d57a&quot;), &quot;name&quot; : &quot;student15&quot;, &quot;age&quot; : 15, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d57b&quot;), &quot;name&quot; : &quot;student16&quot;, &quot;age&quot; : 16, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d57c&quot;), &quot;name&quot; : &quot;student17&quot;, &quot;age&quot; : 17, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d57d&quot;), &quot;name&quot; : &quot;student18&quot;, &quot;age&quot; : 18, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d57e&quot;), &quot;name&quot; : &quot;student19&quot;, &quot;age&quot; : 19, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d57f&quot;), &quot;name&quot; : &quot;student20&quot;, &quot;age&quot; : 20, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;Type &quot;it&quot; for more&gt; it# mongoä¸ºäº†ç»“çœæœåŠ¡å™¨èµ„æºï¼Œä¸ä¼šå°†æ‰€æœ‰çš„å­—æ®µä¸€ä¸‹å­åˆ—å‡ºæ¥ï¼Œè€Œéœ€è¦è¾“å…¥itæ¥ç¿»é¡µæŸ¥çœ‹ï¼Œä¸Žmoreç±»ä¼¼ åœ¨name 1 ä¸Šæž„å»ºå‡åºç´¢å¼•1234567891011121314151617181920212223242526 db.students.ensureIndex(&#123;name: 1&#125;)&#123; &quot;createdCollectionAutomatically&quot; : false, &quot;numIndexesBefore&quot; : 1, &quot;numIndexesAfter&quot; : 2, &quot;ok&quot; : 1&#125; db.students.getIndexes()[ &#123; &quot;v&quot; : 2, &quot;key&quot; : &#123; &quot;_id&quot; : 1 &#125;, &quot;name&quot; : &quot;_id_&quot;, &quot;ns&quot; : &quot;testdb.students&quot; &#125;, &#123; &quot;v&quot; : 2, &quot;key&quot; : &#123; &quot;name&quot; : 1 &#125;, &quot;name&quot; : &quot;name_1&quot;, &quot;ns&quot; : &quot;testdb.students&quot; &#125;] ç§»é™¤ä¹‹å‰å»ºç«‹çš„ç´¢å¼•12db.students.dropIndex(&quot;name_1&quot;)&#123; &quot;nIndexesWas&quot; : 2, &quot;ok&quot; : 1 &#125; æŸ¥çœ‹ç´¢å¼•æ˜¯å¦è¢«ç§»é™¤1234567891011 db.students.getIndexes()[ &#123; &quot;v&quot; : 2, &quot;key&quot; : &#123; &quot;_id&quot; : 1 &#125;, &quot;name&quot; : &quot;_id_&quot;, &quot;ns&quot; : &quot;testdb.students&quot; &#125;] å»ºç«‹ç»´ä¸€é”®ç´¢å¼•1234567891011121314151617181920212223242526272829db.students.ensureIndex(&#123;name: 1&#125;,&#123;unique: true&#125;)&#123; &quot;createdCollectionAutomatically&quot; : false, &quot;numIndexesBefore&quot; : 1, &quot;numIndexesAfter&quot; : 2, &quot;ok&quot; : 1&#125;&gt; &gt; &gt; db.students.getIndexes()[ &#123; &quot;v&quot; : 2, &quot;key&quot; : &#123; &quot;_id&quot; : 1 &#125;, &quot;name&quot; : &quot;_id_&quot;, &quot;ns&quot; : &quot;testdb.students&quot; &#125;, &#123; &quot;v&quot; : 2, &quot;unique&quot; : true, &quot;key&quot; : &#123; &quot;name&quot; : 1 &#125;, &quot;name&quot; : &quot;name_1&quot;, &quot;ns&quot; : &quot;testdb.students&quot; &#125;] åˆ©ç”¨ç´¢å¼•å¿«é€ŸæŸ¥è¯¢123db.students.find(&#123;name: &quot;student500&quot;&#125;)&#123; &quot;_id&quot; : ObjectId(&quot;5acdb56cdf2f304c1068d75f&quot;), &quot;name&quot; : &quot;student500&quot;, &quot;age&quot; : 20, &quot;address&quot; : &quot;#85 Wenhua Road, Zhengzhou, China&quot; &#125;db.students.find(&#123;name: &quot;student500&quot;&#125;).explain() æŸ¥çœ‹ç´¢å¼•æ‰§è¡Œè¿‡ç¨‹1234567891011121314151617181920212223242526272829303132333435363738394041424344&#123; &quot;queryPlanner&quot; : &#123; &quot;plannerVersion&quot; : 1, &quot;namespace&quot; : &quot;testdb.students&quot;, &quot;indexFilterSet&quot; : false, &quot;parsedQuery&quot; : &#123; &quot;name&quot; : &#123; &quot;$eq&quot; : &quot;student500&quot; &#125; &#125;, &quot;winningPlan&quot; : &#123; &quot;stage&quot; : &quot;FETCH&quot;, &quot;inputStage&quot; : &#123; &quot;stage&quot; : &quot;IXSCAN&quot;, &quot;keyPattern&quot; : &#123; &quot;name&quot; : 1 &#125;, &quot;indexName&quot; : &quot;name_1&quot;, &quot;isMultiKey&quot; : false, &quot;multiKeyPaths&quot; : &#123; &quot;name&quot; : [ ] &#125;, &quot;isUnique&quot; : true, &quot;isSparse&quot; : false, &quot;isPartial&quot; : false, &quot;indexVersion&quot; : 2, &quot;direction&quot; : &quot;forward&quot;, &quot;indexBounds&quot; : &#123; &quot;name&quot; : [ &quot;[\&quot;student500\&quot;, \&quot;student500\&quot;]&quot; ] &#125; &#125; &#125;, &quot;rejectedPlans&quot; : [ ] &#125;, &quot;serverInfo&quot; : &#123; &quot;host&quot; : &quot;ssjinyao&quot;, &quot;port&quot; : 27017, &quot;version&quot; : &quot;3.4.14&quot;, &quot;gitVersion&quot; : &quot;fd954412dfc10e4d1e3e2dd4fac040f8b476b268&quot; &#125;, &quot;ok&quot; : 1&#125; Mongodçš„å¸¸ç”¨å…ˆé¡¹:123456789101112131415161718General option: é€šç”¨é€‰é¡¹ fork = &#123;true|false&#125;: mongodæ˜¯å¦è¿è¡Œåœ¨åŽå°; bind_ip = IP: æŒ‡å®šç›‘å¬çš„åœ°å€; port=PORT:æŒ‡å®šç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º27017ï¼Œhttpdè®¿é—®28017; maxConns=: å¹¶å‘æœ€å¤§è¿žæŽ¥æ•°; pidfilepath=: pid æ–‡ä»¶ä½ç½®; httpinterface=:å†…ç½®httpdç»Ÿè®¡ä¿¡æ¯ç­‰; keyFile=:ä¸»ä»ŽåŒæ­¥åŸºäºŽå¯†é’¥çš„è®¤è¯; auth: æ˜¯å¦å¼€å¯è®¤è¯åŠŸèƒ½; repair: æœåŠ¡å™¨æ„å¤–é‡å¯ï¼Œæˆ–æœªæ­£é‡å…³é—­æ—¶ï¼Œè¦ä½¿ç”¨repairæ¥ä¿®å¤; journal:æ˜¯å¦å¯ç”¨æ—¥å¿—åŠŸèƒ½; jounalCommit: æ—¥å¿—æäº¤çš„æ—¶é—´é—´éš”; cpu: é—´æ–­æ€§çš„æ˜¾ç¤ºå†…å­˜CPUçš„ä½¿ç”¨çŽ‡; slowms arg: è¶…å‡ºæŒ‡å®šå€¼åŽé‡‡ç”¨æ…¢æŸ¥è¯¢; Replication options å¤åˆ¶é€‰é¡¹Master/slvae options ä¸»ä»Žå¤åˆ¶é€‰é¡¹Replica set options å¤åˆ¶é›†é€‰é¡¹Sharding options è·Ÿåˆ‡ç‰‡ç›¸å…³çš„é€‰é¡¹ MongoDBçš„å¤åˆ¶åŠŸèƒ½123456789101112131415161718192021222324252627282930313233343536373839ä¸¤ç§ç±»åž‹: master/slave replica set: å¤åˆ¶é›†ã€å‰¯æœ¬é›† ä¸¤ç§ç±»åž‹: ä¸»èŠ‚ç‚¹æ”¯æŒè¯»å†™æ“ä½œï¼Œè€Œä»ŽèŠ‚ç‚¹ä»…æ”¯æŒè¯»æ“ä½œ; æœåŠ¡äºŽåŒä¸€æ•°æ®é›†çš„å¤šä¸ªmongodbå®žä¾‹; ä¸»èŠ‚ç‚¹æ“ä½œæ•°æ®ä¿®æ”¹æ“ä½œä¿å­˜è‡³oplogä¸­; arbiter: ä»²è£è€…ï¼Œå³ä¾¿ç”¨ä¸ä¸Šä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿæ·»åŠ ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä»¥é¿å…è„‘è£‚;å·¥ä½œç‰¹æ€§:è‡³å°‘ä¸‰ä¸ªï¼Œä¸”åº”è¯¥ä¸ºå¥‡æ•°æ®ä¸ªèŠ‚ç‚¹;å¯ä»¥ä½¿ç”¨arbiteræ¥å‚ä¸Žé€‰ä¸¾; hertbeat(é»˜è®¤2sä¼ é€’ä¸€æ¬¡),è‡ªåŠ¨å¤±æ•ˆè½¬ç§»(é€šè¿‡é€‰ä¸¾æ–¹å¼å®žçŽ°)å¤åˆ¶é›†çš„ä¸­èŠ‚ç‚¹åˆ†ç±»çš„é›†ä¸­ç±»åž‹: 0ä¼˜å…ˆçº§çš„èŠ‚ç‚¹: å‡†å¤‡èŠ‚ç‚¹,è¿™ç§èŠ‚ç‚¹ä¸ä¼šé€‰ä¸¾æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œä½†å¯ä»¥å‚ä¸Žé€‰ä¸¾è¿‡ç¨‹; è¢«éšè—çš„ä»ŽèŠ‚ç‚¹: é¦–å…ˆæ˜¯ä¸€ä¸ª0ä¼˜å…ˆçº§çš„ä»ŽèŠ‚ç‚¹ï¼Œä¸”åœ°å®¢æˆ·ç«¯ä¸å¯è§; å»¶è¿Ÿå¤åˆ¶çš„ä»ŽèŠ‚ç‚¹: å½“åœ¨ä¸»èŠ‚ç‚¹è¯¯åˆ é™¤æ•°æ®æ—¶ï¼Œå¯ä»¥ç«‹å³æ–­å¼€ä¸»ä»Žï¼Œå¯ä¿ç•™ä»ŽèŠ‚ç‚¹ä¸Šæœªæ”¹å˜çš„æ•°æ®; é¦–å…ˆæ˜¯ä¸€ä¸ª0ä¼˜å…ˆçº§çš„ä»ŽèŠ‚ç‚¹ï¼Œä¸”å¤åˆ¶æ—¶é—´è½åŽäºŽä¸»èŠ‚ç‚¹ä¸€ä¸ªå›ºå®šæ—¶é•¿; arbiter:MongoDBçš„å¤åˆ¶æž¶æž„: oplog heartbeat oplog: å¤§å°å›ºå®šçš„æ–‡ä»¶ï¼Œå­˜å‚¨åœ¨localæ•°æ®åº“ä¸­; å³ä¾¿ä»ŽèŠ‚ç‚¹æœ‰aplogä¹Ÿä¸ä¼šä½¿ç”¨; åˆå§‹åŒæ­¥(initial sync) å›žæ»šåŽè¿½èµ¶(post-rollback catch-up) åˆ‡åˆ†å—è¿ç§»(sharding chunk migrations) local: å­˜æ”¾äº†å‰¯æœ¬é›†çš„æ‰€æœ‰å…ƒæ•°æ®å’Œoplog: ç”¨äºŽå­˜å‚¨aplogçš„æ˜¯ä¸€ä¸ªåä¸ºoplog.rsçš„collection aplog.rs çš„å¤§å°ä¾èµ–äºŽOS åŠæ–‡ä»¶ç³»ç»Ÿ ; Mongoçš„æ•°åŒæ­¥ç±»åž‹ : åˆå§‹åŒæ­¥: èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•æ•°æ®æ—¶ èŠ‚ç‚¹ä¸¢å¤±å‰¯æœ¬å¤åˆ¶åŽ†å² å¤åˆ¶ åˆå§‹åŒæ­¥çš„æ­¥éª¤: 1ã€å…‹éš†æ‰€æœ‰æ•°æ®; 2ã€åº”ç”¨æ•°æ®é›†çš„æ‰€æœ‰æ”¹å˜ï¼Œå¤åˆ¶oplogå¹¶åº”ç”¨äºŽæœ¬åœ°; 3ã€ä¸ºæ‰€æœ‰collectionæž„å»ºç´¢å¼•; Mongod æ•°æ®åŒæ­¥è¿‡ç¨‹123456789åˆå§‹åŒæ­¥: èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•æ•°æ® ä»ŽèŠ‚ç‚¹ä¸¢å¤±å¤æœ¬ï¼Œå¤åˆ¶åŽ†å²æ•°æ®;åˆå§‹åŒæ­¥çš„æ­¥éª¤: 1ã€å…‹éš†æ‰€æœ‰æ•°æ®åº“; 2ã€åº”ç”¨æ•°æ®é›†çš„æ‰€æœ‰æ”¹å˜;å¤åˆ¶oplogå¹¶åº”ç”¨åœ¨æœ¬åœ°; 3ã€ä¸ºæ‰€æœ‰çš„collectionæž„å»ºç´¢å¼•;è¿™æ ·åˆå§‹åŒæ­¥å°±å®Œæˆäº†;ä¼˜äºŽMySQLçš„åœ°æ–¹ï¼Œ MongoDB æ”¯æŒå¤šçº¿ç¨‹å¤åˆ¶åŠŸèƒ½; 12345# vim /etc/mongd.confreplSet=testSetreplIndexPrefetch=_id_only# systemctl mongod restart 123show dbsuse localshow collections 12345# node2çš„é…ç½®# å°†éœ€è¦å®‰è£…çš„rpm åŒ…å¤åˆ¶åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸Šï¼Œæˆ–è€…åœ¨å¦ä¸€å°æœåŠ¡å™¨ä¸Šé…ç½®mongoçš„yumæº;# yum -y install mongodb-org-server# mkdir -pv /mongodb/data# chown -R mongod.mongod /mongodb 12345# node3çš„é…ç½®# å°†éœ€è¦å®‰è£…çš„rpm åŒ…å¤åˆ¶åˆ°ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæˆ–è€…åœ¨å¦ä¸€å°æœåŠ¡å™¨ä¸Šé…ç½®mongoçš„yumæº;# yum -y install mongodb-org-server# mkdir -pv /mongodb/data # chown -R mongod.mongod /mongodb 123# scp /etc/mongod.conf root@node2:/etc/ # scp /etc/mongod.conf root@node3:/etc/# ä¿è¯ä¸‰ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¸€è‡´ï¼Œå¹¶å°†æœåŠ¡å™¨å¯åŠ¨; 1234567891011121314rs.conf()rs.status()rs.initiate()rs.status()rs.help() # æŸ¥æ‰¾mongoçš„å¸®åŠ©æ–‡æ¡£ï¼ŒæŸ¥çœ‹å¦‚ä½•æ·»åŠ ä¸»æœºè¿›æ¥, rs. ä¸»è¦æŒ‡mongoçš„åˆ†å¸ƒå¼é…ç½®;rs.add(&quot;172.16.55.128&quot;) # åœ¨ä¸»èŠ‚ç‚¹çš„mongoä¸­æ‰§è¡Œ;show dbs # ä»ŽèŠ‚ç‚¹é»˜è®¤æ˜¯ä¸æ”¯æŒæŸ¥è¯¢çš„ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨å¼€å¯;# åœ¨node2 èŠ‚ç‚¹ä¸­ï¼Œå°†å½“å‰æœåŠ¡å™¨èŠ‚ç‚¹æ”¹ä¸ºä»ŽèŠ‚ç‚¹;rs.salveOK() rs.status()rs.isMaster() # æŸ¥çœ‹è‡ªå·±æ˜¯å¦ä¸ºä¸»èŠ‚ç‚¹;# å› æ­¤ï¼Œå½“æœåŠ¡å™¨æ”¹ä¸ºä»ŽèŠ‚ç‚¹ä¹‹åŽå¯ä»¥åœ¨ä»ŽèŠ‚ç‚¹ä¸ŠæŸ¥è¯¢ä¿¡æ¯; # db.statudents.findOne(); 12345# ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹rs.add(&quot;172.16.55.129&quot;) # åœ¨ä¸»èŠ‚ç‚¹çš„mongoä¸­æ‰§è¡Œ# åœ¨ node3 èŠ‚ç‚¹ä¸­ï¼Œå°†å½“å‰æœåŠ¡å™¨èŠ‚ç‚¹æ”¹ä¸ºä»ŽèŠ‚ç‚¹ï¼›rs.salveOK()# æ³¨è¦å†™æ•°æ®çš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦åˆ°ä¸»èŠ‚ç‚¹ä¸­æ”¯å†™; 1234567db.classes.insert(&#123;class: &quot;One&quot;, nostu: 40&#125;) # å°è¯•åœ¨ä¸»èŠ‚ç‚¹ä¸­æ’å…¥æ•°æ®;show collections # è¿™é‡Œä¸»æœåŠ¡å™¨å¯¹åº”çš„æ•°æ®å·²ç»æœ‰äº†;db.classes.findOne() # å°è¯•åœ¨ä»ŽæœåŠ¡å™¨ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œå¦‚æŸ¥æœ‰æ•°æ®ï¼Œåˆ™è¯´æ˜Žæ•°æ®åŒæ­¥æ²¡æœ‰é—®é¢˜;# ä»ŽèŠ‚ç‚¹ä¸­æ˜¯ä¸èƒ½å†™å…¥æ•°æ®;rs.stepDown() # å°†ä¸»èŠ‚ç‚¹å¼ºåˆ¶æˆä¸ºä»ŽèŠ‚ç‚¹;rs.status() # å¯ä»¥çœ‹å‡ºï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šè‡ªåŠ¨æˆä¸ºä¸»èŠ‚ç‚¹;db.printReplicationInfo() # æŸ¥çœ‹äº§ä¸­äº‹ä»¶çš„é—´æ—¶ï¼Œå¤§å°; å‰¯æœ¬é›†çš„é‡æ–°å…ˆä¸¾çš„å½±å“æ¡ä»¶:12345å¿ƒè·³ä¿¡æ¯ä¼˜å…ˆçº§optimeç½‘ç»œè¿žæŽ¥ç½‘ç»œåˆ†åŒº å…ˆä¸¾æœºåˆ¶:1234567è§¦å‘é€‰ä¸¾çš„äº‹ä»¶ æ–°å‰¯æœ¬é›†åˆå§‹åŒ–æ—¶; ä»ŽèŠ‚ç‚¹è”ç³»ä¸åˆ°ä¸»èŠ‚ç‚¹æ—¶; ä¸»èŠ‚ç‚¹&quot;ä¸‹å°&quot;æ—¶; ä¸»èŠ‚ç‚¹æ”¶åˆ°stepDown()å‘½ä»¤æ—¶; æŸä»ŽèŠ‚ç‚¹æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ä¸”å·²ç»æ»¡è¶³äº†æˆä¸»èŠ‚ç‚¹çš„å…¶å®ƒæ‰€æœ‰æ¡ä»¶; ä¸»èŠ‚ç‚¹æ— æ³•è”ç³»åˆ°å‰¯æœ¬é›†çš„&quot;å¤šæ•°æ–¹&quot;ï¼› 1234567891011cfg= rs.conf() # ä¿å­˜å½“å‰mongoçš„é…ç½®ï¼›cfg.member[1].priority=2rs.conf() # è¿™æ—¶çš„é…ç½®ä¾ç„¶æ˜¯1rs.reconfig(cfg) # ç”Ÿæ•ˆé…ç½®åˆ™å¿…éœ€è¦åœ¨ä¸»èŠ‚ç‚¹ä¸­è¿›è¡Œ;# è§¦å‘æ–°çš„é€‰ä¸¾æœºåˆ¶ï¼›cfg = rs.confg()cfg.member[2].abiterOnly=ture # è®¾ç½®abiterOnly å±žæ€§;rs.reconfgi(cfg)rs.conf()rs.printSlaveReplicationInfo() # åŒæ—¶ä¹Ÿå¯ä»¥çœ‹æ˜¯æ¯ä¸ªä»ŽèŠ‚ç‚¹æ˜¯å¦è½åŽäºŽä¸»èŠ‚ç‚¹; MongoDBçš„åˆ†ç‰‡:12345678910111213141516171819sharding åˆ†ç‰‡ # éšç€å…¬å¸ä¸šåŠ¡çš„åˆ†å±•ï¼Œæ•°æ®é›†ä¼šå˜çš„è¶Šæ¥è¶Šå¤§ï¼› # ä¼šåœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼ŒCPUï¼Œå†…å­˜ï¼ŒIO ç­‰å•æœºä¸Šå‡ºçŽ°ç“¶é¢ˆ; # å› æ­¤å‘ä¸Šå¤–å‘å¤–æ‰©å±•ï¼Œå‘ä¸Šæ‰©å±•æ˜¯ç»æµŽå½¢åŠ¿çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä»ŽæŠ€æœ¯è§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å‘å¤–æ‰©å±•;MySQL: Gizzard, HivedDB(ç‹¬ç«‹çš„é¡¹ç›®ï¼Œè½¬é—¨æ¥å¯¹MySQLæ¥å®žçŽ°åˆ†ç‰‡çš„)ï¼ŒMySQL Proxy + HSACLE, Hibernate Shared Pyshards # åˆ†ç‰‡æž¶æž„ä¸­çš„è§’è‰²: mongos: Router; config server: å…ƒæ•°æ®æœåŠ¡å™¨; shard: æ•°æ®èŠ‚ç‚¹ï¼Œä¹Ÿç§°mongodå®žä¾‹èŠ‚ç‚¹; è´Ÿè´£å°†æ•°æ®å­˜ä¸‹æ¥ï¼Œå¹¶å“åº”å®¢æˆ·ç«¯çš„; zookeeper: é€šå¸¸ç”¨äºŽåˆ†å¸ƒå¼èŠ‚ç‚¹çš„åè°ƒ; # åŸºäºŽèŒƒå›´åˆ‡ç‰‡ range # åŸºäºŽåˆ—è¡¨åˆ‡ç‰‡ list # åŸºäºŽhashåˆ‡ç‰‡ hash å†™ç¦»æ•£ï¼Œè¯»è¦é›†ä¸­ åˆ†ç‰‡å¼æž¶æž„é…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657# rm -rf /mongodb/data/ # æ³¨: åœ¨ç”Ÿäº§ä¸­ï¼Œè¿™ä¸ªæ“ä½œéžå¸¸å±é™©ï¼éœ€è¦å°†æ•°æ®åº“ç”¨mongodump å¤‡ä»½ï¼›# å°†mongodb å®‰è£…çš„rpmåŒ…ï¼Œæˆ–è€…yumçš„é…ç½®æ–‡ä»¶ç”¨ansible æˆ–scp åŒæ­¥åˆ°å…¶å®ƒå››ä¸ªèŠ‚ç‚¹ä¸ŠåŽ»;# åœ¨å››ä¸ªèŠ‚ç‚¹å°†mongodb ç›¸å…³è½¯ä»¶åŒ…éƒ½å®‰è£…å¥½# å…ˆè¦é…ç½®config server --&gt; mongos --&gt; Shard1 --&gt; Shard2-------------------------&gt; confiserver æœåŠ¡å™¨é…ç½®# vim /etc/mongod.conf# replSet=testSet# replIndexPrefetch=id_only # dbpath=/mongodb/dataconfigsvr=true# chown -R mongod.mongod /mongodb# install -o mongod -g mongod -d /mongodb/data # å»ºç«‹æ•°æ®åº“çš„å…ƒæ•°æ® ;# systemctl start mongod mongo # config server é»˜è®¤ç›‘å¬åœ¨27019çš„ç«¯å£ä¸Š; -----------------------&gt; mongofs æœåŠ¡å™¨é…ç½®# yum -y insetall mongodb-org-mongos # # å¯åŠ¨ mongofs èŠ‚ç‚¹# mongos --configdb=172.16.55.172.16.55.128 --fork --logpath=/var/log/mongodb/mongo.log# mongo --host 172.16.55.127helpsh.status() # ä»¥ä¸‹èŠ‚ç‚¹èµ·åŠ¨åŽsh.addShard(&quot;172.16.55.129&quot;)ss.addShard(&quot;172.16.55.120&quot;)sh.enableShareding(&quot;testdb&quot;) # åœ¨testdbä¸­å¯æœ‰shardåŠŸèƒ½;sh.help() # æŸ¥æ‰¾shardsé›†ç¾¤ç›¸å…³çš„é…ç½®é¡¹;sh.enableSharding(dbname) # åœ¨å“ªä¸ªèŠ‚ç‚¹èµ·ç”¨sharding;sh.shardCollection(fullName,key,unique) # åœ¨collectionå“ªä¸ªé”®ï¼Œç´¢å¼•ä¸Šåšsharding ;sh.shardCollection(&quot;students&quot;, &#123;&quot;age&quot; : 1 &#125;)sh.status() # æ­¤æ—¶å°±å¯ä»¥æŸ¥çœ‹åˆ†ç‰‡ä¿¡æ¯äº†;use testdb;for (i=1; i&lt;=100000;i++) db.students.insert(&#123;name:&quot;studentt&quot;+i, age:(i%120),classes:&quot;class&quot;+(i%10),address:&quot;www.ssjinyao.com, Magedu, #85 WenhuaRoad, BeiJin, China&quot;&#125;) # æ‰¹é‡æ’å…¥æµ‹è¯•æ•°æ®;use testdbdb.students.find().count()sh.status() # å¯ä»¥çœ‹åˆ°åˆ†ç‰‡å­˜å‚¨çš„ä¿¡æ¯;db.databases.find(&quot;partitioned&quot;:true)db.runCommands(&quot;listShards&quot;)use admindb.runCommand(&quot;listShards&quot;)db.printShardingStatus()sh.isBalancerRunning() # æŸ¥çœ‹å‡è¡¡å™¨çŠ¶æ€ï¼Œå®ƒä¼šåœ¨éœ€è¦æ—¶è‡ªåŠ¨å¯åŠ¨;sh.getBalancerState() # æŸ¥çœ‹BlancerSateçš„çŠ¶æ€;-----------------------&gt; Shard1 æœåŠ¡å™¨é…ç½®# vim /etc/mongod.conf# replSet=testSet# replIndexPrefetch=id_only # æ³¨é‡Šä»¥ä¸Šé…ç½®# dbpath=/mongodb/data# chown -R mongod.mongod /mongodb# systemctl start mongod-----------------------&gt; Shard2 æœåŠ¡å™¨é…ç½®# vim /etc/mongod.conf# replSet=testSet# replIndexPrefetch=id_only # æ³¨é‡Šä»¥ä¸Šé…ç½®# dbpath=/mongodb/data# chown -R mongod.mongod /mongodb# systemctl start mongod]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ansible è‡ªåŠ¨åŒ–è¿ç»´]]></title>
    <url>%2F2018%2F04%2F09%2Fansible%E7%9A%84%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ansible è‡ªåŠ¨åŒ–è¿ç»´ è¿ç»´å·¥å…·12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849OS Provisioning: PXE, Cobbler(repository, distritution, profile) PXE: dhcp, tftp,(http,ftp) dnsmsq:dhcp,dnsOS Config: puppet, saltstack, func Task Excute: fabric, func,saltstackDeployment: fabric,è¿ç»´å·¥å…·åˆ†ç±»: agent: puppet, func è¿™äº›å·¥å…·å¿…éœ€è¦æœ‰agentç«¯; agentless: ansible, fabirc è¿™äº›å·¥å…·å¿…éœ€å¯ç”¨sshæœåŠ¡;Properties: Minimal learning curve, auditability: å…¥é—¨æ›²çº¿éžå¸¸å¹³ç¼“; No bootstrapping: æ— éœ€agent; No DAG ordering, Fails Fast: æ²¡æœ‰æ¬¡åº; No agents(other than sshd) -o resource consumption when not in use: æ²¡æœ‰ä»£ç†; No Server: ä¹Ÿæ²¡æœ‰æœåŠ¡ç«¯ï¼› No additional PKI : æ— éœ€è¯ä¹¦ç­‰åŠŸèƒ½; Modules in any language: æ¨¡å—å¯ä»¥ä½¿ç”¨ä»»æ„ç¼–ç¨‹è¯­è¨€æ¥ç¼–å†™; YAML, not code: ä½¿ç”¨yamlé…ç½®æ–‡ä»¶; SSH by default: ä½¿ç”¨sshé»˜è®¤æŽ¥å£; Strong multi-tier solution: æ”¯æŒå¤šçº§ä½¿ç”¨æ–¹æ¡ˆ;Host Inventory: å®šä¹‰å¯è¢« ansibleç®¡æŽ§çš„ä¸»æœº; Core Modules: å¯è¢«è°ƒç”¨çš„æ ¸å¿ƒæ¨¡å—ï¼Œå¯ä»¥å®Œæˆå¤§éƒ¨ä½œçš„ä»»åŠ¡;Custom Modules: è‡ªå®šä¹‰æ¨¡å—ï¼Œå½“ansibleå®žçŽ°ä¸äº†æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„ç¼–ç¨‹è¯­è¨€æ¥ç¼–å†™æ¨¡å—;Connection Plugins: ansible å¯ä»¥æ”¯æŒä¸€äº›æ’ä»¶æ¥å®žçŽ°ä¸€äº›åŠŸèƒ½ï¼Œå¦‚å‘é€é‚®ä»¶åŠŸèƒ½;ansibleçš„æ ¸å¿ƒçº¿ä»¶: ansible core host iventory core modules custom modules playbook (yaml, jinjia2) connect pluginansibleç‰¹æ€§: åŸºäºŽPythonè¯­è¨€å®žçŽ°ï¼Œç”±Paramikoæ¨¡å—å®žçŽ°ï¼ŒPyYAMLå’ŒJinia2 ä¸‰ä¸ªå…³é”®çš„æ¨¡å—æž„å»ºpythonç‰¹æ€§:,agentless; é»˜è®¤ä½¿ç”¨SSHåè®®: ä¼šæœ‰å®‰å…¨éšæ‚£; åŸºäºŽå¯†é’¥è®¤è¯æ¥è¿žæŽ¥åˆ°å„èŠ‚ç‚¹æ“ä½œ; ä¸»ä»Žæ¨¡å¼: master: ansible, ssh client; savle: ssh serverç»“ç‚¹; æ”¯æŒè‡ªå®šä¹‰æ¨¡å—:æ”¯æŒå„ç§ç¼–ç¨‹è¯­è¨€; æ”¯æŒPlaybook åŸºäºŽ&quot;æ¨¡å—&quot;å®Œæˆå„ç§&quot;ä»»åŠ¡&quot;; ansible çš„å®‰è£…å’Œä½¿ç”¨12345678910111213141516171819202122232425# ansible åœ¨äºŽepelæºä¸­# yum list all *ansible*ansible.noarch 2.4.2.0-2.el7 @extras# å®‰è£…ä¾èµ–äºŽepelæº é…ç½®æ–‡ä»¶ /etc/ansible/ansible.cfg Invertory: /etc/ansible/hosts# vim /etc/ansible # ä¿ç•™ä»¥ä¸‹é…ç½®[dbserver]172.16.55.123[webserver]172.16.55.124172.1655.125# åœ¨ansibleä¸»æœºç”Ÿæˆä¸€ç»„å¯†é’¥# ssh-keygen# å®žçŽ°åŒæœºäº’ä¿¡# for i in &#123;3..5&#125; ; do ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.55.12$i; done# for i in &#123;3..5&#125; ; do ssh root@172.16.55.12$i &quot;date&quot; &amp;&amp; echo &quot;The Messages From 172.16.55.12$i&quot;; done2018å¹´ 04æœˆ 09æ—¥ æ˜ŸæœŸä¸€ 09:47:09 CSTThe Messages From 172.16.55.1232018å¹´ 04æœˆ 09æ—¥ æ˜ŸæœŸä¸€ 09:47:10 CSTThe Messages From 172.16.55.1242018å¹´ 04æœˆ 09æ—¥ æ˜ŸæœŸä¸€ 09:47:10 CSTThe Messages From 172.16.55.125# æ­¤æ—¶ansbileæ‰€åœ¨çš„æœåŠ¡å™¨å¯ä»¥å®žçŽ°å¯¹å„ç»“ç‚¹çš„æŽ§åˆ¶ asnbile-doc çš„ä½¿ç”¨1234# ansible-doc # ç”¨æ¥æŸ¥çœ‹asnbile æ¨¡å—çš„ä½¿ç”¨æŸ¥è¯¢;# ansible-doc -l # ä¾‹å‡ºæ‰€æœ‰å¯ç”¨çš„æ¨¡å—; # ansible-doc -s MODULE_NAME; # æŸ¥çœ‹æŸä¸ªæ¨¡å—çš„ä½¿ç”¨ç”¨æ³•;# ansible-doc -s yum ansibleå‘½ä»¤çš„åº”ç”¨åŸºç¡€12345ansibleå‘½ä»¤åº”ç”¨åŸºç¡€: è¯­æ³•: ansible &lt;host-pattern&gt; [-f forks] [-m module_name] [-a args] -f forks: å¯åŠ¨çš„å¹¶å‘çº¿ç¨‹æ•°; -m module_name: è¦ä½¿ç”¨çš„æ¨¡å—; -a args: æ¨¡å—ç‰¹æœ‰çš„å‚æ•°; å¸¸è§çš„æ¨¡å—:command: å‘½ä»¤æ¨¡å—ï¼Œé»˜è®¤æ¨¡å—ï¼Œç”¨äºŽåœ¨è¿œç¨‹å‘½ä»¤;123456789101112131415161718192021222324252627282930# ansible 172.16.55.124 -m command -a &quot;date&quot;172.16.55.124 | SUCCESS | rc=0 &gt;&gt;2018å¹´ 04æœˆ 09æ—¥ æ˜ŸæœŸä¸€ 09:57:39 CST# ansible dbserver -m command -a &quot;date&quot; 172.16.55.123 | SUCCESS | rc=0 &gt;&gt;2018å¹´ 04æœˆ 09æ—¥ æ˜ŸæœŸä¸€ 09:58:02 CST# ansible all -m command -a &quot;date&quot; 172.16.55.124 | SUCCESS | rc=0 &gt;&gt;2018å¹´ 04æœˆ 09æ—¥ æ˜ŸæœŸä¸€ 09:58:24 CST172.16.55.123 | SUCCESS | rc=0 &gt;&gt;2018å¹´ 04æœˆ 09æ—¥ æ˜ŸæœŸä¸€ 09:58:24 CST172.16.55.125 | SUCCESS | rc=0 &gt;&gt;2018å¹´ 04æœˆ 09æ—¥ æ˜ŸæœŸä¸€ 09:58:32 CST# ansible all -m command -a &quot;tail -2 /var/log/messages&quot;172.16.55.124 | SUCCESS | rc=0 &gt;&gt;Apr 9 09:58:24 fabric1 ansible-command: Invoked with warn=True executable=None _uses_shell=False _raw_params=date removes=None creates=None chdir=None stdin=NoneApr 9 09:59:22 fabric1 ansible-command: Invoked with warn=True executable=None _uses_shell=False _raw_params=tail -2 /var/log/messages removes=None creates=None chdir=None stdin=None172.16.55.123 | SUCCESS | rc=0 &gt;&gt;Apr 9 09:58:24 hyperledger ansible-command: Invoked with warn=True executable=None _uses_shell=False _raw_params=date removes=None creates=None chdir=None stdin=NoneApr 9 09:59:23 hyperledger ansible-command: Invoked with warn=True executable=None _uses_shell=False _raw_params=tail -2 /var/log/messages removes=None creates=None chdir=None stdin=None172.16.55.125 | SUCCESS | rc=0 &gt;&gt;Apr 9 09:58:31 fabric2 ansible-command: Invoked with warn=True executable=None _uses_shell=False _raw_params=date removes=None creates=None chdir=None stdin=NoneApr 9 09:59:23 fabric2 ansible-command: Invoked with warn=True executable=None _uses_shell=False _raw_params=tail -2 /var/log/messages removes=None creates=None chdir=None stdin=None cron æ¨¡å—:å¯ä»¥ä½¿è¢«ç®¡ç†èŠ‚ç‚¹è‡ªåŠ¨ç”Ÿæˆä¸€ç”Ÿä»»åŠ¡è®¡åˆ’;stateæ‰€æœ‰å±žæ€§: present: å®‰è£… absent: ç§»é™¤ 12345678910111213141516171819202122 */10 * * * * /bin/echo &quot;Test Message&quot;# ansible webserver -m cron -a &apos;minute=&quot;*/10&quot; job=&quot;/bin/echo Test Message&quot; name=&quot;Test Cron Job&quot;&apos; 172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;envs&quot;: [], &quot;jobs&quot;: [ &quot;Test Cron Job&quot; ]&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;envs&quot;: [], &quot;jobs&quot;: [ &quot;Test Cron Job&quot; ]&#125;# æ‰§è¡Œå®Œä¹‹åŽç™»å½•ä»¥ä¸Šçš„æŸä¸€å°æœåŠ¡å™¨è¿›è¡ŒéªŒè¯# crontab -l#Ansible: Test Cron Job*/10 * * * * /bin/echo Test Message# ansible webserver -m cron -a &apos;minute=&quot;*/10&quot; job=&quot;/bin/echo Test Message&quot; name=&quot;Test Cron Job&quot; state=&quot;absent&quot;&apos;# å°†ä»¥ä¸Šå»ºç«‹çš„å®šæ—¶ä»»åŠ¡è®¡åˆ’ç§»é™¤ useræ¨¡å—: ç”¨äºŽå»ºç«‹ç”¨æˆ·ï¼›name=: æŒ‡æ˜Žéœ€è¦å»ºç«‹ç”¨æˆ·çš„ç”¨æˆ·å; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980# ansible all -m user -a &apos;user=&quot;user1&quot;&apos;172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;comment&quot;: &quot;&quot;, &quot;createhome&quot;: true, &quot;group&quot;: 1001, &quot;home&quot;: &quot;/home/user1&quot;, &quot;name&quot;: &quot;user1&quot;, &quot;shell&quot;: &quot;/bin/bash&quot;, &quot;state&quot;: &quot;present&quot;, &quot;system&quot;: false, &quot;uid&quot;: 1001&#125;172.16.55.123 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;comment&quot;: &quot;&quot;, &quot;createhome&quot;: true, &quot;group&quot;: 1001, &quot;home&quot;: &quot;/home/user1&quot;, &quot;name&quot;: &quot;user1&quot;, &quot;shell&quot;: &quot;/bin/bash&quot;, &quot;state&quot;: &quot;present&quot;, &quot;system&quot;: false, &quot;uid&quot;: 1001&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;comment&quot;: &quot;&quot;, &quot;createhome&quot;: true, &quot;group&quot;: 1001, &quot;home&quot;: &quot;/home/user1&quot;, &quot;name&quot;: &quot;user1&quot;, &quot;shell&quot;: &quot;/bin/bash&quot;, &quot;state&quot;: &quot;present&quot;, &quot;system&quot;: false, &quot;uid&quot;: 1001&#125;# éªŒè¯æ˜¯å¦åˆ›å»ºäº†ç”¨æˆ·# id user1# å°†ä»¥ä¸Šå»ºç«‹çš„ç”¨æˆ·åˆ é™¤# ansible all -m user -a &apos;user=&quot;user1&quot; state=&quot;absent&quot;&apos;# åˆ›å»ºç³»ç»Ÿç”¨æˆ·ç³»ç»Ÿç»„# ansible all -m group -a &apos;name=&quot;mysql&quot; gid=&quot;306&quot; system=&quot;yes&quot;&apos; # ansible all -m user -a &apos;name=&quot;mysqld&quot; uid=&quot;306&quot; group=&quot;mysql&quot; system=&quot;yes&quot;&apos; 172.16.55.123 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;comment&quot;: &quot;&quot;, &quot;createhome&quot;: true, &quot;group&quot;: 306, &quot;home&quot;: &quot;/home/mysqld&quot;, &quot;name&quot;: &quot;mysqld&quot;, &quot;shell&quot;: &quot;/bin/bash&quot;, &quot;state&quot;: &quot;present&quot;, &quot;system&quot;: true, &quot;uid&quot;: 306&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;comment&quot;: &quot;&quot;, &quot;createhome&quot;: true, &quot;group&quot;: 306, &quot;home&quot;: &quot;/home/mysqld&quot;, &quot;name&quot;: &quot;mysqld&quot;, &quot;shell&quot;: &quot;/bin/bash&quot;, &quot;state&quot;: &quot;present&quot;, &quot;system&quot;: true, &quot;uid&quot;: 306&#125;172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;comment&quot;: &quot;&quot;, &quot;createhome&quot;: true, &quot;group&quot;: 306, &quot;home&quot;: &quot;/home/mysqld&quot;, &quot;name&quot;: &quot;mysqld&quot;, &quot;shell&quot;: &quot;/bin/bash&quot;, &quot;state&quot;: &quot;present&quot;, &quot;system&quot;: true, &quot;uid&quot;: 306&#125; copyæ¨¡å—: ç”¨äºŽæ–‡ä»¶çš„è¿œç¨‹ä¼ è¾“; src=: å®šä¹‰æœ¬åœ°æºæ–‡ä»¶è·¯å¾„; dest=: å®šä¹‰è¿œç¨‹ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼Œä½†ä¸æ”¯æŒç»å¯¹è·¯å¾„; content=: å–ä»£src=,è¡¨ç¤ºç›´æŽ¥ç”¨æ­¤å¤„æŒ‡å®šçš„ä¿¡æ¯ç”Ÿæˆç›®æ ‡æ–‡ä»¶, ä½†è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œä¼šæŠŠèŠ‚ç‚¹ä¸»æœºçš„æºæ–‡ä»¶è¦†ç›–ï¼Œç±»ä¼¼äºŽ echo &gt; /path/to/file 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091# ansible all -m copy -a &apos;src=/etc/fstab dest=/tmp/fstab.ansible owner=root mode=&quot;640&quot;&apos; 172.16.55.123 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;checksum&quot;: &quot;3858e5b009a8c0828cb529780a2ad547411d8d94&quot;, &quot;dest&quot;: &quot;/tmp/fstab.ansible&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;md5sum&quot;: &quot;01ea40602497b8cfe5a53743054fa04d&quot;, &quot;mode&quot;: &quot;0640&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;size&quot;: 541, &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1523241179.42-225211025896206/source&quot;, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 0&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;checksum&quot;: &quot;3858e5b009a8c0828cb529780a2ad547411d8d94&quot;, &quot;dest&quot;: &quot;/tmp/fstab.ansible&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;md5sum&quot;: &quot;01ea40602497b8cfe5a53743054fa04d&quot;, &quot;mode&quot;: &quot;0640&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;secontext&quot;: &quot;unconfined_u:object_r:admin_home_t:s0&quot;, &quot;size&quot;: 541, &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1523241179.42-108291746173038/source&quot;, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 0&#125;172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;checksum&quot;: &quot;3858e5b009a8c0828cb529780a2ad547411d8d94&quot;, &quot;dest&quot;: &quot;/tmp/fstab.ansible&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;md5sum&quot;: &quot;01ea40602497b8cfe5a53743054fa04d&quot;, &quot;mode&quot;: &quot;0640&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;size&quot;: 541, &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1523241179.35-169240840464627/source&quot;, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 0&#125;# ansible all -m copy -a &apos;content=&quot;Hellow Ansible\nWelcome to ssjinyao\n&quot; dest=&quot;/tmp/ssjinyao&quot;&apos;172.16.55.123 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;checksum&quot;: &quot;06759ebeeffb1ec2ba32b71d0440258a2ec812ca&quot;, &quot;dest&quot;: &quot;/tmp/ssjinyao&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;md5sum&quot;: &quot;7da4c3d419470482101fa8cfa338c882&quot;, &quot;mode&quot;: &quot;0644&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;size&quot;: 35, &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1523241579.59-247115936338069/source&quot;, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 0&#125;172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;checksum&quot;: &quot;06759ebeeffb1ec2ba32b71d0440258a2ec812ca&quot;, &quot;dest&quot;: &quot;/tmp/ssjinyao&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;md5sum&quot;: &quot;7da4c3d419470482101fa8cfa338c882&quot;, &quot;mode&quot;: &quot;0644&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;size&quot;: 35, &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1523241579.53-265190945061484/source&quot;, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 0&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;checksum&quot;: &quot;06759ebeeffb1ec2ba32b71d0440258a2ec812ca&quot;, &quot;dest&quot;: &quot;/tmp/ssjinyao&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;md5sum&quot;: &quot;7da4c3d419470482101fa8cfa338c882&quot;, &quot;mode&quot;: &quot;0644&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;secontext&quot;: &quot;unconfined_u:object_r:admin_home_t:s0&quot;, &quot;size&quot;: 35, &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1523241579.58-230356470158720/source&quot;, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 0&#125;# cat /tmp/ssjinyao Hellow AnsibleWelcome to ssjinyao file: ç”¨äºŽè®¾å®šæ–‡ä»¶å±žæ€§; path=: æŒ‡å®šæ–‡ä»¶è·¯å¾„, å¯ä»¥ä½¿ç”¨name æˆ–destæ¥æ›¿æ¢; åˆ›å»ºæ–‡ä»¶çš„ç¬¦å·é“¾æŽ¥; src=:æŒ‡æ˜Žæºæ–‡ä»¶; path=: æŒ‡æ˜Žç¬¦å·é“¾æŽ¥æ–‡ä»¶è·¯å¾„; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273# ansible all -m file -a &apos;owner=&quot;mysql&quot; group=&quot;mysql&quot; mode=&quot;644&quot; path=&quot;/tmp/ssjinyao&quot;&apos; 172.16.55.123 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;gid&quot;: 306, &quot;group&quot;: &quot;mysql&quot;, &quot;mode&quot;: &quot;0644&quot;, &quot;owner&quot;: &quot;mysql&quot;, &quot;path&quot;: &quot;/tmp/ssjinyao&quot;, &quot;size&quot;: 35, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 27&#125;172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;gid&quot;: 306, &quot;group&quot;: &quot;mysql&quot;, &quot;mode&quot;: &quot;0644&quot;, &quot;owner&quot;: &quot;mysql&quot;, &quot;path&quot;: &quot;/tmp/ssjinyao&quot;, &quot;size&quot;: 35, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 27&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;gid&quot;: 306, &quot;group&quot;: &quot;mysql&quot;, &quot;mode&quot;: &quot;0644&quot;, &quot;owner&quot;: &quot;mysql&quot;, &quot;path&quot;: &quot;/tmp/ssjinyao&quot;, &quot;secontext&quot;: &quot;unconfined_u:object_r:admin_home_t:s0&quot;, &quot;size&quot;: 35, &quot;state&quot;: &quot;file&quot;, &quot;uid&quot;: 27&#125;# ansible all -m file -a &apos;path=&quot;/tmp/ssjinyao.link&quot; src=&quot;/tmp/ssjinyao&quot; state=&quot;link&quot;&apos;172.16.55.123 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;dest&quot;: &quot;/tmp/ssjinyao.link&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;mode&quot;: &quot;0777&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;size&quot;: 13, &quot;src&quot;: &quot;/tmp/172.16&quot;, &quot;state&quot;: &quot;link&quot;, &quot;uid&quot;: 0&#125;172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;dest&quot;: &quot;/tmp/ssjinyao.link&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;mode&quot;: &quot;0777&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;size&quot;: 13, &quot;src&quot;: &quot;/tmp/ssjinyao&quot;, &quot;state&quot;: &quot;link&quot;, &quot;uid&quot;: 0&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;dest&quot;: &quot;/tmp/ssjinyao.link&quot;, &quot;gid&quot;: 0, &quot;group&quot;: &quot;root&quot;, &quot;mode&quot;: &quot;0777&quot;, &quot;owner&quot;: &quot;root&quot;, &quot;secontext&quot;: &quot;unconfined_u:object_r:user_tmp_t:s0&quot;, &quot;size&quot;: 13, &quot;src&quot;: &quot;/tmp/ssjinyao&quot;, &quot;state&quot;: &quot;link&quot;, &quot;uid&quot;: 0&#125; ping: æµ‹è¯•è¿œç¨‹ä¸»æœºçš„è¿žæŽ¥æ€§;12345678910111213# ansible all -m ping 172.16.55.123 | SUCCESS =&gt; &#123; &quot;changed&quot;: false, &quot;ping&quot;: &quot;pong&quot;&#125;172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: false, &quot;ping&quot;: &quot;pong&quot;&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: false, &quot;ping&quot;: &quot;pong&quot;&#125; service: æŒ‡å®šè¿è¡ŒçŠ¶æ€; enabled=: æ˜¯å¦å¼€æœºè‡ªåŠ¨å¯åŠ¨; name =: æœåŠ¡åç§°; state =: çŠ¶æ€ï¼Œå–å€¼æœ‰started, stopped, restarted; 1# ansible webserver -m service -a &quot;enabled=true name=httpd state=started&quot; shell: åœ¨è¿œç¨‹ä¸»æœºè¿è¡Œå‘½ä»¤;å°¤å…¶æ˜¯ç”¨åˆ°ç®¡é“ç­‰å¤æ‚å‘½ä»¤ 123456789101112# ansible all -m shell -a &apos;echo &quot;xxxxxxxx&quot; | passwd --stdin user1 &apos; 172.16.55.123 | SUCCESS | rc=0 &gt;&gt;æ›´æ”¹ç”¨æˆ· user1 çš„å¯†ç  ã€‚passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚172.16.55.124 | SUCCESS | rc=0 &gt;&gt;æ›´æ”¹ç”¨æˆ· user1 çš„å¯†ç  ã€‚passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚172.16.55.125 | SUCCESS | rc=0 &gt;&gt;æ›´æ”¹ç”¨æˆ· user1 çš„å¯†ç  ã€‚passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚ script: å°†æœ¬åœ°è„šæœ¬å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºä¸Šå¹¶è¿è¡Œä¹‹;æ³¨æ„: è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„æŒ‡å®šè„šæœ¬; 12345678910111213141516171819202122232425262728293031323334353637# cat test.sh #!/bin/bashsum=0for i in &#123;1..100&#125;; do sum=$[$sum+$i]done echo $sum # chmod +x test.sh # ansible all -m script -a &quot;/tmp/test.sh&quot;172.16.55.123 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;rc&quot;: 0, &quot;stderr&quot;: &quot;Shared connection to 172.16.55.123 closed.\r\n&quot;, &quot;stdout&quot;: &quot;5050\r\n&quot;, &quot;stdout_lines&quot;: [ &quot;5050&quot; ]&#125;172.16.55.124 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;rc&quot;: 0, &quot;stderr&quot;: &quot;Shared connection to 172.16.55.124 closed.\r\n&quot;, &quot;stdout&quot;: &quot;5050\r\n&quot;, &quot;stdout_lines&quot;: [ &quot;5050&quot; ]&#125;172.16.55.125 | SUCCESS =&gt; &#123; &quot;changed&quot;: true, &quot;rc&quot;: 0, &quot;stderr&quot;: &quot;Shared connection to 172.16.55.125 closed.\r\n&quot;, &quot;stdout&quot;: &quot;5050\r\n&quot;, &quot;stdout_lines&quot;: [ &quot;5050&quot; ]&#125; yum: å®‰è£…ç¨‹åºåŒ…; name=: æŒ‡æ˜Žè¦å®‰è£…çš„ç¨‹åºåŒ…ï¼Œå¯ä»¥å¸¦ä¸Šç‰ˆæœ¬å·; state=: present, latestè¡¨ç¤ºå®‰è£…ï¼Œabsentè¡¨ç¤ºå¸è½½; 12# ansible all -m yum -a &apos;name=&quot;zsh&quot; state=&quot;present&quot;&apos;# ansible all -m yum -a &apos;name=&quot;zsh&quot; state=&quot;absent&quot;&apos; setup: æ”¶é›†è¿œç¨‹ä¸»æœºçš„facts; æ¯ä¸ªè¢«ç®¡ç†èŠ‚ç‚¹åœ¨æŽ¥æ”¶å¹¶è¿è¡Œç®¡ç†å‘½ä»¤ä¹‹å‰ï¼Œä¼šå°†è‡ªå·±ä¸»æœºç›¸å…³ä¿¡æ¯ï¼› å¦‚æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€IPåœ°å€ç­‰æŠ¥å‘Šç»™è¿œç¨‹çš„ansibleä¸»æœº; 12# æŸ¥çœ‹è¿œç¨‹èŠ‚ç‚¹çš„æœåŠ¡å™¨ä¿¡æ¯ï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒç”¨é…ç½®# ansible all -m setup ansible-playbook(å‰§æœ¬) çš„ä½¿ç”¨playbookçš„æ ¸å¿ƒå…ƒç´ ; taskfs:ä»»åŠ¡ variadble: å˜é‡ templates: æ¨¡æ¿ handlers: å¤„ç†å™¨ roles:è§’è‰² YAML ä»‹ç»;1234567891011121314YAML æ˜¯ä¸€ä¸ªå¯è¯»æ€§é«˜çš„ç”¨æ¥è¡¨è¾¾èµ„æ–™åºåˆ—çš„æ ¼å¼ï¼ŒYAMLå‚è€ƒäº†å…¶ä»–å¤šå¤„è¯­è¨€;åŒ…æ‹¬:XMLã€Cè¯­è¨€ã€Pythonã€Perlä»¥åŠç”µå­é‚®ä»¶æ ¼å¼ç­‰Clark Evansåœ¨2001å¹´é¦–æ¬¡å‘è¡¨äº†è¿™ç§è¯­è¨€YAML Ain&apos;t Markup Language, å³YAMLä¸æ˜¯XMLã€‚ä¸è¿‡ï¼Œåœ¨å¼€å‘çš„è¿™ç§è¯­è¨€æ—¶;YAMLçš„æ„æ€å…¶å®žæ˜¯:&quot;Yet Another Markup Language(ä»æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€)ã€‚&quot;å…¶ç‰¹æ€§:YAMLçš„å¯è¯»æ€§å¥½YAML å’Œè„šæœ¬è¯­è¨€çš„äº¤äº’æ€§å¥½YAML ä½¿ç”¨å®žçŽ°è¯­è¨€çš„æ•°æ®ç±»åž‹YAML æœ‰ä¸€ä¸ªä¸€è‡´çš„ä¿¡æ¯æ¨¡åž‹YAML æ˜“äºŽå®žçŽ°YAML å¯ä»¥åŸºäºŽæµæ¥å¤„ç†YAML è¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæ‰©å±•æ€§å¥½ 12YAMLçš„è¯­æ³•å’Œå…¶ä»–é«˜é˜¶è¯­è¨€ç±»ä¼¼ï¼Œå¹¶ä¸”å¯ä»¥ç®€å•è¡¨è¾¾æ¸…å•ã€æ•£åˆ—è¡¨ã€æ ‡é‡ç­‰æ•°æ®ç»“æž„; å…¶ç»“æž„(Structure)é€šè¿‡ç©ºæ ¼æ¥å±•ç¤ºï¼Œåºåˆ—(Sequence)é‡Œçš„é¡¹ç”¨&quot;-&quot;æ¥ä»£è¡¨ï¼ŒMapé‡Œçš„é”®å€¼ç”¨&quot;;&quot;åˆ†éš” ansibleå˜é‡:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111å˜é‡å‘½å å˜é‡åä»…èƒ½ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä¸”åªèƒ½ä»¥å­—æ¯å¼€å¤´; facts factsæ˜¯ç”±æ­£åœ¨é€šä¿¡çš„è¿œç¨‹ç›®æ ‡ä¸»æœºå‘å›žçš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ä¿å­˜åœ¨ansibleå˜é‡ä¸­; è¦èŽ·å–æŒ‡å®šçš„è¿œç¨‹ä¸»æœºæ‰€æ”¯æŒçš„æ‰€æœ‰factsï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œ;# ansible hostname -m setupregisteræŠŠä»»åŠ¡çš„è¾“å‡ºå®šä¹‰ä¸ºå˜é‡ï¼Œç„¶åŽç”¨äºŽå…¶ä»–ä»»åŠ¡ï¼Œç¤ºä¾‹å¦‚ä¸‹: tasks: - shell: /usr/bin/foo register: foo_result ignore_errors: True - hosts: websrvs remote_user: root tasks: - name: copy file copy: content=&quot;&#123;&#123; ansible_all_ipv4_address &#125;&#125;&quot; dest=/tmp/var.dnsé€šè¿‡å‘½ä»¤è¡Œä¼ é€’å˜é‡åœ¨è¿è¡Œplaybookçš„æ—¶å€™ä¹Ÿå¯ä»¥ä¼ é€’ä¸€äº›å˜é‡ä¾›playbookä½¿ç”¨ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š ansible-playbook test.yml --extra-vars &quot;hosts=www user=ssjinyao&quot;é€šè¿‡rolesä¼ é€’å˜é‡å½“ç»™ä¸€ä¸ªä¸»æœºåº”ç”¨è§’è‰²çš„æ—¶å€™å¯ä»¥ä¼ é€’å˜é‡ï¼Œç„¶åŽåœ¨è§’è‰²å†…ä½¿ç”¨è¿™äº›å˜é‡ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š - hosts: webservers roles: - common - &#123; role: foo_app_instance, dir: &apos;/web/htdocs/a.com&apos;, port: 8080 &#125;Inventory ansibleçš„ä¸»è¦åŠŸç”¨åœ¨äºŽæ‰¹é‡ä¸»æœºæ“ä½œï¼Œä¸ºäº†ä¾¿æ·åœ°ä½¿ç”¨å…¶ä¸­çš„éƒ¨åˆ†ä¸»æœº; å¯ä»¥åœ¨inventory fileä¸­å°†å…¶åˆ†ç»„å‘½åï¼Œé»˜è®¤çš„inventory fileä¸º/etc/ansible/hosts; inventory fileå¯ä»¥æœ‰å¤šä¸ªï¼Œä¸”ä¹Ÿå¯ä»¥é€šè¿‡Dynamic Inventoryæ¥åŠ¨æ€ç”Ÿæˆ;inventoryæ–‡ä»¶æ ¼å¼ inventoryæ–‡ä»¶éµå¾ªINIæ–‡ä»¶é£Žæ ¼ï¼Œä¸­æ‹¬å·ä¸­çš„å­—ç¬¦ä¸ºç»„å; å¯ä»¥å°†åŒä¸€ä¸ªä¸»æœºåŒæ—¶å½’å¹¶åˆ°å¤šä¸ªä¸åŒçš„ç»„ä¸­ï¼› æ­¤å¤–ï¼Œå½“å¦‚è‹¥ç›®æ ‡ä¸»æœºä½¿ç”¨äº†éžé»˜è®¤çš„SSHç«¯å£ï¼Œè¿˜å¯ä»¥åœ¨ä¸»æœºåç§°ä¹‹åŽä½¿ç”¨å†’å·åŠ ç«¯å£å·æ¥æ ‡æ˜Ž; [webservers] web1.ssjinyao.com:25181 web2.ssjinyao.com [dbservers] db1.ssjinyao db2.ssjinyao.com db3.ssjinyao.com å¦‚æžœä¸»æœºåç§°éµå¾ªç›¸ä¼¼çš„å‘½åæ¨¡å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åˆ—è¡¨çš„æ–¹å¼æ ‡è¯†å„ä¸»æœºï¼Œä¾‹å¦‚ï¼š [webservers] www[01:50].ssjinyao.com [databases] db-[a:f].ssjinyao.comä¸»æœºå˜é‡ å¯ä»¥åœ¨inventoryä¸­å®šä¹‰ä¸»æœºæ—¶ä¸ºå…¶æ·»åŠ ä¸»æœºå˜é‡ä»¥ä¾¿äºŽåœ¨playbookä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š [webservers] web1.ssjinyao.com http_port=80 maxRequestsPerChild=808 web2.ssjinyao.com http_port=8080 maxRequestsPerChild=909ç»„å˜é‡ ç»„å˜é‡æ˜¯æŒ‡èµ‹äºˆç»™æŒ‡å®šç»„å†…æ‰€æœ‰ä¸»æœºä¸Šçš„åœ¨playbookä¸­å¯ç”¨çš„å˜é‡ã€‚ä¾‹å¦‚ï¼š [webservers] web1.ssjinyao.com web2.ssjinyao.com [webservers:vars] ntp_server=web1.ssjinyao.com nfs_server=web2.ssjinyao.comç»„åµŒå¥— åœ¨inventoryä¸­ç»„è¿˜å¯ä»¥åŒ…å«å…¶å®ƒçš„ç»„ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å‘ç»„ä¸­çš„ä¸»æœºæŒ‡å®šå˜é‡; ä¸è¿‡ï¼Œè¿™äº›å˜é‡åªèƒ½åœ¨ansible-playbookä¸­ä½¿ç”¨ï¼Œè€Œansibleä¸æ”¯æŒ; [apache]httpd1.ssjinyao.comhttpd2.ssjinyao.com[nginx]nginx1.ssjinyao.comnginx2.ssjinyao.com[webservers:children]apachenginx[webservers:vars]ntp_server=ntp.ssjinyao.com inventoryå‚æ•° ansibleåŸºäºŽsshè¿žæŽ¥inventoryä¸­æŒ‡å®šçš„è¿œç¨‹ä¸»æœºæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šå…¶äº¤äº’æ–¹å¼ï¼›è¿™äº›å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š ansible_ssh_host The name of the host to connect to, if different from the alias you wish to give to it. ansible_ssh_port The ssh port number, if not 22 ansible_ssh_user The default ssh user name to use. ansible_ssh_pass The ssh password to use (this is insecure, we strongly recommend using --ask-pass or SSH keys) ansible_sudo_pass The sudo password to use (this is insecure, we strongly recommend using --ask-sudo-pass) ansible_connection Connection type of the host. Candidates are local, ssh or paramiko. The default is paramiko before Ansible 1.2, and &apos;smart&apos; afterwards which detects whether usage of &apos;ssh&apos; would be feasible based on whether ControlPersist is supported. ansible_ssh_private_key_file Private key file used by ssh. Useful if using multiple keys and you don&apos;t want to use SSH agent.ansible_shell_type The shell type of the target system. By default commands are formatted using &apos;sh&apos;-style syntax by default. Setting this to &apos;csh&apos; or &apos;fish&apos; will cause commands executed on target systems to follow those shell&apos;s syntax instead. ansible_python_interpreter The target host python path. This is useful for systems with more than one Python or not located at &quot;/usr/bin/python&quot; such as \*BSD, or where /usr/bin/python is not a 2.X series Python. We do not use the &quot;/usr/bin/env&quot; mechanism as that requires the remote user&apos;s path to be set right and also assumes the &quot;python&quot; executable is named python, where the executable might be named something like &quot;python26&quot;. ansible\_\*\_interpreter Works for anything such as ruby or perl and works just like ansible_python_interpreter. This replaces shebang of modules which will run on that host. æ¡ä»¶æµ‹è¯•å¦‚æžœéœ€è¦æ ¹æ®å˜é‡ã€factsæˆ–æ­¤å‰ä»»åŠ¡çš„æ‰§è¡Œç»“æžœæ¥åšä¸ºæŸtaskæ‰§è¡Œä¸Žå¦çš„å‰ææ—¶è¦ç”¨åˆ°æ¡ä»¶æµ‹è¯•; whenè¯­å¥åœ¨taskåŽæ·»åŠ whenå­å¥å³å¯ä½¿ç”¨æ¡ä»¶æµ‹è¯•ï¼›whenè¯­å¥æ”¯æŒJinja2è¡¨è¾¾å¼è¯­æ³• 123456789101112131415161718192021222324 - name: &quot;shutdown Debian flavored systems&quot; command: /sbin/shutdown -h now when: ansible_os_family == &quot;Debian&quot;# whenè¯­å¥ä¸­è¿˜å¯ä»¥ä½¿ç”¨Jinja2çš„å¤§å¤šâ€œfilterâ€;# ä¾‹å¦‚è¦å¿½ç•¥æ­¤å‰æŸè¯­å¥çš„é”™è¯¯å¹¶åŸºäºŽå…¶ç»“æžœï¼ˆfailedæˆ–è€…sucessï¼‰è¿è¡ŒåŽé¢æŒ‡å®šçš„è¯­å¥tasks: - command: /bin/false register: result ignore_errors: True - command: /bin/something when: result|failed - command: /bin/something_else when: result|success - command: /bin/still/something_else when: result|skipped- hosts: all remote_user: root vars: - username: user10 tasks: - name: create &#123;&#123; username &#125;&#125; user user: name=&#123;&#123;username&#125;&#125; when: ansible_fqdn == &quot;fabric2&quot;# whenè¯­å¥ä¸­è¿˜å¯ä»¥ä½¿ç”¨factsæˆ–playbookä¸­å®šä¹‰çš„å˜é‡; è¿­ä»£123456789101112131415161718# å½“æœ‰éœ€è¦é‡å¤æ€§æ‰§è¡Œçš„ä»»åŠ¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£æœºåˆ¶;# å…¶ä½¿ç”¨æ ¼å¼ä¸ºå°†éœ€è¦è¿­ä»£çš„å†…å®¹å®šä¹‰ä¸ºitemå˜é‡å¼•ç”¨ï¼Œå¹¶é€šè¿‡with_itemsè¯­å¥æ¥æŒ‡æ˜Žè¿­ä»£çš„å…ƒç´ åˆ—è¡¨- name: add several users user: name=&#123;&#123; item &#125;&#125; state=present groups=wheel with_items: - testuser1 - testuser2# ä¸Šé¢è¯­å¥åŠŸèƒ½ç­‰åŒäºŽä¸‹é¢è¯­å¥çš„åŠŸèƒ½- name: add user testuser1 user: name=testuser1 state=present groups=wheel- name: add user testuser2 user: name=testuser2 state=present groups=wheel# with_itemsä¸­å¯ä»¥ä½¿ç”¨å…ƒç´ è¿˜å¯ä¸ºhashes- name: add several users user: name=&#123;&#123; item.name &#125;&#125; state=present groups=&#123;&#123; item.groups &#125;&#125; with_items: - &#123; name: &apos;testuser1&apos;, groups: &apos;wheel&apos; &#125; - &#123; name: &apos;testuser2&apos;, groups: &apos;root&apos; &#125; Hostå’ŒUser1234567891011121314151617# playbookä¸­çš„æ¯ä¸€ä¸ªplayçš„ç›®çš„éƒ½æ˜¯ä¸ºäº†è®©æŸä¸ªæˆ–æŸäº›ä¸»æœºä»¥æŸä¸ªæŒ‡å®šçš„ç”¨æˆ·èº«ä»½æ‰§è¡Œä»»åŠ¡;# hostsç”¨äºŽæŒ‡å®šè¦æ‰§è¡ŒæŒ‡å®šä»»åŠ¡çš„ä¸»æœºï¼Œå…¶å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªç”±å†’å·åˆ†éš”ä¸»æœºç»„# remote_useråˆ™ç”¨äºŽæŒ‡å®šè¿œç¨‹ä¸»æœºä¸Šçš„æ‰§è¡Œä»»åŠ¡çš„ç”¨æˆ·; -hosts: webnodes remote_user: root# remote_userä¹Ÿå¯ç”¨äºŽå„taskä¸­;# ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå…¶é€šè¿‡sudoçš„æ–¹å¼åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡ï¼Œå…¶å¯ç”¨äºŽplayå…¨å±€æˆ–æŸä»»åŠ¡;# å¯ä»¥åœ¨sudoæ—¶ä½¿ç”¨sudo_useræŒ‡å®šsudoæ—¶åˆ‡æ¢çš„ç”¨æˆ·ã€‚ - hosts: webnodes remote_user: ssjinyao tasks: - name: test connection ping: remote_user: ssjinyao sudo: yes ä»»åŠ¡åˆ—è¡¨ä¸Žaction1234567891011121314151617181920212223242526# playçš„ä¸»ä½“éƒ¨åˆ†æ˜¯task list;# task listä¸­çš„å„ä»»åŠ¡æŒ‰æ¬¡åºé€ä¸ªåœ¨hostsä¸­æŒ‡å®šçš„æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œï¼Œå³åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®Œæˆç¬¬ä¸€ä¸ªä»»åŠ¡åŽå†å¼€å§‹ç¬¬äºŒä¸ª# åœ¨è¿è¡Œè‡ªä¸‹è€Œä¸‹æŸplaybookæ—¶ï¼Œå¦‚æžœä¸­é€”å‘ç”Ÿé”™è¯¯ï¼Œæ‰€æœ‰å·²æ‰§è¡Œä»»åŠ¡éƒ½å°†å›žæ»šï¼Œå› æ­¤ï¼Œåœ¨æ›´æ­£playbookåŽé‡æ–°æ‰§è¡Œä¸€æ¬¡å³å¯;# taskçš„ç›®çš„æ˜¯ä½¿ç”¨æŒ‡å®šçš„å‚æ•°æ‰§è¡Œæ¨¡å—ï¼Œè€Œåœ¨æ¨¡å—å‚æ•°ä¸­å¯ä»¥ä½¿ç”¨å˜é‡;# æ¨¡å—æ‰§è¡Œæ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€å¤šæ¬¡æ‰§è¡Œæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå…¶ç»“æžœå‡ä¸€è‡´;# æ¯ä¸ªtaskéƒ½åº”è¯¥æœ‰å…¶nameï¼Œç”¨äºŽplaybookçš„æ‰§è¡Œç»“æžœè¾“å‡º;# å»ºè®®å…¶å†…å®¹å°½å¯èƒ½æ¸…æ™°åœ°æè¿°ä»»åŠ¡æ‰§è¡Œæ­¥éª¤,å¦‚æžœæœªæä¾›nameï¼Œåˆ™actionçš„ç»“æžœå°†ç”¨äºŽè¾“å‡ºã€‚# å®šä¹‰taskçš„å¯ä»¥ä½¿ç”¨â€œaction: module optionsâ€æˆ–â€œmodule: optionsâ€çš„æ ¼å¼ï¼ŒæŽ¨èä½¿ç”¨åŽè€…ä»¥å®žçŽ°å‘åŽå…¼å®¹;# å¦‚æžœactionä¸€è¡Œçš„å†…å®¹è¿‡å¤šï¼Œä¹Ÿä¸­ä½¿ç”¨åœ¨è¡Œé¦–ä½¿ç”¨å‡ ä¸ªç©ºç™½å­—ç¬¦è¿›è¡Œæ¢è¡Œã€‚ tasks: - name: make sure apache is running service: name=httpd state=running# åœ¨ä¼—å¤šæ¨¡å—ä¸­ï¼Œåªæœ‰commandå’Œshellæ¨¡å—ä»…éœ€è¦ç»™å®šä¸€ä¸ªåˆ—è¡¨è€Œæ— éœ€ä½¿ç”¨â€œkey=valueâ€æ ¼å¼ï¼Œä¾‹å¦‚ï¼š tasks: - name: disable selinux command: /sbin/setenforce 0# å¦‚æžœå‘½ä»¤æˆ–è„šæœ¬çš„é€€å‡ºç ä¸ä¸ºé›¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ›¿ä»£ï¼š tasks: - name: run this command and ignore the result shell: /usr/bin/somecommand || /bin/true# æˆ–è€…ä½¿ç”¨ignore_errorsæ¥å¿½ç•¥é”™è¯¯ä¿¡æ¯ï¼š tasks: - name: run this command and ignore the result shell: /usr/bin/somecommand ignore_errors: True handlers12345678910111213141516# ç”¨äºŽå½“å…³æ³¨çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶é‡‡å–ä¸€å®šçš„æ“ä½œ;# â€œnotifyâ€è¿™ä¸ªactionå¯ç”¨äºŽåœ¨æ¯ä¸ªplayçš„æœ€åŽè¢«è§¦å‘;# è¿™æ ·å¯ä»¥é¿å…å¤šæ¬¡æœ‰æ”¹å˜å‘ç”Ÿæ—¶æ¯æ¬¡éƒ½æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œå–è€Œä»£ä¹‹;# ä»…åœ¨æ‰€æœ‰çš„å˜åŒ–å‘ç”Ÿå®ŒæˆåŽä¸€æ¬¡æ€§åœ°æ‰§è¡ŒæŒ‡å®šæ“ä½œ;# åœ¨notifyä¸­åˆ—å‡ºçš„æ“ä½œç§°ä¸ºhandlerï¼Œä¹Ÿå³notifyä¸­è°ƒç”¨handlerä¸­å®šä¹‰çš„æ“ä½œ; - name: template configuration file template: src=template.j2 dest=/etc/foo.conf notify: - restart memcached - restart apache # handleræ˜¯taskåˆ—è¡¨ï¼Œè¿™äº›taskä¸Žå‰è¿°çš„taskå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒ; handlers: - name: restart memcached service: name=memcached state=restarted - name: restart apache service: name=apache state=restarted roles12345678910111213141516171819202122232425262728293031323334353637383940414243444546# ansilbeè‡ª1.2ç‰ˆæœ¬å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œç”¨äºŽå±‚æ¬¡æ€§ã€ç»“æž„åŒ–åœ°ç»„ç»‡playbook;# rolesèƒ½å¤Ÿæ ¹æ®å±‚æ¬¡åž‹ç»“æž„è‡ªåŠ¨è£…è½½å˜é‡æ–‡ä»¶ã€tasksä»¥åŠhandlersç­‰;# è¦ä½¿ç”¨rolesåªéœ€è¦åœ¨playbookä¸­ä½¿ç”¨includeæŒ‡ä»¤å³å¯;# roleså°±æ˜¯é€šè¿‡åˆ†åˆ«å°†å˜é‡ã€æ–‡ä»¶ã€ä»»åŠ¡ã€æ¨¡å—åŠå¤„ç†å™¨æ”¾ç½®äºŽå•ç‹¬çš„ç›®å½•ä¸­;# å¹¶å¯ä»¥ä¾¿æ·åœ°includeå®ƒä»¬çš„ä¸€ç§æœºåˆ¶ã€‚è§’è‰²ä¸€èˆ¬ç”¨äºŽåŸºäºŽä¸»æœºæž„å»ºæœåŠ¡çš„åœºæ™¯ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç”¨äºŽæž„å»ºå®ˆæŠ¤è¿›ç¨‹ç­‰åœºæ™¯ä¸­; ä¸€ä¸ªrolesçš„æ¡ˆä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š site.yml webservers.yml fooservers.yml roles/ common/ files/ templates/ tasks/ handlers/ vars/ meta/ webservers/ files/ templates/ tasks/ handlers/ vars/ meta/è€Œåœ¨playbookä¸­ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨rolesï¼š --- - hosts: webservers roles: - common - webservers ä¹Ÿå¯ä»¥å‘rolesä¼ é€’å‚æ•°ï¼Œä¾‹å¦‚ï¼š --- - hosts: webservers roles: - common - &#123; role: foo_app_instance, dir: &apos;/opt/a&apos;, port: 5000 &#125; - &#123; role: foo_app_instance, dir: &apos;/opt/b&apos;, port: 5001 &#125; ç”šè‡³ä¹Ÿå¯ä»¥æ¡ä»¶å¼åœ°ä½¿ç”¨rolesï¼Œä¾‹å¦‚ï¼š --- - hosts: webservers roles: - &#123; role: some_role, when: &quot;ansible_os_family == &apos;RedHat&apos;&quot; &#125; åˆ›å»ºroleçš„æ­¥éª¤ åˆ›å»ºä»¥roleså‘½åçš„ç›®å½•ï¼› åœ¨rolesç›®å½•ä¸­åˆ†åˆ«åˆ›å»ºä»¥å„è§’è‰²åç§°å‘½åçš„ç›®å½•ï¼Œå¦‚webserversç­‰ï¼› åœ¨æ¯ä¸ªè§’è‰²å‘½åçš„ç›®å½•ä¸­åˆ†åˆ«åˆ›å»ºfilesã€handlersã€metaã€tasksã€templateså’Œvarsç›®å½•ï¼› ç”¨ä¸åˆ°çš„ç›®å½•å¯ä»¥åˆ›å»ºä¸ºç©ºç›®å½•ï¼Œä¹Ÿå¯ä»¥ä¸åˆ›å»ºï¼› åœ¨playbookæ–‡ä»¶ä¸­ï¼Œè°ƒç”¨å„è§’è‰²ï¼› roleå†…å„ç›®å½•ä¸­å¯ç”¨çš„æ–‡ä»¶ tasksç›®å½•ï¼šè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶å®šä¹‰äº†æ­¤è§’è‰²çš„ä»»åŠ¡åˆ—è¡¨ï¼›æ­¤æ–‡ä»¶å¯ä»¥ä½¿ç”¨includeåŒ…å«å…¶å®ƒçš„ä½äºŽæ­¤ç›®å½•ä¸­çš„taskæ–‡ä»¶; filesç›®å½•ï¼šå­˜æ”¾ç”±copyæˆ–scriptç­‰æ¨¡å—è°ƒç”¨çš„æ–‡ä»¶; templatesç›®å½•ï¼štemplateæ¨¡å—ä¼šè‡ªåŠ¨åœ¨æ­¤ç›®å½•ä¸­å¯»æ‰¾Jinja2æ¨¡æ¿æ–‡ä»¶; handlersç›®å½•ï¼šæ­¤ç›®å½•ä¸­åº”å½“åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œç”¨äºŽå®šä¹‰æ­¤è§’è‰²ç”¨åˆ°çš„å„handlerï¼›åœ¨handlerä¸­ä½¿ç”¨includeåŒ…å«çš„å…¶å®ƒçš„handleræ–‡ä»¶ä¹Ÿåº”è¯¥ä½äºŽæ­¤ç›®å½•ä¸­; varsç›®å½•ï¼šåº”å½“åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œç”¨äºŽå®šä¹‰æ­¤è§’è‰²ç”¨åˆ°çš„å˜é‡; metaç›®å½•ï¼šåº”å½“åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œç”¨äºŽå®šä¹‰æ­¤è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»; ansible 1.3åŠå…¶ä»¥åŽçš„ç‰ˆæœ¬æ‰æ”¯æŒ; defaultç›®å½•ï¼šä¸ºå½“å‰è§’è‰²è®¾å®šé»˜è®¤å˜é‡æ—¶ä½¿ç”¨æ­¤ç›®å½•ï¼›åº”å½“åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶; Tags1234tagsç”¨äºŽè®©ç”¨æˆ·é€‰æ‹©è¿è¡Œæˆ–è·¯è¿‡playbookä¸­çš„éƒ¨åˆ†ä»£ç ;ansibleå…·æœ‰å¹‚ç­‰æ€§ï¼Œå› æ­¤ä¼šè‡ªåŠ¨è·³è¿‡æ²¡æœ‰å˜åŒ–çš„éƒ¨åˆ†;æœ‰äº›ä»£ç ä¸ºæµ‹è¯•å…¶ç¡®å®žæ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ—¶é—´ä¾ç„¶ä¼šéžå¸¸åœ°é•¿;æ­¤æ—¶ï¼Œå¦‚æžœç¡®ä¿¡å…¶æ²¡æœ‰å˜åŒ–ï¼Œå°±å¯ä»¥é€šè¿‡tagsè·³è¿‡æ­¤äº›ä»£ç ç‰‡æ–­ã€‚ ç›®å½•ååŒè§’è‰²å; ç›®å½•ç»“æž„æœ‰å›ºå®šæ ¼å¼; files: è¡¨æ€æ–‡ä»¶; templates: Jinjia2æ¨¡æ¿æ–‡ä»¶; tasks:è‡³å°‘æœ‰main.ymlæ–‡ä»¶ï¼Œå®šä¹‰å„tasks; handlers: è‡³å°‘æœ‰ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œå®šä¹‰å„handlers; vars:è‡³å°‘æœ‰ä¸€ä¸ªmian.ymlæ–‡ä»¶ï¼Œå®šä¹‰å˜é‡; meta:å®šä¹‰ä¾èµ–å…³ç³»ç­‰ä¿¡æ¯; site.ymlä¸­å®šä¹‰playbookï¼Œé¢å¤–ä¹Ÿå¯ä»¥æœ‰å…¶å®ƒçš„ymlæ–‡ä»¶; ansible-playbookä½¿ç”¨ç¤ºä¾‹åœ¨webserverä¸­æ‰§è¡Œç®€å•ç®¡ç†ç±»å‘½ä»¤12345678910111213test.yml - hosts: webserver remote_user: root tasks: - name: create nginx group group: name=nginx system=yes gid=208 - name: create nginx user user: name=nginx uid=208 group=nginx system=yes- hosts: dbserver remote_user: root tasks: - name: copy file to db_servers copy: src=/etc/inittab dest=/tmp/inittab.ans## ansible-playbook test.yml heartbeat éƒ¨ç½²12345678910111213141516171819heartbeat.yaml- hosts: hbhosts remote_user: root tasks: - name: ensure heartbeat latest version yum: name=heartbeat state=present - name: authkeys configure file copy: src=/root/hb_conf/authkeys dest=/etc/ha.d/authkeys - name: authkeys mode 600 file: path=/etc/ha.d/authkeys mode=600 notify: - restart heartbeat - name: ha.cf configure file copy: src=/root/hb_conf/ha.cf dest=/etc/ha.d/ha.cf notify: - restart heartbeat handlers: - name: restart heartbeat service: name=heartbeat state=restarted ç³»ç»ŸçŽ¯å¢ƒåˆå§‹åŒ–123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137--- - hosts: all tasks: - name: Add mongodb 3.4 yum repo template: src=./yum/mongo34.repo dest=/etc/yum.repos.d/ - name: Yum remove old mongodb yum: name=mongodb state=removed update_cache=true - name: Yum install mongodb 3.4 yum: name=mongodb-org state=installed update_cache=true - name: Mongo shell edit shell: | killall mongod echo &apos;never&apos; &gt; /sys/kernel/mm/transparent_hugepage/enabled echo &apos;never&apos; &gt; /sys/kernel/mm/transparent_hugepage/defrag - name: start mongodb service: name=mongod state=restarted - name: Create mongo user and passwd admin xxxxxx mongodb_user: name: &quot;admin&quot; password: &quot;xxxxxxssjinyao.com&quot; database: &quot;admin&quot; roles: &quot;userAdminAnyDatabase&quot; state: &quot;present&quot; yum: name=mod_ssl state=installed update_cache=true - name: Install git yum: name=git state=installed update_cache=true - name: Install tree yum: name=tree state=installed update_cache=true - name: Install any packages yum: name=&#123;&#123;item&#125;&#125; state=installed update_cache=true with_items: - libffi - libffi-devel - openssl - openssl-devel - libxml2 - libxml2-devel - libjpeg-turbo - libjpeg-turbo-devel - name: Install any packages2 yum: name=&#123;&#123;item&#125;&#125; state=installed update_cache=true with_items: - zlib - zlib-devel - vim - httpd - mariadb-server - redis - php - php-intl - php-pear - php-devel - libicu - libicu-devel - git - centos-release-scl - name: Install any packages3 yum: name=&#123;&#123;item&#125;&#125; state=present update_cache=true with_items: - python-pip - python-devel - gcc - gcc-c++ - kernel-devel - make - MySQL-python - php-mysql - php-gd - mysql-devel - libcurl - libcurl-devel - python-lxml - name: Install any packages4 yum: name=&#123;&#123;item&#125;&#125; state=present update_cache=true with_items: - php55 - php-pecl-mongo - php55-php - php55-php-gd - php55-php-mbstring - php55-php-devel - php55-php-mysqlnd - php55-php-ldap - php55-php-intl - php55-php-pear - php55-php-mongo - unzip - name: Install any packages5 other, you can add yum: name=&#123;&#123;item&#125;&#125; state=present update_cache=true with_items: - readline-devel - patch - name: Copy php-55 config file to etc copy: remote_src=True src=/opt/rh/httpd24/root/etc/httpd/conf.d/php55-php.conf dest=/etc/httpd/conf.d/ - name: Copy php-55 httpd modules to etc copy: remote_src=True src=/opt/rh/httpd24/root/etc/httpd/conf.modules.d/10-php55-php.conf dest=/etc/httpd/conf.d/ - name: Copy php-55 httpd moduels to etc copy: remote_src=True src=/opt/rh/httpd24/root/etc/httpd/modules/libphp55-php5.so dest=/etc/httpd/modules/ - name: pip install any packages pip: name=&#123;&#123;item&#125;&#125; state=present with_items: - supervisor - virtualenv - celery - flower - mongo - redis - name: echo a messages shell: | ifconfig &amp;&gt; /tmp/test.ifconfig netstat -ant &amp;&gt; /tmp/test.netstat exit 0 notify: - start nginx - name: Add redis config file template: src=./redis/redis.conf dest=/etc/ - name: start redis service: name=redis state=started - name: stop apache service: name=httpd state=stopped handlers: - name: start nginx service: name=nginx state=started - name: restart httpd service: name=httpd state=restarted]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[zabbixä½¿ç”¨è¿›é˜¶]]></title>
    <url>%2F2018%2F04%2F02%2Fzabbix%E9%AB%98%E7%BA%A7%2F</url>
    <content type="text"><![CDATA[zabbix é«˜çº§ç”¨æ³• zabbix æŠ¥è­¦åª’ä»‹12345# å¯¹äºŽé‚®ä»¶æŠ¥è­¦æŽ¥å£ï¼ŒCentOSé»˜è®¤é‚®ä»¶æœåŠ¡å°±æ˜¯å¯åŠ¨çš„ï¼Œä½†æ˜¯ï¼Œåªèƒ½æœåŠ¡æœ¬åœ°åˆ°æœ¬åœ°å‘é‚®ä»¶; # å¦‚æžœéœ€è¦å¾€äº’è”ç½‘ä¸Šå‘é‚®ä»¶ï¼Œéœ€è¦æŠŠæœåŠ¡å™¨é…ç½®æˆé‚®ä»¶æœåŠ¡å™¨;# ä½†ä¸€èˆ¬æ¥è®²ï¼Œè‡ªå»ºé‚®ä»¶ç³»ç»Ÿï¼Œä»˜å‡ºçš„æˆæœ¬å’ŒæŠ€æœ¯éƒ½è¾ƒé«˜ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç½‘è”ä¸Šçš„é‚®ä»¶æœåŠ¡;# è€Œå¯¹äºŽæŠ¥è­¦çš„å†…å®¹ï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬åœ¨zabbixæœåŠ¡ç«¯é…ç½®çš„å®æ‰€å®šä¹‰çš„å†…å®¹;# æ²¡æœ‰itemçš„é…ç½®ï¼Œé‚£ä¹ˆå°†æ„å‘³ç€æ²¡æœ‰ç›‘æŽ§æ•°æ®; Zabbixæœ¯è¯­ä¸Žæ“ä½œæ³¨æ„é¡¹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121Item Key å‘½åæ±‚: åªèƒ½ä½¿ç”¨å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ç‚¹å·ã€è¿žæŽ¥ç¬¦; æŽ¥å—å‚æ•°: system.cpu.load[&lt;cpu&gt;,&lt;mode&gt;], net.if.inbound[if,&lt;mode&gt;] æ³¨æ„: æ¯ä¸€ä¸ªkeyèƒŒåŽéƒ½åº”è¯¥æœ‰ä¸€ä¸ªå‘½ä»¤æˆ–è€…è„šæœ¬æ¥è´Ÿè´£å®žçŽ°æ•°æ®æ”¶é›†ï¼›å‘½ä»¤æˆ–è€…è„šæœ¬å¯ä»¥è°ƒç”¨ä¼ é€’ç»™keyçš„å‚æ•°ï¼Œè°ƒç”¨æ–¹å¼ä¸º$1,$2,... åœ¨zabbixä¸­å®šä¹‰itemæ—¶è°ƒç”¨æŸkeyï¼Œè¿˜éœ€è¦é¢å¤–å®šä¹‰æ•°æ®é‡‡é›†é¢‘çŽ‡(æ¯30ç§’é‡‡é›†ä¸€æ¬¡)ã€åŽ†å²æ•°æ®çš„ä¿å­˜æ—¶é•¿ç­‰;Trigger: è§¦å‘å™¨è¡¨è¾¾å¼: &#123;&lt;Server&gt;:&lt;key&gt;.&lt;function&gt;(&lt;parameter&gt;)&#125;&lt;operator&gt;&lt;constant&gt; ä¾‹: &#123;api.transfereasy.com:net.tcp.listen[9991].last()&#125;#1 &lt;function&gt;: è¯„ä¼°é‡‡é›†åˆ°çš„æ•°æ®æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…æ—¶æ‰€ä½¿ç”¨çš„å‡½æ•°ï¼Œå…±è¯„ä¼°è¿‡ç¨‹å¯ä»¥æ ¹æ®é‡‡é›†åˆ°çš„æ•°æ®ã€å½“å‰æ—¶é—´æˆ–å…¶å®ƒå› ç´ ; avg:å¹³å‡å€¼; count:æŒ‡å®šæ—¶é—´å†…çš„ç»Ÿè®¡; change:è¿”å›žæœ€è¿‘è¿”å›žçš„å€¼ï¼Œä¸Žä¹‹å‰ä¸€æ¬¡çš„å·®å€¼; date:å½“å¤©çš„å€¼; dayofweek:è¿”å›žæœ¬å‘¨çš„ç¬¬å‡ å¤©çš„å€¼; dayofmonth:è¿”å›žæœ¬æœˆçš„ç¬¬å‡ å¤©çš„å€¼; delta:æŒ‡å®šæ—¶é—´èŒƒå›´å†…æœ€å¤§å€¼ä¸Žæœ€å°å€¼ä¹‹å·®; diff:å½“æ–‡ä»¶ä¸ä¸€æ ·æ—¶; iregexp:å¿½ç•¥å¤§å°å†™å®ƒç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼; last:æœ€è¿‘ä¸€æ¬¡é‡‡æ ·; max:æœ€è¿‘é‡‡æ ·çš„æœ€å¤§å€¼; min:æœ€è¿‘é‡‡æ ·çš„æœ€å°å€¼; nodata: è¡¨ç¤ºæ²¡æœ‰æ•°æ®; sum:æœ€åŽä¸€æ¬¡é‡‡æ ·æ•°æ®ä¹‹å’Œ; regexp:æ£€æŸ¥æœ€åŽä¸€æ¬¡é‡‡æ ·çš„å€¼æ˜¯å¦èƒ½å¤Ÿè¢«æŒ‡å®šçš„æ¨¡å¼æ‰€åŒ¹é…: 1ã€è¡¨ç¤ºåŒ¹é…, 0è¡¨ç¤ºä¸åŒ¹é…; now:è¿”å›žè‡ªUnixå…ƒå¹´è‡³æ­¤åˆ»ç»åŽ†çš„ç§’æ•°; prev:å€’æ•°ç¬¬äºŒä¸ªé‡‡æ ·å€¼: str:ä»Žæœ€åŽä¸€æ¬¡çš„é‡‡æ ·ä¸­æŸ¥æ‰¾åˆ°æ­¤å¤„æŒ‡å®šçš„å­ä¸²: strlen: åšå­—ç¬¦ä¸²çš„é•¿åº¦æ¯”è¾ƒ; prev:å€’æ•°ç¬¬äºŒä¸ªé‡‡æ ·å€¼ &lt;operator&gt;: &gt;, &lt;, =, #(è¡¨ç¤ºä¸ç­‰äºŽ)äº‹å®žä¸Šæˆ‘ä»¬å¯ä»¥è®©è¡¨è¾¾å¼çš„å€¼ç›´æŽ¥æ¥åšç®—æœ¯è¿ç®—çš„; / ,* ,- ,+ &amp;(ä¸Ž),|(æˆ–) è§¦å‘å™¨ä¹‹é—´çš„å…³ç³» Action: message: condition: ä¸€èˆ¬ç”±eventè§¦å‘: trigger discover: Service Up ,Srvice Down ,Host up ,Host down, Service Discovered,Service Lost,Host Discovered, Host Lost auto-registration operation: send message Medis Type Email (å¸¸ç”¨),SMS ,Jabber, Scripts(å¸¸ç”¨), EZ Texting Usser remote command(è¿œç¨‹å‘½ä»¤) è¿è¡Œzabbixè¿›ç¨‹çš„ç”¨æˆ·æ˜¯zabixç”¨æˆ· æ‰€ä»¥è¿™é‡Œè¦æ³¨æ„ï¼Œzabbixæœªå¿…æœ‰æƒé™æ‰§è¡Œ (1) ç»™zabbix å®šä¹‰sudoè§„åˆ™: zabbix ALL=(ALL) ALL (2) ä¸æ”¯æŒactiveæ¨¡å¼çš„agent: (3) ä¸æ”¯æŒä»£ç†æ¨¡å¼: (4) å‘½ä»¤é•¿åº¦ä¸å¾—è¶…è¿‡255ä¸ªå­—ç¬¦: (5) å¯ä»¥ä½¿ç”¨å®: (6) zabbix-serverä»…æ‰§è¡Œå‘½ä»¤ï¼Œè€Œä¸å…³å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸ: å‰æ: zabbix-agentè¦é…ç½®ä¸ºæ”¯æŒæ‰§è¡Œè¿œç¨‹å‘½ä»¤: EanbleRemoteCommands =1 LogRemoteCammands =1 # å¯ç”¨æ‰§è¡Œè¿œç¨‹å‘½ä»¤åŽè®°å½• # vim /etc/sudoers æˆ–è€… visudo zabbix ALL=(ALL) NOPASSWD:ALL æ³¨: ä»¥ä¸ŠæœåŠ¡å™¨æƒé™çš„æ˜¯æ“ä½œæ˜¯éžå¸¸ç”¨é£Žé™æ€§çš„; Actions --&gt; Operations --&gt; New --&gt; Operation type Remote Command: --&gt; Host æŒ‘è¿œå‡ºè¿œç¨‹ä¸»æœº --&gt; Global script --&gt;åœ¨æ–¹æ¡†ä¸­åŠ å…¥è¿œç¨‹å‘½ä»¤ Hosts --&gt; Applications --&gt; Create Applications --&gt; Http Hosts --&gt; Items --&gt; Create Items --&gt; Name http server --&gt; Type zabbix aggent --&gt; Key net.tcp.listen[80] --&gt; Applications http service Add Items &lt;-- Host --&gt; Triger --&gt; Create Triger --&gt; Name http service is on Expresion --&gt; add --&gt;Item node2: http service --&gt; Function: Previous value is =1 --&gt; Last of(T) 1 --&gt; N 0 --&gt; ä¸¥é‡çº§åˆ«å…ˆHight Configuration --&gt; Actions --&gt; Create Action --&gt; Action Name http service Conditions --&gt; New condition Trigger == node1: httpd serivce is value Operations --&gt; å®šä¹‰æŠ¥è­¦å‡çº§ --&gt; å¯ä»¥å®šä¹‰ç”±ç¬¬ä¸€æ­¥åˆ°ç¬¬å‡ æ­¥æ‰§è¡Œä»€ä¹ˆæ ·çš„æ“ä½œ æ³¨æ„: (1) å¦‚æžœç”¨åˆ°ä»¥æŸå®ƒç”¨æˆ·èº«ä»½è¿è¡Œå…¶å®ƒå‘½ä»¤çš„è¯ï¼Œè¦åŠ  sudo æ¥è¿è¡Œ; sudo systemctl restart httpd (2) åœ¨å„gentä¸Šçš„sudoers æ–‡ä»¶ä¸­ï¼Œè¦æ³¨é‡Šå¦‚ä¸‹è¡Œï¼Œå¦åˆ™å‘½ä»¤ä¾æ—§æ— æ³•æ­£å¸¸è¿è¡Œ; # Default requiretty Script: Alert Script æ”¾ç½®äºŽç‰¹å®šç›®å½•ä¸­: AlertScriptsPath=/usr/lib/zabbix/alertscripts zabbix_server.confé…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°: è„šæœ¬ä¸­ä½¿ç”¨$1,$2,$3æ¥è°ƒç”¨Actionå…ˆé¡¹å¡ä¸­çš„æ”¶ä»¶äººåœ°å€, Default Subject , Default Massage: # vim alert_message.sh #!/bin/bash to=$1 subject=&quot;$2&quot; body=&quot;$3&quot; echo &quot;$body&quot; | mail -s &quot;$subject&quot; &quot;$to&quot; # chmod +x alert_message.sh å½“ç„¶è¿™é‡Œæ˜¯ä¸€ä¸ªæœ€ç®€å•çš„å®žçŽ°è„šæœ¬ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨python,bash,ruby,perl ç­‰è„šæœ¬ æ³¨æ„: æ–°æ”¾å…¥æ­¤ç›®å½•ä¸­çš„è„šæœ¬ï¼Œåªæœ‰é‡å¯zabbix æ–¹èƒ½è¢«å®žåˆ«; Administration --&gt; Mdedia types --&gt; --&gt; Name AlterScript --&gt; Type Script --&gt; Script name alert_message.sh Administration --&gt; Users ---&gt; --&gt; Media --&gt; add --&gt; AlterScripts root@localhost è¿™æ ·çš„è¯ï¼Œé€šè¿‡ä¸¤ç§æ–¹å¼éƒ½èƒ½æ”¶åˆ°é‚®ä»¶Escalation TemplateWeb Scennario ZabbixæœåŠ¡å™¨è¿›ç¨‹123456789housekeeper ç”¨æ¥æ¸…ç†è¿‡æœŸæ•°æ®çš„;alter ä¸“é—¨ç”¨æ¥å‘é€è­¦å‘Šçš„è¿›ç¨‹;discoverer å®žçŽ°ä¸»æœºå‘çŽ°çš„; httppoller å¯¹webæœåŠ¡å™¨è¿›è¡Œç›‘æŽ§æ—¶;Poller ä¸»åŠ¨åŽ»è¢«ç›‘æŽ§èŠ‚ç‚¹åŽ»æ‹‰å–æ•°æ®;Pinger åŸºäºŽpingå‘½ä»¤æ¥æŽ¢æµ‹ä¸»æœºæ˜¯å¦åœ¨çº¿;db_config_syncer æœåŠ¡å™¨é…ç½®åŒæ­¥çš„; timer è®¡æ—¶å™¨;escaltor æŠ¥è­¦å‡çº§å™¨; zabbix å¯è§†åŒ–è‡ªå®šä¹‰å›¾å½¢å±žæ€§ 123456Name: å›¾å½¢çš„ç‹¬æœ‰åç§°;Width: å›¾å½¢çš„å®½åº¦ï¼Œå•ä½ä¸ºåƒç´ ;ä»…é€‚ç”¨äºŽ&quot;é¢„è§ˆ(perview)&quot; æ¨¡å¼ã€é¥¼å›¾æˆ–åˆ†ç¦»åž‹é¥¼å›¾; Height: å›¾å½¢çš„ç±»åž‹, å…±æœ‰å››ç§ï¼Œå³&quot;çº¿çŠ¶å›¾normal&quot;ã€&quot;å †å é¢ç§¯å›¾&quot;ã€&quot;é¥¼å›¾(pie)&quot;ã€ åˆ†ç¦»åž‹é¥¼å›¾(exploded);Show legend: æ˜¯å¦æ˜¾ç¤ºå›¾ä¾‹ï¼Œå³å›¾å½¢æ•°æ®åºåˆ—è¯´æ˜Ž;Show working time: æ˜¯å¦é«˜äº®æ˜¾ç¤ºå·¥ä½œæ—¶é—´åŒºåŸŸ;é€‰å®šæ—¶ï¼Œéžå·¥ä½œæ—¶é—´åŒºé—´çš„èƒŒæ™¯ä¸ºç°è‰²;æ­¤åŠŸèƒ½ä¸ç”¨äºŽpieå’Œexploded;Show Triggers: æ˜¯å¦æ˜¾ç¤ºè§¦å‘å™¨;æ­¤åŠŸèƒ½ä¸é€‚ç”¨äºŽpieå’Œexploded; å¤šå›¾å½¢åˆå¹¶æ˜¾ç¤º 123456Configuration --&gt; Screen --&gt; Create Screen --&gt; Name Test Screen--&gt; Columns 3 # åˆ—--&gt; Row 2 # è¡Œ --&gt; Test Screen --&gt; change è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ª2è¡Œ3åˆ—çš„è¡¨æ ¼ï¼Œç„¶åŽå¾€é‡Œé¢æ·»åŠ å›¾ç‰‡; å¤šå±ç¿»è½¬ 123Slide showsName Default delay(in seconds) å¯è§†åŒ–: graph ,screen, slide shows,map å®(macros) 1234567891011121314151617181920212223# å®å…¶å®žè¯´ç™½äº†å°±æ˜¯å˜é‡ï¼Œç±»åž‹é€šå¸¸ä¸ºæ–‡æœ¬ç±»åž‹; # ä¸ºäº†æ›´å¼ºçš„çµæ´»æ€§,zabbixè¿˜æ”¯æŒåœ¨å…¨å±€ã€æ¨¡æ¿æˆ–ä¸»æœºçº§åˆ«ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å®(user macro);# ç”¨æˆ·è‡ªå®šä¹‰å®è¦ä½¿ç”¨&quot;&#123;$MACRO&#125;&quot;è¿™ç§ç‰¹æ®Šçš„è¯­æ³•æ ¼å¼; # å®å¯ä»¥åº”ç”¨åœ¨item keys å’Œdescriptionsã€ trigger åç§°å’Œè¡¨è¾¾å¼ã€ä¸»æœºæŽ¥å£IP/DNSåŠç«¯å£ã€ discoveryæœºåˆ¶çš„SNMPåè®®çš„ç›¸å…³ä¿¡æ¯ç­‰;# å®çš„åç§°åªèƒ½ä½¿ç”¨å¤§å†™å­—æ¯ã€æ•°å­—åŠä¸‹åˆ’çº¿;# ä¸¤ç±»: å†…å»º: &#123;MACRO_NAME&#125; è‡ªå®šä¹‰:&#123;$MACRO_NAME&#125;# å¯ä»¥åœ¨ä¸‰ä¸ªçº§åˆ«ä½¿ç”¨: Global, Template, Host# ä¼˜å…ˆçº§: Host --&gt; Template --&gt; Global åœ¨æŸçº§åˆ«æ‰¾åˆ°åŽå°†ç›´æŽ¥ä½¿ç”¨: å°†ä¸å†æŸ¥æ‰¾ å…¨å±€å®: Adminstration --&gt; General --&gt; Macrios(åœ¨å…ˆé¡¹å¡ä¸­) ä¸»æœºå®: Configuration --&gt; Hosts --&gt; Macrios ä¸»æœºçº§åˆ«çš„å®ä¼˜å…ˆçº§æœ€é«˜; Template: Configuration --&gt; Complation --&gt; Macrios æ¨¡æ¿(Templats)ä¸€ç³»åˆ—é…ç½®çš„é›†åˆï¼Œæ­¤äº›é…ç½®å¯ä»¥é€šè¿‡â€é“¾æŽ¥â€çš„æ–¹å¼åº”ç”¨äºŽæŒ‡å®šçš„ä¸»æœº:application, item, trigger, graph, scree åŠå‘çŽ°è§„åˆ™; æ·»åŠ ä¾‹è¡Œæƒ¯å¸¸çš„ç»´æŠ¤æ—¶é—´; 1Configuration --&gt; maintenance --&gt; Maintenance User Parameters: 123456789101112# zabbix å†…ç½®äº†è®¸å¤šitem key:å®žçŽ°ç”¨æˆ·è‡ªå®šä¹‰ item key ,å®žçŽ°ç‰¹æœ‰æ•°æ®æŒ‡æ ‡ç›‘æŽ§;è¯­æ³•: UserParameter=&lt;key&gt;,&lt;command&gt;# vim /etc/zabbix/zabbix_agentd.d/os.confUserParameter=os.memory.used, free -m | awk &apos;/^Mem/ &#123;print $3&#125;&apos;UserParameter=os.memory.used, free -m | awk &apos;/^Mem/ &#123;print $3&#125;&apos;UserParameter=os.memory.used, free -m | awk &apos;/^Mem/ &#123;print $3&#125;&apos;æ³¨: éœ€è¦é‡å¯zabbix-agent æ‰èƒ½ä½¿ç”¨# systemctl restart zabbix-agentè¿™ä¸ªæ—¶å€™å®šä¹‰çš„zabbix-agent keyå°±å¯ä»¥ä½¿ç”¨äº†,åœ¨server web æŽ¥å£ä¸­æ·»åŠ ; å¦‚æžœæ‰¾ä¸åˆ°key åˆ™ç›´æŽ¥è¾“å…¥å³å¯ os.memory.used ç›‘æŽ§nginx statusnginx status å¼€å¯æ–¹æ³•: 12345678910server &#123; ... location /status &#123; stub_status on; access_log off; allow 172.16.55.123; # å…è®¸è®¿é—®çš„IP allow 127.0.0.1; deny all; &#125;&#125; 123456789101112131415161718192021222324252627282930çŠ¶æ€é¡µé¢å„é¡¹æ•°æ®çš„æ„ä¹‰;active connections - å½“å‰Nginx æ­£å¤„ç†çš„æ´»åŠ¨è¿žæŽ¥æ•°;serveraccepts handled requests - æ€»å…±å¤„ç†äº† 233851ä¸ªè¿žæŽ¥ï¼ŒæˆåŠŸåˆ›å»º 233851æ¬¡æ¡æ‰‹(è¯æ˜Žä¸­é—´æ²¡æœ‰å¤±è´¥çš„) æ€»å…±å¤„äº† 687942ä¸ªè¯·æ±‚(å¹³å‡æ¯æ¬¡æ‰¬å¤„ç†äº† 2.94 ä¸ªæ•°æ®è¯·æ±‚)ã€‚ reading -nginx è¯»å–åˆ°å®¢æˆ·ç«¯çš„Headerä¿¡æ¯æ•°; writing -nginx è¿”å›žç»™å®¢æˆ·ç«¯çš„Header ä¿¡æ¯æ•°; waiting - å¼€å¯ keep-alive çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼ç­‰äºŽ active- (reading +wrting) æ„æ€å°±æ˜¯Nginx å·²ç»å¤„ç†å®Œæ­£ç­‰å€™ä¸€æ¬¡è¯·æ±‚æŒ‡ä»¤çš„é©»ç•™è¿žæŽ¥;UserParameter=Mysql.dml[*], /usr/local/mysql/bin/mysql -h$1 -u$2 -p$3 -e &apos;SHOW GLOBAL STATUS&apos; | awk &apos;/Com_$4\&gt;/&#123;print $$2&#125;&apos; # åœ¨/etc/init.d/zabbix_agentd.d/xx.confä¸­å®šä¹‰äº†ä»¥ä¸Šé¡¹åŽ; åœ¨zabbix-server ç»ˆç«¯zabbix_get -s 172.16.55.124 -p 10050 -k &quot;Mysql.dml[172.16.55.124,root,password,delete]&quot; #æ³¨æ„mysqlç”¨æˆ·çš„æŽˆæƒzabbix_get -s 172.16.55.124 -p 10050 -k &quot;Mysql.dml[172.16.55.124]&quot;UserParameter=Nginx.active[*], /usr/bin/curl -s &quot;http://$1:$2/status&quot; | awk &apos;/^Active/ &#123;print $NF&#125;&apos;UserParameter=Nginx.reading[*], /usr/bin/curl -s &quot;http://$1:$2/status&quot; | grep &apos;Reading&apos; | cut -d&quot; &quot; -f2UserParameter=Nginx.writing[*], /usr/bin/curl -s &quot;http://$1:$2/status&quot; | grep &apos;Writing&apos; | cut -d&quot; &quot; -f4UserParameter=Nginx.waiting[*], /usr/bin/curl -s &quot;http://$1:$2/status&quot; | grep &apos;Waiting&apos; | cut -d&quot; &quot; -f6UserParameter=Nginx.accepted[*], /usr/bin/curl -s &quot;http://$1:$2/status&quot; | awk &apos;/^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+/ &#123;print $$1&#125;&apos;UserParameter=Nginx.handled[*], /usr/bin/curl -s &quot;http://$1:$2/status&quot; | awk &apos;/^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+/ &#123;print $$2&#125;&apos;UserParameter=Nginx.requests[*], /usr/bin/curl -s &quot;http://$1:$2/status&quot; | awk &apos;/^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+/ &#123;print $$3&#125;&apos;UserParameter=nginx.access_countaccess, /usr/lib/zabbix/externalscripts/logcheck_nginx.accesslog totalaccessUserParameter=nginx.access_count200, /usr/lib/zabbix/externalscripts/logcheck_nginx.accesslog 200accessUserParameter=nginx.access_count202, /usr/lib/zabbix/externalscripts/logcheck_nginx.accesslog 202accessUserParameter=nginx.access_count4xx, /usr/lib/zabbix/externalscripts/logcheck_nginx.accesslog 4xxaccessUserParameter=nginx.access_count3xx, /usr/lib/zabbix/externalscripts/logcheck_nginx.accesslog 3xxaccessUserParameter=nginx.access_count5xx, /usr/lib/zabbix/externalscripts/logcheck_nginx.accesslog 5xxaccessUserParameter=varnish.stat[*], /usr/lib/zabbix/externalscripts/varnishstatus varnish_stat $1UserParameter=varnish.count[*], /usr/lib/zabbix/externalscripts/varnishstatus varnish_count $1UserParameter=varnish.hitrate, /usr/lib/zabbix/externalscripts/varnishstatus varnish_hitrate zabbix è‡ªåŠ¨å‘çŽ°åŠŸèƒ½12345678910111213141516171819202122232425262728293031323334353637zabbix æä¾›ç½‘ç»œå‘çŽ°åŠŸèƒ½: network discovery åŸºäºŽHTTPã€ ICMPã€ SSHã€ LDAPã€ TCPã€ SNMPã€ Telnetã€ Zabbix_agentæ‰«ææŒ‡å®šç½‘å†…çš„ä¸»æœº; ä¸€æ—¦ä¸»æœºè¢«å‘çŽ°ï¼Œå¦‚ä½•å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œå°†ç”±actionæ¥å†³å®š; LLD: low leverl Discovery (åº•çº§ç½‘ç»œå‘çŽ°åŠŸèƒ½) æ­¤äºŒè€…çš„åŠŸèƒ½: è‡ªåŠ¨æ·»åŠ ä¸»æœºã€é“¾æŽ¥è‡³æ¨¡æ¿/ç§»é™¤é“¾æŽ¥ã€è‡ªåŠ¨åˆ†ç»„ã€è‡ªåŠ¨æ·»åŠ ç›‘æŽ§é¡¹ã€å®šä¹‰è§¦å‘å™¨ç­‰ã€æ‰§è¡Œè¿œç¨‹è„šæœ¬; Discoveryä¸­çš„äº‹ä»¶: Service Up, Service Down, Host Up, Host Down, Service Discovered, Service Lost, Host Discovererd, Host Lost ç½‘ç»œå‘çŽ°æœ‰ä¸¤ä¸ªæ­¥éª¤: discovery --&gt; action actions: Sending notifications Adding/removting hosts Enabling/disabling hosts Adding hosts to a group Removing hosts from a group Linking hosts to/unlinking from a template Executing remote scripts è‡ªåŠ¨å‘çŽ°åŠŸèƒ½çš„ä½¿ç”¨ï¼Œé¦–å…ˆè¦å°†serverç«¯å’Œagentuç«¯çš„æ—¶é—´è‡ªåŠ¨åŒæ­¥; # vim /etc/zabbix/zabbix_agentd.conf Server = 172.16.55.124 ServerActive = 172.16.55.124 Hostname = test.xxxxxx.com LogRemoteCommand = 1 # systectl start zabbix-agent Configure --&gt; Discovery --&gt; Create discovery rule --&gt; Name Local Linux Servers --&gt; IP range 172.16.55.125-127 Delay(in sec) 3600 --&gt; Checks Check type ICMP ping(æœ€æ˜“äºŽå®žçŽ°çš„æ–¹å¼) --&gt; Add --&gt; Device uniqueness criteria IP address --&gt; Enabled Add &lt;-- # å½“è¿”å›žåˆ°Discovery æ—¶ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨å·²ç»è¢«è‡ªåŠ¨å‘çŽ°; 12345678910111213141516171819202122232425 # åˆ›å»ºåŠ¨ä½œ Configuration --&gt; Actions --&gt; Discovery(å’Œä»¥å¾€actionä¸åŒï¼Œåœ¨é€‰é¡¹å¡ä¸­å…ˆæ‹©) ä¸»æœºå‘çŽ°çš„æ¡ä»¶ Conditions: New condition Host IP = æˆ–è€…æŒ‡å®šç½‘ç»œçš„å‘çŽ°è§„åˆ™æ¥å®šä¹‰ Operations: è¿™é‡Œå°±å¯ä»¥å®šä¹‰å¯¹åº”çš„æ“ä½œï¼ˆæ·»åŠ åˆ°ç»„ä¸­ï¼‰ Configuration --&gt; Templates --&gt; --&gt; Template name Linux Server Memory Stats --&gt; Visible anme --&gt; Groups In groups test group Add &lt;--# å¦å¤–éœ€è¦è‡ªå·±å®šä¹‰å¥½ä¸€ä¸ªæ¨¡æ¿Configuration --&gt; Actions --&gt; Create Action--&gt; Conditions --&gt; Type of calculation And/Or --&gt; Conditions --&gt; Host IP = 172.16.55.125-128 --&gt;Discovery rule = Local Linux Servers --&gt; Discovery status = Discovered--&gt; Operations --&gt; New --&gt; Add To host group (Test group) # æ·»åŠ åˆ°ç»„ä¸­ --&gt; Link to template Linux Server Memory status add ADD &lt;--åœ¨ç½‘ç»œçš„è‡ªåŠ¨å‘çŽ°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨zabbix-agentæ¥å‘çŽ° åœ¨ç½‘ç»œçš„ä¸»åŠ¨å‘çŽ°ä¸­ï¼Œç”±äºŽæ˜¯zabbixä¸»åŠ¨æ‰«æï¼Œå› æ­¤è¿™ç§æ¨¡åž‹æ˜¯éžå¸¸æ¶ˆè€—æ€§èƒ½çš„ åœ¨mariadbä¸­æŸ¥çœ‹æ”¯æŒçš„key 123MariaDB&gt; use zabbix;MariaDB&gt; SELECT key_ FROM items;ä½¿ç”¨agent-ping æ¥åšå®žçŽ°ä¸»æœºæŽ¢æµ‹; auto_registation ä¸»åŠ¨æ³¨å†ŒåŠŸèƒ½123456789Active Agent Auto-Registration# é¦–å…ˆä¸»æœºä¹‹é—´è¦æ—¶é—´åŒæ­¥; # å®‰è£…zabbix-agent ç«¯;# vim /etc/zabbix/zabbix-agent.conf# ServerActive=172.16.100.6# Hostname=test.xxxxx.com# ListenIp=172.16.55.126# HostMetdata = test4 (åªç”¨äºŽè‡ªåŠ¨æ³¨å†Œä¸»æœºçš„å”¯ä¸€æ ‡è¯†) # systemctl restart zabbix-agent 123456# æ·»åŠ è‡ªåŠ¨æ³¨å†Œçš„åŠ¨ä½œConfiguration --&gt; Actions --&gt; (Event source Autoregistration) --&gt; Create Action--&gt; Actions: auto registration --&gt; Condition: Hostname like node4 (æ¯”å¦‚ä¸»æœºåä¸­åŒ…ä¸­åŒ…æ¶µnode4) --&gt; Add--&gt; Operations Add to Host groups --&gt; Link with templates é“¾æŽ¥è‡³æ¨¡æ¿# æ”¯æŒä½¿ç”¨agent(active)ç±»åž‹çš„item key: 1234567891011# é…ç½®è¿‡ç¨‹: (1)å®šä¹‰agentç«¯: ServerActive= Server= Hostname= ListenIP= è®¾ç½®ä¸ºæœ¬æœºæŸç‰¹å®šIPï¼š ListenPort= HostMetadata= HostMetadataItem= item keyï¼Œ ä¸€èˆ¬ä½¿ç”¨system.uname (2) é…ç½®actionï¼Œè¦æ±‚å…¶äº‹ä»¶ä¸€æºä¸ºauto-registation LLD: low Level Discovery 12345678910# è‡ªåŠ¨å‘çŽ°ç‰¹å®šå˜æ›´çš„åç§° #IFNAME(æŽ¥å£åç§°) , #FSNAME(æ–‡ä»¶ç³»ç»Ÿåç§°)# ä¸»è¦å°†æœ¬åœ°çš„ä¸€äº›ç‰¹æ®Šæ•°æ®å‘é€åˆ°æœåŠ¡ç«¯ï¼Œæ¯”å¦‚æŽ¥å£ç±»çš„æ•°æ®;# æ·»åŠ é’ˆå¯¹å˜ç†çš„Items:# è¿”å›žå€¼ä¸ºJSON Configurations --&gt;Templates --&gt; discovery rules --&gt; create discovery rules--&gt; name if lld--&gt; Type zabbix agent --&gt; Key net.if.[#IFNAME,bytes] 123# ç™»å½• zabbixæ•°æ®åº“æŸ¥è¯¢å¯¹åº”çš„key# use zabbix;# SELECT key_ FROM iem WHERE key_ LIKE &apos;%discovery%&apos;; Web ç›‘æŽ§ Zabbix è¿˜å¯ä»¥è¿›è¡Œweb ç«™ç‚¹çš„å¯ç”¨æ€§æ£€æµ‹; åˆ›å»ºwebç›‘æŽ§éœ€è¦å®šä¹‰ä¸€ä¸ªwebæ–¹æ¡ˆ(scenarios); webæ–¹æ¡ˆåŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªHTTPè¯·æ±‚æˆ–â€æ­¥éª¤(step)â€; æ­¥éª¤(step)çš„æ‰§è¡Œè¿‡ç¨‹æŒ‰ç…§é¢„å…ˆå®šä¹‰çš„é¡ºåºè¿›è¡Œæ‰§è¡Œ; é€šè¿‡webç›‘æŽ§å¯ä»¥å®žæ—¶èŽ·å–ä»¥ä¸‹ä¿¡æ¯; 123# æ•´ä¸ªwebæ–¹æ¡ˆä¸­æ‰€æœ‰çš„æ­¥éª¤çš„å¹³å‡ä¸‹è½½é€Ÿåº¦;# å¤±è´¥çš„æ­¥éª¤å·;# å¤±è´¥çš„æŠ¥é”™ä¿¡æ¯; åœ¨webæ–¹æ¡ˆçš„å…·ä½“æ­¥éª¤ä¸­ï¼Œå¯ä»¥æŒ‰éœ€è¦ä½¿ç”¨å¦‚ä¸‹ä¿¡æ¯ 123# è¯¥æ­¥éª¤çš„ä¸‹è½½é€Ÿåº¦;# å›žåº”æ—¶é—´;# å›žåº”çŠ¶æ€ç ; Zabbixä¹Ÿå¯ä»¥æ£€æµ‹èŽ·å–åˆ°HTMLé¡µé¢ä¸­æ˜¯å¦åŒ…å«é¢„è®¾çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥å®žçŽ°ç™»å½•å’Œé¡µé¢ç‚¹å‡»; 12345678# é¦–å…ˆéœ€è¦å®šæ„ä¸€ä¸ªapplication# Configuration --&gt; Hosts --&gt; Web --&gt; Scenario Zabbix server --&gt; google charme--&gt; Steps --&gt; zabbix home --&gt; http://172.16.55.123/index.html --&gt; Require status code 200 zabbixçš„ç›‘æŽ§æ–¹å¼ 123456789# zabbix-web æ‰€èƒ½å¤Ÿæ˜¾ç¤ºçš„ä¸”å¯æŒ‡å®šä¸ºç›‘æŽ§æŽ¥å£ç±»åž‹çš„ç›‘æŽ§æ–¹å¼:Agent: passive activeSNMP: Simple Network Management ProtocolIPMI: æ™ºæ…§å¹³å°ç®¡ç†æŽ¥å£ï¼ˆInterlligent-Platform Management Interfaceï¼‰åŽŸæœ¬æ˜¯ä¸€ç§Interæž¶æž„çš„ä¼ä¸šç³»ç»Ÿçš„å‘¨è¾¹ è®¾å¤‡æ‰€é‡‡ç”¨çš„ä¸€ç§å·¥ä¸šæ ‡å‡†; IPMIäº¦æ˜¯ä¸€å¼€æ”¾çš„å…è´¹æ ‡å‡†ï¼Œä½¿ç”¨è€…æ— éœ€æ”¯ä»˜é¢å¤–çš„è´¹å³å¯ä½¿ç”¨æ­¤æ ‡å‡†;JMX: Java Manaement Extensions, ç”¨äºŽé€šè¿‡Javaè‡ªå·±çš„æŽ¥å£å¯¹javaç¨‹åºè¿›è¡Œç›‘æŽ§;zabbix-java-getwayç”¨äºŽèŽ·å–ç›‘æŽ§æ•°æ®: SNMP ç›‘æŽ§æ–¹å¼ 12345678910# æ“ä½œ: Get, NetNext, Set , Resonse, TrapMIB: æ˜¯è¢« ç®¡ç†å¯¹è±¡çš„é›†åˆï¼Œè€Œä¸”è¿˜é¢å¤–å®šä¹‰äº†è¢«ç®¡ç†å¯¹è±¡çš„åç§°ã€è®¿é—®æƒé™ã€æ•°æ®ç±»åž‹ç­‰å±žæ€§;MIBè§†å›¾: MIBçš„å­é›†;æŽˆæƒ:å°†MIBè§†å›¾ä¸ŽCommunityç»‘å®šæ¥å®žçŽ°;OID: Object ID 1.3.5.1.2.1 1: system 2: interface 4:ip 6: tcp 7: udp 12345678910111213# yum -y install net-snmp net-snmp-libs net-snmp-utils# vim /etc/snmp/snmpd.conf com2sec notConfigUser default public group notConfigGroup v1 notConfigUser group notConfigGroup v2c notConfigUser view systemview include .1.3.6.1.2.1 view systemview include .1.3.6.1.2.1.25.1.1access notConfigGroup &quot;&quot; any noauth exact systemview none none# service smpd start # ç¡®å®šudp çš„161ç«¯å£å·²ç»å¯ç”¨;# æ­¤æ—¶å¯ä»¥ä½¿ç”¨icmpæ¥æ”¶é›†æ•°æ®äº†; JMXç›‘æŽ§æ–¹å¼: 1234567891011121314(1) å®‰è£…zabbix-java-gateway: é…ç½®æ–‡ä»¶: /etc/zabbix/zabbix_java_gateway.conf Listen_IP = Listen_PORT = 10052 zabbix serverçš„é…ç½®æ–‡ä»¶ /etc/zabbix/zabbix_server.conf JavaGateWay= JavaGateWayPort= 10052 (2) Javaåº”ç”¨ç¨‹åºå¼€æˆ·JMXæŽ¥å£: java -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port =10053 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremoe.ssl=falseç›‘æŽ§Tomcat export CATALINA_OPTS=&quot;$CATALINA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port =10053 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremoe.ssl=false&quot; zabbix åˆ†å¸ƒå¼ç›‘æŽ§æ¦‚è¿°1234567891011121314151617181920212223# Zabbixèƒ½é«˜æ•ˆåœ°ç›‘æŽ§åˆ†å¸ƒå¼ITæž¶æž„;# åœ¨å¤§åž‹çŽ¯å¢ƒä¸­Zabbixæä¾›ä¸¤ç§è§£å†³æ–¹æ¡ˆ; 1ã€ä½¿ç”¨ä»£ç†(proxy); 2ã€ä½¿ç”¨èŠ‚ç‚¹(node);# ä»£ç†(proxy)ç”¨äºŽæœ¬åŒºåŸŸæ•°æ®æ”¶é›†ï¼Œå¹¶å°†æ•°æ®å‘é€ç»™server;# èŠ‚ç‚¹(node) æä¾›å®Œæ•´çš„Zabbix serverç”¨ä»¥å»ºç«‹åˆ†å¸ƒå¼ç›‘æŽ§ä¸­çš„å±‚çº§;# Server-Node-Clientç‰¹æ€§; è§£å†³hostè¿‡å¤šæ—¶å•å°Serveré¢ä¸´æ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜; ä½¿ç”¨å¤šä¸ªinstance; æ¯ä¸ªinstanceæ˜¯ç‹¬ç«‹çš„ä¸€å¥—zabbixï¼Œæœ‰databaseå’ŒFrontend(optional); æ”¯æŒçƒ­æ’æ‹”ï¼ŒNodeå’ŒServerçš„è¿žæŽ¥å¯ä»¥éšæ—¶æ–­å¼€ï¼Œä½†ä¸å½±å“Nodeçš„æ­£å¸¸è¿è¡Œ; Nodeå®šæ—¶ç»™Serverå‘é€configuration, history,event; Serverå®šæ—¶ç»™Nodeå‘é€configurations æ‰€æœ‰é…ç½®å˜æ›´åªèƒ½åœ¨NodeèŠ‚ç‚¹æ“ä½œï¼Œä¸èƒ½å†Serveræ“ä½œ; æ”¯æŒæ ‘çŠ¶ç»“æž„ï¼ŒNodeåˆå¯ä»¥æ˜¯å¤šä¸ªServer;# Proxy vs Node Nodeæœ¬èº«æ˜¯ä¸€å°server,å®ƒæœ‰å®Œæ•´çš„webé¡µé¢ï¼Œå®Œæ•´çš„æ•°æ®åº“ï¼Œå®ƒå°†æ•°æ®æºæºä¸æ–­ä¼ é€ç»™Master; Poxyæ˜¯åªæœ‰ä¸€ä¸ªproxyçš„daemonè¿›ç¨‹ï¼Œproxyä¹Ÿæœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œä½†å®ƒçš„æ•°æ®åº“åªä¼šä¿å­˜ä¸€å®šæ—¶é—´çš„æ•°æ®; å®ƒä¸ŽMasteré€šä¿¡æ˜¯å°†ä¸€æ‰¹ä¿¡æ¯æ‰“åŒ…åŽå‘é€åˆ°Masterï¼Œ Masterå°†è¿™äº›æ•°æ®mergeå…¥Materæ•°æ®åº“;# Master-Proxy ç›¸æ¯”Master-Nodeçš„ä¼˜ç‚¹æœ‰ä»¥ä¸‹ ProxyåŽ‹åŠ›å°ï¼Œæ•°æ®åº“åªå­˜å‚¨ä¸€å®šæ—¶é—´æ•°æ®; MasteråŽ‹åŠ›å˜å°ï¼Œæ•°æ®ä¸æ˜¯æºæºä¸æ–­èŽ·å–ï¼Œå‡å°IOåŽ‹åŠ›; æž¶æž„æ›´æ¸…æ™°ï¼Œæ˜“ç»´æŠ¤ï¼› 123456789101112131415# zabbix-proxy ä¹Ÿéœ€è¦è¢«ç›‘æŽ§# yum -y install zabbix-proxy zabbix-proxy-mysql zabbix zabbix-agent# mysql CREATE DATABASE zabbix_proxy CHARACTER SET utf8;GRANT ALL ON zabbix_proxy.* TO zbxuser@&apos;172.16.%.%&apos; IDENTIFIED BY &apos;xxxxxx&apos;;FLUSH PREVILEGES; # vim /etc/zabbix/zabbix_proxy.confServer=172.16.55.123Hostname=test.xxxx.comDBHost=172.16.55.123DBName=zabbix_proxyDBUser=zbxuserDBPassword=xxxxxxConfigFrequency=600 #å¤šä¹…å‘æœåŠ¡å™¨ç«¯æ‹‰å–ä¸€æ¬¡æ•°æ®# server zabbix-proxy start 12345Administration --&gt; Proxies Proxy name test.xxxx.comProxy mode ActiveHosts Proxy hosts# å†æ·»åŠ è¢«ç›‘æŽ§æœåŠ¡å™¨æ—¶å¯ä»¥åœ¨åˆ›å»ºä¸»æœºæ—¶å¯ä»¥æŒ‡æ˜ŽMonitored by proxy zabbix databaseéœ€è¦ç”¨åˆ°çš„ç©ºé—´: 12345678960000/60 = 1000æ¡ åŽ†å²æ•°æ®=å¤©æ•°xæ¯ç§’é’Ÿå¤„ç†çš„æ•°æ®æ˜¯x24x3600x50Bytes 90x1000x8600x50Bytesè¶‹åŠ¿æ•°æ®: æ¯ä¸€ä¸ªè¶‹åŠ¿æ•°æ®128Bytes, å¤§å°=å¤©æ•°xç›‘æŽ§é¡¹x24x128Bytesäº‹ä»¶æ•°æ®: æ¯ä¸ªå æ®130Bytes å¤§å°:å¤©æ•°x86400x130]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[zabbixç›‘æŽ§å®žçŽ°æ–‡æ¡£]]></title>
    <url>%2F2018%2F04%2F02%2Fzabbix%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3%2F</url>
    <content type="text"><![CDATA[Zabbix ç›‘æŽ§å®žçŽ°æ–‡æ¡£ ç†è®ºçŸ¥è¯†äº†è§£123456789101112131415ä¼ æ„Ÿå™¨;æ•°æ®é‡‡é›† --&gt; æ•°æ®å­˜å‚¨ --&gt; æ•°æ®å±•ç¤º; æŠ¥è­¦: é‡‡é›†åˆ°çš„æ•°æ®è¶…å‡ºé˜ˆå€¼æ—¶ï¼Œé€šå¸¸ä¼šæ‰§è¡ŒæŠ¥è­¦æ“ä½œ; æ—¶é—´åºåˆ—æ•°æ®;å¤§è§„æ¨¡çš„ç›‘æŽ§: å¼€æºç›‘æŽ§å·¥å…·: Nagiosæœ‰ä¸¤ç§ç»“ç‚¹ç±»åž‹: NMS(ç½‘ç»œç›‘æŽ§ç³»ç»Ÿ)ï¼Œå‘¨æœŸæ€§çš„å®Œæˆæ•°æ®é‡‡é›†,ä¸”æœ€é‡è¦çš„æ˜¯è¦å®Œæˆå­˜å‚¨ï¼Œä¸ä»…ä»…æ˜¯ä¸»æœºã€‚æ›´é‡è¦çš„è·¯ç”±å™¨; SNMP å¯¹å…¶å®ƒç‰©ç†è®¾å¤‡è¿›è¡Œç›‘æŽ§, Simple Network Management Protocol ä¸€èˆ¬è€Œè¨€è¦å¯¹å…¶å®ƒç»“ç‚¹ä¸­å®‰è£…agentç«¯; SNMPçš„å·¥ä½œæ¨¡å¼: NMSå‘agenté‡‡é›†æ•°æ®; agentå‘NMSæŠ¥å‘Šæ•°æ®; NMSè¯·æ±‚agentä¿®æ”¹é…ç½®; SNMPçš„ç»„ä»¶MIB: management information base;SMI: MIBè¡¨ç¤ºç¬¦å·;SNMPåè®®ä¸­çš„ NMS;SNMPåè®®çš„ç‰ˆæœ¬; 123v1,v2,v3v2c:NMS --&gt; agentv3:è®¤è¯ã€åŠ å¯†ã€ è§£å¯† NMS å¯ä»¥å‘èµ·çš„æ“ä½œ: 12345678910111213141516Get, GetNextï¼ŒSet, Trap(æ•èŽ·);agent: Response,è¿”å›žä¸€ä¸ªæˆ–è€…å¤šä¸ªå€¼;UDP NMS:161ç«¯å£ agent:162ç«¯å£;cacti: å¯ä»¥è°ƒç”¨ç¼–ç¨‹æŽ¥å£ï¼Œåˆ©ç”¨SNMPï¼Œå³æ—¶ç»˜åˆ¶å±•ç¤ºå›¾å½¢;cacti: æŠ¥è­¦èƒ½åŠ›æ˜¯éžå¸¸å¼±çš„; ä¸‡ä¸€æœåŠ¡èŽ«åå¥‡å¦™çš„çš„å…³é—­äº†ï¼Œå¯ä»¥å°è¯•å¯åŠ¨æœåŠ¡ï¼Œå¯åŠ¨ä¸äº†åŽå†æ‰§è¡ŒæŠ¥è­¦æ“ä½œ; ä¸ºé¿å…è¯¯åˆ¤ï¼Œåº”è¦å¤šæ¬¡é‡‡æ ·;Nagios: å¯ä»¥è°ƒç”¨å„ç§æŠ¥è­¦å·¥å…·æ¥æ‰§è¡ŒæŠ¥è­¦æ“ä½œ; æŠ¥è­¦æ¬¡æ•°æ®å’ŒæŠ¥è­¦èŒƒå›´ï¼ŒæŠ¥è­¦èŒƒå›´çš„æ“ä½œ; ä»£ç ä¸Šçº¿çš„æ—¶å€™ä¸éœ€è¦æŠ¥è­¦ï¼Œä¸”è¦å®šä¹‰ä¸æŠ¥è­¦æ—¶é—´æ®µ; Nagios å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªéžå¸¸å¼ºå¤§çš„æŠ¥è­¦å·¥å…·; NMS å¯èƒ½è¦ç›‘æŽ§æ•°ä¸‡ä¸ªæŒ‡æ ‡ï¼Œé‚£ä¹ˆä¼šå¯¹NMS çš„ç£ç›˜IO,ç½‘ç»œå¸¦å®½ï¼ŒCPUè´Ÿè½½ç­‰é€ æˆè¾ƒå¤§çš„åŽ‹åŠ›; æˆ‘ä»¬å¯ä»¥å¯¹è®¾å¤‡ä¸Žç½‘ç»œåˆ’åˆ†ï¼Œéƒ¨ç½²å¤šå¥—ç›‘æŽ§ç³»ç»Ÿï¼Œè€Œä¸”å®ƒä»¬æ˜¯ç”¨ä¸åŒçš„æ–¹æ³•å®žçŽ°çš„; ä½†è¿™æ ·å¯¹æˆ‘ä»¬çš„é’ˆå¯¹å¼ç®¡ç†å°±ä¼šå¸¦æ¥å·¨å¤§çš„éº»çƒ¦; å®ŒæˆçŠ¶æ€è½¬æ¢ï¼Œå¹¶å®ŒæˆæŠ¥è­¦; cacti å®Œæˆæ•°æ®æ”¶é›†å’Œå±•ç¤ºï¼Œä½†å¯¹äºŽæŠ¥è­¦èƒ½åŠ›æ¯”è¾ƒè–„å¼±; Zabbix:ç»“åˆäº†ä»¥ä¸Šä¸¤ç§å·¥å…·çš„åŠŸèƒ½; 1231ã€zabbix ä¼šè‡ªå·±å…ˆè§£å†³2ã€zabbix è§£å†³ä¸äº†æŠ¥è­¦ç»™éƒ¨é—¨è´Ÿè´£äºº3ã€zabbix ç»§ç»­æŠ¥è­¦å‡çº§ï¼ŒæŠ¥è­¦ç»™éƒ¨é—¨è´Ÿè´£äºº, éƒ¨é—¨é¢†å¯¼ è‘—åçš„å¼€æºç›‘æŽ§å·¥å…·: zabbix, zennos, opennms, cacti, nagios(icinga),ganglia (NMS linux) (è¢«ç›‘æŽ§ç«¯ Linuxä¸»æœº) ç›‘æŽ§åŠŸèƒ½çš„å®žçŽ°:12341ã€agent 2ã€ssh3ã€SIMP4ã€IPMI æ™ºæ…§å¹³å°ç®¡ç†æŽ¥å£ 1234567891011zabbix NMS ä¸Ž agent ç«¯åŒæ–¹æ”¯æŒçš„åè®®(JSON,XML)è§†å›¾(è¯»æ“ä½œ/å†™æ“ä½œå„å®šä¹‰ä¸€ä¸ªå›¢ä½“)åœ¨linuxä¸Šè¦ä½¿ç”¨snmpåŠŸèƒ½è¦ä½¿ç”¨&quot;Linux: net-snmpç¨‹åºåŒ…&quot;zabbixï¼šæœ‰ä¸“ç”¨agentçš„ç›‘æŽ§å·¥å…·; ç›‘æŽ§ä¸»æœº: linuxã€windowsã€FreeBSD ç½‘ç»œè®¾ç½®ã€è·¯ç”±äº¤æ¢è®¾å¤‡ï¼Œå¯ä»¥ç”¨SNMPè¿™ç§åè®®æ¥è¿›è¡Œç›‘æŽ§; é‡‡é›†ç½‘å¡æµé‡ï¼Œå¯ä»¥å°†å¤šä¸ªç½‘å¡æµé‡éƒ½åŠ èµ·æ¥è¿›è¡Œè®¡ç®—; æŠ¥è­¦ï¼Œéœ€è¦æ·»åŠ æŠ¥è­¦ç­–ç•¥ï¼Œå¦å¤–éœ€è¦æŠ¥è­¦è·Ÿè¸ªï¼ŒæŠ¥è­¦è¿žåŠ¨; å¯¹ç›‘æŽ§ç³»ç»Ÿè¦åšç³»ç»Ÿè¯„ä¼°;zabbix æ˜¯ç”±phpå®žçŽ°çš„ï¼Œæ‰€ä»¥å¯ä»¥å®žçŽ°åŠŸèƒ½çš„äºŒæ¬¡å¼€å‘; ç›‘æŽ§å¯¹è±¡12345678è®¾å¤‡å’Œè½¯ä»¶ è®¾å¤‡:æœåŠ¡å™¨ã€è·¯ç”±å™¨ ã€äº¤æ¢æœºã€IOç³»ç»Ÿ è½¯ä»¶: OSã€ç½‘ç»œã€åº”ç”¨ç¨‹åºå¶å‘æ€§æ•…éšœ ä¸»æœºdownæœºã€æœåŠ¡ä¸å¯ç”¨ã€ä¸»æœºä¸å¯è¾¾ä¸¥é‡æ•…éšœä¸»æœºæ€§èƒ½æ‰¹æ ‡è¶‹åŠ¿:æ—¶é—´åºåˆ—æ•°æ® æ•°æ®å­˜å‚¨123456789101112131415cacti: rrd(round robin database) å¼ºå¤§çš„é›†æˆå·¥å…·zabbix: mysql,pgsqlä¼ä¸šçº§çš„ç›‘æŽ§è§£å†³æ–¹æ¡ˆ; å¦‚æžœå®šä¹‰äº†è§¦å‘å™¨ï¼Œè¶…å‡ºäº†é¢„å€¼ï¼Œåˆ™æ‰§è¡Œè„šæœ¬ï¼Œè€ŒåŽå†æ‰§è¡ŒæŠ¥è­¦ï¼ŒæŠ¥è­¦å‡çº§æ“ä½œ; zabbixå¯ä»¥åšåˆ†å¸ƒå¼; zabbixå¯ä»¥éƒ¨ç½²ä¸­å¿ƒèŠ‚ç‚¹ï¼Œä¸Žåˆ†å¸ƒå¼èŠ‚ç‚¹; è¦å…³æ³¨ç³»ç»Ÿæœ‰å¤šå¤§çš„åŽ‹åŠ›ï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„ç»„ä»¶; åŸºäºŽZabbix agent,SNMP Agent, IPMI Agent,SSH.pingï¼ŒDatabase Monitoring ,è‡ªå®šä¹‰ç›‘æŽ§è„šæœ¬; ç›‘æŽ§ç›®æ ‡: CPU, Memeory, Network, Disk, Service, Log, File, Other å¯¹Webåšç›‘æŽ§æ—¶ï¼Œå¯ä»¥çŸ¥é“å“åº”çš„æ—¶é—´ï¼Œé€Ÿåº¦ï¼ŒåŠèŽ·å–çš„å†…å®¹; èŽ·å–é€šçŸ¥: é‚®ä»¶ï¼ŒçŸ­ä¿¡ï¼Œç”µè¯ç­‰ç­‰; Zabbix çš„å››ä¸ªä¸»è¦åŠŸèƒ½ Data gathering: æ•°æ®çš„æ”¶é›† Data storage: æ•°æ®çš„å­˜å‚¨ Alerting: æŠ¥è­¦ Visualisation:å¯è§†åŒ– zabbix æž¶æž„ä¸­çš„ç»„ä»¶1ã€zabbixä¹‹é—´çš„é€šä¿¡ 12345678910111213141516zabbix-server: ä½¿ç”¨Cè¯­è¨€ç ”å‘çš„OS zabbix-agent: ä½¿ç”¨Cè¯­è¨€ç ”å‘çš„zabbix-web: GUI,ç”¨äºŽå®žçŽ°zabbixè®¾å®šå’Œå±•ç¤ºzabbix-proxy:åˆ†å¸ƒå¼ç›‘æŽ§çŽ¯å¢ƒä¸­çš„ä¸“ç”¨ç»„ä»¶å› æ­¤å·¥ä½œæ€§èƒ½ä¹Ÿæ˜¯ç›¸å½“ä¸é”™çš„æž¶æž„é€šä¿¡åè®®: agentæž¶æž„ä½¿ç”¨zabbix agentåè®®è¿›è¡Œé€šä¿¡ web pagess ä½¿ç”¨httpåè®® ICMP/IPMI/SNMP: Devicezabbix dabases: MySQL,PGSQL(postgreSQL),DB2,Orcale,SQLite zabbix-server(zabbix-get) ä¸Ž zabbix-agentd è¿›è¡Œé€šä¿¡ zabbix-getä¸Žzabbix-agentd(zabbix-sender) è¿›è¡Œé€šä¿¡ zabbix-server çš„æ—¥å¿—ä¿å­˜åœ¨ /var/log/zabbix/zabbix-server.logä¸­ zabbix-agentd çš„æ—¥å¿—ä¿å­˜åœ¨ /var/log/zabbix/zabbix-agentd.logä¸­ zabbix-gui æŽ¥å£éœ€è¦ä¸€ä¸ªlampå¹³å°æ¥è¿è¡Œ 2ã€ zabbixçš„éƒ¨ç½²åˆ†ç±» 1234aã€å¯ä»¥å°†zabbix-serverï¼Œzabbix-gui web (lamp),databaseåˆ†åˆ«æ”¾åœ¨ä¸€å°æœåŠ¡å™¨ä¸Š; ç„¶è€Œ,zabbix-serverä¸Ždatabaseé€šä¿¡ï¼Œ zabbix-guiä¹Ÿåªéœ€è¦ä¸Ždatabaseé€šä¿¡å°±å¯ä»¥äº†;bã€å¯ä»¥å°†zabbix-server, zabbix-gui web(lamp),database ç»Ÿä¸€æ”¾åœ¨ä¸€å°æœåŠ¡å™¨ä¸Š;dã€å¯ä»¥å°†ä»¥ä¸Šç»„ä»¶ï¼Œä¸¤ä¸¤éƒ¨ç½²åœ¨ä¸€å°æœåŠ¡å™¨ä¸Š; zabbixå¸¸ç”¨æœ¯è¯­ ä¸»æœºHost: è¦ç›‘æŽ§çš„ç½‘ç»œè®¾å¤‡; ä¸»æœºç»„Host Group: åˆ†ç±»ç›‘æŽ§çš„æœåŠ¡å™¨ï¼Œä¸€ç»„æ¨¡æ¿(ç›‘æŽ§é¡¹ï¼Œè§¦å‘å™¨ï¼Œç­‰ç­‰); ç›‘æŽ§é¡¹item: zabbixè¿›è¡Œæ•°æ®æ”¶é›†çš„æ ¸å¿ƒï¼Œä¸€ä¸ªæŒ‡å®šçš„ç›‘æŽ§æŒ‡æ ‡; è§¦å‘å™¨trigger: æ˜¯æŒ‡ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¯„ä¼°itemæ”¶é›†çš„æ•°æ®æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…; äº‹ä»¶event: å³å‘ç”Ÿä¸€ä»¶å€¼å¾—å…³æ³¨çš„äº‹æƒ…ï¼Œä¾‹å¦‚triggerçŠ¶æ€ç”±problemè½¬ä¸ºokçŠ¶æ€; åŠ¨ä½œaction: å³é¢„å…ˆå®šä¹‰çš„å¤„ç†æ–¹æ³•ï¼Œé€šè¿‡å®šä¹‰çš„åŠ¨ä½œï¼Œå‘é€é‚®ä»¶ï¼ŒçŸ¥ä¿¡ç­‰ç­‰; æŠ¥è­¦å‡çº§escalation:å‘é€æŠ¥è­¦ï¼Œæˆ–è€…æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œæ¯äº”åˆ†é’Ÿå‘ä¸€æ¬¡ï¼Œå…±å‘5æ¬¡ç­‰; åª’ä»‹media: å‘é€é€šçŸ¥çš„æ‰‹æ®µæˆ–é€šé“ï¼Œå¦‚Emailã€Jobberã€SMS æˆ–è€…å¾®ä¿¡ç­‰ç­‰; é€šçŸ¥notification:é€šè¿‡é€‰å®šçš„åª’ä»‹å‘ç”¨æˆ·å‘é€æœ‰å…³çš„æŸä»¶äº‹æƒ…; è¿œç¨‹å‘½ä»¤(remote command): é¢„å®šä¹‰çš„å‘½ä»¤ï¼Œå¯ä»¥åœ¨è¢«ç›‘æŽ§çš„ä¸»æœºå¤„äºŽæŸç‰¹å®šæ¡ä»¶ä¸‹æ—¶è‡ªåŠ¨æ‰§è¡Œ; æ¨¡æ¿(template): ç”¨äºŽå¿«åº¦å®šä¹‰è¢«ç›‘æŽ§ä¸»æœºçš„çš„é¢„è®¾æ¡ç›®é›†åˆï¼Œé€šå¸¸åŒ…å«äº†itemã€trigeerã€graphã€screen; å¦å¤–ï¼Œæ¨¡æ¿å¯ä»¥ç›´æŽ¥é“¾æŽ¥è‡³å•ä¸ªä¸»æœº; åº”ç”¨(application):ä¸€ç»„itemçš„é›†åˆ; webåœºæ™¯(web scennario):ç”¨äºŽæ£€æµ‹webç«™ç‚¹å¯ç”¨æ€§çš„ä¸€ä¸ªæˆ–å¤šä¸ªHTTPè¯·æ±‚; å‰ç«¯(frontend): zabbixçš„webæŽ¥å£; å¯æ ¹æ®ç³»ç»Ÿç±»åž‹ ï¼Œä¸šåŠ¡éœ€æ±‚ï¼Œè®¾å¤‡ç±»åž‹ç­‰ç­‰å°†æœåŠ¡å™¨åˆ†ç»„; zabbix server å®žçŽ° watchdog è´Ÿè´£è¿è¡Œçš„è¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œä¸­; housekeeper ç®¡å®¶ï¼ŒæŒ‡æ˜Žä½ çš„æ•°æ®å°†è¦è¢«ä¿å­˜å¤šä¹…; alerter æ‰§è¡Œè­¦æŠ¥æ“ä½œçš„; poller ç›‘æŽ§è¿›ç¨‹ï¼› httppoler ç›‘æŽ§webé¡µé¢çš„ä¸“ç”¨poller; discover é«˜çº§çš„å‘çŽ°æœºåˆ¶ï¼Œå¯ä»¥è‡ªåŠ¨åŠ è½½è¿›æ¥ï¼Œä½†å®ƒçš„å·¥ä½œç›¸å½“å ç”¨èµ„æº; escalator æŠ¥è­¦å‡çº§; timer è®¡æ—¶å™¨; nodewatcher ç›‘æŽ§å„èŠ‚ç‚¹çš„; db_data_syncer æ•°æ®åº“çš„æ•°æ®åŒæ­¥å™¨; db_config_syncer æ•°æ®åº“çš„æ•°æ®åŒæ­¥å™¨; pinger èƒ½è¿‡pingæ“ä½œæŸ¥çœ‹å„ä¸»æœºæ˜¯å¦åœ¨çº¿çš„å·¥å…·; zabbix ç›‘æŽ§å®žçŽ°çš„ç¡¬ä»¶éœ€æ±‚ Name Platform CPU/Memory Database Monitored Hosts Small Ubuntu Linux PII 350MHZ 256MB SQLite 20 Medium Ubuntu linux 64 bit AMD Athlon 320 + 2GB MySQL InnoDB 500 Large Ubuntu Linux 64 bit Inter Dual Core 6400 + 6GB RAID 10 MySQL InnoDB or PostgreSQL &gt;1000 Verfy Large RedHat Enterprise Inter Xeon 2xCPU 8G FAST RAID 10 MySQl InnoDB or PostgreSQL &gt;10000 zabbixäº§ç”Ÿçš„æ•°æ®ç»„æˆå…±æœ‰å››éƒ¨åˆ† é…ç½®æ•°æ®; åŽ†å²æ•°æ® 50Bytes; åŽ†å²è¶‹åŠ¿æ•°æ® 128Bytes; äº‹ä»¶æ•°æ®130Bytes; Zabbix ç›®å‰éƒ¨ç½²åœ¨LinuxæœåŠ¡å™¨æœ€ä¸ºå¸¸è§ zabbix å®˜æ–¹æºç  zabbixçš„å®‰è£…ä¸Žä½¿ç”¨zabbix-server çš„å®‰è£…ä¸Žä½¿ç”¨123456789101112131415161718192021222324252627282930# yum -y install mariadb-server mariadb # systemctl enable mariadb# systemctl start mariadb# mysql MariaDB [(none)]&gt; CREATE DATABASE zabbix CHARACTER SET utf8;MariaDB [(none)]&gt; GRANT ALL on zabbix.* TO &apos;zbxuser&apos;@&apos;127.0.0.1&apos; IDENTIFIED BY &apos;xxxxxxx%3&apos;; Query OK, 0 rows affected (0.00 sec)MariaDB [(none)]&gt; GRANT ALL on zabbix.* TO &apos;zbxuser&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;xxxxxxx%3&apos;; Query OK, 0 rows affected (0.00 sec)MariaDB [mysql]&gt; FLUSH PRIVILEGES ;Query OK, 0 rows affected (0.00 sec)Welcome to the MariaDB monitor. Commands end with ; or \g.Your MariaDB connection id is 3Server version: 5.5.56-MariaDB MariaDB ServerCopyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.MariaDB [(none)]&gt; show databases;+--------------------+| Database |+--------------------+| information_schema || test || zabbix |+--------------------+3 rows in set (0.00 sec)MariaDB [(none)]&gt; è¿™é‡Œé€‰ç”¨ zabbix 2.2 çš„åŒ…æ¥å®‰è£…;ä¹‹åŽä¼šé™„zabbix 2.2 å‡çº§3.4 çš„æ–‡æ¡£ 12345678910# rpm -i http://repo.zabbix.com/zabbix/2.2/rhel/7/x86_64/zabbix-release-2.2-1.el7.noarch.rpm# yum clean all# yum -y install zabbix zabbix-server zabbix-server-mysql zabbix-get zabbix-web zabbix-web-mysql zabbix-agent zabbix-sender # systemctl start httpd# systemctl enable httpd Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.# cd /usr/share/doc/zabbix-server-mysql-2.2.21/create/# mysql zabbix &lt; schema.sql # mysql zabbix &lt; images.sql # mysql zabbix &lt; data.sql 1234567891011121314151617181920212223242526# vim /etc/zabbix/zabbix_server.conf# å‚æ•°è¯´æ˜ŽListenPort = 10051 æŒ‡å®šç«¯å£ LogFile = æŒ‡å®šæ—¥å¿—æ–‡ä»¶LogFileSize =0 è¡¨ç¤ºä¸åšæ»šåŠ¨DebugLevel = 3 PidFile = /var/run/zabbix/zabbix_server.pid DBHost = localhost DBName = zabbix DBUser = zbxuserDBPassword = xxxxxxx%3DBSocket = /tmp/mysql.sockStartPollers = 5 éšæ—¶ç­‰å¾…çš„è¿›ç¨‹æœ‰å¤šå°‘ä¸ªSNMPTrapperFile = /var/log/snmppt/snmptt.logMaxHousekeeperDelete=500 æœ€å¤šåˆ é™¤å¤šå°‘ä¸ªCacheUpdateFrequency= 60 cache æœ€å¤§çš„æ›´æ–°é¢‘çŽ‡StartDBsyncers=4 DBåŒæ­¥è¿›ç¨‹å¤šå°‘ä¸ªStartDiscoverers =1 æ˜¯å¯åŠ¨è‡ªåŠ¨æ·»åŠ æ¨¡æ¿åŠŸèƒ½çš„StartHTTPPollers =1 ä½œä¸ºhttpæµè§ˆå™¨æ¥è¯·æ±‚è¢«ç›‘æŽ§é¡µé¢çš„StartTimers =1 å¯åŠ¨è®¡æ—¶å™¨ JavaGateway = 1 ç›‘æŽ§javaç½‘å…³çš„ä¸€èˆ¬é»˜è®¤çš„ç¼“å­˜å€¼ä¸ç”¨è°ƒ AlertScriptsPath=/usr/lib/zabbix/alertscripts/ æŠ¥è­¦è„šæœ¬çš„å­˜æ”¾ä½ç½®ExternalScripts=/usr/lib/zabbix/externalscripts/ å¤–éƒ¨è„šæœ¬çš„å­˜æ”¾ä½ç½®FpingLocation=/usr/sbin/fping å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚ï¼Œå¯ä»¥å½“ä½œæ”»å‡»å‘½ä»¤SSLCerLocation = å¦‚æžœå¯ç”¨SSLçš„è¯åˆ™é…é…ç½®è¯¥é¡¹ 1234567# systemctl start zabbix-server# vim /etc/php.inidate.timezone = Asia/Chongqingmax_input_time = 600max_execution_time = 600post_max_size = 28M# systemctl restart httpd å¦‚æžœä½¿ç”¨ç¼–è¯‘å®‰è£…123456789101112131415# åŒæ—¶å®‰è£… server å’Œagent ï¼Œå¹¶æ”¯æŒå°†æ•°æ®æ”¾å…¥myqlæ•°æ®ä¸­ï¼Œå¯ä½¿ç”¨ç±»ä¼¼å¦‚ä¸‹é…ç½®å‘½ä»¤;# ./configure --enable-server --enable-agent --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-ssh2 # å¦‚æžœä»…å®‰è£… server,å¹¶æ”¯æŒå°†æ•°æ®æ”¾å…¥mysqlæ•°æ®ä¸­ï¼Œå¯ä½¿ç”¨ä¼¼å¦‚ä¸‹é…ç½®å‘½ä»¤; # ./configure --enable-server --with-mysql --with-net-snmp --with-libcurl# å¦‚æžœä»…å®‰è£… proxyï¼Œå¹¶æ”¯æŒå°†æ•°æ®æ”¾å…¥mysqlæ•°æ®ä¸­ï¼Œå¯ä½¿ç”¨ç±»ä¼¼å¦‚ä¸‹é…ç½®å‘½ä»¤; # ./configure --profix=/usr --enable-proxy --with-net-snmp --with-mysql --with-ssh2# å¦‚æžœä»…å®‰è£… agentï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼å¦‚ä¸‹é…ç½®å‘½ä»¤;# ./configure --enable-agent # è€ŒåŽç¼–è¯‘å®‰è£…zabbix å³å¯;# make # make install zabbix agent çš„å®‰è£…å’Œä½¿ç”¨12345# vim /etc/zabbix/zabbix_agentd.conf ServerActive=127.0.0.1,172.16.55.123Hostname=zabbix-test-server# systemctl start zabbix-agentCongiguration --&gt; Hosts --&gt; (å°†zabbix-serverç«¯çš„agentæœåŠ¡å¯ç”¨) zabbix æ·»åŠ é¢å¤–çš„agentç«¯åœ¨ä¸€å°éœ€è¦è¢«ç›‘æŽ§çš„æœåŠ¡å™¨ä¸Šå®‰è£… zabbix-agent 12345678910111213141516# rpm -i http://repo.zabbix.com/zabbix/2.2/rhel/7/x86_64/zabbix-release-2.2-1.el7.noarch.rpm# yum clean all # yum -y install zabbix zabbix-agent zabbix-sender# vim /etc/zabbix/zabbix_agentd.conf Server=172.16.55.123ServerActive=172.16.55.123Hostname= zabbix-agent-node1# systemctl start zabbix-agent# netstat -tnlup | grep zabbixtcp 0 0 0.0.0.0:10050 0.0.0.0:* LISTEN 30383/zabbix_agentd tcp6 0 0 :::10050 :::* LISTEN 30383/zabbix_agentd æ³¨: æœ€å¥½åœ¨zabbix-server åšä¸€ä¸‹æŽ¢æµ‹ï¼Œç¡®ä¿åœ¨zabbix-server ç«¯å¯ä»¥æŽ¢æµ‹é€šagentçš„ç«¯å£# telnet 172.16.55.124 10050Trying 172.16.55.124...Connected to 172.16.55.124.Escape character is &apos;^]&apos;. ç™»å½•zabbix-server çš„webæŽ¥å£ 123456789101112Configuration --&gt; Hosts --&gt; Create Hosts --&gt;[Host name: zabbix-agent-node1Visible name: zabbix-agent-node1Group In goups : Linux serversAgent interfaces: è¿™é‡Œé€‰ç”¨çš„æ˜¯ip-&gt; 172.16.55.124Templates -&gt; Template OS Linux --&gt; Add -&gt; Save --&gt; IPMI -&gt; å…ˆç•™ç©ºMacros -&gt; å…ˆç•™ç©ºHost inventory -&gt; å…ˆç•™ç©º]Host &lt;-- Save zabbix on CentOS712345678910Linuxå¼€æºç›‘æŽ§ç³»ç»Ÿ: nagios cacti zabbix: å†…nagiosï¼Œcacti ganglia: å†…ç½®å¼ºå¤§çš„èšåˆåŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½zabbixæ˜¯ä¸å…·å¤‡çš„ åœ¨å¤§å…¬å¸èƒ½äº†è§£åˆ°æ›´å¥½è§„èŒƒ; åœ¨å°å…¬å¸èƒ½å¤Ÿå¾—åˆ°æ›´å¤šçš„ç»éªŒ;# vim /etc/my.cnfinnodb_file_per_table = 1 skip_name_reslove = 1 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253CentOS 7.1 å®‰è£…~]# yum install zabbix-2.4.6-1.el7.x86_64.rpm zabbix-server-2.4.6-1.el7.x86_64.rpm zabbix-server-mysql-2.4.6-1.el7.x86_64.rpm zabbix-agent-2.4.6-1.el7.x86_64.rpm zabbix-sender-2.4.6-1.el7.x86_64.rpm zabbix-web-2.4.6-1.el7.noarch.rpm zabbix-get-2.4.6-1.el7.x86_64.rpm zabbix-web-mysql-2.4.6-1.el7.noarch.rpm trousers-0.3.11.2-4.el7_1.x86_64.rpmè¯´æ˜Žï¼šCentOS 7.1å®‰è£…zabbix-2.4.6-1.el7ï¼Œå…¶ä¸Žtrousers-0.3.11.2-3ä¸å…¼å®¹ï¼Œéœ€è¦å‡çº§trousersè‡³0.3.11.2-4.el7_1ã€‚å¦‚æžœæ²¡æœ‰zabbix rpmåŒ…ï¼Œå¯ä»¥åœ¨å®˜ç½‘æŸ¥æ‰¾å®‰è£…yumæºrpmåŒ… ï¼Œç±»ä¼¼ä»¥ä¸Šçš„å®‰è£…æ–¹æ³•åˆ›å»ºæ•°æ®åº“ï¼š serverå’Œproxyçš„è¿è¡Œéƒ½ä¾èµ–äºŽæ•°æ®åº“ï¼Œagentåˆ™ä¸éœ€è¦ã€‚ ä»¥MySQLæ•°æ®åº“ä¸ºä¾‹ï¼š shell&gt; mysql -uroot -p&lt;password&gt; mysql&gt; create database zabbix character set utf8 collate utf8_bin; mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by '&lt;password&gt;'; mysql&gt; quit; shell&gt; mysql -uzabbix -p&lt;password&gt; zabbix &lt; database/mysql/schema.sql # stop here if you are creating database for Zabbix proxy shell&gt; mysql -uzabbix -p&lt;password&gt; zabbix &lt; database/mysql/images.sql shell&gt; mysql -uzabbix -p&lt;password&gt; zabbix &lt; database/mysql/data.sqlé…ç½®zabbixï¼š (1) zabbix_server serverçš„é…ç½®æ–‡ä»¶ä¸ºzabbix_server.confï¼Œè‡³å°‘åº”è¯¥ä¸ºå…¶é…ç½®æ•°æ®åº“ç­‰ç›¸å…³çš„ä¿¡æ¯ï¼›ä¾‹å¦‚ï¼š LogFile=/var/log/zabbix/zabbix_server.log LogFileSize=0 PidFile=/var/run/zabbix/zabbix_server.pid DBHost=172.16.100.67 DBName=zabbix DBUser=zbxuser DBPassword=zbxpass DBSocket=/var/lib/mysql/mysql.sock SNMPTrapperFile=/var/log/snmptt/snmptt.log AlertScriptsPath=/usr/lib/zabbix/alertscripts ExternalScripts=/usr/lib/zabbix/externalscripts (2) é…ç½®phpçŽ¯å¢ƒ ç¼–è¾‘/etc/httpd/conf.d/zabbix.confï¼Œæ·»åŠ å¦‚ä¸‹é¡¹ã€‚ php_value date.timezone Asia/Shanghai å¯åŠ¨httpdæœåŠ¡ï¼šsystemctl start httpd.service è®¿é—®zabbix web http://your_host/zabbix ç™»å½•ï¼šAdmin/zabbix (3) é…ç½®zabbix_agent agentçš„é…ç½®æ–‡ä»¶ä¸ºzaabix_agentd.confï¼Œè‡³å°‘åº”è¯¥ä¸ºå…¶æŒ‡å®šserverçš„IPåœ°å€ï¼› 12345678910111213141516171819202122zabbixç»„ä»¶ zabbix zabbix-server zabbix-database zabbix-web zabbix-agent zabbix-proxyzabbix é€»è¾‘ç»„ä»¶ ä¸»æœºç»„ã€ä¸»æœº item(ç›‘æŽ§é¡¹)ã€appliction(åº”ç”¨) trigger(è§¦å‘å™¨) even(äº‹ä»¶) action notice command media users(media) ç›‘æŽ§ç³»ç»Ÿ: æ•°æ®é‡‡é›†ã€æ•°æ®å­˜å‚¨ã€æŠ¥è­¦ã€æ•°æ®å¯è§†åŒ– zabbix: database --&gt; zabbix-server (zabbix_server.conf)--&gt; zabbix-web(LAMPå¹³å°) --&gt; http://zabbix-web-server/zabbix/zabbix-agent (zabix-agent.conf) zabbix æŠ¥è­¦å…¥é—¨é…ç½®æ³¨: åœ¨æ·»åŠ ä¸»æœºçš„æ—¶å€™å¦‚æžœè¦æƒ³è®©æ”¯æŒsnmpåè®®ï¼Œåˆ™å®‰è£…yum -y install net-snmp 12# vim /etc/snmp/snmp.conf# service snmpd start 1234567# æŸ¥çœ‹æ”¯æŒçš„key MariaDB [zabbix]&gt; SELECT key_,type FROM items ;# æŸ¥çœ‹æ”¯æŒçš„items MariaDB [zabbix]&gt; SELECT * FROM items\G;# zabbix_get -h å‘æŒ‡å®šçš„ä¸»æœºèŽ·å–æŒ‡å®šçš„å€¼çš„# zabbix_get -s 172.16.55.124 -k &quot;net.if.out[ens3]&quot;1161497309# zabbix_get -s 172.16.55.124 -k &quot;net.if.in[ens3]&quot; 1390144843 1234# æ‰‹åŠ¨åˆ›å»ºitem# å…ˆåœ¨zabbixæœåŠ¡å™¨ç«¯å°è¯•èŽ·å–CPUä¸­æ–­æ•° # zabbix_get -s 172.16.55.124 -k &quot;system.cpu.intr&quot;597504908 12345678910111213141516171819Configuration --&gt; Hosts --&gt; é€‰å®šä¸»æœºçš„Items Name: cpu interrupts Type: zabbix Key:system.cpu.intrHost interface:172.16.100.8:10050Type of information: Numeric(unsigned) : æ•°æ®ç±»åž‹å†³å®šä»¥ä¸‹é…ç½®æ˜¯å¦å¯ç”¨Data type : Decimal Units:Use custom multipier: åšå•ä½æ¢ç®—New flexible interval Interval(in sec)ï¼šæŒ‡å®šç›‘æŽ§æ—¶é—´History storage period (in days): åŽ†å²æ•°æ®çš„å­˜æ”¾å¤©æ•°ï¼Œåªè¦æ»¡è¶³éœ€è¦äº†ï¼Œå°½å¯èƒ½ä¸å¯æ—¶é•¿è¿‡å¤š 90Treand storage period (in days): åŽ†å²é‡‡æ ·çš„æ•°æ® 365åŽ†å²æ•°æ®:é‡‡æ ·ç”Ÿæˆçš„æ•°æ®;åŽ†å²è¶‹åŠ¿æ•°æ® :æ¯å°æ—¶çš„æœ€å¤§å€¼ ã€æœ€å°å€¼ ã€å¹³å‡å€¼ã€ç»Ÿè®¡å€¼Sotre valus: æ•°æ®å­˜å‚¨çš„ç»“æžœ As isï¼Œä¸åšä»»ä½•å¤„ç†; Delta(sppd per second): (value -per_value)/(time - pre_time) 10: 1200 , 20: 13000æ·»åŠ å®Œä»¥ä¸Šä¿¡æ¯ä¹‹åŽï¼Œæ·»addå³å¯; å¯ä»¥åœ¨hostsä¸­æŸ¥çœ‹åˆ°çŠ¶æ€æ˜¯enabledåŒæ ·çš„æ–¹å¼å¯ä»¥åˆ›å»º å…¶å®ƒItem æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå›¾å½¢ 12345678910Configuration --&gt; Hosts --&gt; --&gt; é€‰å®šä¸»æœºçš„Graph Name: cpu interrupts Width: 900Heig: 200Graph type: Normal Show legend Show working time Show triggersadd ItemsPreview ï¼Œé…ç½®å®Œä¹‹åŽï¼Œå¯ä»¥é¢„è§ˆåŽæ·»åŠ ; è§¦å‘å™¨çŠ¶æ€ä¸¥é‡æ€§ï¼Œçº§åˆ« 123456Not classfiled Grey æ— åˆ†ç±»Information Light green èµ„è®¯Warning Yellow è­¦å‘ŠAverage Orange è§‰è§é—®é¢˜High red é«˜å±Disaster bright red æ¯ç­ åˆ›å»ºè§¦å‘å™¨ 1234567891011121314Configuration --&gt; Hosts --&gt; é€‰å®šä¸»æœºçš„TriggerName too many interruptsExpression add --&gt; node1:cpu intterrupts --&gt; last(most recent)T value is &gt; N --&gt; Last of (T) --&gt; Time shift --&gt; N 50 --&gt; addDescription åç§°ä¸­å¯ä»¥ä½¿ç”¨å®: &#123;HOST.HOST&#125;,&#123;HOST.NAME&#125;,&#123;HOST.IP&#125;,&#123;HOST.COMN&#125;,&#123;HOST.DNS&#125; URL: å¯ä»¥ç•™ç©ºï¼Œä¹Ÿå¯ä»¥æ·»åŠ ä¸€ä¸ªurlï¼ŒæŠ¥è­¦åˆ™è¯´æ˜Žç”±å“ªä¸ªurlè§¦å‘çš„ 1234# yum -y install hping3 å¤šä¸ªhping3å¯ä»¥å®žçŽ°DDOSæ”»å‡»# hping3 172.16.55.124 --faster å¯ä»¥åœ¨124ä¸Šçœ‹åˆ°,cpuä¸Šä¸‹æ–‡åˆ‡æ¢é€Ÿåº¦éžå¸¸çš„å¿«,cpuä¸­æ–­é£™å‡# vmstat 1 å®šä¹‰æŠ¥åª’ä»‹ 12345678910Administration --&gt; Media types --&gt; Name Email --&gt; Type Email --&gt; SMTP Server å¯ä»¥æŒ‡å®šåˆ°é‚®ä»¶æœåŠ¡å™¨ --&gt; SMTP helo localhost æŒ‡å®šæ”¶ä»¶äºº --&gt; SMTP email zabbix@xxxxx.com æŒ‡å®šå‘ä»¶äºº # å®šä¹‰æŠ¥è­¦ç”¨æˆ· è¿™é‡Œå»ºè®®ä¸åˆ›å»ºæŠ¥è­¦ç”¨æˆ·ï¼Œç›´æŽ¥ä½¿ç”¨adminå‘Media å¯ä»¥å®žçŽ°æŠ¥è­¦å‡çº§åŠŸèƒ½;åœ¨adminç”¨æˆ·ä¸­é…ç½®æŠ¥è­¦åª’ä»‹ é…ç½®Actions 123456Configure --&gt; Actions--&gt; Create Actions Action--&gt; names ä¿¡æ¯é‡‡ç”¨å®ï¼Œå¯ç”¨æŠ¥æ•…éšœæ¢å¤åŽå‘é€ä¿¡æ¯; Conditions æ¡å®šæ‰§è¡Œæ¡ä»¶Operations å®šä¹‰æŠ¥è­¦å‡çº§ (æ¯ä¸€æ¬¡å¯æœ‰å¤šä¸ªè·¨åº¦åŒºé—´) zabbix å¸¸ç”¨é…ç½®ç”±zabbixç›‘æŽ§æŸå…³æ³¨çš„æŒ‡æ ‡ 123host group --&gt; host --&gt; item(å­˜å‚¨äºŽMySQL) --&gt; graph (zabbix-web)--&gt; trigger(è§¦å‘å™¨) --&gt; action(conditon+operation)application: æŠŠåŠŸèƒ½ç›¸è¿‘çš„ä¸€ç»„itemå½’ç±»åœ¨ä¸€èµ·ç»Ÿä¸€è¿›è¡Œç®¡ç†ç»„ä»¶: 123ServerActive= 172.16.55.124 ; è¿™é‡Œåœ¨agentä¸­å¦‚æžœæŒ‡å®šäº†ï¼Œåˆ™è¯´æ˜Žæ˜¯ä¸»åŠ¨çš„ç›‘æŽ§æ–¹å¼;Actions å¯ä»¥æŽ¥æ”¶äº‹ä»¶ï¼Œå¯ä»¥å‘é€åŠ¨ä½œè€Œç”¨æ¥æŠ¥è­¦;(Events,Actions,Trigger) æ˜¯zabbixçš„æ ¸å¿ƒç»„ä»¶ Zabbix å®Œæ•´çš„ç›‘æŽ§é…ç½®æµç¨‹å¤§ä½“ç”±å¦‚ä¸‹ç»„æˆ: 123456Host group --&gt; Hosts --&gt; Applications --&gt; Items --&gt; Triggers --&gt; Events --&gt; Actions (å‘è­¦å‘Š) --&gt; User group --&gt; Users --&gt; Mediasgraph, screen ä¾èµ–å…³ç³»: Host --&gt; Item --&gt; Trigger --&gt; Action æ·»åŠ ä¸»æœºåˆ°zabbix server: 1ä¸€å®šä¸è¦è®©æ²¡æœ‰ç›‘æŽ§çš„æœåŠ¡å™¨ä¸Šçº¿ 123å®šä¹‰å¥½discoevery: å¯ä»¥æ ¹æ®ç»™å®šçš„ç½‘æ®µï¼Œè‡ªåŠ¨æç½‘æ®µï¼Œå¹¶æ·»åŠ ï¼Œæ­¤ç§æ–¹å¼æ˜¯æœåŠ¡å™¨ç«¯ä¸»åŠ¨auto_registrion: è¢«ç›‘æŽ§ä¸»æœºï¼Œè‡ªåŠ¨å‘æœåŠ¡ç«¯æ³¨å†Œlow level discovery: åŒºåˆ«ä¸åŒçš„åº•å±‚è®¾å¤‡çš„ æ¨¡æ¿(template): 1ä¸€èˆ¬æ¨¡æ¿æ˜¯å¥—åœ¨ä¸»æœºä¹‹ä¸Šçš„;(item,application,trigger,graph,action) Item 1234567891011121314151617181920212223242526272829303132é»˜è®¤çš„Iemsæœ‰å¤šç§ç±»åž‹ Zabbix-agent å·¥ä½œæ¨¡å¼: passive, active ç½‘å¡æµé‡ç›¸å…³: net.if.in[if,&lt;mode&gt;] if: æŽ¥å£ï¼Œå¦‚eth0 mode:bytes, packets, errors, dropped net.if.out[if,&lt;mode&gt;] net.if.total[if.&lt;mode&gt;] ç«¯å£ç›¸å…³: net.tcp.listen[port] net.tcp.port[&lt;ip&gt;,port] net.tcp.service[service,&lt;ip&gt;,&lt;port&gt;] net.udp.listen[port] ç›‘æŽ§ç«¯å£æ˜¯å¦å¤„äºŽç›‘å¬çŠ¶æ€ è¿›ç¨‹ç›¸å…³: kernel.maxfiles å†…æ ¸æ‰“å¼€çš„æ–‡ä»¶æ•° kernel.maxproc å†…æ ¸æ‰“å¼€çš„æœ€å¤§è¿›ç¨‹æ•° CPUç›¸å…³: system.cpu.intr ä¸­æ–­æ¬¡æ•° system.cpu.load[&lt;cpu&gt;,&lt;mode&gt;] cpuè´Ÿè½½ system.cpu.num[type] cpuä¸ªæ•° system.cpu.switches cpuåˆ‡æ¢é¢‘çŽ‡ system.cpu.util [&lt;cpu&gt;,&lt;type&gt;,&lt;mode&gt;] cpuå“ªä¸ªæŒ‡æ ‡çš„åˆ©ç”¨çŽ‡ ç£ç›˜IOç›¸å…³: vfs.dev.read[&lt;device&gt;,&lt;type&gt;,&lt;mode&gt;] vfs.dev.write[&lt;device&gt;,&lt;type&gt;,&lt;mode&gt;] vfs.fs.inode [fs,&lt;mode&gt;] ç”¨æˆ·å¯è‡ªå®šä¹‰item: 12å…³é”®:é€‰å–ä¸€ä¸ªæƒŸä¸€çš„key;å‘½ä»¤:æ”¶é›†æ•°æ® çš„å‘½ä»¤æˆ–è„šæœ¬; Trigger: 123456789101112çŠ¶æ€: OK: äº‹ä»¶è½¬ä¸ºæ­£çŠ¶æ€; PROBLEMï¼šè¡¨ç¤ºæœ‰äº‹ä»¶å‘ç”Ÿ; zabbix server æ¯æ¬¡æŽ¥æ”¶åˆ°itemsçš„æ–°æ•°æ®æ—¶å°±ä¼šå¯¹Itemçš„å½“å‰é‡‡æ ·å€¼è¿›è¡Œåˆ¤æ–­ï¼Œå³ä¸Žtriggerçš„è¡¨è¾¾å¼è¿›è¡Œæ¯”è¾ƒ;ä¸€ä¸ªtriggeråªèƒ½å±žäºŽä¸€ä¸ªItemï¼Œä½†ä¸€ä¸ªItemå¯æœ‰æœ‰å¤šä¸ªTrigger;Severity: No classfied: æœªçŸ¥çº§åˆ«ï¼Œç°è‰²; Information: ä¸€èˆ¬ä¿¡æ¯ï¼Œäº®ç»¿; Warning: è­¦å‘Šä¿¡æ¯ï¼Œé»„è‰²; Average: ä¸€èˆ¬æ•…éšœï¼Œçº¢è‰²; Disater:è‡´å‘½æ•…éšœï¼Œäº®çº¢; Action: 12345è§¦å‘æ¡ä»¶ä¸€èˆ¬ä¸ºäº‹ä»¶: Trigger events: OK --&gt; PROBLEM; Discovery events: zabbixçš„network discoveryå·¥ä½œ; Auto registration events: ä¸»åŠ¨æ¨¡å¼çš„agentæ³¨å†Œæ—¶äº§ç”Ÿçš„äº‹ä»¶; Internal events: Itemå˜æˆä¸å†è¢«æ”¯æŒï¼Œæˆ–Triggerå˜æˆä¸ºæœªçŸ¥é“çŠ¶æ€]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¿è¡Œä¸€ä¸ªç®€å•çš„Fabricç½‘ç»œ]]></title>
    <url>%2F2018%2F03%2F21%2F%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84Fabric%E7%BD%91%E7%BB%9C%2F</url>
    <content type="text"><![CDATA[è¿è¡Œä¸€ä¸ªç®€å•çš„Fabricç½‘ç»œè®¾å®šä¸€ä¸ªç®€å•çš„Fabricçš„ç½‘ç»œåœºæ™¯,åŒ…æ‹¬2ä¸ªorganization,æ¯ä¸ªæœ‰2ä¸ªpeer,å¹¶ä½¿ç”¨â€soloâ€ orderingæœåŠ¡;ç½‘ç»œå®žä½“æ‰€éœ€çš„åŠ å¯†ææ–™(x509è¯ä¹¦)å·²é¢„å…ˆç”Ÿæˆå¹¶æ”¾åˆ°ç›¸åº”ç›®å½•å’Œé…ç½®æ–‡ä»¶é‡Œäº†ã€‚æ— éœ€ä¿®æ”¹è¿™äº›é…ç½®; example/e2e_cliæ–‡ä»¶å¤¹é‡ŒåŒ…å«äº†docker-composeæ–‡ä»¶å’Œè¦ç”¨æ¥åˆ›å»ºå’Œæµ‹è¯•çš„ç½‘ç»œçš„è„šæœ¬æ–‡ä»¶; å¦å¤–å¦‚ä½•ä½¿ç”¨é…ç½®ç”Ÿæˆå·¥å…·configtxgenç”Ÿæˆç½‘ç»œé…ç½®; å‰æå®Œæˆä»¥ä¸‹å®‰è£…Fabricæºç å’Œç¼–è¯‘configtxgenå·¥å…·: å®ŒæˆçŽ¯å¢ƒï¼Œå¹¶è®¾ç½®æ­£ç¡®çš„$GOPATHçŽ¯å¢ƒå˜é‡; 1234åœ¨/etc/profile/go.sh ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/srv/jdk1.8.0_66/bin:/root/bin:/usr/local/go/binexport GOPATH=/opt/gopathchmod +x /etc/profile/go.sh &amp;&amp; source /etc/profile/go.sh æŽ¥å–Fabricæºç ; 1# git clone https://github.com/hyperledger/fabric.git å¦‚æžœè¿è¡Œåœ¨linuxï¼Œåœ¨Fabricç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: 123456# cd $GOPATH/src/github.com/hyperledger/fabric# make configtxgen # è¾“å‡ºbuild/bin/configtxgenCGO_CFLAGS=" " GOBIN=/opt/gopath/src/github.com/hyperledger/fabric/build/bin go install -tags "nopkcs11" -ldflags "-X github.com/hyperledger/fabric/common/configtx/tool/configtxgen/metadata.Version=1.0.7-snapshot-84a7e5c" github.com/hyperledger/fabric/common/configtx/tool/configtxgenBinary available as build/bin/configtxgen å¦‚æžœè¿è¡Œåœ¨OSXï¼Œå…ˆå®‰è£…Xcode 8.0æˆ–è€…ä»¥ä¸Šç‰ˆæœ¬ï¼Œç„¶åŽåœ¨Fabricç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: 1234567891011121314# å®‰è£… Homebrew,è‹¥macä¸Šæœ‰brewçš„å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; #æ·»åŠ  gnu-tar# brew install gnu-tar --with-default-name #æ·»åŠ  libtool# brew install libtool# ç¼–è¯‘ configtxgen # make confgitxgenbuild/bin/configtxgenCGO_CFLAGS=&quot; &quot; GOBIN=/Users/johndoe/work/src/github.com/hyperledger/fabric/build/bin go install -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=1.0.0-snapshot-8d3275f -X github.com/hyperledger/fabric/common /metadata.BaseVersion=0.3.0 -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric&quot; github.com/hyperledger/fabric/common/configtx/tool/configtxgenBinary available as build/bin/configtxgen`` ç¼–è¯‘åŽæ‰«è¡Œæ–‡ä»¶æ”¾åœ¨Fabricç›®å½•ä¸‹çš„ build/bin/configtxgenä¸­ æ‰§è¡Œå®Œæ•´è„šæœ¬ä¸ºäº†åŠ å¿«éƒ¨ç½²è¿‡ç¨‹ï¼ŒFabricæä¾›äº†ä¸€ä¸ªè„šæœ¬ æ¥æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ã€‚æ‰§è¡Œè¯¥è„šæœ¬ ä¼šç”Ÿæˆé…ç½®ç»“æžœã€æœ¬åœ°ç½‘ç»œã€Chaincodeæµ‹è¯•; è¿›å…¥ examples/e2e_cliç›®å½•ï¼Œé¦–å…ˆä»ŽDcoker Hubæ‘˜å–é•œåƒ: 12# æ‰§è¡Œè„šæœ¬# bash ./download-dockerimages.sh è¿™ä¸ªæ‰§è¡Œè¿‡ç¨‹è€—æ—¶ä¼šæ¯”è¾ƒé•¿ï¼Œè„šæœ¬æ‰§è¡ŒåŽè¾“å‡º: 123456789101112131415161718===&gt; List out hyperledger docker imageshyperledger/fabric-ca latest 35311d8617b4 7 days ago 240 MBhyperledger/fabric-ca x86_64-1.0.0-alpha 35311d8617b4 7 days ago 240 MBhyperledger/fabric-couchdb latest f3ce31e25872 7 days ago 1.51 GBhyperledger/fabric-couchdb x86_64-1.0.0-alpha f3ce31e25872 7 days ago 1.51 GBhyperledger/fabric-kafka latest 589dad0b93fc 7 days ago 1.3 GBhyperledger/fabric-kafka x86_64-1.0.0-alpha 589dad0b93fc 7 days ago 1.3 GBhyperledger/fabric-zookeeper latest 9a51f5be29c1 7 days ago 1.31 GBhyperledger/fabric-zookeeper x86_64-1.0.0-alpha 9a51f5be29c1 7 days ago 1.31 GBhyperledger/fabric-orderer latest 5685fd77ab7c 7 days ago 182 MBhyperledger/fabric-orderer x86_64-1.0.0-alpha 5685fd77ab7c 7 days ago 182 MBhyperledger/fabric-peer latest 784c5d41ac1d 7 days ago 184 MBhyperledger/fabric-peer x86_64-1.0.0-alpha 784c5d41ac1d 7 days ago 184 MBhyperledger/fabric-javaenv latest a08f85d8f0a9 7 days ago 1.42 GBhyperledger/fabric-javaenv x86_64-1.0.0-alpha a08f85d8f0a9 7 days ago 1.42 GBhyperledger/fabric-ccenv latest 91792014b61f 7 days ago 1.29 GBhyperledger/fabric-ccenv x86_64-1.0.0-alpha 91792014b61f 7 days ago 1.29 GBçŽ°åœ¨è¿è¡Œå®Œæ•´è„šæœ¬ï¼š çŽ°åœ¨è¿è¡Œå®Œæ•´è„šæœ¬: 1bash network_setup.sh up mychannel å¦‚æžœæ²¡æœ‰è®¾ç½® channel-IDå‚æ•°ï¼Œchannelåé»˜è®¤æ˜¯mychannelã€‚è„šæœ¬æ‰§è¡ŒæˆåŠŸåŽè¾“å‡º: 123===================== Query on PEER3 on channel &apos;mychannel&apos; is successful ========================================== All GOOD, End-2-End execution completed ===================== æ­¤æ—¶ï¼Œç½‘ç»œå¯åŠ¨è¿è¡Œå¹¶æµ‹è¯•æˆåŠŸ æ¸…ç†åœæ­¢ç½‘ç»œ: 12# åœ¨e2e_cliç›®å½•ä¸‹ # docker rm -f $(docker ps -aq) ç„¶åŽæ‰§è¡Œ docker imageså‘½ä»¤æŸ¥çœ‹Chaincodeé•œåƒï¼Œç±»ä¼¼è¾“å‡ºå¦‚ä¸‹: 1234REPOSITORY TAG IMAGE ID CREATED SIZEdev-peer3-mycc-1.0 latest 13f6c8b042c6 5 minutes ago 176 MBdev-peer0-mycc-1.0 latest e27456b2bd92 5 minutes ago 176 MBdev-peer2-mycc-1.0 latest 111098a7c98c 5 minutes ago 176 MB åˆ é™¤é•œåƒ: 1docker rmi &lt;IMAGE ID&gt; &lt;IMAGE ID&gt; &lt;IMAGE ID&gt; ä¾‹å¦‚: 1# docker rmi -f 13e e122 333 æœ€åŽåˆ é™¤é…ç½®ç»“æžœï¼Œ åœ¨crypto/orderer ç›®å½•åˆ é™¤ orderer.blockå’Œchannel.tx; configtxgenconfigtxgen å·¥å…·ç”Ÿæˆä¸¤ä¸ªå†…å®¹: Ordererçš„bootstrap blockå’ŒFabricçš„channel configuration transaction; roderer blockæ˜¯orderingæœåŠ¡çš„åˆ›ä¸–åŒºå—; channel transactionæ–‡ä»¶åœ¨create channelæ—¶ä¼šè¢«å¹¿æ’­ç»™orderer; configtx.yamlåŒ…å«ç½‘ç»œçš„å®šä¹‰ï¼Œå¹¶ç»™å‡ºäº†ç½‘ç»œç»„ä»¶çš„æ‹“æ‰‘ç»“æž„-2ä¸ªæˆå‘˜(Org0å’ŒOrg1)åˆ†åˆ«ç®¡ç†ç»´æŠ¤2ä¸ªpeerã€‚ è¿˜æŒ‡å‡ºæ¯ä¸ªç½‘ç»œå®žä½“çš„åŠ å¯†ææ–™çš„å­˜å‚¨ä½ç½®ã€‚cryptoç›®å½•åŒ…å«æ¯ä¸ªå®žä½“çš„adminè¯ä¹¦ã€caè¯ä¹¦ã€ç­¾åè¯ä¹¦å’Œç§é’¥; ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ªè„šæœ¬ generateCfgTrx.sh,è¯¥è„šæœ¬æ•´åˆäº†configtxgençš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ‰§è¡ŒåŽä¼šç”Ÿæˆä¸¤ä¸ªé…ç½®ç»“æžœ:orderer.blockå’Œchannel.txã€‚å¦‚æžœè¿è¡Œè¿‡ä¸Šè¾¹network_setup.shåˆ™è¿™ä¸¤ä¸ªé…ç½®ç»“æžœå·²ç”Ÿæˆï¼Œè¦å…ˆåˆ°crypto/orderereç›®å½•å°†ä¹‹åˆ é™¤; æ‰§è¡ŒgenerateCfgTrx.shè„šæœ¬åœ¨e2e_cliç›®å½•ä¸‹: 1# cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli generateCfgTrx.shè„šæœ¬æœ‰ä¸ªå¯é€‰èƒ½æ•°channel-ID,å¦‚æžœä¸è®¾æ­¤å‚æ•°ï¼Œåˆ™é»˜è®¤ä¸ºmychannelï¼› 12# &lt;channel-ID&gt;å‚æ•°æ˜¯è¦å¯é€‰çš„# bash generateCfgTrx.sh &lt;channel-ID&gt; æ‰§è¡ŒæˆåŠŸåŽè¾“å‡º: 123456782017/02/28 17:01:52 Generating new channel configtx2017/02/28 17:01:52 Creating no-op MSP instance2017/02/28 17:01:52 Obtaining default signing identity2017/02/28 17:01:52 Creating no-op signing identity instance2017/02/28 17:01:52 Serializing identity2017/02/28 17:01:52 signing message2017/02/28 17:01:52 signing message2017/02/28 17:01:52 Writing new channel tx ç”Ÿæˆçš„orderer.blockå’Œchannel.txä¸¤ä¸ªæ–‡ä»¶å­˜æ”¾åœ¨corypto/ordererç›®å½•; orderer.blockæ˜¯orderingæœåŠ¡çš„åˆ›ä¸–åŒºå—ï¼Œchannel.txåŒ…å«æ–°channelçš„é…ç½®ä¿¡æ¯ã€‚å¦‚å‰æ‰€è¿°ï¼Œè¿™ä¿©æ–‡ä»¶ éƒ½æ¥è‡ªconfigtx.yamlåŠå…¶æ‰€åŒ…å«çš„åŠ å¯†ææ–™å’Œç½‘ç»œä¿¡æ¯çš„æ•°æ®; æ³¨: ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬generateCfgTrx.shé‡Œçš„å‘½ä»¤ã€‚å¦‚æžœå‚…è¿™ç§æ–¹å¼ï¼Œåˆ™å¿…éœ€å…ˆç”¨e2e_cliç›®å½•ä¸‹çš„configtx.yamlæ›¿æ¢Fabric sampleconfgiç›®å½•ä¸‹é»˜è®¤çš„configtx.yamlï¼Œç„¶åŽè¿”å›žfabricç›®å½•æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œå‰ææ˜¯åˆ é™¤ä¹‹å‰çš„generateCfgTrx.shç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶; å¯åŠ¨ç½‘ç»œä½¿ç”¨docker-composeå¯åŠ¨ç½‘ç»œï¼Œå¦‚æžœè¿˜æ²¡æœ‰æ‘˜å– Fabricé•œåƒï¼Œåˆ™è¿”å›žä¹‹å‰çš„æ“ä½œåŽ»æ‹‰å–é•œåƒ; è„šæœ¬scrpit.shåµŒå…¥åˆ°docker-composeæ–‡ä»¶é‡Œï¼Œè¯¥è„šæœ¬å°†peeråŠ å…¥åˆ°channelå¹¶å‘peerå‘é€read/writeè¯·æ±‚ï¼Œå¦‚æ­¤ä¾¿å¯è‡ªåŠ¨æ‰§è¡Œäº¤æ˜“æµç¨‹ã€‚å¦‚æžœè¿˜ä¸æƒ³ä½¿ç”¨è¿™ä¸ªè„šæœ¬è‡ªåŠ¨æ‰§è¡Œäº¤æ˜“ï¼Œå¯ä»¥è·³åˆ°ä¸‹é¢â€æ‰‹åŠ¨æ‰§è¡Œäº¤æ˜“â€ä¸€èŠ‚; åœ¨e2e_cliç›®å½•ä¸‹ä½¿ç”¨docker-composeç”Ÿæˆç½‘ç»œå®žä½“å¹¶æ‰§è¡ŒåµŒå…¥çš„è„šæœ¬: 1CHANNEL_NAME=&lt;channel-id&gt; docker-compose up -d å¦‚æžœä¹‹å‰åˆ›å»ºäº†ä¸ªchannelåï¼Œå°±å¿…é¡»å°†å…¶ä½œä¸ºå‚æ•°ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤çš„mychannelã€‚ä¾‹å¦‚: 1CHANNEL_NAME=mychannel dcoker -comopse up -d ç­‰å¾…ä¸€ä¼šå„¿ï¼Œå› ä¸ºèƒŒåŽæœ‰äº¤æ˜“ä¼šå‘é€åˆ°peerã€‚æ‰§è¡Œdocker psæŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„containerï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹: 12345678910vagrant@hyperledger-devenv:v0.3.0-4eec836:/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli$ docker psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES45e3e114f7a2 dev-peer3-mycc-1.0 &quot;chaincode -peer.a...&quot; 4 seconds ago Up 4 seconds dev-peer3-mycc-1.05970f740ad2b dev-peer0-mycc-1.0 &quot;chaincode -peer.a...&quot; 24 seconds ago Up 23 seconds dev-peer0-mycc-1.0b84808d66e99 dev-peer2-mycc-1.0 &quot;chaincode -peer.a...&quot; 48 seconds ago Up 47 seconds dev-peer2-mycc-1.016d7d94c8773 hyperledger/fabric-peer &quot;peer node start -...&quot; About a minute ago Up About a minute 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp peer33561a99e35e6 hyperledger/fabric-peer &quot;peer node start -...&quot; About a minute ago Up About a minute 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp peer20baad3047d92 hyperledger/fabric-peer &quot;peer node start -...&quot; About a minute ago Up About a minute 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp peer11216896b7b4f hyperledger/fabric-peer &quot;peer node start -...&quot; About a minute ago Up About a minute 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0155ff8747b4d hyperledger/fabric-orderer &quot;orderer&quot; About a minute ago Up About a minute 0.0.0.0:7050-&gt;7050/tcp orderer èƒŒåŽå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ åœ¨CLIå®¹å™¨ä¸­æ‰§è¡Œäº†è„šæœ¬script.shã€‚è¯¥è„šæœ¬ç”¨é»˜è®¤çš„mychannelæ‰§è¡ŒcreateChannelå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ç”¨åˆ°äº†ä¹‹å‰configtxgenå·¥å…·ç”Ÿæˆçš„channel.txã€‚ createChannelæ‰§è¡ŒåŽä¼šç”Ÿæˆä¸€ä¸ªåˆ›ä¸–åŒºå—mychannel.blockå¹¶ä¿å­˜åˆ°å½“å‰ç›®å½• ; å¯¹4ä¸ªpeeråˆ†åˆ«æ‰§è¡ŒjoinChannelå‘½ä»¤ï¼Œé€šè¿‡åˆå§‹åŒºå—mychannel.blockåŠ å…¥channelã€‚ è‡³æ­¤æœ‰ä¸€ä¸ªchannelåŒ…å«4ä¸ªpeerå’Œ2ä¸ªorganzationï¼› PER0å’ŒPEER1å±žäºŽOrg0, PEER2å’Œ PEER3å±žäºŽOrg1ã€‚è¿™äº›å…³ç³»çš„å®šä¹‰éƒ½åœ¨confiigtx.yamlä¸­ Chaincodechaincode_example02è¢« installåˆ°PEER0å’ŒPEER2 ç„¶åŽChaincodeåœ¨PEER2ä¸Šinstantiateã€‚å®žä¾‹åŒ–æ˜¯æŒ‡å¯åŠ¨å®¹å™¨å’Œåˆå§‹åŒ–ä¸ŽChaincodeç›¸å…³çš„é”®å€¼å¯¹ï¼Œæœ¬ä¾‹ä¸­çš„åˆå§‹å€¼ æ˜¯[&quot;a&quot;,&quot;100&quot; &quot;b&quot;,&quot;200&quot;]ã€‚å®žä¾‹åŒ–çš„ç»“æžœæ˜¯ä¸€ä¸ªåä¸ºdev-peer2-mycc-1.0çš„å®¹å™¨å¯åŠ¨ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªå®¹å™¨ä»…æ˜¯é’ˆå¯¹PEER2; å®žä¾‹åŒ–æ—¶è¿˜ä¼šå¸¦æœ‰èƒŒä¹¦ç­–ç•¥å‚æ•°ï¼Œæœ¬ä¾‹ä¸­èƒŒä¹¦ç­–ç•¥ä¸ºâ€-Pâ€ OR(â€˜OrgOMSP.memeberâ€,Org1MSP.memberâ€™)â€,æ„æ€æ˜¯ä»»ä½•äº¤æ˜“å¿…é¡»ç”±ç»‘å®šåˆ°Org0æˆ–è€…Org1çš„peerèƒŒä¹¦; å¯¹äºŽâ€aâ€çš„queryè¯·æ±‚å‘æ…ˆç¦§å¤ªåŽåˆ°PEER0ã€‚åœ¨ä¹‹å‰Chaincodeè¢«installåˆ°PEER0äº†ï¼Œæ‰€ä»¥å°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªåä¸ºdev-peer0-mycc-1.0çš„æ–°å®¹å™¨ï¼Œç„¶åŽè¿”å›žæŸ¥è¯¢ç»“æžœã€‚ç”±äºŽæ²¡æœ‰writeæ“ä½œå‘ç”Ÿï¼Œæ‰€ä»¥â€aâ€çš„å€¼ä¾ç„¶æ˜¯â€100â€ã€‚ ä»Žâ€aâ€è½¬ç§»â€10â€ç»™â€bâ€çš„invokeè¯·æ±‚å‘é€åˆ°PEER0 Chaincode install åˆ° PEER3 å¯¹â€aâ€çš„query è¯·æ±‚å‘å…³åˆ°PEER3ã€‚ è¿™å¯åŠ¨äº†ç¬¬ä¸‰ä¸ªåä¸ºdev-peer3-mycc-1.0çš„å®¹å™¨ï¼Œå¹¶è¿”å›žæŸ¥è¯¢ç»“æžœ90ï¼Œæ­£ç¡®çš„ååº”äº†ä¹‹å‰çš„äº¤æ˜“; Chaincodeå¿…é¡»è¢« installåˆ°ä¸€ä¸ªpeerä¸Šæ‰èƒ½æˆåŠŸçš„å¯¹è¿™ä¸ªpeerçš„ledgeræ‰§è¡Œread/writeæ“ä½œã€‚æ­¤å¤–ï¼Œåªæœ‰å½“åœ¨peerä¸Šé’ˆå¯¹chaincodeæ‰§è¡Œread/writeræ“ä½œæ—¶ï¼Œè¿™ä¸ªpeerä¸Šæ‰ä¼šå¯è¯¥chaincodeå®¹å™¨(æ¯”å¦‚ï¼ŒæŸ¥è¯¢â€aâ€çš„å€¼)äº¤æ˜“åˆ°å®¹å™¨å¯åŠ¨ã€‚channelä¸­çš„æ‰€æœ‰peerï¼ˆåŒ…æ‹¬é‚£ç»“æ²¡æœ‰install chaincodeçš„peerï¼Œå°±åƒä¸Šä¾‹ä¸­çš„PEER3ï¼‰éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªå‡†ç¡®çš„ledgerï¼ŒledgeråŒ…å«å­˜å‚¨äº†ä¸å¯å˜çš„ã€æœ‰åºçš„äº¤æ˜“è®°å½•çš„blockï¼Œè¿˜æœ‰ç»´æŠ¤current stateçš„statedbã€‚åœ¨peerä¸Šinstall chaincodeä¹‹åŽå°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨è¯¥peerä¸Šçš„chaincodeäº†ï¼ˆå°±åƒä¸Šä¾‹ä¸­çš„PEER3ï¼‰ï¼Œå› ä¸ºä¹‹å‰å·²ç»instantiatedè¿‡äº†; æŸ¥çœ‹äº¤æ˜“ æŸ¥çœ‹CLIå®¹å™¨çš„log: 1# docker logs -f cli è¾“å‡º: 123456789102017-02-28 04:31:20.841 UTC [logging] InitFromViper -&gt; DEBU 001 Setting default logging level to DEBUG for command &apos;chaincode&apos;2017-02-28 04:31:20.842 UTC [msp] GetLocalMSP -&gt; DEBU 002 Returning existing local MSP2017-02-28 04:31:20.842 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 003 Obtaining default signing identity2017-02-28 04:31:20.843 UTC [msp] Sign -&gt; DEBU 004 Sign: plaintext: 0A8F050A59080322096D796368616E6E...6D7963631A0A0A0571756572790A01612017-02-28 04:31:20.843 UTC [msp] Sign -&gt; DEBU 005 Sign: digest: 52F1A41B7B0B08CF3FC94D9D7E916AC4C01C54399E71BC81D551B97F5619AB54Query Result: 902017-02-28 04:31:30.425 UTC [main] main -&gt; INFO 006 Exiting.....===================== Query on chaincode on PEER3 on channel &apos;mychannel&apos; is successful ========================================== All GOOD, End-2-End execution completed ===================== å®žæ—¶æŸ¥çœ‹æ—¥å¿—æ—¶ï¼Œéœ€è¦æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯; é¦–å…ˆï¼Œåœæ­¢è¿è¡Œç€çš„dockerå®¹å™¨: 1# docker rm -f $(docker ps -aq) åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯å¯åŠ¨docker-composeè„šæœ¬: 1CHANNEL_NAME=&lt;channel-id&gt; docker-compose up -d åœ¨ç¬¬äºŒä¸ªç»ˆç«¯æŸ¥çœ‹logï¼š 1# docker logs -f cli è¿™å°†å®žæ—¶è¾“å‡ºé€šè¿‡script.shæ‰§è¡Œçš„äº¤æ˜“ä¿¡æ¯; æŸ¥çœ‹chaincodeæ—¥å¿—å¯¹æ¯ä¸ªchaincodeå®¹å™¨å•ç‹¬æŸ¥çœ‹logï¼Œè¾“å‡º: 12345678910111213141516$ docker logs dev-peer2-mycc-1.004:30:45.947 [BCCSP_FACTORY] DEBU : Initialize BCCSP [SW]ex02 InitAval = 100, Bval = 200$ docker logs dev-peer0-mycc-1.004:31:10.569 [BCCSP_FACTORY] DEBU : Initialize BCCSP [SW]ex02 InvokeQuery Response:&#123;&quot;Name&quot;:&quot;a&quot;,&quot;Amount&quot;:&quot;100&quot;&#125;ex02 InvokeAval = 90, Bval = 210$ docker logs dev-peer3-mycc-1.004:31:30.420 [BCCSP_FACTORY] DEBU : Initialize BCCSP [SW]ex02 InvokeQuery Response:&#123;&quot;Name&quot;:&quot;a&quot;,&quot;Amount&quot;:&quot;90&quot;&#125; æ‰‹åŠ¨æ‰§è¡Œäº¤æ˜“åœæ­¢æ‰€æœ‰å®¹å™¨: 1# docker rm -f $(docker ps -aq) ç„¶åŽï¼Œæ‰§è¡Œdocker iamge å‘½ä»¤æŸ¥çœ‹chaincodeé•œåƒï¼Œä¼šæœ‰ç±»ä¼¼ä»¥ä¸‹å†…å®¹: 1234REPOSITORY TAG IMAGE ID CREATED SIZEdev-peer3-mycc-1.0 latest 13f6c8b042c6 5 minutes ago 176 MBdev-peer0-mycc-1.0 latest e27456b2bd92 5 minutes ago 176 MBdev-peer2-mycc-1.0 latest 111098a7c98c 5 minutes ago 176 MB åˆ é™¤è¿™äº›é•œåƒï¼š 1docker rmi &lt;IMAGE ID&gt; &lt;IMAGE ID&gt; &lt;IMAGE ID&gt; æ¯”å¦‚: 1# docker rmi -f 12f e27 111 ç¡®ä¿ä¹‹å‰ç”Ÿæˆçš„é…ç½®å†…å®¹è¿˜åœ¨ï¼Œå¦‚æžœåˆ é™¤äº†å°±å†æ‰§è¡Œè„šæœ¬: 1./generatecCfgTrx.sh&lt;channel-ID&gt; æˆ–è€…ä½¿ç”¨è„šæœ¬ä¸­çš„å‘½ä»¤æ‰‹åŠ¨ç”Ÿæˆ; ä¿®æ”¹docker-composeæ–‡ä»¶æ‰“å¼€docker-composeæ–‡ä»¶æ³¨é‡ŠæŽ‰æ‰§è¡Œscript.shè„šæœ¬çš„å‘½ä»¤ï¼Œå¦‚ä¸‹: 12working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer# command: /bin/bash -c &apos;./scripts/script.sh $&#123;CHANNEL_NAME&#125;&apos; ä¿å­˜æ–‡ä»¶ ï¼Œé‡å¯ç½‘ç»œ: 12# åœ¨e2e_cliç›®å½•ä¸‹æ‰§è¡Œï¼Œè®¾ç½®æ­£ç¡®çš„CHANNEL_NAMECHANNEL_NAME=&lt;channel-id&gt; docker-compose up -d å‘½ä»¤è¯­æ³• å‚ç…§ script.shè„šæœ¬ä¸­çš„creaeteå’Œjoinå‘½ä»¤ã€‚ä¸‹é¢çš„å‘½ä»¤åªæ˜¯é’ˆå¯¹PEER0çš„ï¼Œå½“å¯¹ordererå’Œpeeræ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦ä¿®æ”¹ä¸‹é¢ç»™å‡ºçš„å››ä¸ªçŽ¯å¢ƒå˜é‡çš„å€¼; 12345# å¯¹PEER0æ‰€ç”¨çš„çŽ¯å¢ƒå˜é‡CORE_PEER_MSPCONFIGPATH=$GOPATH/src/github.com/hyperledger/fabric/peer/crypto/peer/peer0/localMspConfigCORE_PEER_ADDRESS=peer0:7051CORE_PEER_LOCALMSPID=&quot;Org0MSP&quot;CORE_PEER_TLS_ROOTCERT_FILE=$GOPATH/src/github.com/hyperledger/fabric/peer/crypto/peer/ peer0/localMspConfig/cacerts/peerOrg0.pem ç¬¬ä¸ªpeerçš„çŽ¯å¢ƒå˜çš„å€¼éƒ½åœ¨docker-composeæ–‡ä»¶ä¸­ Create channelè¿›åŽ»cliå®¹å™¨: 1# docker exec -it cli bash æ‰§è¡ŒæˆåŠŸè¾“å‡º: 1root@0d78bb69300d:/opt/gopath/src/github.com/hyperledger/fabric/peer# ç”¨-cæŒ‡å®šchannel name, -fæŒ‡å®šchannel configruation transaction(æ­¤ä¾‹ä¸­æ˜¯channel.tx)å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„åç§°å®‰è£…configuration transaction; 12# channel.tx å’Œ orderer.block åœ¨ cli å®¹å™¨çš„ crypto/orderer ç›®å½•ä¸‹peer channel create -o orderer0:7050 -c mychannel -f crypto/orderer/channel.tx --tls $CORE_PEER_TLS_ENABLED --cafile $GOPATH/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem ç”±äºŽæ­¤ä¾‹çš„peer channel createå‘½ä»¤æ˜¯é’ˆå¯¹ordererçš„ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ä¹‹å‰çš„çŽ¯å¢ƒå˜é‡ï¼Œå› æ­¤ä¸Šè¾¹çš„å‘½ä»¤åº”è¯¥æ˜¯: 1CORE_PEER_MSPCONFIGPATH=$GOPATH/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig CORE_PEER_LOCALMSPID=&quot;OrdererMSP&quot; peer channel create -o orderer0:7050 -c mychannel -f crypto/orderer/channel.tx --tls $CORE_PEER_TLS_ENABLED --cafile $GOPATH/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem æ³¨æ„:ä¸‹é¢çš„å…¶ä»–å‘½ä»¤ä¾ç„¶åœ¨CLIå®¹ä¸­æ‰§è¡Œï¼Œè€Œä¸”è¦è®°ä½å‘½ä»¤é‡Œæ¯ä¸ªpeerå¯¹åº”çš„çŽ¯å¢ƒå˜é‡; å°†æŒ‡å®šçš„peeråŠ å…¥åˆ°channel: 12#é»˜è®¤åªå°† PEER0 åŠ å…¥ peer channel join -b mychannel.block å®Œæ•´çš„å‘½ä»¤åº”è¯¥æ˜¯: 1CORE_PEER_MSPCONFIGPATH=$GOPATH/src/github.com/hyperledger/fabric/peer/crypto/peer/peer0/localMspConfig CORE_PEER_ADDRESS=peer0:7051 CORE_PEER_LOCALMSPID=&quot;Org0MSP&quot; CORE_PEER_TLS_ROOTCERT_FILE=$GOPATH/src/github.com/hyperledger/fabric/peer/crypto/peer/peer0/localMspConfig/cacerts/peerOrg0.pem peer channel join -b mychannel.block ä¿®æ”¹è¿™å››ä¸ªçŽ¯å¢ƒå˜é‡å°†å…¶ä»–çš„peeråŠ å…¥åˆ°channelä¸­ å°†ç¤ºä¾‹chaincodeä»£ç å®‰è£…åˆ°å››ä¸ªå¯¹ç­‰èŠ‚ç‚¹ä¸­çš„ä¸€ä¸ª: Install chaincode12# åœ¨å‘½ä»¤å‰é¢è¦åŠ ä¸Špeerå¯¹åº”çš„å››ä¸ªçŽ¯å¢ƒå˜é‡peer chaincode install -n mycc -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 åœ¨ä¸€ä¸ªpeerä¸Šå®žä¾‹åŒ–chaincodeï¼Œè¿™å°†å¯¹è¯¥peerå¯åŠ¨ä¸€ä¸ªchaincodeå®¹å™¨ï¼Œå¹¶ä¸ºè¯¥chaincodeè®¾ç½®èƒŒä¹¦ç­–ç•¥ã€‚æ­¤ä¾‹ä¸­å®šä¹‰çš„ç­–ç•¥æ˜¯æœ‰org0æˆ–org1ä¸­çš„ä¸€ä¸ªpeerèƒŒä¹¦å³å¯; 123# åœ¨å‘½ä»¤å‰é¢è¦åŠ ä¸Špeerå¯¹åº”çš„å››ä¸ªçŽ¯å¢ƒå˜é‡# ç”¨ -C å‚æ•°è®¾ç½®æ­£ç¡®çš„channelåï¼Œé»˜è®¤æ˜¯ mychannelpeer chaincode instantiate -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $GOPATH/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n mycc -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;, &quot;100&quot;, &quot;b&quot;,&quot;200&quot;]&#125;&apos; -P &quot;OR (&apos;Org0MSP.member&apos;,&apos;Org1MSP.member&apos;)&quot; Invoke chaincode 12# åœ¨å‘½ä»¤å‰é¢è¦åŠ ä¸Špeerå¯¹åº”çš„å››ä¸ªçŽ¯å¢ƒå˜é‡peer chaincode invoke -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $GOPATH/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&apos; Query chaincode 12# åœ¨å‘½ä»¤å‰é¢è¦åŠ ä¸Špeerå¯¹åº”çš„å››ä¸ªçŽ¯å¢ƒå˜é‡peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos; æ‰§è¡Œç»“æžœ: 1Query Result: 90 æ‰‹åŠ¨æž„å»ºé•œåƒæž„å»ºpeerå’Œordereré•œåƒ: 12# åœ¨farbicç›®å½•ä¸‹æ‰§è¡Œï¼Œå¦‚æžœä¸èƒ½é¡ºåˆ©ç”Ÿæˆé•œåƒï¼Œåˆ™ä½¿ç”¨vagrantçŽ¯å¢ƒ# make peer-docker orderer-docker æ‰§è¡Œdocker imageså‘½ä»¤è¾“å‡º 123456789101112vagrant@hyperledger-devenv:v0.3.0-4eec836:/opt/gopath/src/github.com/hyperledger/fabric$ docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEhyperledger/fabric-orderer latest 264e45897bfb 10 minutes ago 180 MBhyperledger/fabric-orderer x86_64-0.7.0-snapshot-a0d032b 264e45897bfb 10 minutes ago 180 MBhyperledger/fabric-peer latest b3d44cff07c6 10 minutes ago 184 MBhyperledger/fabric-peer x86_64-0.7.0-snapshot-a0d032b b3d44cff07c6 10 minutes ago 184 MBhyperledger/fabric-javaenv latest 6e2a2adb998a 10 minutes ago 1.42 GBhyperledger/fabric-javaenv x86_64-0.7.0-snapshot-a0d032b 6e2a2adb998a 10 minutes ago 1.42 GBhyperledger/fabric-ccenv latest 0ce0e7dc043f 12 minutes ago 1.29 GBhyperledger/fabric-ccenv x86_64-0.7.0-snapshot-a0d032b 0ce0e7dc043f 12 minutes ago 1.29 GBhyperledger/fabric-baseimage x86_64-0.3.0 f4751a503f02 4 weeks ago 1.27 GBhyperledger/fabric-baseos x86_64-0.3.0 c3a4cf3b3350 4 weeks ago 161 MB ä½¿ç”¨æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶è¿›æ”¯vagrantçŽ¯å¢ƒ 1234cd $GOPATH/src/github.com/hyperledger/fabric/devenv# ç¬¬ä¸€æ¬¡å¯åŠ¨VMç”¨ vagrant up vagrant ssh åœ¨fabricç›®å½•ç¼–è¯‘peerå’Œorderer: 12make cleanmake native ç”Ÿæˆccenvé•œåƒ 1make peer-docker ç„¶åŽæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯éƒ½è¿›å…¥vagrantï¼Œè‡³æ­¤æœ‰ä¸‰ä¸ªç»ˆç«¯éƒ½åœ¨vagranté‡Œ;é¦–å…ˆæ¸…ç©ºledgeræ–‡ä»¶/var/hyperledger/ (æ¯æ¬¡è¿è¡ŒåŽï¼Œä¸ºé¿å…é”™è¯¯æˆ–é‡å¤ï¼Œéƒ½è¦æ¸…ç©º): 1rm -rf /var/hyperledger/* ä½¿ç”¨configtxgenå·¥å…·åˆ›å»ºordereråˆ›ä¸–åŒºå—: 1configtxgen -profile SampleMSPSolo -outputBlock orderer.block ç”¨åˆšç”Ÿæˆçš„åˆ›ä¸–åŒºå—å¯åŠ¨orderer: 1ORDERER_GENERAL_GENESISMETHOD=file ORDERER_GENERAL_GENESISFILE=./orderer.block orderer åˆ›å»º channel configuration transaction: 1configtxgen -profile SampleSingleMSPSolo -outputCreateChannelTx channel.tx -channelID &lt;channel-ID&gt; æ‰§è¡ŒæˆåŠŸä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆchannel.tx ä»¥chanlessæ¨¡å—å¯åŠ¨peer: 1peer node start --peer-defaultchain-false ä»¥channel.txä¸ºå‚æ•°åˆ›å»ºchannel: 1peer channel create -o 127.0.0.1:7050 -c mychannel -f channel.tx æ‰§è¡ŒåŽåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªchannelçš„åˆ›ä¸–åŒºå—mychannel.block Join channelé€šè¿‡channelçš„åˆ›ä¸–åŒºå—mychannel.blockåŠ å…¥channel: 1peer channel join -b mychannel.block Install chaincodeåœ¨peerä¸Šå®‰è£…chaincode: 1peer chaincode install -o 127.0.0.1:7050 -n mycc -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 æ‰§è¡ŒæˆåŠŸåŽæŸ¥çœ‹æ–‡ä»¶å¯ä»¥çœ‹åˆ°mycc.1.0: 1ls /var/hyperledger/production/chaincodes Instantiate chaincode å®žä¾‹åŒ–chaincode: 1peer chaincode instantiate -o 127.0.0.1:7050 -C mychannel -n mycc -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;, &quot;100&quot;, &quot;b&quot;,&quot;200&quot;]&#125;&apos; docker psæŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ï¼Œå¦‚æžœchaincodeå¯åŠ¨æˆåŠŸï¼Œåˆ™æ˜¾ç¤º: 12CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMESbd9c6bda7560 dev-jdoe-mycc-1.0 &quot;chaincode -peer.a...&quot; 5 seconds ago Up 5 seconds dev-jdoe-mycc-1.0 Invoke chaincodeè°ƒç”¨chaincodeä»Žâ€aâ€è½¬ç§»â€10â€ç»™â€bâ€: 1peer chaincode invoke -o 127.0.0.1:7050 -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&apos; Query chaincodeæŸ¥è¯¢â€aâ€çš„å€¼: 12# è¿”å›žå€¼åº”æ˜¯ 90peer chaincode query -o 127.0.0.1:7050 -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos; è¿è¡Œå®ŒæˆåŽä¸è¦å¿˜è®°æ¸…ç©ºledgeræ–‡ä»¶å¤¹/var/hyperledger: 1rm -rf /var/hyperledger/* ä½¿ç”¨CouchDBå¯ä»¥å°†stateDBé»˜è®¤çš„goleveldbæ›¿æ¢æˆCouchDBã€‚å¯¹äºŽCouchDB, chainocdeå„åŠŸèƒ½ä¾ç„¶å¯ç”¨ï¼Œä½†å°†chaincodeæ•°æ®ä»¥JSONæ–¹å¼å­˜å‚¨çš„è¯å°±å¯ä»¥ä½¿ç”¨CouchDBçš„å¤æ‚æŸ¥è¯¢çš„åŠŸèƒ½; ä¸ºäº†ä½¿ç”¨CouchDBï¼Œé™¤äº†æœ€å‰é¢çš„â€å‰æâ€ä¸€èŠ‚çš„æ“ä½œå¤–ï¼Œè¿˜éœ€è¦ä¸‹è¾¹ä¸¤æ­¥å¯åŠ¨CouchDBå®¹å™¨å¹¶å°†ä¹‹ä¸Žpeerå®¹å™¨å…³è”; æž„å»º CouchDBé•œåƒ 12# make sure you are in the fabric directorymake couchdb ç¼–è¾‘fabric/example/e2e_cli/docker-compose.yaml å’Œdocker-compose.yam å°†æ‰€æœ‰ä¸ŽCouchDBæœ‰å…³çš„å†…å®¹å–æ¶ˆæ³¨é‡Šã€‚è¿™æ · chaincode_xample02å°±å¯ä»¥CouchDBä¸‹è¿è¡Œäº†; æ³¨æ„:å¦‚æžœå°†CouchDBå®¹å™¨çš„ç«¯å£æ˜ å°„çš„ä¸»æœºï¼Œè¯·ä¸€å®šè¦æ³¨æ„å®‰å…¨ï¼Œåœ¨å¼€å‘çŽ¯å¢ƒ ä¸­å°†ç«¯æ˜ å°„å‡ºæ¥å¯ä»¥é€šè¿‡CouchDBçš„webç•Œé¢å¯è§†åŒ–æ“ä½œæ•°æ®ã€‚ç”Ÿäº§çŽ¯å¢ƒä¸­ä¸€èˆ¬ä¸ä¼šåšç«¯å£æ˜ å°„ï¼Œä»¥é™åˆ¶CouchDBçš„å¤–éƒ¨è®¿é—®; å¯ä»¥ç”¨chaincode_example02åœ¨CouldDBä¸‹æ‰§è¡Œä¸Šè¾¹çš„chaincodeæ“ä½œï¼Œä½†æ˜¯ä¸ºäº†ä½¿ç”¨CouchDBçš„å¤æ‚æŸ¥è¯¢åŠŸèƒ½ï¼Œchaincodeæ•°æ®ä¸€å®šè¦ä»¥JSONæ ¼å¼å­˜å‚¨(ä¾‹å¦‚ fabric/examples/chaincode/go/merbles02); ä½¿ç”¨æ‰‹åŠ¨æ‰§è¡Œäº¤æ˜“è¿™ä¸€èŠ‚ä¸­çš„æ­¥éª¤installã€instantiateã€invokeå’Œquerymarbles02ï¼Œæ‰§è¡Œå®Œæˆjoin channelè¿™æ­¥åŽä½¿ç”¨ä¸‹è¾¹çš„å‘½ä»¤æ“ä½œmarbles02: åœ¨PEER0ä¸Šå®‰è£…å®žä¾‹åŒ–chaincode 12peer chaincode install -o orderer0:7050 -n marbles -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/marbles02peer chaincode instantiate -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n marbles -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/marbles02 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;]&#125;&apos; -P &quot;OR (&apos;Org0MSP.member&apos;,&apos;Org1MSP.member&apos;)&quot; åˆ›å»ºä¸€äº›marbleå¹¶ç§»åŠ¨å®ƒä»¬ 123456peer chaincode invoke -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;initMarble&quot;,&quot;marble1&quot;,&quot;blue&quot;,&quot;35&quot;,&quot;tom&quot;]&#125;&apos;peer chaincode invoke -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;initMarble&quot;,&quot;marble2&quot;,&quot;red&quot;,&quot;50&quot;,&quot;tom&quot;]&#125;&apos;peer chaincode invoke -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;initMarble&quot;,&quot;marble3&quot;,&quot;blue&quot;,&quot;70&quot;,&quot;tom&quot;]&#125;&apos;peer chaincode invoke -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;transferMarble&quot;,&quot;marble2&quot;,&quot;jerry&quot;]&#125;&apos;peer chaincode invoke -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;transferMarblesBasedOnColor&quot;,&quot;blue&quot;,&quot;jerry&quot;]&#125;&apos;peer chaincode invoke -o orderer0:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;delete&quot;,&quot;marble1&quot;]&#125;&apos; å¦‚æžœåšäº†CouchDBå®¹å™¨çš„ç«¯å£æ˜ å°„ï¼Œå¯ä»¥é€šè¿‡webç•Œé¢æŸ¥çœ‹æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°åä¸ºmychannelçš„æ•°æ®åº“åŠå…¶æ–‡æ¡£ å¦‚æžœä½¿ç”¨çš„æ˜¯vagrantçŽ¯å¢ƒ 1234http://localhost:15984/_utils* å¦‚æžœä¸æ˜¯vagrantçŽ¯å¢ƒï¼Œä½¿ç”¨CouchDBå®¹å™¨æŒ‡å®šçš„ç«¯å£http://localhost:5984/_utils æœ‰å¯è§„å¾‹çš„æŸ¥è¯¢chaincode(ä¾‹å¦‚,è¯»å–marble2) peer chaincode query-C mychannel -n marbles -c {â€œArgsâ€:[â€œreadMarbleâ€,â€marble2â€]}â€™ å¯ä»¥çœ‹åˆ°mable2çš„è¯¦ç»†ä¿¡æ¯: 1Query Result: &#123;&quot;color&quot;:&quot;red&quot;,&quot;docType&quot;:&quot;marble&quot;,&quot;name&quot;:&quot;marble2&quot;,&quot;owner&quot;:&quot;jerry&quot;,&quot;size&quot;:50&#125; èŽ·å– marble1çš„åŽ†å² 1peer chaincode query -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;getHistoryForMarble&quot;,&quot;marble1&quot;]&#125;&apos; å¯ä»¥çœ‹åˆ°æ“ä½œè¿‡marbel1çš„äº¤æ˜“: 1Query Result: [&#123;&quot;TxId&quot;:&quot;1c3d3caf124c89f91a4c0f353723ac736c58155325f02890adebaa15e16e6464&quot;, &quot;Value&quot;:&#123;&quot;docType&quot;:&quot;marble&quot;,&quot;name&quot;:&quot;marble1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:35,&quot;owner&quot;:&quot;tom&quot;&#125;&#125;,&#123;&quot;TxId&quot;:&quot;755d55c281889eaeebf405586f9e25d71d36eb3d35420af833a20a2f53a3eefd&quot;, &quot;Value&quot;:&#123;&quot;docType&quot;:&quot;marble&quot;,&quot;name&quot;:&quot;marble1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:35,&quot;owner&quot;:&quot;jerry&quot;&#125;&#125;,&#123;&quot;TxId&quot;:&quot;819451032d813dde6247f85e56a89262555e04f14788ee33e28b232eef36d98f&quot;, &quot;Value&quot;:&#125;] è¿˜å¯ä»¥æ‰§è¡Œå¤æ‚æŸ¥è¯¢,æ¯”å–»å¦‚æŸ¥è¯¢jerryæ‰€æ‹¥æœ‰çš„marble: 1peer chaincode query -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;queryMarblesByOwner&quot;,&quot;jerry&quot;]&#125;&apos; æŸ¥è¯¢ç»“æžœä¸ºjerryæ‰€æ‹¥æœ‰çš„2ä¸ªmarbleçš„ä¿¡æ¯: 1peer chaincode query -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;queryMarblesByOwner&quot;,&quot;jerry&quot;]&#125;&apos; æŸ¥è¯¢ç»“æžœä¸ºjerryæ‰€æ‹¥æœ‰çš„2ä¸ªmarbleçš„ä¿¡æ¯: 1Query Result: [&#123;&quot;Key&quot;:&quot;marble2&quot;, &quot;Record&quot;:&#123;&quot;color&quot;:&quot;red&quot;,&quot;docType&quot;:&quot;marble&quot;,&quot;name&quot;:&quot;marble2&quot;,&quot;owner&quot;:&quot;jerry&quot;,&quot;size&quot;:50&#125;&#125;,&#123;&quot;Key&quot;:&quot;marble3&quot;, &quot;Record&quot;:&#123;&quot;color&quot;:&quot;blue&quot;,&quot;docType&quot;:&quot;marble&quot;,&quot;name&quot;:&quot;marble3&quot;,&quot;owner&quot;:&quot;jerry&quot;,&quot;size&quot;:70&#125;&#125;] é€šè¿‡ownerå­—æ®µç­‰äºŽjerryæŸ¥è¯¢: 1peer chaincode query -C mychannel -n marbles -c &apos;&#123;&quot;Args&quot;:[&quot;queryMarbles&quot;,&quot;&#123;\&quot;selector\&quot;:&#123;\&quot;owner\&quot;:\&quot;jerry\&quot;&#125;&#125;&quot;]&#125;&apos; æŸ¥è¯¢ç»“æžœå¦‚ä¸‹: 1Query Result: [&#123;&quot;Key&quot;:&quot;marble2&quot;, &quot;Record&quot;:&#123;&quot;color&quot;:&quot;red&quot;,&quot;docType&quot;:&quot;marble&quot;,&quot;name&quot;:&quot;marble2&quot;,&quot;owner&quot;:&quot;jerry&quot;,&quot;size&quot;:50&#125;&#125;,&#123;&quot;Key&quot;:&quot;marble3&quot;, &quot;Record&quot;:&#123;&quot;color&quot;:&quot;blue&quot;,&quot;docType&quot;:&quot;marble&quot;,&quot;name&quot;:&quot;marble3&quot;,&quot;owner&quot;:&quot;jerry&quot;,&quot;size&quot;:70&#125;&#125;] æ•°æ®æŒä¹…åŒ–å¦‚æžœéœ€è¦å¯¹peeræˆ–CouchDBå®¹å™¨çš„æ•°æ®æŒä¹…åŒ–ï¼Œä¸€ç§æ˜¯é€‰æ‹©æ˜¯å°†å®¹å™¨çš„ç›¸å…³ç›®å½•æŒ‚è½½åˆ°dockerä¸»æœº;ä¾‹å¦‚ï¼Œå°†ä¸‹é¢ä¸¤å†…å®¹å™¨å…¥åˆ°docker-compose.yamlæ–‡ä»¶ä¸­çš„å¯¹åº”peerå¤„: 12volumes: - /var/hyperledger/peer0:/var/hyperledger/production 12volumes:- /var/hyperledger/couchdb0:/opt/couchdb/data æ•…éšœæŽ’é™¤ æ¯æ¬¡è¿è¡ŒåŽè¦æ¸…ç†æ–‡ä»¶ å¦‚æžœå‡ºçŽ°dockeré”™è¯¯ï¼Œåˆ™åˆ é™¤é•œåƒï¼Œä»Žå¤´å†æ“ä½œä¸€é; 12make clean make peer-docker orderer-docker å¦‚æžœå‡ºçŽ°ä¸‹é¢çš„é”™è¯¯ 1Error: Error endorsing chaincode: rpc error: code = 2 desc = Error installing chaincode code mycc:1.0(chaincode /var/hyperledger/production/chaincodes/mycc.1.0 exits) chaincodeé•œåƒ(å¦‚dev-peer0-mycc-1.0æˆ–dev-peer1-mycc-1.0)å¯èƒ½æ˜¯ä»¥å‰è¿è¡Œè¿‡çš„ï¼Œåˆ é™¤å®ƒä»¬ç„¶åŽé‡è¯•; 1docker rmi -f $(docker images | grep peer[0-9]-peer[0-9] | awk &apos;&#123;print $3&#125;&apos;) ä½¿ç”¨ downé€‰é¡¹æ¸…ç†ç½‘ç»œ 12./network_setup.sh down Next Previous]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hyperledger Fabric Chaincode for Operators]]></title>
    <url>%2F2018%2F03%2F20%2F%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%2F</url>
    <content type="text"><![CDATA[å®žæ“æ™ºèƒ½åˆçº¦ ä»€ä¹ˆæ˜¯Chaincode chaincodeæ˜¯ä¸€ä¸ªç¨‹åºï¼Œå®ƒæ˜¯ä½¿ç”¨Goè¯­è¨€ç¼–å†™çš„ï¼Œæœ€ç»ˆåœ¨Javaç­‰å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­å®žçŽ°äº†æŒ‡å®šçš„æŽ¥å£ï¼›chaincodeè¿è¡Œä¸€ä¸ªè¢« èƒŒä¹¦peerè¿›ç¨‹ç‹¬ç«‹å‡ºæ¥çš„å®‰å…¨çš„Dockerå®¹å™¨ä¸­;chaincodeé€šè¿‡åº”ç”¨ç¨‹åºæäº¤çš„äº‹åŠ¡åˆå§‹åŒ–å’Œç®¡ç†å¸æœ¬çŠ¶æ€; chaincodeé€šå¸¸å¤„ç†è¢«ç½‘ç»œæˆå‘˜è®¤å¯çš„ä¸šåŠ¡é€»è¾‘;å› æ­¤å®ƒè¢«è®¤ä¸ºæ˜¯ä¸€ç§â€æ™ºèƒ½åˆçº¦â€;ç”±chaincodeåˆ›å»ºçš„çŠ¶æ€åªä½œç”¨äºŽè¯¥chaincodeï¼Œè€Œä¸èƒ½é€šè¿‡å¦ä¸€ä¸ªchaincodeç›´æŽ¥è®¿é—®;ä½†æ˜¯ï¼Œåœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œç»™å®šé€‚å½“çš„æƒé™;chaincodeå¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªchaincodeæ¥è®¿é—®å®ƒçš„çŠ¶æ€; é€šè¿‡åŒºå—é“¾é€šä¿¡äº§å“åº”ç”¨æ–¹æ¡ˆä¾›åº”å•†è¯ºäºšçš„è§†è§’æ¥æŽ¢ç´¢chaincode;ä¸»è¦å…³æ³¨è¯ºäºšå¯¹chaincodeç”Ÿå‘½å‘¨æœŸçš„æ“ä½œ;åœ¨åŒºå—é“¾ç½‘ç»œä¸­ï¼Œæ‰“åŒ…ï¼Œå®‰è£…ï¼Œå®žä¾‹åŒ–å’Œå‡çº§chaincodeçš„è¿‡ç¨‹;æ˜¯chaincodeçš„æ“ä½œç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªåŠŸèƒ½; Packaging(åŒ…)chaincodeåŒ…ç”±3éƒ¨åˆ†ç»„æˆ: chaincodeç”±chaincodeéƒ¨ç½²è§„èŒƒ(ChaincodeDeploymentSpec)æˆ–CDSå®šä¹‰ç å’Œå…¶ä»–å±žæ€§(å¦‚åç§°å¦‚ç‰ˆæœ¬) å®šä¹‰äº†chaincodeåŒ…; ä¸€ä¸ªå¯é€‰çš„å®žä¾‹åŒ–ç­–ç•¥ï¼Œä»–å¯ä»¥åœ¨ç­–ç•¥ä¸Šç”¨ç›¸åŒçš„ç­–ç•¥æ¥æè¿°;ç”¨äºŽä¸€æ”¯æŒå’Œåœ¨èƒŒä¹¦ç­–ç•¥ä¸­æè¿°ã€‚ ç”±â€æ‹¥æœ‰â€chaincodeçš„å®žä½“çš„ä¸€ç»„ç­¾å; è¿™äº›ç­¾åæœ‰ä»¥ä¸‹ç›®çš„: ä¸ºäº†å»ºç«‹chaincodeçš„æ‰€æœ‰æƒ; å…è®¸å¯¹åŒ…çš„å†…å®¹è¿›è¡ŒéªŒè¯; å…è®¸æ£€æµ‹åŒ…æ˜¯å¦ç¯¡æ”¹; ä¸€ä¸ªchannelä¸Šçš„chaincodeå®žä¾‹åŒ–äº‹åŠ¡çš„åˆ›å»ºè€…æ˜¯é€šè¿‡chaincodeçš„å®žä¾‹åŒ–ç­–ç•¥æ¥éªŒè¯çš„; åˆ›å»ºpackage(åŒ…) æ‰“åŒ…chaincodeæœ‰ä¸¤ç§æ–¹æ³•ã€‚ä¸€ç§æ˜¯å½“æƒ³è¦ä¸€ä¸ªchaincodeæ‹¥æœ‰å¤šä¸ªæ‰€æœ‰è€…æ—¶ï¼Œéœ€è¦ä½¿ç”¨å¤šä¸ªèº«ä»½æ ‡è¯†ä¸ºè¯¥chaincodeç­¾å;è¿™ä¸ªå·¥ä½œæµç¨‹éœ€è¦æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªå·²ç­¾åçš„chaincode(ä¸€ä¸ªç­¾ç½²çš„CDS);ç„¶åŽé€šè¿‡åºåˆ—çš„æ–¹å¼å°†å…¶ä¼ é€’ç»™å…¶ä»–æ‰€æœ‰è€…æ¥ç­¾ç½² ; æ›´ç®€å•çš„å·¥ä½œæµç¨‹æ˜¯æ­£åœ¨å‘è¡Œå®‰è£…äº‹åŠ¡çš„èŠ‚ç‚¹çš„èº«ä»½ç­¾åæ—¶éƒ¨ç½²å·²éƒ¨ç½²çš„CDS;é¦–å…ˆå°†å¤„ç†æ›´å¤æ‚çš„æƒ…å†µï¼Œä½†æ˜¯ï¼Œå¦‚æžœä¸éœ€è¦æ‹…å¿ƒå¤šä¸ªæ‰€æœ‰è€…; é‚£ä¹ˆå¯ä»¥è·³è¿‡ä¸‹åœ¨çš„å®‰è£…chaincodeéƒ¨åˆ†; è¦åˆ›å»ºä¸€ä¸ªå·²ç­¾åçš„chaincodeåŒ…ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤: 1234567891011121314root@6edc4e6c7b9c:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode package -n mycc -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 -v 0 -s -S -i &quot;AND(&apos;OrgA.admin&apos;)&quot; ccpack.out2018-03-20 06:28:29.298 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP2018-03-20 06:28:29.299 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity2018-03-20 06:28:29.299 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc2018-03-20 06:28:29.299 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc2018-03-20 06:28:29.526 UTC [golang-platform] getCodeFromFS -&gt; DEBU 005 getCodeFromFS github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example022018-03-20 06:28:29.965 UTC [golang-platform] func1 -&gt; DEBU 006 Discarding GOROOT package fmt2018-03-20 06:28:29.965 UTC [golang-platform] func1 -&gt; DEBU 007 Discarding provided package github.com/hyperledger/fabric/core/chaincode/shim2018-03-20 06:28:29.965 UTC [golang-platform] func1 -&gt; DEBU 008 Discarding provided package github.com/hyperledger/fabric/protos/peer2018-03-20 06:28:29.965 UTC [golang-platform] func1 -&gt; DEBU 009 Discarding GOROOT package strconv2018-03-20 06:28:29.965 UTC [golang-platform] GetDeploymentPayload -&gt; DEBU 00a done2018-03-20 06:28:29.968 UTC [msp/identity] Sign -&gt; DEBU 00b Sign: plaintext: 0A58080112520A476769746875622E63...0A2D2D2D2D2D454E44202D2D2D2D2D0A 2018-03-20 06:28:29.968 UTC [msp/identity] Sign -&gt; DEBU 00c Sign: digest: 8A854844B0721EB24D348CC38C19A3D5E182CBE46FDFFE8CB9ECA7C44406F720 2018-03-20 06:28:29.969 UTC [chaincodeCmd] chaincodePackage -&gt; DEBU 00d Packaged chaincode into deployment spec of size &lt;3409&gt;, with args = [ccpack.out] -s å‚æ•°æ˜¯æŒ‡å¯ä»¥åˆ›å»ºä¸€ä¸ªç”±å¤šä¸ªæ‰€æœ‰ç­¾ç½²çš„åŒ…ï¼Œè€Œä¸æ˜¯ç®€å•åœ°åˆ›å»ºä¸€ä¸ªæœªå¤„ç†/ä¿®é¥°è¿‡çš„CDSï¼›å½“æŒ‡å®šäº†-sæ—¶ï¼Œå¦‚æžœå…¶ä»–æ‰€æœ‰è€…éœ€è¦ç­¾åï¼Œä¹Ÿå¿…éœ€è¦æŒ‡å®š-så‚æ•°; å¦åˆ™ï¼Œè¿™ä¸ªè¿›ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªé™¤äº†CDSå®žä¾‹åŒ–ç­–ç•¥ä¹‹å¤–çš„å·²ç­¾ç½²CDS; -S å‚æ•°ä½¿ç”¨åœ¨core.yamlä¸­ç”±localMspidå±žæ€§å€¼æ ‡è¯†çš„MSPæ¥æŒ‡ç¤ºè¯¥ç¨‹åºçš„ç­¾å; -S å‚æ•°æ˜¯å¯é€‰çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æžœä¸€ä¸ªåŒ…æ˜¯åœ¨æ²¡æœ‰ç­¾åçš„æƒ…å†µä¸‹åˆ›å»ºçš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¸èƒ½ç”±ä»»ä½•å…¶ä»–æ‰€æœ‰è€…ä½¿ç”¨signpackageæ¥ç­¾ç½²; -i å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå³æŒ‡å®š chaincodeå®žä¾‹åŒ–ç­–ç•¥ã€‚å®žä¾‹åŒ–ç­–ç•¥ä¸ŽèƒŒä¹¦ç­–ç•¥å…·æœ‰ç›¸åŒçš„æ ¼å¼ï¼›å¹¶æŒ‡å®šå“ªäº›idå¯ä»¥å®žä¾‹åŒ–chaincodeã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œåªå…è®¸ä½¿ç”¨OrgAçš„adminå®žä¾‹åŒ–é“¾ä»£ç ;å¦‚æžœæ²¡æœ‰æä¾›ç­–ç•¥ï¼Œåˆ™ä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼Œè¿™å°†åªå…è®¸peerä¸­MSPçš„adminèº«ä»½æ¥å®žä¾‹åŒ–chaincodeï¼› åŒ…ç­¾å(Package signing)ä¸€ä¸ªå·²ç»è¢«ç­¾åçš„chaincodeåŒ…åœ¨è¢«åˆ›å»ºæ—¶å€™å¯ä»¥äº¤ç”±å…¶å®ƒæ‰€æœ‰è€…æ£€æŸ¥å¹¶ç­¾å;è¿™ä¸ªå·¥ä½œæµç¨‹æ”¯æŒchaincodeåŒ…å¸¦å¤–ç­¾ç½²; SignedCDSåŒ…å«äº†3ä¸ªå…ƒç´ ; CDSåŒ…å«äº†chaincodeçš„æºç ,å³è¡¨ç¤ºèƒŒä¹¦ç­–ç•¥; chaincodeçš„å®žä¾‹åŒ–ç­–ç•¥ï¼Œå³è¡¨ç¤ºèƒŒä¹¦ç­–ç•¥; chaincodeçš„æ‰€æœ‰è€…åˆ—è¡¨,ä»¥èƒŒä¹¦çš„æ–¹å¼å®šä¹‰; æ³¨: å½“chaincodeåœ¨æŸäº›channelä¸Šå®žä¾‹åŒ–æ—¶ï¼Œæ­¤èƒŒä¹¦ç­–ç•¥æ˜¯ç”±å¸¦å¤–å†³å®šçš„ï¼Œä»¥æä¾›é€‚å½“çš„MSPåŽŸåˆ™ã€‚å¦‚æžœæ²¡æœ‰æŒ‡å®šå®žä¾‹åŒ–ç­–ç•¥ï¼Œåˆ™é»˜è®¤ç­–ç•¥æ˜¯channelçš„ä»»ä½•MSPçš„admin æ¯ä¸ªæ‰€æœ‰éƒ½é€šè¿‡å°†å…¶ä¸Žæ‰€æœ‰è€…çš„èº«ä»½(ä¾‹å¦‚è¯ä¹¦) ç›¸ç»“åˆï¼Œå¹¶ç­¾ç½²ç»“åˆåŽçš„ç»“æžœæ¥ä¸ºChaincodeDeploymentSpecèƒŒä¹¦;ä¸€ä¸ªcaincodeæ‰€æœ‰è€…å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ç­¾ç½²ä¸€ä¸ªä»¥å‰åˆ›å»ºçš„ç­¾ååŒ…: 1234567root@6edc4e6c7b9c:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode signpackage ccpack.out signedccpack.out2018-03-20 06:48:52.479 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP2018-03-20 06:48:52.479 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity2018-03-20 06:48:52.479 UTC [msp/identity] Sign -&gt; DEBU 003 Sign: plaintext: 0A58080112520A476769746875622E63...0A2D2D2D2D2D454E44202D2D2D2D2D0A 2018-03-20 06:48:52.479 UTC [msp/identity] Sign -&gt; DEBU 004 Sign: digest: 8A854844B0721EB24D348CC38C19A3D5E182CBE46FDFFE8CB9ECA7C44406F720 Wrote signed package to signedccpack.out successfully2018-03-20 06:48:52.480 UTC [main] main -&gt; INFO 005 Exiting..... ccpack.out å’Œsignedccpack.outåˆ†åˆ«æ˜¯è¾“å…¥å’Œè¾“å‡ºåŒ…ã€‚signedccpack.outåŒ…å«äº†ä½¿ç”¨çš„åŒ…é™„åŠ ç­¾å; å®‰è£…chaincodeå®‰è£…äº‹åŠ¡å°†chaincodeçš„æºä»£ç æ‰“åŒ…æˆä¸€ç§æŒ‡å®šçš„æ ¼å¼ï¼Œç§°ä¸ºChaincodeDeploymentSpec(chaincodeéƒ¨ç½²è§„èŒƒæˆ–CDS);å¹¶å°†å…¶å®‰è£…åˆ°è¿è¡Œè¯¥chaincodeçš„peerèŠ‚ç‚¹ä¸Š; å¿…é¡»åœ¨channelä¸­çš„æ¯ä¸ªèƒŒä¹¦èŠ‚ç‚¹ä¸Šå®‰è£…chaincodeã€‚ä»¥è¿è¡Œchaincode; å½“å®‰è£…APIè¢«ç®€å•åœ°ç»™å‡ºä¸€ä¸ªChaincodeDeploymentSpecæ—¶ï¼Œå®ƒä¼šå°†é»˜è®¤å®žä¾‹åŒ–ç­–ç•¥;å¹¶åŒ…å«ä¸€ä¸ªç©ºçš„æ‰€æœ‰è€…åˆ—è¡¨; chaincodeåªåº”è¯¥å®‰è£…åœ¨chaincodeæ‹¥æœ‰çš„æˆå‘˜çš„èƒŒä¹¦pperèŠ‚ç‚¹ä¸Š; ä»¥ä¿æŠ¤ç½‘ç»œä¸­å…¶ä»–æˆå‘˜çš„chaincodeé€»è¾‘çš„æœºå¯†æ€§ é‚£äº›æ²¡æœ‰chaincodeçš„æˆå‘˜ï¼Œä¸èƒ½æˆä¸ºchaincodeäº¤æ˜“çš„èƒŒä¹¦äºº; ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¸èƒ½æ‰§è¡Œchaincode ä½†æ˜¯ï¼Œå®ƒä»¬ä»ç„¶å¯ä»¥éš¾å¹¶å°†äº‹åŠ¡æäº¤åˆ°è´¦æœ¬ä¸Š; è¦å®‰è£…ä¸€ä¸ªchainocdeï¼Œè¯·å°†ä¸€ä¸ªç­¾ç½²çš„ææ¡ˆå‘é€åˆ°system chaincode(ç³»ç»Ÿæ™ºèƒ½åˆçº¦) å…¶ä¸­è¢«æè¿°ä¸ºç”Ÿå‘½å‘¨æœŸç³»ç»Ÿæ™ºèƒ½åˆçº¦(lifecycle system chaincode â€“LSCC) çš„éƒ¨åˆ†;ä¾‹å¦‚ï¼Œè¦å®‰è£…ä½¿ç”¨CLIçš„ç®€å•èµ„äº§chaincodeä¸­æè¿°çš„saccç¤ºä¾‹chaincodeï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤: 1# peer chaincode install -n asset_mgmt -v 1.0 -p sacc CLIå®¹å™¨æ‰§è¡Œåˆ›å»ºçš„SignedChaincodeDeploymentSpec sacc ï¼Œå¹¶å°†å…¶å‘é€ç»™æœ¬åœ°peerï¼›æœ¬åœ°peerä¼šè°ƒç”¨LSCCä¸Šçš„å®‰è£…æ–¹æ³•ã€‚å¯¹-pé€‰é¡¹çš„å‚æ•°æŒ‡å®š äº†chaincodeçš„è·¯å¾„ï¼›å®ƒå¿…éœ€ä»¬ä½äºŽç”¨æˆ·çš„GOPATHçš„æºç æ ‘ä¸­ï¼Œä¾‹å¦‚ $GOPATH/src/sacc;ä¸ºäº†åœ¨peerä¸Šå®‰è£…ï¼Œç­¾ç½²çš„ææ¡ˆçš„ç­¾åå¿…éœ€æ¥è‡ªpeerçš„åœ°æœ¬MSPç®¡ç†å‘˜çš„ä¸€ä¸ªç­¾å chaincodeå®žä¾‹åŒ–å®žä¾‹åŒ–äº‹åŠ¡è°ƒç”¨ç”Ÿå‘½å‡»æœŸç³»ç»Ÿchaincode(LSCC)æ¥åˆ›å»ºå’Œåˆå§‹åŒ–ä¸€ä¸ªchannelçš„chaincode;è¿™æ˜¯ä¸€ä¸ªchaincode-chanelç»‘å®šè¿‡ç¨‹: chaincodeå¯ä»¥ç»‘å®šåˆ°ä»»æ„æ•°é‡çš„channelï¼Œå¹¶åˆ†åˆ«åœ¨æ¯ä¸ªchannelä¸Šç‹¬ç«‹æ“ä½œ;ä¸ç®¡chaincodeå®‰è£…å’Œå®žä¾‹åŒ–äº†å¤šå°‘ä¸ªå…¶ä»–channelï¼ŒçŠ¶æ€éƒ½è¢«éš”ç¦»åˆ°ä¸€ä¸ªäº‹åŠ¡æäº¤åˆ°channelä¸Š; å®žä¾‹åŒ–äº‹åŠ¡çš„åˆ›å»ºè€…å¿…éœ€æ»¡è¶³åœ¨SingedCDSä¸­åŒ…å«çš„chincodeçš„å®žä¾‹åŒ–ç­–ç•¥;å¹¶ä¸”è¯¥åˆ›å»ºè€…ä½œä¸ºåˆ›å»ºè¯¥channelé…ç½®ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå¿…éœ€æ˜¯channelä¸Šçš„ä¸€ä¸ªå†™å…¥è€…;è¿™å¯¹äºŽchannelçš„å®‰å…¨æ€§æ¥è¯´æ˜¯éžå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥é˜²æ­¢æ¶æ„å®žä½“éƒ¨ç½²chaincodeæˆ–æ¬ºéª—æˆå‘˜åœ¨ä¸€ä¸ªæœªç»‘å®šçš„channelä¸Šæ‰§è¡Œchaincode; ä¾‹å¦‚ï¼Œé»˜è®¤çš„å®žä¾‹åŒ–ç­–ç•¥æ˜¯ä»»ä½•channelçš„MSPç®¡ç†å‘˜ï¼Œå› æ­¤ä¸€ä¸ªchaincodeå®žä¾‹åŒ–äº‹åŠ¡çš„åˆ›å»ºè€…å¿…é¡»æ˜¯channelç®¡ç†å‘˜çš„æˆå‘˜;å½“äº‹åŠ¡ææ¡ˆåˆ°è¾¾èƒŒä¹¦(èŠ‚ç‚¹)çš„æ—¶å€™ï¼Œå®ƒå°†éªŒè¯åˆ›å»ºè€…çš„ç­¾åä¸Žå®žä¾‹åŒ–ç­–ç•¥; å¹¶ä¸”åœ¨å°†å…¶æäº¤ç»™è´¦æœ¬ä¹‹å‰;åœ¨äº‹åŠ¡éªŒè¯æœŸé—´å†æ¬¡æ‰§è¡Œæ­¤æ“ä½œ; å®žä¾‹åŒ–äº‹åŠ¡è¿˜ä¸ºchannel ä¸Šçš„chaincodeè®¾ç½®äº†èƒŒä¹¦ç­–ç•¥ã€‚èƒŒä¹¦ç­–ç•¥æè¿°äº†äº¤æ˜“ç»“æžœçš„è®¤è¯éœ€æ±‚;è¢«è¯¥channelçš„æ‰€æœ‰æˆå‘˜æ‰€æŽ¥å—; ä¾‹å¦‚,ä½¿ç”¨CLIå®žä¾‹åŒ–sacc chaincodeï¼Œå¹¶ä½¿ç”¨johnå’Œ0åˆå§‹åŒ–çŠ¶æ€ï¼Œå‘½ä»¤å¦‚ä¸‹: 1peer chaincode instantiate -n sacc -v 1.0 -c &apos;&#123;&quot;Args&quot;:[&quot;john&quot;,&quot;0&quot;]&#125;&apos; -P &quot;OR (&apos;Org1.member&apos;,&apos;Org2.member&apos;)&quot; ç­¾æ³¨ç­–ç•¥(CLIä½¿ç”¨æ³¢å…°è¡¨ç¤ºæ³•)ï¼Œå®ƒéœ€è¦æ¥è‡ªOrg1æˆ–Org2çš„ä»»æ„æˆå‘˜çš„æ”¯æŒä»¥æ”¯æŒæ‰€æœ‰çš„äº‹åŠ¡åˆ°saccã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºæ˜¯Org1è¿˜æ˜¯Org2éƒ½å¿…é¡»ç­¾ç½²åœ¨saccä¸Šæ‰§è¡Œè°ƒç”¨çš„ç»“æžœï¼Œä»¥ä½¿ç”¨äº‹åŠ¡æ˜¯æœ‰æ•ˆçš„ æ³¢å…°è¡¨ç¤ºæ³•(Polish notation,æˆ–æ³¢å…°è®°æ³•)ï¼Œæ˜¯ä¸€ç§é€»è¾‘ã€ç®—æœ¯å’Œä»£æ•°è¡¨ç¤ºæ–¹æ³•;å…¶ç‰¹ç‚¹æ˜¯æ“ä½œç¬¦ç½®äºŽæ“ä½œæ•°çš„å‰é¢,å› æ­¤ä¹Ÿç§°åšå‰ç¼€è¡¨ç¤ºæ³•;å¦‚æžœæ“ä½œç¬¦çš„å…ƒæ•°(arity)æ˜¯å›ºå®šçš„ï¼Œåˆ™è¯­æ³•ä¸Šä¸éœ€è¦æ‹¬å·ä»ç„¶èƒ½è¢«æ— æ­§ä¹‰çš„è§£æž;æ³¢å…°è®°æ³•æ˜¯æ³¢å…°æ•°å­¦å®¶æ‰¬. æ­¦å¡è°¢ç»´å¥‡1920å¹´ä»£å¼•å…¥çš„ã€‚ç”¨äºŽç®€åŒ–å‘½é¢˜é€»è¾‘; åœ¨chaincodeæˆåŠŸå®žä¾‹åŒ–ä¹‹åŽ,chaincodeåœ¨channelä¸Šè¿›å…¥æ´»è·ƒçŠ¶æ€;å¹¶å‡†å¤‡å¤„ç†ä»»ä½•èƒŒä¹¦äº‹åŠ¡ç±»æ­¦æŠ€çš„äº‹åŠ¡åè®®ã€‚ã€‚è¿™äº›äº‹åŠ¡æ˜¯å¹¶å‘å¤„ç†çš„ï¼Œå› ä¸ºå®ƒä»¬åˆ°è¾¾äº†èƒŒä¹¦peer; chaincodeå‡çº§ä»»ä½•æ—¶å€™ï¼Œchaincodeéƒ½å¯ä»¥é€šè¿‡æ›´æ”¹å…¶ç‰ˆæœ¬æ¥è¿›è¡Œå‡çº§ï¼Œè¿™æ˜¯SignedCDSçš„ä¸€éƒ¨åˆ†;å…¶ä»–éƒ¨åˆ†ï¼Œä¾‹å¦‚æ‰€æœ‰è€…å’Œå®žä¾‹åŒ–ç­–ç•¥æ˜¯å¯é€‰çš„ã€‚ä½†æ˜¯ï¼Œchaincodeçš„åç§°å¿…éœ€æ˜¯ç›¸åŒçš„;å¦åˆ™ï¼Œå®ƒå°†è¢«è§†ä¸ºå®Œå…¨ä¸åŒçš„chaincode; åœ¨å‡çº§ä¹‹å‰ï¼Œå¿…é¡»å°†chaincodeçš„æ–°ç‰ˆæœ¬å®‰è£…åœ¨éœ€è¦èƒŒä¹¦peerä¸Šï¼Œå‡çº§æ˜¯ä¸€ä¸ªç±»ä¼¼äºŽå®žä¾‹åŒ–äº‹åŠ¡çš„äº‹åŠ¡;å®ƒå°†chaincodeçš„æ–°ç‰ˆæœ¬ç»‘å®šåˆ°channelã€‚å…¶ä»–channelæ‰€ç»‘å®šçš„æ—§ç‰ˆæœ¬chaincodeå°†ä¼šç»§ç»­è¿è¡Œæ—§ç‰ˆçš„chaincodeï¼› æ¢å¥è¯è¯´ï¼Œå‡çº§äº‹åŠ¡åªä¼šä¸€æ¬¡å½±å“ ä¸€ä¸ªchannelï¼Œå³æäº¤äº‹åŠ¡çš„channel; æ³¨æ„:ç”±äºŽchaincodeçš„å¤šä¸ªç‰ˆæœ¬å¯èƒ½åŒæ—¶å¤„äºŽæ´»è·ƒçŠ¶æ€ï¼Œæ‰€ä»¥å‡çº§è¿‡ç¨‹ä¸ä¼šè‡ªåŠ¨åˆ é™¤æ—§ç‰ˆæœ¬ï¼›å› æ­¤ç”¨æˆ·å¿…éœ€æš‚æ—¶ç®¡ç†è¿™ä¸ªç‰ˆæœ¬; ä¸Žå®žä¾‹åŒ–äº‹åŠ¡ä¸€ä¸ªå¾®å¦™çš„åŒºåˆ«; å‡çº§äº‹åŠ¡æ˜¯æ ¹æ®å½“å‰çš„chaincode å®žä¾‹åŒ–ç­–ç•¥æ£€æŸ¥çš„ï¼Œè€Œä¸æ˜¯æ–°ç­–ç•¥;è¿™æ˜¯ä¸ºäº†ç¡®ä¿å½“å‰çš„å®žä¾‹åŒ–ç­–ç•¥ä¸­æŒ‡å®šçš„çŽ°æœ‰æˆå‘˜å¯ä»¥å‡çº§chaincode; åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨chaincode Initå‡½æ•°æ¥æ‰§è¡Œä»»ä½•ä¸Žæ•°æ® ç›¸å…³çš„æ›´æ–°æˆ–é‡æ–°åˆå§‹åŒ–å®ƒ;å› æ­¤åœ¨å‡çº§chaincodeæ—¶å¿…éœ€æ³¨æ„é¿å…é‡æ–°è®¾ç½®çŠ¶æ€; åœæ­¢å’Œå¯åŠ¨chaincodeåœæ­¢å’Œå¯åŠ¨ç”Ÿå‘½å‘¨æœŸäº‹åŠ¡è¿˜æ²¡æœ‰å®žçŽ°ã€‚ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡æ¯ä¸ªèƒŒä¹¦äººåˆ é™¤chaincodeå®¹å™¨å’ŒSignedCDSåŒ…æ¥æ‰‹åŠ¨åœæ­¢chaincodeè¿™æ˜¯é€šè¿‡peerèŠ‚ç‚¹è¿è¡Œçš„æ¯ä¸ªä¸»æœºæˆ–è™šæ‹Ÿæœºä¸Šåˆ é™¤chaincodeçš„å®¹å™¨æ¥å®Œæˆçš„,ç„¶åŽä»Žæ¯ä¸ªèƒŒä¹¦peerèŠ‚ç‚¹ ä¸Šåˆ é™¤SignedCDS TODO-ä¸ºäº†peerèŠ‚ç‚¹åˆ é™¤CDSï¼Œé¦–å…ˆéœ€è¦è¿›å…¥peerèŠ‚ç‚¹çš„å®¹å™¨ï¼Œæˆ‘ä»¬ç¡®å®žéœ€è¦æä¾›ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡ŒåŠŸèƒ½çš„å®žç”¨ç¨‹åºè„šæœ¬ 12#docker rm -f &lt;container id&gt;rm /var/hyperledger/production/chaincodes/&lt;ccname&gt;:&lt;ccversion&gt; Stopåœ¨å·¥ä½œiytkkæ˜¯æœ‰ç”¨çš„,å¯ä»¥æŽ§åˆ¶æ–¹å¼ä¸Šè¿›è¡Œå‡çº§ï¼Œåœ¨è¿›è¡Œå‡çº§ä¹‹å‰ï¼Œå¯ä»¥åœ¨æ‰€æœ‰peerä¸Šåœæ­¢ä¸€ä¸ªchaincode ; CLI(å®¢æˆ·ç«¯) å®˜æ–¹æ­£åœ¨è¯„ä¼°ä¸ºHyperledger Fabric peeräºŒè¿›åˆ¶æ–‡ä»¶åˆ†å‘ç‰¹å®šå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„éœ€æ±‚; ç›®å‰ï¼Œå¯ä»¥ç®€å•åœ°è¿è¡Œdodcker å®¹å™¨ä¸­è°ƒç”¨å‘½ä»¤; æŸ¥çœ‹å½“å‰çš„å¯ç”¨çš„CLIå‘½ä»¤ï¼Œè¿è¡Œçš„fabric-peer Dockerå®¹å™¨ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: 12# docker run -it hyperledger/fabric-peer bash# peer chaincode --help æ³¨: å¯ä½¿ç”¨docker exec -it cli (å®¹å™¨å) bashå‘½ä»¤è¿›å…¥cli ä¸Žä¸‹é¢ç±»ä¼¼çš„è¾“å‡º 12345678910111213141516171819202122232425262728293031323334Usage: peer chaincode [command]Available Commands: install Package the specified chaincode into a deployment spec and save it on the peer&apos;s path. instantiate Deploy the specified chaincode to the network. invoke Invoke the specified chaincode. package Package the specified chaincode into a deployment spec. query Query using the specified chaincode. signpackage Sign the specified chaincode package upgrade Upgrade chaincode.Flags: --cafile string Path to file containing PEM-encoded trusted certificate(s) for the ordering endpoint -C, --chainID string The chain on which this command should be executed (default &quot;testchainid&quot;) -c, --ctor string Constructor message for the chaincode in JSON format (default &quot;&#123;&#125;&quot;) -E, --escc string The name of the endorsement system chaincode to be used for this chaincode -l, --lang string Language the chaincode is written in (default &quot;golang&quot;) -n, --name string Name of the chaincode -o, --orderer string Ordering service endpoint -p, --path string Path to chaincode -P, --policy string The endorsement policy associated to this chaincode -t, --tid string Name of a custom ID generation algorithm (hashing and decoding) e.g. sha256base64 --tls Use TLS when communicating with the orderer endpoint -u, --username string Username for chaincode operations when security is enabled -v, --version string Version of the chaincode specified in install/instantiate/upgrade commands -V, --vscc string The name of the verification system chaincode to be used for this chaincodeGlobal Flags: --logging-level string Default logging level and overrides, see core.yaml for full syntax --test.coverprofile string Done (default &quot;coverage.cov&quot;)Use &quot;peer chaincode [command] --help&quot; for more information about a command.2018-03-20 07:55:59.840 UTC [main] main -&gt; INFO 003 Exiting..... å…¨å±€flags: â€“logging-level stringé»˜è®¤çš„æ—¥å¿—è®°å½•levelå’Œoverrides test.coverprofile string Done(default â€œcoverage.covâ€)-v ,â€“versionä½¿ç”¨â€peer chaincode [command] -helpâ€ èŽ·å–æ›´å¤šå…³äºŽå‘½ä»¤çš„ä¿¡æ¯;ä¸ºäº†æ–¹ä¾¿åœ¨è„šæœ¬åŒ–çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œpeerå‘½ä»¤æ€»æ˜¯åœ¨å‘ç”Ÿå‘½ä»¤å¤±è´¥æ—¶ç”Ÿæˆéžé›¶è¿”å›žä»£ç ; chaincodeå‘½ä»¤çš„ä¾‹å­: 123456peer chaincode install -n mycc -v 0 -p path/to/my/chaincode/v0peer chaincode instantiate -n mycc -v 0 -c &apos;&#123;&quot;Args&quot;:[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]&#125;&apos; -C mychannelpeer chaincode install -n mycc -v 1 -p path/to/my/chaincode/v1peer chaincode upgrade -n mycc -v 1 -c &apos;&#123;&quot;Args&quot;:[&quot;d&quot;, &quot;e&quot;, &quot;f&quot;]&#125;&apos; -C mychannelpeer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;e&quot;]&#125;&apos;peer chaincode invoke -o orderer.example.com:7050 --tls --cafile $ORDERER_CA -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&apos; ç³»ç»Ÿæ™ºèƒ½åˆçº¦(System chaincode)ç³»ç»Ÿchaincodeå…·æœ‰ç›¸åŒçš„ç¼–ç¨‹æ¨¡åž‹ï¼Œé™¤äº†å®ƒåœ¨peerè¿›ç¨‹ä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯æ™®é€šçš„chaincodeé‚£æ ·åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­è¿è¡Œ; å› æ­¤ï¼Œç³»ç»Ÿchaincodeè¢«æž„å»ºåˆ°peerä¸­å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”ä¸éµå¾ªä¸Šé¢æè¿°çš„ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸã€‚ç‰¹åˆ«æ˜¯å®‰è£…ã€å®žä¾‹åŒ–å’Œå‡çº§ å¹¶ä¸é€‚ç”¨äºŽç³»ç»Ÿchaincodeï¼› ç³»ç»Ÿchaincodeçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨peerå’Œchaincodeä¹‹é—´å‡å°‘gRPCçš„é€šä¿¡æˆæœ¬ï¼Œå¹¶æƒè¡¡ç®¡ç† çš„çµæ´»æ€§;ä¾‹å¦‚,ç³»ç»Ÿchaincodeåªèƒ½ç”¨peeräºŒè¿›åˆ¶è¿›è¡Œå‡çº§ã€‚å®ƒè¿˜å¿…é¡»æ³¨å†Œä¸€ä¸ªå›ºå®šçš„å‚æ•°é›†ï¼Œå¹¶ä¸”æ²¡æœ‰èƒŒä¹¦ç­–ç•¥æˆ–èƒŒä¹¦ç­–ç•¥çš„åŠŸèƒ½; ç³»ç»Ÿchaincodeç”¨äºŽHyperledger Fabricä»¥å®žçŽ°è®¸å¤šç³»ç»Ÿè¡Œä¸ºï¼Œä½¿å®ƒä»¬å¯ä»¥è¢«ç³»ç»Ÿé›†æˆæ‰€å–ä»£æˆ–ä¿®æ”¹; ç³»ç»Ÿchaincodeåˆ—è¡¨: 123451. LSCC(Lifecycle system chaincode): ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿchaindoeå¤„ç†ä¸Šæè¿°çš„ç”Ÿå‘½å‘¨æœŸè¯·æ±‚; 2. CSCC(Configuration system chaincode):é…ç½®ç³»ç»Ÿchaincodeåœ¨peerç«¯å¤„ç†channelé…ç½®; 3. QSCC(Query system chaincode): æŸ¥è¯¢ç³»ç»Ÿchaincodeæä¾›äº†åˆ†ç±»æŸ¥è¯¢api,ä¾‹å¦‚èŽ·å–å—å’Œäº‹åŠ¡; 4. ESCC(Query system chaincode): èƒŒä¹¦ç³»ç»Ÿchaincodeé€šè¿‡ç­¾ç½²äº‹åŠ¡ææ¡ˆå“åº”æ¥å¤„ç†æ”¯æŒ; 5. VSCC(Validation system chaincode): éªŒè¯ç³»ç»Ÿchaincodeå¤„ç†äº‹åŠ¡éªŒè¯,ç­–ç•¥å’Œå¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶; åœ¨ä¿®æ”¹æˆ–æ›¿æ¢è¿™äº›ç³»ç»Ÿchaincodeæ—¶å¿…éœ€æ³¨æ„,ç‰¹åˆ«æ˜¯LSCCã€ESCCå’ŒVSCCï¼Œå› ä¸ºå®ƒä»¬åœ¨ä¸»äº‹åŠ¡æ‰§è¡Œè·¯å¾„ ä¸­ï¼›å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“VSCCåœ¨å°†å…¶æäº¤åˆ°è´¦æœ¬ä¹‹å‰ä¸€ä¸ªå—ï¼Œé‡è¦çš„æ˜¯ï¼Œchannelä¸­çš„æ‰€æœ‰peerèŠ‚ç‚¹éƒ½è¦è®¡ç®—ç›¸åŒçš„éªŒè¯ï¼Œä»¥é¿å…è´¦æœ¬å·®å¼‚ã€‚å› æ­¤ï¼Œå¦‚æžœVSCCè¢«ä¿®æ”¹æˆ–æ›¿æ¢ï¼Œå°±éœ€è¦ç‰¹åˆ«çš„å¤„ç†å’Œç»´æŠ¤;]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MariaDBä¹‹SELECTè¯­æ³•ç»ƒä¹ ]]></title>
    <url>%2F2018%2F02%2F28%2FMariaDB%E4%B9%8BSELECT%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[ä¸€ ã€å¯¼å…¥hellodb.sqlç”Ÿæˆæ•°æ®åº“åŽå®žçŽ°ä»¥ä¸‹æ“ä½œ1# mysql -uroot -h172.16.23.23 -pcento.123 &lt; hellodb.sql 123456789101112mysql&gt; SHOW DATABASES; #å¯ä»¥åˆ—å‡ºå·²å­˜åœ¨çš„æ•°æ®åº“ +--------------------+| Database |+--------------------+| information_schema || NODE1 || RJYY || hellodb || mysql || performance_schema || test |+--------------------+ 12345678910111213mysql&gt; USE hellodb;mysql&gt; SHOW TABLES; +-------------------+| Tables_in_hellodb |+-------------------+| classes || coc || courses || scores || students || teachers || toc |+-------------------+ 1ã€ åœ¨studentsè¡¨ä¸­ï¼ŒæŸ¥è¯¢å¹´é¾„å¤§äºŽ25å²ï¼Œä¸”ä¸ºç”·æ€§çš„åŒå­¦çš„åå­—å’Œå¹´é¾„ï¼›123456789101112mysql&gt; SELECT Name,Age FROM students WHERE Age &gt;25 AND Gender='M'; +--------------+-----+| Name | Age |+--------------+-----+| Xie Yanke | 53 || Ding Dian | 32 || Yu Yutong | 26 || Shi Qing | 46 || Tian Boguang | 33 || Xu Xian | 27 || Sun Dasheng | 100 |+--------------+-----+ 2ã€ ä»¥ClassIDä¸ºåˆ†ç»„ä¾æ®ï¼Œæ˜¾ç¤ºæ¯ç»„çš„å¹³å‡å¹´é¾„ï¼›123456789101112mysql&gt; SELECT avg(age),ClassID FROM students WHERE ClassID IS NOT NULL GROUP BY ClassID ;+----------+---------+| avg(age) | ClassID |+----------+---------+| 20.5000 | 1 || 36.0000 | 2 || 20.2500 | 3 || 24.7500 | 4 || 46.0000 | 5 || 20.7500 | 6 || 19.6667 | 7 |+----------+---------+ 3ã€ æ˜¾ç¤ºç¬¬2é¢˜ä¸­å¹³å‡å¹´é¾„å¤§äºŽ30çš„åˆ†ç»„åŠå¹³å‡å¹´é¾„ï¼›1234567mysql&gt; SELECT avg(Age),ClassID FROM students WHERE ClassID IS NOT NULL GROUP BY ClassID HAVING avg(Age) &gt; 30;+----------+---------+| avg(Age) | ClassID |+----------+---------+| 36.0000 | 2 || 46.0000 | 5 |+----------+---------+ 4ã€ æ˜¾ç¤ºä»¥Lå¼€å¤´çš„åå­—çš„åŒå­¦çš„ä¿¡æ¯ï¼›12345678mysql&gt; SELECT * FROM students WHERE Name LIKE 'L%';+-------+-------------+-----+--------+---------+-----------+| StuID | Name | Age | Gender | ClassID TeacherID |+-------+-------------+-----+--------+---------+-----------+| 8 | Lin Daiyu | 17 | F | 7 | NULL || 14 | Lu Wushuang | 17 | F | 3 | NULL || 17 | Lin Chong | 25 | M | 4 | NULL |+-------+-------------+-----+--------+---------+-----------+ 5ã€ æ˜¾ç¤ºTeacherIDéžç©ºçš„åŒå­¦çš„ç›¸å…³ä¿¡æ¯ï¼›12345678910mysql&gt; SELECT * FROM students WHERE TeacherID IS NOT NULL; +-------+-------------+-----+--------+---------+-----------+| StuID | Name | Age | Gender | ClassID | TeacherID |+-------+-------------+-----+--------+---------+-----------+| 1 | Shi Zhongyu | 22 | M | 2 | 3 || 2 | Shi Potian | 22 | M | 1 | 7 || 3 | Xie Yanke | 53 | M | 2 | 16 || 4 | Ding Dian | 32 | M | 4 | 4 || 5 | Yu Yutong | 26 | M | 3 | 1 |+-------+-------------+-----+--------+---------+-----------+ 6ã€ ä»¥å¹´é¾„æŽ’åºåŽï¼Œæ˜¾ç¤ºå¹´é¾„æœ€å¤§çš„å‰10ä½åŒå­¦çš„ä¿¡æ¯ï¼›123456789101112131415mysql&gt; SELECT * FROM students ORDER BY Age DESC LIMIT 10;+-------+--------------+-----+--------+---------+-----------+| StuID | Name | Age | Gender | ClassID | TeacherID |+-------+--------------+-----+--------+---------+-----------+| 25 | Sun Dasheng | 100 | M | NULL | NULL || 3 | Xie Yanke | 53 | M | 2 | 16 || 6 | Shi Qing | 46 | M | 5 | NULL || 13 | Tian Boguang | 33 | M | 2 | NULL || 4 | Ding Dian | 32 | M | 4 | 4 || 24 | Xu Xian | 27 | M | NULL | NULL || 5 | Yu Yutong | 26 | M | 3 | 1 || 17 | Lin Chong | 25 | M | 4 | NULL || 23 | Ma Chao | 23 | M | 4 | NULL || 18 | Hua Rong | 23 | M | 7 | NULL |+-------+--------------+-----+--------+---------+-----------+ 7ã€ æŸ¥è¯¢å¹´é¾„å¤§äºŽç­‰äºŽ20å²ï¼Œå°äºŽç­‰äºŽ25å²çš„åŒå­¦çš„ä¿¡æ¯ï¼›ç”¨ä¸‰ç§æ–¹æ³•ï¼›1234567891011121314151617mysql&gt; SELECT * FROM students WHERE Age &gt;=20 AND Age &lt;=25; mysql&gt; SELECT * FROM students WHERE Age BETWEEN 20 AND 25; mysql&gt; SELECT * FROM students WHERE Age IN (20,21,22,23,24,25);+-------+---------------+-----+--------+---------+-----------+| StuID | Name | Age | Gender | ClassID | TeacherID |+-------+---------------+-----+--------+---------+-----------+| 1 | Shi Zhongyu | 22 | M | 2 | 3 || 2 | Shi Potian | 22 | M | 1 | 7 || 9 | Ren Yingying | 20 | F | 6 | NULL || 11 | Yuan Chengzhi | 23 | M | 6 | NULL || 16 | Xu Zhu | 21 | M | 1 | NULL || 17 | Lin Chong | 25 | M | 4 | NULL || 18 | Hua Rong | 23 | M | 7 | NULL || 21 | Huang Yueying | 22 | F | 6 | NULL || 22 | Xiao Qiao | 20 | F | 1 | NULL || 23 | Ma Chao | 23 | M | 4 | NULL |+-------+---------------+-----+--------+---------+-----------+ äºŒã€ å¯¼å…¥hellodb.sqlï¼Œä»¥ä¸‹æ“ä½œåœ¨studentsè¡¨ä¸Šæ‰§è¡Œ1ã€ä»¥ClassIDåˆ†ç»„ï¼Œæ˜¾ç¤ºæ¯ç­çš„åŒå­¦çš„äººæ•°ï¼›12345678910111213mysql&gt; SELECT count(StuID),ClassID FROM students GROUP BY ClassID ; +--------------+---------+ | count(StuID) | ClassID |+--------------+---------+| 2 | NULL || 4 | 1 || 3 | 2 || 4 | 3 || 4 | 4 || 1 | 5 || 4 | 6 || 3 | 7 |+--------------+---------+ 2ã€ä»¥Genderåˆ†ç»„ï¼Œæ˜¾ç¤ºå…¶å¹´é¾„ä¹‹å’Œï¼›1234567mysql&gt; SELECT sum(Age),Gender FROM students GROUP BY Gender ;+----------+--------+| sum(Age) | Gender |+----------+--------+| 190 | F || 495 | M |+----------+--------+ 3ã€ä»¥ClassIDåˆ†ç»„ï¼Œæ˜¾ç¤ºå…¶å¹³å‡å¹´é¾„å¤§äºŽ25çš„ç­çº§ï¼›12345678mysql&gt; SELECT avg(Age),ClassID FROM students GROUP BY ClassID HAVING avg(Age) &gt; 25;+----------+---------+| avg(Age) | ClassID |+----------+---------+| 63.5000 | NULL || 36.0000 | 2 || 46.0000 | 5 |+----------+---------+ 4ã€ä»¥Genderåˆ†ç»„ï¼Œæ˜¾ç¤ºå„ç»„ä¸­å¹´é¾„å¤§äºŽ25çš„å­¦å‘˜çš„å¹´é¾„ä¹‹å’Œï¼›123456mysql&gt; SELECT sum(Age),Gender FROM students WHERE Age &gt; 25 GROUP BY Gender ;+----------+--------+| sum(Age) | Gender |+----------+--------+| 317 | M |+----------+--------+ ä¸‰ã€ å¯¼å…¥hellodb.sqlï¼Œå®Œæˆä»¥ä¸‹é¢˜ç›®ï¼š1ã€æ˜¾ç¤ºå‰5ä½åŒå­¦çš„å§“åã€è¯¾ç¨‹åŠæˆç»©ï¼›12345678910111213141516171819mysql&gt; SELECT s.Name,courses.Course,scores.Score FROM (select * from students limit 5) AS s LEFT JOIN scores ON scores.StuID = s.StuID LEFT JOIN courses ON scores.CourseID =courses.CourseID;mysql&gt; SELECT s.name,sc.course,sc.score FROM (SELECT * FROM students LIMIT 5 ) AS s LEFT JOIN (SELECT scores.stuid,courses.course,scores.score FROM scores LEFT JOIN courses ON courses.CourseID=scores.CourseID)AS sc ON s.StuId=sc.StuID;+-------------+----------------+-------+| name | course | score |+-------------+----------------+-------+| Shi Zhongyu | Kuihua Baodian | 77 || Shi Zhongyu | Weituo Zhang | 93 || Shi Potian | Kuihua Baodian | 47 || Shi Potian | Daiyu Zanghua | 97 || Xie Yanke | Kuihua Baodian | 88 || Xie Yanke | Weituo Zhang | 75 || Ding Dian | Daiyu Zanghua | 71 || Ding Dian | Kuihua Baodian | 89 || Yu Yutong | Hamo Gong | 39 || Yu Yutong | Dagou Bangfa | 63 |+-------------+----------------+-------+ 2ã€æ˜¾ç¤ºå…¶æˆç»©é«˜äºŽ80çš„åŒå­¦çš„åç§°åŠè¯¾ç¨‹ï¼›1234567891011121314mysql&gt; SELECT Name,Course,Score FROM (students LEFT JOIN scores ON students.StuID=scores.StuID ) LEFT JOIN courses ON courses.CourseID=scores.CourseID WHERE Score &gt; 80; +-------------+----------------+-------+| Name | Course | Score |+-------------+----------------+-------+| Shi Zhongyu | Weituo Zhang | 93 || Shi Potian | Daiyu Zanghua | 97 || Xie Yanke | Kuihua Baodian | 88 || Ding Dian | Kuihua Baodian | 89 || Shi Qing | Hamo Gong | 96 || Xi Ren | Hamo Gong | 86 || Xi Ren | Dagou Bangfa | 83 || Lin Daiyu | Jinshe Jianfa | 93 |+-------------+----------------+-------+ 3ã€æ±‚å‰8ä½åŒå­¦æ¯ä½åŒå­¦è‡ªå·±ä¸¤é—¨è¯¾çš„å¹³å‡æˆç»©ï¼Œå¹¶æŒ‰é™åºæŽ’åˆ—ï¼›1234567891011121314mysql&gt; SELECT Name,avg(Score) FROM (SELECT * FROM students LIMIT 8) AS rj LEFT JOIN scores ASjr ON rj.StuID=jr.StuID GROUP BY Name ORDER BY avg(Score) DESC;+-------------+------------+| Name | avg(Score) |+-------------+------------+| Shi Qing | 96.0000 || Shi Zhongyu | 85.0000 || Xi Ren | 84.5000 || Xie Yanke | 81.5000 || Ding Dian | 80.0000 || Lin Daiyu | 75.0000 || Shi Potian | 72.0000 || Yu Yutong | 51.0000 |+-------------+------------+ 4ã€æ˜¾ç¤ºæ¯é—¨è¯¾ç¨‹è¯¾ç¨‹åç§°åŠå­¦ä¹ äº†è¿™é—¨è¯¾çš„åŒå­¦çš„ä¸ªæ•°ï¼›123456789101112mysql&gt; SELECT courses.Course,count(rj.StuID) FROM scores AS rj LEFT JOIN courses ON courses.CourseID=rj.CourseID GROUP BY rj.CourseID;+----------------+-----------------+| Course | count(rj.StuID) |+----------------+-----------------+| Hamo Gong | 3 || Kuihua Baodian | 4 || Jinshe Jianfa | 1 || Taiji Quan | 1 || Daiyu Zanghua | 2 || Weituo Zhang | 2 || Dagou Bangfa | 2 |+----------------+-----------------+ å››ã€æ€è€ƒé¢˜1ã€å¦‚ä½•æ˜¾ç¤ºå…¶å¹´é¾„å¤§äºŽå¹³å‡å¹´é¾„çš„åŒå­¦çš„åå­—ï¼Ÿ12345678910mysql&gt; SELECT Name,Age FROM students WHERE Age &gt; (SELECT avg(Age) FROM students);+--------------+-----+| Name | Age |+--------------+-----+| Xie Yanke | 53 || Ding Dian | 32 || Shi Qing | 46 || Tian Boguang | 33 || Sun Dasheng | 100 |+--------------+-----+ 2ã€å¦‚ä½•æ˜¾ç¤ºå…¶å­¦ä¹ çš„è¯¾ç¨‹ä¸ºç¬¬1ã€2ï¼Œ4æˆ–ç¬¬7é—¨è¯¾çš„åŒå­¦çš„åå­—ï¼Ÿ123456789101112131415mysql&gt; SELECT rj.Name,scores.CourseID FROM students AS rj LEFT JOIN scores ON scores.StuID = rj.StuID WHERE scores.CourseID IN (1,2,4,7);+-------------+----------+| Name | CourseID |+-------------+----------+| Shi Zhongyu | 2 || Shi Potian | 2 || Xie Yanke | 2 || Ding Dian | 2 || Yu Yutong | 1 || Yu Yutong | 7 || Shi Qing | 1 || Xi Ren | 1 || Xi Ren | 7 || Lin Daiyu | 4 |+-------------+----------+ 3ã€å¦‚ä½•æ˜¾ç¤ºå…¶æˆå‘˜æ•°æœ€å°‘ä¸º3ä¸ªçš„ç­çº§çš„åŒå­¦ä¸­å¹´é¾„å¤§äºŽåŒç­åŒå­¦å¹³å‡å¹´é¾„çš„åŒå­¦ï¼Ÿ123456789101112131415mysql&gt; SELECT students.name,students.age,tp.classid,tp.vg FROM students,(SELECT classid,COUNT(stuid) AS cs,AVG(age) AS vg FROM students GROUP BY classid HAVING cs &gt;=3) AS tp WHERE students.age&gt;tp.vg AND students.classid=tp.classid;+---------------+-----+---------+---------+| name | age | classid | vg |+---------------+-----+---------+---------+| Shi Potian | 22 | 1 | 20.5000 || Xie Yanke | 53 | 2 | 36.0000 || Ding Dian | 32 | 4 | 24.7500 || Yu Yutong | 26 | 3 | 20.2500 || Yuan Chengzhi | 23 | 6 | 20.7500 || Xu Zhu | 21 | 1 | 20.5000 || Lin Chong | 25 | 4 | 24.7500 || Hua Rong | 23 | 7 | 19.6667 || Huang Yueying | 22 | 6 | 20.7500 |+---------------+-----+---------+---------+ 4ã€ç»Ÿè®¡å„ç­çº§ä¸­å¹´é¾„å¤§äºŽå…¨æ ¡åŒå­¦å¹³å‡å¹´é¾„çš„åŒå­¦ã€‚12345678910mysql&gt; SELECT rj.Name,rj.Age FROM students AS rj LEFT JOIN classes AS jr ON rj.ClassID=jr.ClassID WHERE rj.ClassID=jr.ClassID AND Age &gt; (SELECT AVG(Age) FROM students);+--------------+-----+| Name | Age |+--------------+-----+| Xie Yanke | 53 || Ding Dian | 32 || Shi Qing | 46 || Tian Boguang | 33 |+--------------+-----+]]></content>
      <tags>
        <tag>database</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Žå¤´å¼€å§‹äº†è§£Hyperledger]]></title>
    <url>%2F2018%2F02%2F15%2Fhyperledger%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[ä»Žå¤´å¼€å§‹äº†è§£Hyperledger Hyperledgerè¯æ±‡è¡¨ Anchor Peer -é”šèŠ‚ç‚¹ é”šèŠ‚ç‚¹æ˜¯é€šé“ä¸­èƒ½è¢«æ‰€æœ‰å¯¹ç­‰èŠ‚ç‚¹æŽ¢æµ‹ã€å¹¶èƒ½ä¸Žä¹‹è¿›è¡Œé€šä¿¡çš„ä¸€ç§å¯¹ç­‰èŠ‚ç‚¹;é€šé“ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½æœ‰ä¸€ä¸ª(æˆ–è€…å¤šä¸ªï¼Œä»¥é˜²å•ç‚¹æ•…éšœ) é”šèŠ‚ç‚¹ ;å…è®¸å±žäºŽä¸åŒæˆå‘˜èº«ä»½çš„èŠ‚ç‚¹æ¥å‘çŽ°é€šé“ä¸­å­˜åœ¨çš„å…¶å®ƒèŠ‚ç‚¹; Block - åŒºå— åœ¨ä¸€ä¸ªé€šé“ä¸Šï¼Œ(åŒºå—æ˜¯)ä¸€ç»„æœ‰åºäº¤æ˜“çš„é›†åˆ;åŒºå—å¾€å¾€é€šè¿‡å¯†ç å­¦æ‰‹æ®µ(Hashå€¼)è¿žæŽ¥åˆ°å‰å¯¼åŒºå—;åŒºå—æ˜¯ä¸€ç»„æœ‰åºçš„äº¤æ˜“é›†åˆï¼Œåœ¨é€šé“ä¸­ç»è¿‡åŠ å¯†ç (å“ˆå¸ŒåŠ å¯†ï¼ŒåŽä¸Žå‰åºåŒºå—è¿žæŽ¥)ï¼› Chain - é“¾ chainå°±æ˜¯blockä¹‹é—´ä»¥hashè¿žæŽ¥ä¸ºç»“æž„çš„äº¤æ˜“æ—¥å¿—ã€‚peerä»Žorder serviceæŽ¥æ”¶äº¤æ˜“block;å¹¶æ ¹æ®èƒŒä¹¦ç­–å’Œå¹¶å‘å†²çªæ ‡è®°blockä¸Šäº¤æ˜“æ˜¯å¦æœ‰æ•ˆ;ç„¶åŽå°†è¯¥blockè¿½å›žåˆ°pperæ–‡ä»¶ç³»ç»Ÿä¸­çš„hash chain å¸æœ¬çš„é“¾æ˜¯ä¸€ä¸ªäº¤æ˜“åŒºå—ç»è¿‡â€å“ˆå¸Œè¿žæŽ¥â€ç»“æž„åŒ–çš„äº¤æ˜“æ—¥å¿—;å¯¹ç­‰èŠ‚ç‚¹ä»ŽæŽ’åºæœåŠ¡æ”¶åˆ°äº¤äº¤æ˜“åŒºå—;åŸºäºŽèƒŒä¹¦ç­–ç•¥å’Œå¹¶å‘å†²çªæ¥æ ‡æ³¨åŒºå—çš„äº¤æ˜“ä¸ºæœ‰æ•ˆæˆ–è€…æ— æ•ˆçŠ¶æ€;å¹¶ä¸”å°†åŒºå—è¿½å›žåˆ°ç­‰ç»“ç‚¹æ–‡ä»¶ç³»ç»Ÿçš„å“ˆå¸Œé“¾ä¸­; Chaincode-é“¾ç  é“¾ç æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å¸æœ¬ä¸Šçš„è½¯ä»¶ï¼Œå®ƒå¯ä»¥å¯¹èµ„äº§è¿‡è¡Œç¼–ç ;å…¶ä¸­çš„äº¤æ˜“æŒ‡ä»¤(æˆ–è€…å«ä¸šåŠ¡é€»è¾‘)ä¹Ÿå‘†ä»¥ç”¨æ¥ä¿®æ”¹èµ„äº§; Channel-é€šé“ é€šé“æ˜¯æž„å»ºåœ¨â€Fabricâ€ç½‘ç»œä¸Šçš„ç§æœ‰åŒºå—é“¾ï¼Œå®žçŽ°äº†æ•°æ®çš„éš”ç¦»å’Œä¿å¯†;é€šé“ç‰¹å®šçš„å¸æœ¬åœ¨é€šé“ä¸­æ˜¯ä¸Žæ‰€æœ‰å¯¹ç­‰èŠ‚ç‚¹å…±äº«çš„;å¹¶ä¸”äº¤æ˜“æ–¹å¿…é¡»é€šè¿‡è¯¥é€šé“çš„æ­£ç¡®éªŒè¯æ‰èƒ½ä¸Žè´¦æœ¬è¿›è¡Œäº¤äº’;é€šé“æ˜¯ç”±ä¸€ä¸ªâ€é…ç½®å—â€æ¥å®šä¹‰çš„; Commitment-æäº¤ ä¸€ä¸ªé€šé“ä¸­çš„æ¯ä¸ªå¯¹ç­‰èŠ‚ç‚¹éƒ½ä¼šéš¾äº¤æ˜“çš„æœ‰åºåŒºå—ï¼Œç„¶åŽå°†åŒºå—æäº¤è‡³è¯¥é€šé“ä¸Šå¸æœ¬çš„å„ä¸ªå‰¯æœ¬;å¯¹ç­‰èŠ‚ç‚¹ä¹Ÿä¼šç¥¨æˆ¿æ¯ä¸ªåŒºå—ä¸­çš„æ¯ç¬”äº¤æ˜“çš„çŠ¶æ€ æ˜¯æœ‰æ•ˆæˆ–è€…æ— æ•ˆ; Concurrency Control Version Check- å¹¶å‘æŽ§åˆ¶ç‰ˆæœ¬æ£€æŸ¥(CCVC) CCVCæ˜¯ä¿æŒé€šé“ä¸­å„å¯¹ç­‰èŠ‚ç‚¹çŠ¶æ€åŒæ­¥çš„ä¸€ç§æ–¹æ³•ã€‚å¯¹ç­‰èŠ‚ç‚¹å¹¶è¡Œçš„äº¤æ˜“ï¼›åœ¨äº¤æ˜“æäº¤åˆ°å¸æœ¬ä¹‹å‰ï¼Œå¯¹ç­‰èŠ‚ç‚¹ä¼šæ£€æŸ¥äº¤æ˜“åœ¨æ‰§è¡ŒæœŸé—´è¯»åˆ°çš„æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹;å¦‚æžœè¯»å–çš„æ•°æ®åœ¨æ‰§è¡Œå’Œæäº¤ä¹‹é—´è¢«æ”¹å˜ï¼Œå°±ä¼šå¼•å‘CCVCå†²çª;è¯¥äº¤æ˜“å°±ä¼šåœ¨å¸æœ¬ä¸­è¢«æ ‡è®°ä¸ºæ— æ•ˆï¼Œè€Œä¸”å€¼ä¸ä¼šæ›´æ–°åˆ°çŠ¶æ€æ•°æ®åº“; Configuration Block - é…ç½®åŒºå— åŒ…å«ä¸ºç³»ç»Ÿé“¾(æŽ’åºæœåŠ¡)æˆ–é€šé“å®šä¹‰æˆå‘˜å’Œç­–ç•¥çš„é…ç½®æ•°æ®ã€‚å¯¹æŸä¸ªé€šé“æˆ–æ•´ä¸ªç½‘ç»œçš„ä¿®æ”¹;(æ¯”å¦‚ï¼Œæˆå‘˜ç¦»å¼€æˆ–åŠ å…¥)éƒ½å°†å¯¼è‡´ç”Ÿæˆä¸€ä¸ªæ–°çš„é…ç½®åŒºå—å¹¶è¿½å›žåˆ°é€‚å½“çš„é“¾ä¸Š;è¿™ä¸ªé…ç½®åŒºå—ä¼šåŒ…å«åˆ›å§‹åŒºå—çš„å†…å®¹åŠ ä¸Šå¢žé‡; Consensus - å…±è¯† å…±è¯†æ˜¯è´¯ç©¿æ•´ä¸ªäº¤æ˜“æµç¨‹çš„å¹¿ä¹‰æœ¯è¯­ï¼Œå…¶ç”¨äºŽäº§ç”Ÿä¸ªå¯¹äºŽæŽ’åºçš„åŒæ„ä¹¦å’Œç¡®è®¤æž„æˆåŒºå—çš„äº¤æ˜“é›†çš„æ­£ç¡®æ€§; Current State -å½“å‰çŠ¶æ€ ledgerçš„current stateè¡¨ç¤ºå…¶chainäº¤æ˜“logä¸­æ‰€æœ‰keyçš„æœ€æ–°å€¼ã€‚peerä¼šå°†å¤„ç†è¿‡çš„blockä¸­çš„æ¯ä¸ªäº¤æ˜“;å¯¹åº”çš„ä¿®æ”¹valueæäº¤åˆ°ledgerå’Œcurrent stateã€‚ç”±äºŽcurrent state è¡¨ç¤ºchannelæ‰€çŸ¥çš„æ‰€æœ‰æœ€æ–°çš„k-v;æ‰€ä»¥current stateä¹Ÿè¢«ç§°ä¸ºWorld State. Chaincodeæ‰§è¡Œäº¤æ˜“proposalå°±æ˜¯é’ˆå¯¹çš„current state; Dynamic Membership -åŠ¨æ€æˆå‘˜ Fabricæ”¯æŒåŠ¨æ€æ·»åŠ -ç§»é™¤memberã€peer å’ŒorderingæœåŠ¡èŠ‚ç‚¹ï¼Œè€Œä¸ä¼šå½±å“æ•´ä¸ªç½‘ç»œçš„æ“ä½œæ€§;å½“ä¸šåŠ¡å…³ç³»è°ƒæ•´æˆ–å› å„ç§åŽŸå› éœ€æ·»åŠ -ç§»é™¤å®žä½“æ—¶ï¼ŒDynamic Membership è‡³å…³é‡è¦ï¼› Endorsement-èƒŒä¹¦ Endorsementæ˜¯æŒ‡ä¸€ä¸ªpeeræ‰§è¡Œä¸€ä¸ªäº¤æ˜“å¹¶è¿”å›žYES-NOç»™ç”Ÿæˆäº¤æ˜“proposalçš„client appçš„è¿‡ç¨‹;chaincodeå…·æœ‰ç›¸åº”çš„endorsement policies.å…¶ä¸­æŒ‡å®šäº†endorsing peer; Endorsement plolicy - èƒŒä¹¦ç­–ç•¥ Endorsement policyå®šä¹‰äº†ä¾èµ–äºŽç‰¹å®šchaincodeæ‰§è¡Œäº¤æ˜“çš„channelä¸Šçš„peerå’Œå“åº”ç»“æžœ;(endorsements) çš„å¿…è¦ç»„åˆæ¡ä»¶(å³åå›žYesæˆ–NOçš„æ¡ä»¶)ã€‚ Endorsement policyå¯ä»¥æŒ‡å®šå¯¹äºŽæŸä¸€chaincode;å¯ä»¥å¯¹äº¤æ˜“èƒŒä¹¦çš„æœ€å°èƒŒä¹¦èŠ‚ç‚¹æˆ–è€…æœ€å°èƒŒä¹¦èŠ‚ç‚¹ç™¾åˆ†æ¯”;èƒŒä¹¦ç­–ç•¥ç”±èƒŒä¹¦èŠ‚ç‚¹åŸºäºŽåº”ç”¨ç¨‹åºå’Œå¯¹æŠµå¾¡ä¸è‰¯è¡Œä¸ºçš„æœŸæœ›æ°´æ¥æ¥ç»„ç»‡ç®¡ç†;åœ¨installå’Œinstantiate Chaincode (deploy tx)æ—¶éœ€è¦æŒ‡å®šèƒŒä¹¦ç­–ç•¥; Fabric-ca Fabric-caæ˜¯é»˜è®¤çš„è¯ä¹¦ç®¡ç†ç»„ä»¶ï¼Œå®ƒå‘ç½‘ç»œæˆå‘˜åŠå…¶ç”¨æˆ·é¢å‘åŸºäºŽPKIçš„è¯ä¹¦;CAä¸ºæ¯ä¸ªæˆå‘˜é¢å‘ä¸€ä¸ªæ ¹è¯ä¹¦(RootCert),ä¸ºæ¯ä¸ªæŽˆæƒç”¨æˆ·é¢å‘ä¸€ä¸ªæ³¨å†Œè¯ä¹¦(eCert);ä¸ºæ¯ä¸ªæ³¨å†Œè¯ä¹¦é¢å‘å¤§é‡äº¤æ˜“è¯ä¹¦(tCerts); Genesis Block - åˆå§‹åŒºå— Genesis Blockæ˜¯åˆå§‹åŒ–åŒºå—é“¾ç½‘ç»œæˆ–channelçš„é…ç½®å—ï¼Œä¹Ÿæ˜¯é“¾ä¸Šçš„æ¯ä¸€ä¸ªåŒºå—; Gossip Protocol - Gossip åè®® Gossiopæ•°æ®ä¼ è¾“åè®®æœ‰ä¸‰é¡¹åŠŸèƒ½ 1.ç®¡ç†peerå‘å’Œchannelæˆå‘˜;2.channelä¸Šçš„æ‰€æœ‰peeré—´å¹¿æ’­å¸æœ¬æ•°æ®;3.channelä¸Šçš„æ‰€æœ‰peeré—´åŒæ­¥æ”¶æœ¬æ•°æ®; Initialize- åˆå§‹åŒ– ä¸€ä¸ªåˆå§‹åŒ–chaincodeç¨‹åºçš„æ–¹æ³•; Install -å®‰è£… å°†chaincodeæ”¾åˆ°peerçš„æ–‡ä»¶ç³»ç»Ÿçš„è¿‡ç¨‹; Instantiate - å®žä¾‹åŒ– å¯åŠ¨chaincodeå®¹å™¨çš„è¿‡ç¨‹; Invoke - è°ƒç”¨ ç”¨äºŽè°ƒç”¨ chaincodeå†…çš„å‡½æ•°; Chaincode invokeå°±æ˜¯ä¸€ä¸ªäº¤æ˜“proposal;ç„¶åŽæ‰§è¡Œæ¨¡å—åŒ–çš„æµç¨‹(èƒŒä¹¦ã€å…±è¯†ã€éªŒè¯ã€æäº¤);invokeçš„ç»“æž„å°±æ˜¯ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå‚æ•°æ•°ç»„; Leading Peer - ä¸»å¯¼èŠ‚ç‚¹ æ¯ä¸€ä¸ªMemberåœ¨å…¶è®¢é˜…çš„channelä¸Šå¯ä»¥æ‹¥æœ‰å¤šä¸ªpeerï¼›å…¶ä¸­ä¸€ä¸ªpeerä¼šä½œä¸ºchanelçš„leading peer ä»£è¡¨è¯¥Memberä¸Žordering service é€šä¿¡;ordering service å°†blockä¼ é€’ç»™leading peerdï¼Œ è¯¥peerå†å°†æ­¤blockåˆ†å‘ç»™åŒä¸€memerä¸‹çš„å…¶ä»–peer; Ledger - å¸æœ¬ Ledgeræ˜¯ä¸ªchannelçš„chainå’Œç”±channelä¸­æ¯ä¸ªpeerç»´æŠ¤ çš„world stateï¼› Member- æˆå‘˜ æ‹¥æœ‰ç½‘ç»œå”¯ä¸€æ ¹è¯ä¹¦çš„åˆæ³•ç‹¬ç«‹å®žä½“ã€‚åƒpeerèŠ‚ç‚¹å’Œapp clientè¿™æ ·çš„ç½‘ç»œç»„ä»¶ä¼šé“¾æŽ¥åˆ°ä¸€ä¸ªMember; Membership Service Provider -MSP MSPæ˜¯æŒ‡ä¸ºclientå’Œpeeræä¾›è¯ä¹¦çš„ç³»ç»ŸæŠ½è±¡çº¿ä»¶ã€‚Cientç”¨è¯ä¹¦æ¥è°ä»–ä»¬çš„äº¤æ˜“;peerç”¨è¯ä¹¦è®¤è¯å…¶äº¤æ˜“èƒŒä¹¦ã€‚è¯¥æŽ¥å£ä¸Žç³»ç»Ÿçš„äº¤æ˜“å¤„ç†ç»„ä»¶å¯†åˆ‡ç›¸å…³;æ—¨åœ¨ä½¿å·²å®šä¹‰çš„æˆå‘˜èº«ä»½æœåŠ¡ç»„ä»¶ä»¥è¿™ç§æ–¹å¼é¡ºåˆ©æŒºå¥½å…¥è€Œä¸ä¼šä¿®æ”¹ç³»ç»Ÿçš„äº¤æ˜“å¤„ç†ç»„ä»¶çš„æ ¸å¿ƒ; Membership Services - æˆå‘˜æœåŠ¡ æˆå‘˜æœåŠ¡åœ¨è®¸å¯çš„åŒºå—é“¾ç½‘ç»œä¸Šè®¤è¯ã€æŽˆæƒå’Œç®¡ç†èº«ä»½ ;åœ¨peerå’Œorderè¿è¡Œçš„æˆå‘˜æœåŠ¡çš„ä»£ç è€…ä¼šè®¤è¯å’ŒæŽˆæƒåŒºå—é“¾æ“ä½œ;å®ƒæ˜¯åŸºäºŽPKIçš„MSPå®žçŽ°; fabric-caç»„ä»¶å®žçŽ°äº†æˆå‘˜æœåŠ¡ï¼Œæ¥ç®¡ç†èº«ä»½ã€‚ç‰¹åˆ«çš„ï¼Œå®ƒå¤„ç†ECertå’ŒTCertçš„é¢å‘å’Œæ’¤é”€; ECertæ˜¯é•¿æœŸçš„èº«ä»½ä»»è¯; TCertæ˜¯çŸ­æœŸçš„èº«ä»½å‡­è¯ï¼Œæ˜¯åŒ¿åå’Œä¸å¯é“¾æŽ¥çš„; Ordering Service -æŽ’åºæœåŠ¡æˆ–å…±è¯†æœåŠ¡ å°†äº¤æ˜“æŽ’åºæ”¾å…¥blockçš„èŠ‚ç‚¹çš„é›†åˆã€‚ordering service ç‹¬ç«‹äºŽpeeræµç¨‹ä¹‹å¤–;å¹¶ä»¥å…ˆåˆ°å…ˆå¾—çš„æ–¹å¼ä¸ºç½‘ç»œä¸Šæ‰€æœ‰çš„channelä½œäº¤æ˜“æŽ’åº;ordering service æ”¯æŒå¯æ’æ‹”å®žçŽ°ï¼Œç›®å‰é»˜è®¤å®žçŽ°äº†SOLOå’ŒKafka;ordering serviceæ˜¯æ•´ä¸ªç½‘ç»œçš„å…¬ç”¨bindingï¼Œ åŒ…å«æ¯ä¸ªMemberç›¸å…³çš„åŠ å¯†ææ–™; Peer -èŠ‚ç‚¹ ä¸€ä¸ªç½‘ç»œå®žä½“ï¼Œç»´æŠ¤ledgerå¹¶è¿è¡ŒChaincodeå®¹å™¨æ¥å¯¹ledgerå¾ˆä¹–read-writeæ“ä½œ;peerç”±Memberæ‹¥æœ‰å’Œç»´æŠ¤; Policy-ç­–ç•¥ æœ‰èƒŒä¹¦ç­–ç•¥;æ ¡éªŒç­–ç•¥;åŒºå—æäº¤ç­–ç•¥;Chaincodeç®¡ç†ç­–ç•¥å’Œç½‘ç»œ-é€šé“ç®¡ç†ç­–ç•¥; Proposal - ææ¡ˆ ä¸€ç§é’ˆå¯¹channelä¸­æŸpeerçš„èƒŒä¹¦è¯·æ±‚ã€‚æ¯ä¸ªproposalè¦ä¹ˆæ˜¯Chaincode instantiate è¦ä¹ˆæ˜¯Chaincode inovke; Query- æŸ¥è¯¢ å¯¹äºŽcurrent stateä¸­æŸä¸ªkeyçš„valueçš„æŸ¥è¯¢è¯·æ±‚; Software Development Kit -SDK SDkä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ä¸ªç»“æž„åŒ–çš„åº“çŽ¯å¢ƒï¼Œç”¨äºŽç¼–å†™å’Œæµ‹è¯•é“¾ç åº”ç”¨ç¨‹åºï¼›SDKå®Œå…¨å¯ä»¥é€šè¿‡æ ‡å‡†æŽ¥å£å®žçŽ°é…ç½®å’Œæ‰©å±•ï¼Œåƒç­¾åçš„åŠ å¯†ç®—æ³•;æ—¥å¿—æ¡†æž¶å’Œstateå­˜å‚¨è¿™æ ·çš„ç»„ä»¶éƒ½å¯ä»¥è½»æ¾åœ°å®žçŽ°æ›¿æ¢;SDK API ä½¿ç”¨gRPCè¿›è¡Œäº¤æ˜“å¤„ç†ï¼Œæˆå‘˜æœåŠ¡ã€èŠ‚ç‚¹éåŽ†ä»¥åŠäº‹ä»¶å¤„ç†éƒ½æ˜¯æ®æ­¤ä¸Žfabricé€šä¿¡;ç›®å‰SDKæ”¯æŒNode.js Java å’Œpython ; State Database - stateDB ä¸ºäº†ä»ŽChainncodeä¸­é«˜æ•ˆçš„è¯»å†™,Current stateæ•°æ®ç¤åœ¨stateDBä¸­ï¼Œ åŒ…æ‹¬levelDBå’ŒsouchDB; System chain-ç³»ç»Ÿé“¾ åŒ…å«åœ¨ç³»ç»Ÿçº§å®šä¹‰ç½‘ç»œçš„é…ç½®åŒºå—ã€‚ç³»ç»Ÿé“¾å­˜åœ¨äºŽordering serviceä¸­;å…·æœ‰åŒ…å«ä»¥ä¸‹ä¿¡æ¯çš„åˆå§‹é…ç½®:MSPä¿¡æ¯ã€ç­–ç•¥å’Œä¿¡æ¯é…ç½®ã€‚å¯¹æ•´ä¸ªç½‘ç»œçš„ä»»ä½•å˜åŒ–;(ä¾‹å¦‚æ–°çš„OråŠ å…¥æˆ–è€…æ·»åŠ æ–°çš„Ordering èŠ‚ç‚¹)å°†å¯¼è‡´æ–°çš„é…ç½®åŒºå—è¢«æ·»åŠ åˆ°ç³»ç»Ÿé“¾; Transaction- äº¤æ˜“ Caincodeçš„invokeæˆ–instantiateæ“ä½œ; Invokeæ˜¯ä»Žledgerä¸­è¯·æ±‚read-write setï¼›Instantiateæ˜¯è¯·æ±‚åœ¨peerä¸Šå¯åŠ¨Chaincodeå®¹å™¨; äº†è§£Hyperledger FarbicHyperledger Fabricæ˜¯ä¸€ä¸ªæä¾› åˆ†å¸ƒå¼è´¦æœ¬æ–¹æ¡ˆçš„å¹³å°ã€‚Hyperledger Fabricç”±æ¨¡å—åŒ–æž¶æž„æ”¯æ’‘; å¹¶å…·å¤‡æžä½³çš„ä¿å¯†æ€§ã€å¯ä¼¸ç¼©æ€§ã€çµæ´»æ€§å’Œå¯æ‰©å±•å¹³å°; Hyperledger Fabircè¢«è®¾è®¡æˆæ”¯æŒä¸åŒçš„æ¨¡å—ç»„ä»¶ç›´æŽ¥æ‹”æ’å¯åŠ¨; å¹¶èƒ½é€‚åº”åœ¨ç»æµŽç”Ÿæ€ç³»ç»Ÿä¸­é”™ç»¼å¤æ‚çš„å’Œç§åœºæ™¯; Hyperledger Fabricæä¾›äº†ä¸€ä¸ªç‹¬ç‰¹çš„å¯ä¼¸ç¼©ã€å¯æ‰©å±•çš„æž¶æž„ï¼Œè¿™ä¹Ÿæ˜¯Hyperledger Fabricä¸Žå…¶ä»–åŒºå—çš„é“¾è§£å†³æ–¹æ¡ˆçš„æ˜¾è‘—åŒºåˆ«;å¦‚æžœæ­£è®¡åˆ’éƒ¨ç½²å…·å¤‡å®Œæ•´å®¡æŸ¥æœºåˆ¶ä»¥åŠå¼€æºæž¶æž„çš„ä¼ä¸šçº§åŒºå—é“¾; Hyperledger Fabricæ˜Œä¸€ä¸ªä¸é”™çš„èµ·ç‚¹; åŒºå—é“¾åˆ†å¸ƒå¼è´¦æœ¬ä¸€ä¸ªåŒºé“¾ç½‘ç»œçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è´¦æœ¬ï¼Œåœ¨è¿™ä¸ªè´¦æœ¬ä¸­è®°å½•äº†ç½‘ç»œå‘ç”Ÿçš„æ‰€æœ‰äº¤æ˜“ä¿¡æ¯; åŒºå—é“¾è´¦æœ¬é€šå¸¸è¢«å®šä¹‰ä¸ºåŽ»ä¸­å¿ƒåŒ–ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ•´ä¸ªç½‘ç»œä¸­ï¼Œæ¯ä¸ªå‚ä¸Žè€…éƒ½ä¿å­˜ç€ä¸€ä¸ªåŒºå—é“¾è´¦æœ¬çš„å‰¯æœ¬ï¼Œæ‰€æœ‰å‚ä¸Žè€…é€šè¿‡åä½œ å…±åŒç»´æŠ¤ç€è´¦æœ¬; åŽ»ä¸­å¿ƒåŒ–ä¸Žåä½œ è¿™ä¸¤ä¸ªç‰¹ç‚¹åœ¨çŽ°å®žä¸–ç•Œçš„å•†ä¸šè´§ç‰©äº¤æ˜“å’Œå•†åŠ¡æœåŠ¡ä¸­å±•å‡ºçŽ°çš„æ˜¾è‘—ä¼˜ç‚¹; é™¤äº†åŽ»ä¸­å¿ƒåŒ–ä¸Žåä½œï¼ŒåŒºé“¾é“¾çš„å¦ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹æ˜¯ä¿¡æ¯åœ¨åªèƒ½ä»¥â€é™„åŠ â€çš„æ–¹å¼è®°å½•åœ¨åŒºå—é“¾ä¸­; åŒæ—¶ä½¿ç”¨åŠ å¯†ç æŠ€æœ¯ä¿éšœäº†äº¤æ˜“ä¸€æ—¦è¢«æ·»åŠ è¿›è´¦æœ¬ä¸­ï¼Œå°±æ— æ³•è¢«ç¯¡æ”¹ã€‚åŒºå—é“¾çš„è¿™ç§ä¸å¯ç¯¡æ”¹æ€§ä½¿å¾—ä¿¡æ¯æ¥æºçš„ç¡®è®¤å˜å¾—å¼‚å¸¸å®¹æ˜“ï¼Œè¿™æ˜¯ç”±äºŽå‚ä¸Žè€…å¯ä»¥è‚¯å®šä¿¡æ¯ä¸€æ—¦è¢«å†™å…¥åŒºå—é“¾ä¸­å°±å‡ ä¹Žä¸å¯è¢« ç¯¡æ”¹ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåŒºå—é“¾å¸¸å¸¸ä¹Ÿè¢«ç§°ä¸ºè¯æ˜Žçš„ç³»ç»Ÿçš„åŽŸå› ; æ™ºèƒ½åˆçº¦ä¸ºäº†æŒç»­çš„è¿›è¡Œä¿¡æ¯çš„æ›´æ–°ï¼Œä»¥åŠå¸æœ¬è¿›è¡Œç®¡ç†(å†™å…¥äº¤æ˜“ï¼Œè¿›è¡ŒæŸ¥è¯¢ç­‰)ï¼ŒåŒºå—é“¾ç½‘ç»œå¼•å…¥äº†æ™ºèƒ½åˆçº¦æ¥å®žçŽ°å¯¹è´¦æœ¬çš„è®¿é—®å’ŒæŽ§åˆ¶; æ™ºèƒ½åˆçº¦ä¸ä»…ä»…å¯ç”¨äºŽåœ¨åŒºå—é“¾ç½‘ç»œä¸­æ‰“åŒ…ä¿¡æ¯ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥è¢«ç”¨äºŽè‡ªåŠ¨çš„æ‰§è¡Œç”±å‚ä¸Žè€…å®šä¹‰çš„ç‰¹å®šäº¤æ˜“æ“ä½œ; ä¾‹å¦‚,ä¹°å–åŒæ–¹è¦ä»¥å®šä¹‰ä¸€ä¸ªæ™ºèƒ½åˆçº¦ï¼Œä»¥ä¿è¯å½“å–æ–¹å‘è´§çš„ç«¯å£è¿é€åˆ°è¾¾æ—¶ï¼Œä¹°æ–¹æ”¯ä»˜çš„è´§æ¬¾ä¼šè‡ªäºŒç”²åŒèƒè½¬å¸ç»™å–æ–¹; å…±è¯†ä¿æŒç½‘ç»œä¸­æ‰€æœ‰è´¦æœ¬äº¤æ˜“çš„åŒæ­¥æµç¨‹ï¼Œå°±æ˜¯å…±è¯†ã€‚å…±è¯†ä¿è¯ äº†è´¦æœ¬åªä¼šåœ¨äº¤æ˜“åŒæ–¹éƒ½ç¡®è®¤åŽæ‰è¿›è¡Œæ›´æ–°ã€‚åŒæ—¶åœ¨è´¦æœ¬æ›´æ–°æ—¶ï¼Œäº¤æ˜“åŒæ–¹èƒ½å¤Ÿåœ¨åœ¨è´¦æœ¬ä¸­çš„ç›¸åŒä½ç½® ï¼Œæ›´æ–°ä¸€ä¸ªç›¸åŒçš„äº¤æ˜“ä¿¡æ¯; ##åŒºå—é“¾å› ä½•å¯è¡Œ å½“å‰çš„è®°å½•ç³»ç»Ÿè‡ªä»Žå•†ä¸šæ•°æ®è®°å½•ç½‘ç»œç³»ç»Ÿè¯žç”Ÿä»¥æ¥ï¼Œç›´åˆ°ä»Šå¤©çš„äº¤æ˜“ç½‘ç»œå¹¶ä¸éª¨å‘ç”Ÿå¤ªå¤§çš„å˜åŒ–; åœ¨å•†ä¸šç½‘ç»œä¸­çš„æˆå‘˜è¿›è¡Œç›¸äº’äº¤æ˜“æ—¶ï¼Œä»–ä»¬å„è‡ªç»´æŠ¤ç€è‡ªå·±ç‹¬ç«‹çš„äº¤æ˜“è®°å½•ã€‚åŒæ—¶ï¼Œäººä»¬äº¤æ˜“çš„ç‰©å“â€“æ— è®ºæ˜¯16ä¸–çºªä½›å…°å¾·çš„æŒ‚æ¯¯ï¼Œè¿˜æ˜¯çŽ°ä»£çš„æœ‰ä»·è¯åˆ¸â€“éƒ½ä»»ç„¶éœ€è¦åœ¨æ¯æ¬¡å–å‡ºäº¤æ˜“è¿‡ç¨‹ä¸­æä¾›æ¥æºä¿¡æ¯ï¼Œä»¥ç¡®ä¿å–æ–¹æ‹¥æœ‰æ‰€å‡ºå”®ç«¯å£çš„æ‰€æœ‰æƒ; éšç€ç§‘æŠ€çš„è¿›æ­¥ï¼Œäº¤æ˜“æµç¨‹ä¸æ–­æ·±åŒ–å‘å±•ï¼Œç»åŽ†äº†ä»Žä½¿ç”¨ç”¨çŸ³ç¢‘ã€ä½¿ç”¨çº¸è´¨è´¦æœ¬ã€ä½¿ç”¨ç¡¬ç›˜å­˜å‚¨å™¨ç›´åˆ°ä½¿ç”¨äº‘è®¡ç®—å¹³å°çš„ä¸åŒé˜¶æ®µï¼Œä½†æµç¨‹çš„åº•å±‚æž¶æž„å¹¶æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚å¹¶ä¸å­˜ä¸€ä¸ªå¯ä»¥ç»Ÿä¸€ç®¡ç†ç½‘ç»œå‚ä¸Žè€…èº«ä»½çš„ç³»ç»Ÿï¼Œç¡®è®¤å•†å“æ¥æºååˆ†è´¹åŠ²,å¸¸å¸¸ä¼šè€—è´¹æ•°å¤©çš„æ—¶é—´ æ˜Žç¡®è¯åˆ¸çš„äº¤æ˜“(åŒ…å«æ•°ä»¥ä¸‡è®¡ç¾Žå…ƒçš„æ•°é‡)ã€‚äººä»¬å¿…éœ€ç­¾è®¢åˆçº¦å¹¶æ‰‹åŠ¨æ‰§è¡Œï¼Œæ¯ä¸€ä¸ªç³»ç»Ÿä¸­çš„æ•°æ®åº“éƒ½åŒ…å«ç€ç‹¬ç«‹ çš„ä¿¡æ¯å¹¶æœ€ç»ˆä»£è¡¨ä¸€ä¸ªå•ç‚¹çš„é”™è¯¯ã€‚ åœ¨ä»Šå¤©çš„ä¿¡æ¯å’Œè¿‡ç¨‹å…±äº«æ–­è£‚çš„æ–¹æ³•ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªè·¨è¶Šå•†ä¸šç½‘ç»œçš„è®°å½•ç³»ç»Ÿæ˜¯ä¸å¯èƒ½çš„ï¼Œå°½ç®¡å¯è§æ€§å’Œä¿¡ä»»çš„éœ€æ±‚æ˜¯æ˜Žç¡®çš„; åŒºå—é“¾çš„ä¸åŒç‚¹ ä¸ºä»€ä¹ˆä¸ç”¨â€çŽ°ä»£â€çš„äº¤æ˜“ç³»ç»Ÿæ¥æ›¿ä»£è¿™ç§æ•ˆçŽ‡ä½Žä¸‹çš„ç½‘ç»œï¼Ÿæ–°çš„å•†ä¸šç½‘ç»œå¯ä»¥å…·æœ‰æ ‡å‡†çš„æ–¹æ³•å»ºç«‹èº«ä»½ä¿¡æ¯ï¼Œæ‰§è¡Œäº¤æ˜“ï¼Œå¹¶ä¸”å­˜å‚¨æ•°æ®ã€‚ä¸ºä»€ä¹ˆä¸å»ºç«‹ä¸€ä¸ªå¯ä½çš„äº¤æ˜“é“¾æ¡è®°å½•ï¼Ÿé€šè¿‡æŸ¥è¯¢è¿™ä¸ªé“¾æ¡ä¸Šçš„æ‰€æœ‰äº¤æ˜“ï¼Œæ¥ç¡®å®šäº¤æ˜“å•†å“æ¥æºï¼Œå¹¶ä¸”è¿™ä¸ªé“¾æ¡ä¸Šçš„ä¿¡æ¯ä¸€æ—¦è¢«å†™å…¥ï¼Œå°±æ— æ³•è¢«å†æ¬¡ç¯¡æ”¹; è¿™å°±æ˜¯åŒºå—é“¾ç½‘ç»œã€‚åœ¨åŒºå—é“¾ç½‘ç»œä¸­ï¼Œæ¯ä¸€ä¸ªå‚ä¸Žè€…éƒ½ä¿æœ‰ä¸€ä»½è´¦æœ¬çš„å‰¯æœ¬ã€‚åœ¨åŒºå—é“¾ç½‘ç»œä¸­ï¼Œä¸ä»…ä»…æ˜¯è´¦æœ¬ä¿¡æ¯ä¼šè¢«å…±äº«ï¼Œæ›´æ–°è´¦æœ¬çš„æµç¨‹æ˜¯å…±äº«çš„ã€‚ä¸åŒäºŽç›®å‰çš„ç³»ç»Ÿâ€“å‚ä¸Žè€…ä½¿ç”¨ç§æœ‰çš„ç¨‹åºå¯¹ç§èƒ¡çš„è´¦æœ¬è¿›è¡Œæ›´æ–°ï¼Œè€ŒåŒºå—é“¾ç³»ç»Ÿä½¿ç”¨å…±äº«çš„ç¨‹åºå¯¹å…±äº«çš„è´¦æœ¬è¿›è¡Œæ›´æ–°; é€šè¿‡ä½¿ç”¨å…±äº«è´¦åè°ƒæ•´ä¸ªå•†ä¸šç½‘ç»œï¼ŒåŒºå—é“¾ç½‘ç»œèƒ½å…å‡å°‘æ—¶é—´ã€æˆæœ¬ä»¥åŠéšç§ä¿¡æ¯æ³„éœ²çš„é£Žé™©ï¼Œå¹¶ä¸”èƒ½ä½¿ç”¨æµç¨‹æ›´åŠ å¯ä¿¡å’Œé€æ˜Ž; Hyperledger Fabric2015å¹´ï¼ŒLinuxåŸºé‡‘ä¼šå¯åŠ¨äº†Hyperledgeré¡¹ç›®ï¼Œhhsfiæ˜¯å‘å±•è·¨è¡Œä¸šçš„åŒºå—é“¾æŠ€æœ¯ã€‚Hyperledgeré¡¹ç›®å¹¶ä¸ä»…ä»…æ˜¯å®šä¹‰ä¸€ä¸ªå•ä¸€çš„åŒºå—é“¾æ ‡å‡†ï¼Œå®ƒæ›´é¼“åŠ±èƒ½è¿‡å¼€æºç¤¾åŒºçš„åŠ›é‡åä½œå¼€å‘åŒºå—é“¾æŠ€æœ¯ ; Hyperledger Fabricæ˜¯Hyperledgerä¸­çš„ä¸€ä¸ªåŒºå—é“¾é¡¹ç›®ã€‚ä¸Žå…¶ä»–åŒºå—é“¾æŠ€æœ¯ç±»ä¼¼, Hyperledger FabricåŒ…å«ä¸€ä¸ªè´¦æœ¬ï¼Œä½¿ç”¨æ™ºèƒ½åˆçº¦å¹¶ä¸”æ˜¯ä¸€ä¸ªé€šè¿‡æ‰€æœ‰å‚ä¸Žè€…ç®¡ç† äº¤æ˜“çš„ç³»ç»Ÿ; Hyperledger Fabric ä¸Žå…¶ä»–åŒºå—é“¾ç³»ç»Ÿæœ€å¤§çš„ä¸åŒä½“çŽ°åœ¨ç§æœ‰å’Œè®¸å¯ã€‚ä¸Žå¼€æ”¾æ— éœ€è®¸å¯çš„ç½‘ç»œç³»ç»Ÿå…è®¸æœªçŸ¥èº«ä»½çš„å‚ä¸Žè€…åŠ å…¥ç½‘ç»œä¸åŒ(éœ€è¦èƒ½è¿‡å·¥ä½œé‡è¯æ˜Žåè®®æ¥ä¿è¯äº¤æ˜“æœ‰æ•ˆå¹¶ç»´æŠ¤ç½‘ç»œçš„å®‰å…¨)ï¼ŒHyperledger Fabricé€šè¿‡Membership Service Provider(MSP)æ¥ç™»è®°æ‰€æœ‰çš„æˆå‘˜; Hyperledger Fabricä¹Ÿæä¾›äº†å¤šä¸ªå¯æ‹”æ’é€‰é¡¹ã€‚è´¦æœ¬æ•°æ®å¯è¢«å­˜å‚¨ä¸ºå¤šç§æ ¼å¼ï¼Œå…±è¯†æœºåˆ¶å¯è¢«æŽ¥å…¥æˆ–è€…æ–­å¼€ï¼ŒåŒæ—¶æ”¯æŒå¤šç§ä¸åŒçš„MSPã€‚ Hyperledger Fabricæä¾›äº†å»ºç«‹ channelçš„åŠŸèƒ½ï¼Œè¿™å…è®¸å‚ä¸Žè€…ä¸ºäº¤æ˜“æ–°å»ºä¸€ä¸ªå•ç‹¬çš„è´¦æœ¬ã€‚å½“ç½‘ç»œä¸­çš„ä¸€äº›å‚ä¸Žè€…æ˜¯ç«žäº‰å¯¹æ‰‹æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½å˜å¾—å°¤ä¸ºé‡è¦ã€‚å› ä¸ºè¿™äº›å‚ä¸Žè€…å¹¶ä¸å¸Œæœ›æ‰€æœ‰çš„äº¤æ˜“ä¿¡æ¯â€“æ¯”å¦‚æä¾›ç»™éƒ¨åˆ†å®¢æˆ·çš„ç‰¹å®šä»·æ ¼ä¿¡æ¯â€“éƒ½å¯¹ç½‘ç»œä¸­æ‰€æœ‰å‚ä¸Žè€…å…¬å¼€ã€‚åªæœ‰åœ¨åŒä¸€ä¸ªchannelä¸­çš„å‚ä¸Žè€…ï¼Œæ‰ä¼šæ‹¥æœ‰è¯¥channelä¸­çš„è´¦æœ¬ï¼Œè€Œå…¶ä»–ä¸åœ¨æ­¤channelä¸­çš„å‚ä¸Žè€…åˆ™çœ‹ä¸åˆ°è¿™ä¸ªè´¦æœ¬; å…±äº«è´¦æœ¬Hyperledger FabricåŒ…å«ä¸€ä¸ªè´¦æœ¬å­ç³»ç»Ÿï¼Œè¿™ä¸ªå­ç³»ç»ŸåŒ…å«ä¸¤ä¸ªç»„ä»¶:ä¸–ç•ŒçŠ¶æ€(world state) å’Œäº¤æ˜“è®°å½•ã€‚åœ¨Hyperledger Fabricç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªå‚ä¸Žè€…éƒ½æ‹¥æœ‰ä¸€ä¸ªè´¦æœ¬çš„å‰¯æœ¬; ä¸–ç•ŒçŠ¶æ€ç»„ä»¶æè¿°äº†è´¦æœ¬åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„çŠ¶æ€ï¼Œå®ƒæ˜¯è´¦æœ¬çš„æ•°æ®åº“ã€‚äº¤æ˜“è®°å½•ç»„ä»¶è®°å½•äº†äº§ç”Ÿä¸–ç•ŒçŠ¶æ€å½“å‰å€¼çš„æ‰€æœ‰äº¤æ˜“ï¼Œå®ƒæ˜¯ä¸–ç•ŒçŠ¶æ€çš„æ›´æ–°åŽ†å²ã€‚é‚£ä¹ˆï¼Œè´¦æœ¬åˆ™æ˜¯ä¸–ç•ŒçŠ¶æ€æ•°æ®åº“å’Œäº¤æ˜“åŽ†å²è®°å½•çš„é›†åˆ; è´¦æœ¬çš„ä¸–ç•ŒçŠ¶æ€å­˜å‚¨æ•°æ®åº“æ˜¯å¯æ›´æ¢çš„ã€‚é»˜è®¤é…ç½®ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªkey-valueå­˜å‚¨æ•°æ®åº“ã€‚äº¤æ˜“è®°å½•æ¨¡ å—ä¸éœ€è¦è¢«ä¸æŽ¥å…¥ã€‚åªéœ€è¦è®°å½•åœ¨åŒºå—é“¾ç½‘ç»œä¸­æ›²æ£çƒæ•°æ®åº“è¢« ä½¿ç”¨æ—¶ä¹‹å‰å’Œä¹‹åŽçš„å€¼å°±å¯ä»¥äº†; æ™ºèƒ½åˆçº¦Hyperledger Fabricæ™ºèƒ½åˆçº¦è¢«ç§°ä¸ºchaincodeï¼Œå½“ä¸€ä¸ªåŒºå—é“¾å¤–éƒ¨çš„ä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€è¦è®¿é—®è´¦æœ¬æ—¶,å°±ä¼šè°ƒç”¨chaincodeã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œchaincodeåªä¼šè®¿é—®è´¦æœ¬çš„æ•°æ®åº“ç»„ä»¶å’Œä¸–ç•ŒçŠ¶æ€(world sate)(æ¯”å¦‚æŸ¥è¯¢)ï¼Œä½†ä¸ä¼šæŸ¥è¯¢äº¤æ˜“è®°å½•; chaincodeå¯é€šè¿‡å¤šç§ä¸åŒç¼–ç¨‹è¯­è¨€å®žçŽ°ã€‚ç›®å‰æ”¯æŒchaincodeçš„è¯­è¨€æ˜¯Go(åŒ…å«å¯¹javaçš„æ”¯æŒ)]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Installing and Accessing Mysql Server]]></title>
    <url>%2F2018%2F02%2F09%2FInstalling-and-Accessing-Mysql-Server%2F</url>
    <content type="text"><![CDATA[MariaDB or MySQL1234567891011121314151617181920212223242526272829303132333435363738DBMS: æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåªæ˜¯ä¸€ä¸ªç¨‹åºï¼Œè€Œéžæ•°æ®RDBMS: å…³ç³»åž‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ C/S: ä¸“æœ‰åè®® å…³ç³»æ¨¡åž‹: è¡¨(è¡Œï¼Œåˆ—) ç»„æˆçš„äºŒç»´å…³ç³» èŒƒå¼:ç¬¬ä¸€èŒƒå¼ã€ç¬¬äºŒèŒƒå¼ã€ç¬¬ä¸‰èŒƒå¼ å…³ç³»è¿ç®—: é€‰æ‹© æŠ•å½± æ•°æ®åº“: è¡¨ï¼Œç´¢å¼•ï¼Œè§†å›¾(è™šè¡¨) SQL: Structure Query Language (ç»“æž„åŒ–æŸ¥è¯¢è¯­è¨€) DDL(æ•°æ®å®šä¹‰è¯­è¨€),DML(æ•°æ®æ“çºµè¯­è¨€ï¼Œæ“ä½œè¡¨ä¸­çš„æ•°æ®) ç¼–ç¨‹æŽ¥å£: å­˜å‚¨è¿‡ç¨‹ å­˜å‚¨å‡½æ•° è§¦å‘å™¨ äº‹ä»¶è°ƒè¯•å™¨ (Event scheduling) è¿‡ç¨‹å¼ç¼–è¾‘: é€‰æ‹©ã€å¾ªçŽ¯ä¸‰å±‚æ¨¡åž‹: ç‰©ç†å±‚(ä¸€å¼ è¡¨ï¼Œæˆ–è€…å¤šå¼ è¡¨ï¼Œè¡¨çŽ°ä¸ºä¸€ä¸ªæ–‡ä»¶) é€»è¾‘å±‚(è¡¨ï¼Œç´¢å¼•ï¼Œè§†å›¾ï¼Œç­‰ç­‰) è§†å›¾å±‚(æœ€ç»ˆç”¨æˆ·æ‰€çœ‹åˆ°çš„æ ·å­ï¼ŒæŽˆæƒç”¨æˆ·æ‰€çœ‹åˆ°çš„) åšä¸ºDBAéœ€è¦: è®¾è®¡/åˆ›å»ºè¡¨ è®¾è®¡/åˆ›å»ºç´¢å¼• è®¾è®¡/åˆ›å»ºè§†å›¾ æ•°æ®åº“çš„å¯¼å…¥å¯¼å‡ºç­‰è§£å†³æ–¹æ¡ˆ: ä»˜è´¹: Oracle ,Sybase ,Infomix(IBM) ,DB2(IBM) å¼€æº: MySQL ,MariaDB ,PostgreSQL , SQLite(æ˜¯ä¸€ç§åµŒå…¥å¼çš„è§£å†³æ–¹æ¡ˆ) ç›®å‰MySQLå·²ç»è¢«Oracleæ”¶è´­ æœ‰ä¸‰æˆæŠŠæ¡çš„æ—¶å€™ï¼Œå°±è¦äº‰å–ã€‚ä¸ç„¶æœºä¼šå°±é”™è¿‡äº†ï¼Œä½†è¦åšå¥½å……ä»½å‡†å¤‡ã€‚ æ²¡æœ‰è°å¥½è°åï¼Œåªè¦å‘å¾€è‡ªå·±çš„ç†æƒ³å°±å¥½äº†ã€‚ MySQL --&gt; 5.1 --&gt; 5.5 --&gt; 5.6 --&gt; 5.7 MariaDB æ’ä»¶å¼å­˜å‚¨å¼•æ“Ž(æ”¯æŒä¼—å¤šç±»åž‹çš„å­˜å‚¨å¼•æ“Ž) MySQLæ˜¯å¦æ”¯æŒäº‹ç‰©ï¼Œåˆ™éœ€è¦æŸ¥çœ‹å­˜å‚¨å¼•æ“Žæ˜¯å¦æ”¯æŒäº‹ç‰© å•è¿›ç¨‹å¤šçº¿ç¨‹ è¿žæŽ¥çº¿ç¨‹ å®ˆæŠ¤çº¿ç¨‹ 12345678910111213141516MariaDB [mysql]&gt; SHOW ENGINES ;+--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+| Engine | Support | Comment | Transactions | XA | Savepoints |+--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+| CSV | YES | CSV storage engine | NO | NO | NO || MRG_MYISAM | YES | Collection of identical MyISAM tables | NO | NO | NO || MEMORY | YES | Hash based, stored in memory, useful for temporary tables | NO | NO | NO || BLACKHOLE | YES | /dev/null storage engine (anything you write to it disappears) | NO | NO | NO || MyISAM | YES | MyISAM storage engine | NO | NO | NO || InnoDB | DEFAULT | Percona-XtraDB, Supports transactions, row-level locking, and foreign keys | YES | YES | YES || ARCHIVE | YES | Archive storage engine | NO | NO | NO || FEDERATED | YES | FederatedX pluggable storage engine | YES | NO | YES || PERFORMANCE_SCHEMA | YES | Performance Schema | NO | NO | NO || Aria | YES | Crash-safe tables with MyISAM heritage | NO | NO | NO |+--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+10 rows in set (0.00 sec) 1234567891011121314151617181920212223242526272829303132333435363738MySQLé…ç½®æ–‡ä»¶:é›†ä¸­å¼çš„é…ç½®ï¼Œèƒ½å¤Ÿä¸ºmysqlçš„å„åº”ç”¨ç¨‹åºæä¾›é…ç½®ä¿¡æ¯ [mysqld] ä¸“ç”¨äºŽmysqldåº”ç”¨ç¨‹åº [mysqld_safe] çº¿ç¨‹å®‰å…¨çš„mysqldä¸“æœ‰é…ç½® [mysqld_multi] å¤šå®žä¾‹å…±ç¦»çš„mysql [server] åªè¦æœ‰æ˜¯mysqlæœåŠ¡ç«¯çš„éƒ½æœ‰æ•ˆçš„ [mysql] mysqlå®¢æˆ·ç«¯çš„ [mysqldump] æ•°æ®å¯¼å…¥å¯¼å‡ºçš„ [client] å¯¹äºŽå®¢æˆ·ç«¯å·¥å…·çš„ parameter = value æ”¯æŒ_ - ä¸¤ç§ skip-name-reslove skip_name_reslove ä¸¤ç§æ–¹å¼éƒ½æ˜¯å¯ä»¥çš„mysqlå¯åŠ¨æ—¶æŸ¥æ‰¾è·¯å¾„ /etc/my.cnf --&gt; /etc/mysql/my.cnf --&gt; $MYSQL_HOME/my.cnf --&gt; default-extra-file=/path/to/somdir/my.cnf --&gt; ~/.my.cnf åŽæ‰¾åˆ°çš„ï¼Œè¡Œä¼šè¦†ç›–å…ˆæ‰¾åˆ°çš„ï¼ŒäºŽæ˜¯ï¼Œè¶Šä½åŽçš„æ˜¯ï¼Œè¶Šæ˜¯å…ˆç”Ÿæ•ˆ å®‰è£…æ–¹æ³• os vendor: rpm ubuntuæœ€æˆåŠŸçš„é¢†åŸŸåœ¨æ¡Œé¢ æœåŠ¡å™¨å»ºè®®ä½¿ç”¨CentOS, SUSE,OpenSUSE,Debianç­‰ç­‰ Debian è¦æ±‚æŠ€æœ¯èƒ½åŠ›åé«˜ MySQL: rpm å±•å¼€å¯ç”¨ï¼Œä¸€èˆ¬å®‰è£…å°±ç”¨çš„è¿™ç§æ–¹å¼ æºç ï¼Œæºç å®‰è£…æ—¶éœ€è¦å¯¹ä»£ç æ‰“å¸ƒä¸ï¼Œå¯¹MySQLè®¢åˆ¶ å®‰è£…åŽçš„è®¾è®¡: ï¼ˆ1ï¼‰ä¸ºæ‰€æœ‰rootç”¨æˆ·è®¾å®šå¯†ç  mysql&gt; SET PASSWORD mysql&gt; update mysql.user SET password= PASSWORD(&apos;your_pass&apos;) WHERE cluase; mysql&gt; FLUSH PRIVILEGES ; # mysqladmin ç”¨è¿™ä¸ªå‘½ä»¤æ¥ä¿®æ”¹ (2) åˆ é™¤æ‰€æœ‰åŒ¿åç”¨æˆ· mysql&gt; DROP USER &apos;&apos;@ &apos;localhost&apos;; ä¸Šæœ¯ä¸¤æ­¥éª¤å¯è¿è¡Œå‘½ä»¤: mysql_secure_installation (3) å»ºè®®å…³é—­ä¸»æœºååè§£åŠŸèƒ½å…ƒæ•°æ®æ•°æ®åº“: mysql user,host ç­‰mysql å®¢æˆ·ç«¯å·¥å…· mysql]]></content>
      <tags>
        <tag>linux</tag>
        <tag>database</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux å¸¸ç”¨å‘½ä»¤ä¸ŽæŠ€å·§]]></title>
    <url>%2F2018%2F02%2F08%2Flinux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B8%8E%E6%8A%80%E5%B7%A7%2F</url>
    <content type="text"><![CDATA[linux å¸¸ç”¨å‘½ä»¤ä¸ŽæŠ€å·§ 1.æ£€æŸ¥è¿œç¨‹ç«¯å£æ˜¯å¦å¯¹bashå¼€æ”¾ï¼š1echo &gt;/dev/tcp/8.8.8.8/53 &amp;&amp; echo "open" 2.è®©è¿›ç¨‹è½¬å…¥åŽå°ï¼š1Ctrl + z 3.å°†è¿›ç¨‹è½¬åˆ°å‰å°ï¼š1fg 4.äº§ç”Ÿéšæœºçš„åå…­è¿›åˆ¶æ•°ï¼Œå…¶ä¸­næ˜¯å­—ç¬¦æ•°ï¼š1openssl rand -hex n 5.åœ¨å½“å‰shellé‡Œæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶é‡Œçš„å‘½ä»¤ï¼š1source /home/user/file.name 6.æˆªå–å‰5ä¸ªå­—ç¬¦ï¼š1$&#123;variable:0:5&#125; 7.SSH debug æ¨¡å¼:1ssh -vvv user@ip_address 8.SSH with pem key:1ssh user@ip_address -i key.pem 9.ç”¨wgetæŠ“å–å®Œæ•´çš„ç½‘ç«™ç›®å½•ç»“æž„ï¼Œå­˜æ”¾åˆ°æœ¬åœ°ç›®å½•ä¸­ï¼š1wget -r --no-parent --reject "index.html*" http://hostname/ -P /home/user/dirs 10.ä¸€æ¬¡åˆ›å»ºå¤šä¸ªç›®å½•ï¼š1mkdir -p /home/user/&#123;test,test1,test2&#125; 11.åˆ—å‡ºåŒ…æ‹¬å­è¿›ç¨‹çš„è¿›ç¨‹æ ‘ï¼š1ps axwef 12.åˆ›å»º war æ–‡ä»¶:1jar -cvf name.war file 13.æµ‹è¯•ç¡¬ç›˜å†™å…¥é€Ÿåº¦ï¼š1dd if=/dev/zero of=/tmp/output.img bs=8k count=256k; rm -rf /tmp/output.img 14.æµ‹è¯•ç¡¬ç›˜è¯»å–é€Ÿåº¦ï¼š1hdparm -Tt /dev/sda 15.èŽ·å–æ–‡æœ¬çš„md5 hashï¼š1echo -n "text" | md5sum 16.æ£€æŸ¥xmlæ ¼å¼ï¼š1xmllint --noout file.xml 17.å°†tar.gzæå–åˆ°æ–°ç›®å½•é‡Œï¼š1tar zxvf package.tar.gz -C new_dir 18.ä½¿ç”¨curlèŽ·å–HTTPå¤´ä¿¡æ¯ï¼š1curl -I http://www.example.com 19.ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æ—¶é—´æˆ³(YYMMDDhhmm):1touch -t 0812250000 file 20.ç”¨wgetå‘½ä»¤æ‰§è¡Œftpä¸‹è½½ï¼š1wget -m ftp://username:password@hostname 21.ç”Ÿæˆéšæœºå¯†ç (ä¾‹å­é‡Œæ˜¯16ä¸ªå­—ç¬¦é•¿):1LANG=c &lt; /dev/urandom tr -dc _A-Z-a-z-0-9 | head -c$&#123;1:-16&#125;;echo; 22.å¿«é€Ÿå¤‡ä»½ä¸€ä¸ªæ–‡ä»¶ï¼š1cp some_file_name&#123;,.bkp&#125; 23.è®¿é—®Windowså…±äº«ç›®å½•ï¼š1smbclient -U "DOMAIN\user" //dc.domain.com/share/test/dir 24.æ‰§è¡ŒåŽ†å²è®°å½•é‡Œçš„å‘½ä»¤(è¿™é‡Œæ˜¯ç¬¬100è¡Œ):1!100 25.è§£åŽ‹:123unzip package_name.zip -d dir_nametar xvf package_name.tar.gz -d dir_nametar cvf package_name.tar.gz /path/to/file/ 26.è¾“å…¥å¤šè¡Œæ–‡å­—(CTRL + d é€€å‡º):1cat &lt; &gt;&gt; test.txt 27.åˆ›å»ºç©ºæ–‡ä»¶æˆ–æ¸…ç©ºä¸€ä¸ªçŽ°æœ‰æ–‡ä»¶ï¼š1\&gt; test.txt 28.ä¸ŽUbuntu NTP serveråŒæ­¥æ—¶é—´ï¼š1ntpdate ntp.ubuntu.com 29.ç”¨netstatæ˜¾ç¤ºæ‰€æœ‰tcp4ç›‘å¬ç«¯å£ï¼š1netstat -lnt4 | awk '&#123;print $4&#125;' | cut -f2 -d: | grep -o '[0-9]*' 30.qcow2é•œåƒæ–‡ä»¶è½¬æ¢ï¼š1qemu-img convert -f qcow2 -O raw precise-server-cloudimg-amd64-disk1.img \precise-server-cloudimg-amd64-disk1.raw 31.é‡å¤è¿è¡Œæ–‡ä»¶ï¼Œæ˜¾ç¤ºå…¶è¾“å‡ºï¼ˆç¼ºçœæ˜¯2ç§’ä¸€æ¬¡ï¼‰ï¼š12watch ps -efwatch -n1 &quot;df -h&quot; 32.æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ï¼š123getent passwdawk -F: '&#123;print $1&#125;' /etc/passwd cat /etc/passwd | cut -d ':' -f 1 33.Mount root in read/write mode:1mount -o remount,rw / 34.æŒ‚è½½ä¸€ä¸ªç›®å½•ï¼ˆè¿™æ˜¯ä¸èƒ½ä½¿ç”¨é“¾æŽ¥çš„æƒ…å†µï¼‰:1mount --bind /source /destination 35.åŠ¨æ€æ›´æ–°DNS server:1234nsupdate &lt; &lt;EOFupdate add $HOST 86400 A $IPsendEOF 36.é€’å½’grepæ‰€æœ‰ç›®å½•ï¼š1grep -r "some_text" /path/to/dir 37.åˆ—å‡ºå‰10ä¸ªæœ€å¤§çš„æ–‡ä»¶ï¼š1lsof / | awk '&#123; if($7 &gt; 1048576) print $7/1048576 "MB "$9 &#125;' | sort -n -u | tail 38.æ˜¾ç¤ºå‰©ä½™å†…å­˜(MB):1free -m | grep cache | awk '/[0-9]/&#123; print $4" MB" &#125;' 39.æ‰“å¼€Vimå¹¶è·³åˆ°æ–‡ä»¶æœ«ï¼š1vim + some_file_name 40.Git å…‹éš†æŒ‡å®šåˆ†æ”¯(master):1git clone git@github.com:name/app.git -b master 41.Git åˆ‡æ¢åˆ°å…¶å®ƒåˆ†æ”¯(develop):1git checkout develop 42.Git åˆ é™¤åˆ†æ”¯(myfeature):1git branch -d myfeature 43.Git åˆ é™¤è¿œç¨‹åˆ†æ”¯1git push origin :branchName 44.Git å°†æ–°åˆ†æ”¯æŽ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼š1git push -u origin mynewfeature 45.æ‰“å°åŽ†å²è®°å½•ä¸­æœ€åŽä¸€æ¬¡catå‘½ä»¤ï¼š1!cat:p 46.è¿è¡ŒåŽ†å²è®°å½•é‡Œæœ€åŽä¸€æ¬¡catå‘½ä»¤ï¼š1!cat 47.æ‰¾å‡º/home/userä¸‹æ‰€æœ‰ç©ºå­ç›®å½•:1find /home/user -maxdepth 1 -type d -empty 48.èŽ·å–test.txtæ–‡ä»¶ä¸­ç¬¬50-60è¡Œå†…å®¹ï¼š1&lt; test.txt sed -n '50,60p' 49.è¿è¡Œæœ€åŽä¸€ä¸ªå‘½ä»¤(å¦‚æžœæœ€åŽä¸€ä¸ªå‘½ä»¤æ˜¯mkdir /root/test, ä¸‹é¢å°†ä¼šè¿è¡Œ: sudo mkdir /root/test)ï¼š1sudo !! 50.åˆ›å»ºä¸´æ—¶RAMæ–‡ä»¶ç³»ç»Ÿ â€“ ramdisk (å…ˆåˆ›å»º/tmpramç›®å½•):1mount -t tmpfs tmpfs /tmpram -o size=512m 51.Grep whole words:1grep -w "name" test.txt 52.åœ¨éœ€è¦æå‡æƒé™çš„æƒ…å†µä¸‹å¾€ä¸€ä¸ªæ–‡ä»¶é‡Œè¿½åŠ æ–‡æœ¬ï¼š1echo "some text" | sudo tee -a /path/file 53.åˆ—å‡ºæ‰€æœ‰kill signalå‚æ•°:1kill -l 54.åœ¨bashåŽ†å²è®°å½•é‡Œç¦æ­¢è®°å½•æœ€åŽä¸€æ¬¡ä¼šè¯ï¼š1kill -9 $$ 55.æ‰«æç½‘ç»œå¯»æ‰¾å¼€æ”¾çš„ç«¯å£ï¼š1nmap -p 8081 172.20.0.0/16 56.è®¾ç½®git email:1git config --global user.email "me@example.com" 57.To sync with master if you have unpublished commits:1git pull --rebase origin master 58.å°†æ‰€æœ‰æ–‡ä»¶åä¸­å«æœ‰â€txtâ€çš„æ–‡ä»¶ç§»å…¥/home/userç›®å½•:1find -iname "*txt*" -exec mv -v &#123;&#125; /home/user \; 59.å°†æ–‡ä»¶æŒ‰è¡Œå¹¶åˆ—æ˜¾ç¤ºï¼š1paste test.txt test1.txt 60.shellé‡Œçš„è¿›åº¦æ¡:1pv data.log 61.ä½¿ç”¨netcatå°†æ•°æ®å‘é€åˆ°Graphite server:12echo "hosts.sampleHost 10 `date +%s`" | nc 192.168.200.2 3000 62.å°†tabsè½¬æ¢æˆç©ºæ ¼ï¼š1expand test.txt &gt; test1.txt 63.Skip bash history:1&lt; space &gt;cmd 64.åŽ»ä¹‹å‰çš„å·¥ä½œç›®å½•ï¼š1cd - 65.æ‹†åˆ†å¤§ä½“ç§¯çš„tar.gzæ–‡ä»¶(æ¯ä¸ª100MB)ï¼Œç„¶åŽåˆå¹¶å›žåŽ»ï¼š12split â€“b 100m /path/to/large/archive /path/to/output/filescat files* &gt; archive 66.ä½¿ç”¨curlèŽ·å–HTTP status code:1curl -sL -w "%&#123;http_code&#125;\\n" www.example.com -o /dev/null 67.è®¾ç½®rootå¯†ç ï¼Œå¼ºåŒ–MySQLå®‰å…¨å®‰è£…:1/usr/bin/mysql_secure_installation 68.å½“Ctrl + cä¸å¥½ä½¿æ—¶:1Ctrl + \ 69.èŽ·å–æ–‡ä»¶owner:1stat -c %U file.txt 70.blockè®¾å¤‡åˆ—è¡¨ï¼š1lsblk -f 71.æ‰¾å‡ºæ–‡ä»¶åç»“å°¾æœ‰ç©ºæ ¼çš„æ–‡ä»¶ï¼š1find . -type f -exec egrep -l " +$" &#123;&#125; \; 72.æ‰¾å‡ºæ–‡ä»¶åæœ‰tabç¼©è¿›ç¬¦çš„æ–‡ä»¶1find . -type f -exec egrep -l $'\t' &#123;&#125; \; 73.ç”¨â€=â€æ‰“å°å‡ºæ¨ªçº¿:å…¨é€‰å¤åˆ¶æ”¾è¿›ç¬”è®°1printf '%100s\n' | tr ' ' = 74.å½“ä¸€ä¸ªæ–‡ä»¶è¾ƒå¤§ï¼Œrm -rf ä¹Ÿæ— æ³•åˆ é™¤æ—¶12echo '' &gt; filenamerm -rf filename 75.ç»Ÿè®¡è®¿é—®é‡å‰5çš„ip12cat /var/log/nginx/access.log| cut -d " " -f 1 | sort -r | uniq -c | sort -nr | head -n5awk &#123;'print $1'&#125; /var/log/nginx/access.log | sort -r | uniq -c | sort -nr | head -5 76.CPUå ç”¨æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹ï¼š1ps auxw|head -1;ps auxw|sort -rn -k3|head -10 78.å†…å­˜æ¶ˆè€—æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹1ps auxw|head -1;ps auxw|sort -rn -k4|head -10 79.è™šæ‹Ÿå†…å­˜ä½¿ç”¨æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹1ps auxw|head -1;ps auxw|sort -rn -k5|head -10 80.å°†443ç«¯å£è½¬å‘åˆ°8080ç«¯å£1sudo iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-ports 8080 1234567mkdir -p /root/configtouch /root/config/postfix-accounts.cfdocker run --rm \ -e MAIL_USER=renjin@ssjinyao.com \ -e MAIL_PASS=centos.123\ -ti tvial/docker-mailserver:latest \ /bin/sh -c &apos;echo &quot;$MAIL_USER|$(doveadm pw -s SHA512-CRYPT -u $MAIL_USER -p $MAIL_PASS)&quot;&apos; &gt;&gt; /root/config/postfix-accounts.cf]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx è´Ÿè½½å‡è¡¡å¤šä¸ªnmmpä¸»æœº]]></title>
    <url>%2F2018%2F02%2F07%2FNginx-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%A4%9A%E4%B8%AAnmmp%E4%B8%BB%E6%9C%BA%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ‹“æ‰‘å›¾ ä¸€ã€Memcacheç®€ä»‹cache(ç¼“å­˜ç³»ç»Ÿ)12345678910111213141516é«˜æ€§èƒ½åˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡å™¨ï¼Œç¼“å­˜æ‰€æœ‰çš„â€œå¯æµå¼åŒ–â€æ•°æ®livejournalæ——ä¸‹Danga Interaciveå…¬å¸ ç¨‹åº=æŒ‡ä»¤+æ•°æ®æŒ‡ä»¤ï¼šç¨‹åºæ•°æ®ï¼šIOæ“ä½œæ–‡ä»¶ç³»ç»Ÿï¼šç‰¹å¾ï¼šåè®®ç®€å•åŸºäºŽlibeventçš„äº‹ä»¶å¤„ç†å†…ç½®å†…å­˜å­˜å‚¨æ–¹å¼memcached ä¸äº’é€šä¿¡çš„åˆ†å¸ƒå¼ç”±äºŽä¸€å°memcachedå˜åŠ¨æ—¶ä¼šå¯¼è‡´æ•°æ®æ— æ³•æŸ¥è¯¢åˆ°ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ä¸€è‡´æ€§hashç®—æ³•ä¸€å°memcachedå˜åŠ¨æ—¶ï¼Œæ•°æ®ä¼šä¸¢å¤±ã€‚memcachedä¹‹é—´ä¸èƒ½äº’ç›¸é€šä¿¡ï¼Œæ‰€ä»¥ä¸æ”¯æŒå†—ä½™ã€‚æ³¨:memcacchedæœåŠ¡é‡å¯æ—¶ï¼Œç¼“å­˜çš„æ•°æ®ä¼šä¸¢å¤±ï¼›CentOS 7 memcachedçš„å®‰è£…æµç¨‹ï¼›base repository;æœåŠ¡ç«¯ç¨‹åº:memcached ç¨‹åºçŽ¯å¢ƒ123456é…ç½®æ–‡ä»¶ï¼› /etc/sysconfig/memcachedä¸»ç¨‹åº:/usr/bin/memcachedå·¥å…·/usr/bin/memcached-toolunitfile /usr/lib/systemd/system/memcached.servicelibmemcached:libmemcached æ˜¯ä¸€ä¸ªC/C++å¯¹äºŽmemcachedæœåŠ¡å™¨çš„å®¢æˆ·ç«¯åº“å’Œå·¥å…·libmemcached-devel:è¿™ä¸ªåŒ…ä¸­åŒ…æ¶µlibmemcachedçš„å¤´æ–‡ä»¶å’Œåº“ 1234567891011121314151617 Memcachedå‘½ä»¤è¯¦è§£ memcachedmemcached [options]:-l &lt;ip_addr&gt;:ç›‘å¬çš„åœ°å€-d Run memcahched as a daemon-m &lt;num&gt; ç¼“å­˜ç©ºé—´æœ€å¤§å€¼-u &lt;username&gt;:è¿›ç¨‹å±žä¸»-p &lt;num&gt;:ç›‘å¬çš„tcpç«¯å£ï¼Œé»˜è®¤ä¸º11211-U &lt;num&gt;:ç›‘å¬çš„udpç«¯å£ï¼Œ0è¡¨ç¤ºå…³é—­-M å½“ç¼“å­˜æ»¡æ—¶ï¼Œç¦æ­¢å¯¹ç¼“å­˜æ¸…ç†-c æœ€å¤§å¹¶å‘è¿žæŽ¥æ•°-t &lt;threads&gt;ç”¨äºŽæŒ‡å®šæœåŠ¡å™¨å¯åŠ¨çš„çº¿ç¨‹æ•°ï¼›æ¯ä¸ªçº¿ç¨‹æ•°å“åº”å¤šä¸ªè¯·æ±‚Slab Allocator:å†…å­˜åˆ†é…å™¨é¢„å…ˆåˆ†é…å¥½å›ºå®šå¤§å°ï¼ˆslab classï¼‰å†…å­˜å—ï¼Œæ¯ç§å¤§å°çš„å—ï¼ˆchunkï¼‰æœ‰1 æˆ–å¤šä¸ªï¼›ç›¸ä¿¡çš„slab classçš„å¤§å°å·®åˆ«ç”±å¢žé•¿å› å­æŽ§åˆ¶;-f&lt;factor&gt;,é»˜è®¤ä¸º1.25# vim /etc/sysconfig/memcachedOPITONS=&quot; -f 1.1 -U 0&quot; å¯ä»¥æ›´æ”¹ phpè¿žæŽ¥memcachedç¨‹åº123456php-pecl-memcachephp-pecl-memcachedClusterä¿æŒä¼šè¯çš„æ–¹æ³•session stickysession clustersession server äºŒã€å®‰è£…é…ç½®memcached,php-fpm,nginxnode3 å®‰è£…memcached123# ansible node3 -m yum -a "name=memcached state=present"# ansible node3 -m command -a "rpm -ql memcached"# ansible node3 -m service -a "name=memcached state=started" node0,1,2å®‰è£…nginx12345678910# for i in &#123;1..2&#125;; do ansible node$i -m copy -a "src=/root/nginx-1.10.0-1.el7.ngx.x86_64.rpm dest=/root/ " ; done# for i in &#123;1..2&#125; ; do ssh node$i yum -y install /root/nginx-1.10.0-1.el7.ngx.x86_64.rpm ; donenode1,2å®‰è£…php-fpm mariadb php-pecl-memcached php-memcache php-memcached# for i in &#123;1..2&#125;; do ansible node$i -m yum -a "name=mariadb-server state=present" ; done# for i in &#123;1..2&#125;; do ansible node$i -m yum -a "name=php-fpm state=present" ; done# for i in &#123;1..2&#125;; do ansible node$i -m service -a "name=mariadb enabled=on" ; done# for i in &#123;1..2&#125;; do ansible node$i -m yum -a "name=php-pecl-memcached state=present" ; done# ll /usr/lib64/php/modules/ å®‰è£…å®Œ php-peclmemcached åŽå¯ä»¥çœ‹åˆ° memcached.so-rwxr-xr-x 1 root root 118160 Apr 2 2014 memcached.so-rwxr-xr-x 1 root root 106160 Jun 10 2014 memcache.so 1234567891011# for i in &#123;1..2&#125; ; do ansible node$i -m yum -a "name=php-memcache state=present";done;# for i in &#123;1..2&#125; ; do ansible node$i -m yum -a "name=php-memcached state=present";done;# vim /etc/php.ini # æ³¨è¿™é‡Œç”¨çš„æ˜¯ansible æ‰€ä»¥å¯ä»¥ä¿®æ”¹æˆ–ç¼–è¾‘å¥½ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åŽå¤åˆ¶åˆ°å…¶å®ƒçš„ä¸¤ä¸ªåœ¨çº¿çš„ç»“ç‚¹[PHP] extension = "/usr/lib64/php/modules/memcache.so" æ³¨ï¼šè¦ä¿®æ”¹çš„åœ°æ–¹extension = "/usr/lib64/php/modules/memcached.so" æ³¨ï¼šè¦ä¿®æ”¹çš„åœ°æ–¹session.save_handler = memcached æ³¨:éœ€è¦ä¿®æ”¹session.save_path = "tcp://node3:11211 æ³¨ï¼šéœ€è¦ä¿®æ”¹ # for i in &#123;1..2&#125;; do ansible node$i -m copy -a "src=/etc/php.ini dest=/etc/ " ; done# for i in &#123;1..2&#125;; do ansible node$i -m service -a "name=php-fpm state=started " ; done 1234567891011121314151617181920# vim /etc/nginx/conf.d/default.confserver &#123;listen 80;server_name localhost;location / &#123; root /usr/share/nginx/html; index index.html index.htm index.php;&#125;error_page 500 502 503 504 /50x.html;location = /50x.html &#123;root /usr/share/nginx/html;&#125;location ~ \.php$ &#123;root /usr/share/nginx/html;fastcgi_pass 127.0.0.1:9000;fastcgi_index index.php;fastcgi_param SCRIPT_FILENAME /usr/share/nginx/html$fastcgi_script_name;include fastcgi_params;&#125;&#125; 1234#vim /usr/share/nginx/html/index.php&lt;?phpphpinfo() ;?&gt; å°†nignxçš„é…ç½®æ–‡ä»¶å’Œphpçš„æµ‹è¯•é¡µå¤åˆ¶åˆ°ä¸¤ä¸ªç»“ç‚¹ä¸Š1234# for i in &#123;1..2&#125;; do ansible node$i -m copy -a "src=/etc/nginx/conf.d/default.conf dest=/etc/nginx/conf.d/ " ; done# for i in &#123;1..2&#125;; do ansible node$i -m copy -a "src=/usr/share/nginx/html/index.php dest=/usr/share/nginx/html/ " ; doneå¯åŠ¨ä¸¤ä¸ªç»“ç‚¹(node1,node2)çš„nginx# for i in &#123;1..2&#125; ; do ansible node$i -m service -a "name=nginx state=started";done; åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ http://172.16.23.11/index.phpæŸ¥çœ‹ä¸¤ä¸ªç»“ç‚¹çš„phpæ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”æŸ¥çœ‹å…¶index.phpä¸­æä¾›çš„phpinfo(); phpé…ç½®ä¿¡æ¯ ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°memcache å’Œmemcachedä¸¤é¡¹ è®¿é—® http://172.16.23.12/index.php ä¸‰ã€åœ¨node0ç»“ç‚¹ä¸Šé…ç½®nginxè´Ÿè½½å‡è¡¡åŽå°ä¸¤å°(node1,node2)ä¸»æœºï¼Œä¸ºä¸¤ç»“ç‚¹é€šè¿‡phpç¨‹åºæµ‹è¯•mariadbæ³¨ï¼š ç”±äºŽansibleå°±åœ¨node0ä¸Šï¼Œæ‰€ä»¥æ­¤å¤„ç›´æŽ¥ç”¨ç³»ç»Ÿè‡ªèº«çš„å‘½ä»¤æ¥è¿›è¡Œé…ç½®ï¼Œè€Œéžè¿œç¨‹æ‰§è¡Œ; æŠŠåˆšåˆšç»™node1,node2è¿œç¨‹å¤åˆ¶çš„default.confé…ç½®è¿˜åŽŸè¿˜åŽ»; ç”±äºŽnode0çš„nginxæ— å…¶å®ƒå°†é…ç½®æ–‡ä»¶åˆ äº†é‡æ–°å®‰è£…ä¸€ä¸‹nignx ä¹Ÿè¡Œï¼› è´Ÿè½½å‡è¡¡123456# vim /etc/nginx/nginx.conf# åœ¨httpæ®µä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹upstream mem &#123;server node1:80;server node2:80;&#125; 1234# vim /etc/nginx/conf.d/default.conf# åœ¨æ¯ä¸€ä¸ªlocationä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹proxy_pass http://mem;# systemctrl start nginx æ­¤æ—¶nginxå·²ç»å¯ä»¥è´Ÿè½½å‡è¡¡åŽé¢çš„ä¸¤å°æœåŠ¡å™¨äº†ä¸ºnode1,node2æä¾›ä¸¤ä¸ªphpè¿žæŽ¥mysqlçš„æµ‹è¯•é¡µ 123456&lt;h1&gt;www.rj.com NODE2&lt;/h1&gt;&lt;?php$link=mysql_connect("localhost","root","centos.123");if(!$link)echo"CNONNECT FILED!";else echo "CAN CNONNECT !";?&gt; æ­¤æ—¶è®¿é—®nginxçš„è´Ÿè½½å‡è¡¡çš„ç»“ç‚¹172.16.23.10åŽå¯æµ‹è¯•ç»“æžœå¦‚ä¸‹]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MariaDBä¹‹åŸºäºŽopensslçš„ä¸»ä»Žå¤åˆ¶]]></title>
    <url>%2F2018%2F02%2F07%2FMariaDB%E4%B9%8B%E5%9F%BA%E4%BA%8Eopenssl%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%2F</url>
    <content type="text"><![CDATA[ä¸€ã€é…ç½®openssl1ã€ åœ¨master server(node0)ä¸Šæ ¹CAçš„æ­å»º(åŠç”Ÿæˆè‡ªç­¾åè¯ä¹¦)1234567891011121314151617181920212223[root@node0 ~]# cd /etc/pki/CA/[root@node0 CA]# (umask 077;openssl genrsa -out private/cakey.pem 2048)Generating RSA private key, 2048 bit long modulus.................+++..................+++e is 65537 (0x10001)[root@node0 CA]# touch index.txt [root@node0 CA]# echo 01 &gt; serial[root@node0 CA]# openssl req -new -x509 -key private/cakey.pem -out ./cacert.pem -days 3650You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Country Name (2 letter code) [XX]:CNState or Province Name (full name) []:BJLocality Name (eg, city) [Default City]:BJOrganization Name (eg, company) [Default Company Ltd]:rjOrganizational Unit Name (eg, section) []:rjCommon Name (eg, your name or your server's hostname) []:www.rj.comEmail Address []: 2ã€ä¸ºmasterä¸»æœºç”Ÿæˆå¯†é’¥ï¼Œå¹¶åä¸ºä¹‹ç­¾å1234567891011121314151617181920212223242526[root@node0 CA]# cd /etc/my.cnf.d/[root@node0 my.cnf.d]# (umask 077;openssl genrsa -out master.key 2048)Generating RSA private key, 2048 bit long modulus...............................................+++................+++e is 65537 (0x10001)[root@node0 my.cnf.d]# openssl req -new -key /etc/my.cnf.d/master.key -out /etc/my.cnf.d/master.csrYou are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Country Name (2 letter code) [XX]:CNState or Province Name (full name) []:BJ Locality Name (eg, city) [Default City]:BJOrganization Name (eg, company) [Default Company Ltd]:rjOrganizational Unit Name (eg, section) []:rjCommon Name (eg, your name or your server's hostname) []:www.rj.comEmail Address []:Please enter the following 'extra' attributesto be sent with your certificate requestA challenge password []:An optional company name []: 3ã€æ ¹CAç­¾å‘masterè¯·æ±‚1234567891011121314151617181920212223242526272829303132[root@node0 my.cnf.d]# openssl ca -in master.csr -out master.crt -days 3650Using configuration from /etc/pki/tls/openssl.cnfCheck that the request matches the signatureSignature okCertificate Details: Serial Number: 1 (0x1) Validity Not Before: Feb 16 06:55:06 2017 GMT Not After : Feb 14 06:55:06 2027 GMT Subject: countryName = CN stateOrProvinceName = BJ organizationName = rj organizationalUnitName = rj commonName = www.rj.com X509v3 extensions: X509v3 Basic Constraints: CA:FALSE Netscape Comment: OpenSSL Generated Certificate X509v3 Subject Key Identifier: B4:A1:66:8C:5B:2B:F9:59:9D:F6:4F:F7:35:72:E2:87:9C:A5:95:F9 X509v3 Authority Key Identifier: keyid:71:DD:03:78:51:12:5F:58:C2:1B:53:76:A0:2B:E9:BF:60:D8:67:36Certificate is to be certified until Feb 14 06:55:06 2027 GMT (3650 days)Sign the certificate? [y/n]:y1 out of 1 certificate requests certified, commit? [y/n]yWrite out database with 1 new entriesData Base Updated 4ã€ä¸ºslaveç»“ç‚¹(node1)é…ç½®openssl123456789101112131415161718192021222324252627282930313233[root@node1 CA]# cd /etc/my.cnf.d/[root@node1 my.cnf.d]# (umask 077;openssl genrsa -out slave.key 2048)Generating RSA private key, 2048 bit long modulus.............+++......................................................................................................................................................................................................................................................+++e is 65537 (0x10001)[root@node1 my.cnf.d]# openssl req -new -key slave.key -out slave.csrYou are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Country Name (2 letter code) [XX]:CNState or Province Name (full name) []:BJLocality Name (eg, city) [Default City]:BJOrganization Name (eg, company) [Default Company Ltd]:rjOrganizational Unit Name (eg, section) []:rjCommon Name (eg, your name or your server's hostname) []:www.rj.comEmail Address []:Please enter the following 'extra' attributesto be sent with your certificate requestA challenge password []:An optional company name []:[root@node1 my.cnf.d]# scp slave.csr node0:/tmpThe authenticity of host 'node0 (172.16.23.10)' can't be established.ECDSA key fingerprint is 2b:98:49:35:5b:78:24:ed:f0:ab:fa:54:b1:8e:df:29.Are you sure you want to continue connecting (yes/no)? yesWarning: Permanently added 'node0,172.16.23.10' (ECDSA) to the list of known hosts.root@node0's password: slave.csr 5ã€ä¸ºslaveç»“ç‚¹ç­¾å‘è¯·æ±‚123456789101112131415161718192021222324252627282930313233343536[root@node0 my.cnf.d]# mv /etc/pki/CA/serial /root/[root@node0 my.cnf.d]# mv /etc/pki/CA/index.txt /root/[root@node0 my.cnf.d]# touch /etc/pki/CA/index.txt[root@node0 my.cnf.d]# echo 01 &gt; /etc/pki/CA/serial[root@node0 my.cnf.d]# openssl ca -in /tmp/slave.csr -out slave.crt -days 3650Using configuration from /etc/pki/tls/openssl.cnfCheck that the request matches the signatureSignature okCertificate Details: Serial Number: 1 (0x1) Validity Not Before: Feb 16 07:07:14 2017 GMT Not After : Feb 14 07:07:14 2027 GMT Subject: countryName = CN stateOrProvinceName = BJ organizationName = rj organizationalUnitName = rj commonName = www.rj.com X509v3 extensions: X509v3 Basic Constraints: CA:FALSE Netscape Comment: OpenSSL Generated Certificate X509v3 Subject Key Identifier: A5:FE:11:EB:4D:B5:F1:85:61:E7:18:E3:1D:B7:25:C6:1B:24:97:AF X509v3 Authority Key Identifier: keyid:71:DD:03:78:51:12:5F:58:C2:1B:53:76:A0:2B:E9:BF:60:D8:67:36Certificate is to be certified until Feb 14 07:07:14 2027 GMT (3650 days)Sign the certificate? [y/n]:y1 out of 1 certificate requests certified, commit? [y/n]yWrite out database with 1 new entriesData Base Updated 123[root@node0 my.cnf.d]# scp slave.crt node1:/etc/my.cnf.d/slave.crt 100% 4382 4.3KB/s 00:00 # æ­¤æ—¶ä¸»ä»Žç»“ç‚¹çš„è¯ä¹¦éƒ½å·²ç»å‡†å¤‡å¥½ äºŒã€é…ç½®mariadbä¸»ä»ŽæœåŠ¡å™¨1ã€å·¥ä½œæ‹“æ‰‘å›¾ 2ã€ä¸»æœåŠ¡å™¨é…ç½®12345678910111213141516171819[root@node0 ~]# yum -y install mariadb[root@node0 my.cnf.d]# vim /etc/my.cnfå°†mysqldæ®µä¸­çš„é…ç½®ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹[mysqld]datadir=/var/lib/mysqlsocket=/var/lib/mysql/mysql.socksymbolic-links=0innodb-file-per-table = ONskip-name-resolve = ONserver-id = 1 log-bin = master-logsslssl_ca=/etc/my.cnf.d/cacert.pem ssl_cert=/etc/my.cnf.d/master.crtssl_key=/etc/my.cnf.d/master.key [root@node0 my.cnf.d]# cp /etc/pki/CA/cacert.pem .[root@node0 my.cnf.d]# chown mysql.mysql cacert.pem master.*[root@node0 my.cnf.d]# systemctl start mariadb 3ã€ä»ŽæœåŠ¡é…ç½®123456789101112131415161718[root@node0 ~]# yum -y install mariadb[root@node0 my.cnf.d]# vim /etc/my.cnfå°†mysqldæ®µä¸­çš„é…ç½®ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹[mysqld]datadir=/var/lib/mysqlsocket=/var/lib/mysql/mysql.socksymbolic-links=0skip_name_resolve = ON relay-log = relay-logserver-id = 2 æ³¨idå·ä¸èƒ½ä¸Žä¸»æœåŠ¡çš„ä¸€æ ·sslssl-ca = /etc/my.cnf.d/cacert.pemssl-cert = /etc/my.cnf.d/slave.crtssl-key = /etc/my.cnf.d/slave.key[root@node0 my.cnf.d]# scp /etc/pki/CA/cacert.pem node1:/etc/my.cnf.d/cacert.pem [root@node1 my.cnf.d]# cd /etc/my.cnf.d/ &amp;&amp; chown mysql.mysql cacert.pem slave.*[root@node1 my.cnf.d]# systemctl start mariadb 4ã€ä¸»æœåŠ¡å™¨æŽˆæƒä¸€ä¸ªç”¨æˆ·å¯è¿žæŽ¥mysqlæ‹‰å–äºŒè¿›åˆ¶æ–‡ä»¶1MariaDB [(none)]&gt; GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO 'rj'@'172.16.23.11' IDENTIFIED BY 'centos.123' REQUIRE ssl; 5ã€é…ç½®ä»ŽæœåŠ¡å™¨è¿žæŽ¥åˆ°ä¸»æœåŠ¡å™¨ï¼Œå¹¶æ‹‰å–æ•°æ®å…ˆæŸ¥çœ‹ä¸»ç»“ç‚¹çš„äºŒè¿›åˆ¶æ—¥å¿— 123456MariaDB [(none)]&gt; SHOW MASTER STATUS; +-------------------+----------+--------------+------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |+-------------------+----------+--------------+------------------+| master-log.000007 | 342 | | |+-------------------+----------+--------------+------------------+ 123MariaDB [(none)]&gt; CHANGE MASTER TO MASTER_HOST='172.16.23.10', MASTER_USER='rj', MASTER_PASSWORD='centos.123', MASTER_LOG_FILE='master-log.000007', MASTER_LOG_POS=245, MASTER_SSL=1, MASTER_SSL_CA='/etc/my.cnf.d/cacert.pem', MASTER_SSL_CERT='/etc/my.cnf.d/slave.crt', MASTER_SSL_KEY='/etc/my.cnf.d/slave.key';Query OK, 0 rows affected (0.03 sec)æŸ¥çœ‹ä¸»ä»ŽæœåŠ¡å™¨çš„opensslçš„æ˜¯ç”¨å¦ç”¨ 123456789101112MariaDB [(none)]&gt; SHOW VARIABLES LIKE '%ssl%';+---------------+--------------------------+| Variable_name | Value |+---------------+--------------------------+| have_openssl | YES || have_ssl | YES || ssl_ca | /etc/my.cnf.d/cacert.pem || ssl_capath | || ssl_cert | /etc/my.cnf.d/master.crt || ssl_cipher | || ssl_key | /etc/my.cnf.d/master.key |+---------------+--------------------------+ 123456789101112MariaDB [(none)]&gt; SHOW VARIABLES LIKE '%ssl%';+---------------+--------------------------+| Variable_name | Value |+---------------+--------------------------+| have_openssl | YES || have_ssl | YES || ssl_ca | /etc/my.cnf.d/cacert.pem || ssl_capath | || ssl_cert | /etc/my.cnf.d/slave.crt || ssl_cipher | || ssl_key | /etc/my.cnf.d/slave.key |+---------------+--------------------------+ 6ã€å¯ç”¨ä»ŽæœåŠ¡å™¨12345678910111213141516171819202122232425262728293031323334353637383940414243444546MariaDB [(none)]&gt; START SLAVE;Query OK, 0 rows affected, 1 warning (0.00 sec)MariaDB [(none)]&gt; SHOW SLAVE STATUS \G*************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 172.16.23.10 Master_User: rj Master_Port: 3306 Connect_Retry: 60 Master_Log_File: master-log.000007 Read_Master_Log_Pos: 245 Relay_Log_File: relay-log.000003 Relay_Log_Pos: 530 Relay_Master_Log_File: master-log.000007 Slave_IO_Running: Yes æ³¨:IO SQLè¿™ä¸¤é¡¹è¡¨ç¤ºä¸»ä»ŽåŒæ­¥å·²ç»æ­£å­¦è¿›è¡Œ Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 245 Relay_Log_Space: 818 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: Yes Master_SSL_CA_File: /etc/my.cnf.d/cacert.pem Master_SSL_CA_Path: Master_SSL_Cert: /etc/my.cnf.d/slave.crt Master_SSL_Cipher: Master_SSL_Key: /etc/my.cnf.d/slave.key Seconds_Behind_Master: 0Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 11 row in set (0.00 sec) 7ã€ç”±äºŽä»ŽæœåŠ¡å™¨åªèƒ½è¯»ï¼Œæ‰€ä»¥éœ€è¦å¼€å¯mariadbçš„åªè¯»1234567MariaDB [(none)]&gt; SHOW VARIABLES LIKE 'read_only';+---------------+-------+| Variable_name | Value |+---------------+-------+| read_only | ON |+---------------+-------+1 row in set (0.00 sec) 12MariaDB [(none)]&gt; SET GLOBAL read_only=ON;Query OK, 0 rows affected (0.00 sec) 8ã€opensslè¿›è¡Œæµ‹è¯•1234567891011121314151617[root@node1 my.cnf.d]# mysql -urj -pcentos.123 -h172.16.23.10 --ssl-ca=/etc/my.cnf.d/cacert.pem --ssl-cert=/etc/my.cnf.d/slave.crt --ssl-key=/etc/my.cnf.d/slave.keyWelcome to the MariaDB monitor. Commands end with ; or \g.Your MariaDB connection id is 7Server version: 5.5.44-MariaDB-log MariaDB ServerCopyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.MariaDB [(none)]&gt; SHOW DATABASES;+--------------------+| Database |+--------------------+| information_schema || test |+--------------------+2 rows in set (0.00 sec) 9ã€ä¸»ä»ŽåŒæ­¥æµ‹è¯•123456789101112MariaDB [(none)]&gt; CREATE DATABASE node0create;åœ¨ä¸»æœåŠ¡ä¸Šåˆ›å»ºäº†ä¸€ä¸ªåº“Query OK, 1 row affected (0.00 sec)MariaDB [(none)]&gt; SHOW DATABASES; åœ¨ä»ŽæœåŠ¡å™¨ä¸Šä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°äº†+--------------------+| Database |+--------------------+| information_schema || mysql || node0create || performance_schema || test |+--------------------+]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>database</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[corosync v2 + pacemaker + crmsh å®žçŽ°mariadbé«˜å¯ç”¨]]></title>
    <url>%2F2018%2F02%2F07%2Fcorosync-v2-pacemaker-crmsh-%E5%AE%9E%E7%8E%B0mariadb%E9%AB%98%E5%8F%AF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[é«˜å¯ç”¨mariadbæ‹“æ‰‘å›¾ ä¸€ã€è®¾è®¡å‰æ1ã€æ—¶é—´åŒæ­¥ # ntpdate 172.16.0.1 æˆ–è€… # chronyc sources2ã€æ‰€æœ‰çš„ä¸»æœºå¯¹åº”çš„IPåœ°å€è§£æžå¯ä»¥æ­£å¸¸å·¥ä½œï¼Œ ä¸»æœºåè¦ä¸Žå‘½ä»¤#uname -n æ‰€å¾—çš„ç»“æžœä¸€è‡´ å› æ­¤ï¼Œ/etc/hostsä¸­çš„å†…å®¹ä¸ºä»¥ä¸‹å†…å®¹ 123172.16.23.10 node1.rj.com node1 172.16.23.11 node2.rj.com node2 172.16.23.12 node3.rj.com node3 äºŒã€çŽ¯å¢ƒçš„å»ºç«‹åŠå®‰è£…orosync ,pacemaker ,crmshä¸‰å°æœºå™¨éƒ½å®‰è£…å¥½ansible ï¼ˆå¯¹äºŽansibleé›†ç¾¤ç®¡ç†å·¥å…·è€Œè¨€éœ€è¦åŒæœºäº’ä¿¡,å…¶ä¸­node1å½“åšå ¡åž’æœºï¼‰ å®‰è£…é…ç½®12345678910111213141516# ssh-keygen # for i in &#123;10..12&#125;; do ssh-copy-id -i 172.16.23.$i ; done ; # æ­¤æ¡å‘½ä»¤å°†å…¬é’¥å‘é€ç»™ä¸‰å°æœºå™¨ï¼Œå…¶ä¸­åŒ…æ‹¬è‡ªå·±ä¹Ÿå°±æ˜¯å ¡åž’æœº# vim /etc/ansible/hosts [mariadb] 172.16.23.10 172.16.23.11 172.16.23.12# ansible mariadb -m ping # æµ‹è¯•ä¸‰å°ä¸»æœºä¸Žå ¡åž’æœºä¹‹é—´çš„è¿žé€šæ€§ # vim /etc/hosts ä¸»æœºåè§£æžé…ç½® 172.16.23.10 node1.rj.com node1 172.16.23.11 node2.rj.com node2 172.16.23.12 node3.rj.com node3# ansible mariadb -m command -a "ntpdate 172.16.0.1" åŒæ­¥ä¸‰å°ä¸»æœºçš„æ—¶é—´ # ansible mariadb -m yum -a "name=pacemaker,mariadb-server state=present" åœ¨ä¸‰å°ä¸»æœºä¸Šå®‰è£… mariadb ,corosync å’Œ pacemaker æ³¨ï¼šyum å®‰è£…pacemaker çš„æ—¶å€™ï¼Œå…¶corosyncä¹Ÿä¼šè‡ªåŠ¨å®‰è£…ä¸Š corosyncé…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142# vim /etc/corosync/corosync.conf åŠ å…¥ä»¥ä¸‹ä¿¡æ¯ totem &#123; version: 2 crypto_cipher: aes256 crypto_hash: sha1 interface &#123; ringnumber: 0 bindnetaddr: 172.16.0.0 mcastaddr: 239.255.23.1 mcastport: 5405 ttl: 1 &#125; logging &#123; fileline: off to_stderr: no to_logfile: yes logfile: /var/log/cluster/corosync.log to_syslog: no debug: off timestamp: on logger_subsys &#123; subsys: QUORUM debug: off &#125; quorum &#123; provider: corosync_votequorum node &#123; ring0_addr: node1.rj.com nodeid:1 &#125; node &#123; ring0_addr: node2.rj.com nodeid:2 &#125; node &#123; ring0_addr: node3.rj.com nodeid:3 &#125; &#125; 123456# corosync-keygen # ansible mariadb -m copy -a "src=/etc/corosync/authkey dest=/etc/corosync/"# ansible mariadb -m copy -a "src=/etc/corosync/corosync.conf dest=/etc/corosync/"# ansible mariadb -m service -a "name=corosync state=persent"# ansible mariadb -m service -a "name=pacemaker state=persent"# tcpdump -i eno16777736 -nn port 5405 æŠ“åŒ…åˆ†æžä½¿ç”¨tcpdumpæŠ“åŒ…å·¥å…·å¯ä»¥æ¥æŸ¥çœ‹ä¸‰å°ä¸»æœºä¹‹é—´ä¼ é€’çš„å¿ƒè·³ä¿¡æ¯ æ³¨:mariadbåœ¨é›†ç¾¤èµ„æºçš„é…ç½®ä¸­å¿…éœ€æ˜¯å¼€æœºè‡ªå¯åŠ¨çš„è¿™æ ·corosyncæ‰èƒ½å®žåˆ«å…¶Unitfile æ–‡ä»¶ï¼Œè€Œä¸èƒ½åœ¨é…ç½®å‰å¯åŠ¨æ‰€ä»¥æœåŠ¡ä¸€å®šæ˜¯å…³é—­çš„ 123456789# ansible mariadb -m service -a "name=mariadb enabled=on"# ansible mariadb -m service -a "name=corosync enabled=on"# ansible mariadb -m service -a "name=pacemaker enabled=on"# mkdir rpm &amp;&amp; cd rpm # wget 172.18.0.1/pub/Sources/7.x86_64/crmsh/crmsh-2.1.4-1.1.x86_64.rpm ä¸‹è½½crmshåŠå…¶æ‰€ä¾èµ–çš„rpmåŒ… # wget 172.18.0.1/pub/Sources/7.x86_64/crmsh/pssh*.rpm# wget 172.18.0.1/pub/Sources/7.x86_64/crmsh/python-passh*.rpm # ansible mariadb -m copy -a "src=/root/rpm dest=/root/"# for i in &#123;1..3&#125;; do ssh node$i yum -y install /root/rpm/*; done æŸ¥çœ‹corosyncå¼•æ“Žæ˜¯å¦å·²ç»æ­£å¸¸å¯åŠ¨1234567891011# ansible mariadb -e command -a "grep -e 'Corosync Cluster Engine' -e 'configuration file' /var/log/messages" Feb 13 11:27:35 node1 systemd: Stopped Corosync Cluster Engine.Feb 13 14:08:03 node1 systemd: Starting Corosync Cluster Engine...Feb 13 14:08:04 node1 corosync: Starting Corosync Cluster Engine (corosync): [ OK ]Feb 13 14:08:04 node1 systemd: Started Corosync Cluster Engine.Feb 13 14:28:16 node1 systemd: Mounted NFSD configuration filesystem.Feb 13 14:28:44 node1 smartd[787]: Opened configuration file /etc/smartmontools/smartd.confFeb 13 14:32:12 node1 systemd: Starting Corosync Cluster Engine... Feb 13 14:32:13 node1 corosync: Starting Corosync Cluster Engine (corosync): [ OK ]Feb 13 14:32:13 node1 systemd: Started Corosync Cluster Engine.Feb 13 14:43:03 node1 systemd: Started Corosync Cluster Engine. æŸ¥çœ‹å…¶æˆå‘˜ä¹‹é—´çš„ç»“ç‚¹é€šçŸ¥ä¿¡æ¯æ˜¯å¦æ­£å¸¸1234567891011# ansible mariadb -e command -a "grep TOTEM /var/log/messages"æŸ¥çœ‹å¯åŠ¨è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯äº§ç”Ÿ # ansible mariadb -e command -a "grep 'ERROR' /var/log/messages"æŸ¥çœ‹pacemakeræ˜¯å¦å·²ç»æ­£å¸¸å¯åŠ¨# ansible mariadb -e command -a "grep 'pacemaker' /var/log/messages " ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç»“ç‚¹çš„çŠ¶æ€# crm status Last updated: Mon Feb 13 15:43:08 2017Last change: Mon Feb 13 14:33:58 2017 by hacluster via crmd on node3.rj.comStack: corosync Current DC: node3.rj.com (version 1.1.13-10.el7-44eb2dd) - partition with quorum3 nodes and 0 resources configured Online: [ node1.rj.com node2.rj.com node3.rj.com ] æŸ¥çœ‹pacemaker å’Œä¸Žcorosyncæ‰€å¯åŠ¨çš„è¿›ç¨‹12345678910# ansible mariadb -m command -a "ps auxf " | grep pacemakerroot 1720 0.0 1.3 130484 6384 ? Ss 14:33 0:00 /usr/sbin/pacemakerd -fhaclust+ 1729 0.0 2.7 132816 13268 ? Ss 14:33 0:01 \_ /usr/libexec/pacemaker/cibroot 1730 0.0 1.4 133968 6956 ? Ss 14:33 0:00 \_ /usr/libexec/pacemaker/stonithdroot 1731 0.0 0.8 102936 4108 ? Ss 14:33 0:00 \_ /usr/libexec/pacemaker/lrmdhaclust+ 1732 0.0 1.3 124780 6736 ? Ss 14:33 0:00 \_ /usr/libexec/pacemaker/attrdhaclust+ 1733 0.0 0.7 114896 3668 ? Ss 14:33 0:00 \_ /usr/libexec/pacemaker/penginehaclust+ 1734 0.0 1.5 143160 7484 ? Ss 14:33 0:00 \_ /usr/libexec/pacemaker/crmd# ansible marriadb -m command -a "ps auxf" | grep corosync root 1483 0.6 7.9 134848 38436 ? Ssl 14:32 0:28 corosync ä¸‰ã€åˆ©ç”¨crmshæ¥é…ç½®corosyncçš„IPåœ°å€èµ„æºåŠmariadbèµ„æºå¦‚æžœæƒ³è¦æŸ¥çœ‹æŸç§ç±»åˆ«ä¸‹çš„æ‰€ç”¨èµ„æºä»£ç†çš„åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„å‘½ä»¤æ¥å®žçŽ° å®‰è£…é…ç½®1234#crm ra list lsb #crm ra list ocf heartbeat #crm ra list ocf pacemaker #crm ra list ocf stonith é…ç½®vip1 # crm configure property stonith-enabled=false #å…³é—­stonsthè®¾å¤‡ 1234567891011121314# crm configure primitive DBIP ocf:heartbeat:IPaddr params ip=172.16.23.23 æ·»åŠ vipèµ„æºä»£ç† # crm configure verify æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯# crm configure commit ç”¨æ¥æäº¤é…ç½®ä¿¡æ¯ # crm configure show å¯ä»¥ç”¨æ¥æŸ¥çœ‹é…ç½®ä¿¡æ¯ node 1: node1.rj.com node 2: node2.rj.com node 3: node3.rj.com primitive DBIP IPaddr \ params ip=172.16.23.23 property cib-bootstrap-options: \ have-watchdog=false \ dc-version=1.1.13-10.el7-44eb2dd \ cluster-infrastructure=corosync \ stonith-enabled=false 1234567891011# crm node standby node1.rj.com å½“å°†node1ç»“ç‚¹æˆä¸ºå¤‡ç”¨ç»“ç‚¹æ—¶ # ansible mariadb -m command -a "ip addr list" æŸ¥çœ‹å…¶vipçš„å˜åŒ–ä¿¡æ¯# crm ra info systemd:mairadb ç”¨æ¥æŸ¥çœ‹systemdç±»åž‹çš„mariadbèµ„æºçš„è¯­æ³•æ ¼å¼ systemd unit file for mariadb (systemd:mariadb) MariaDB database server Operations' defaults (advisory minimum): start timeout=15 stop timeout=15 status timeout=15 restart timeout=15 monitor timeout=15 interval=15 start-delay=15 vipèµ„æº å½“node1 # crm node standby node1.rj.com æ—¶ å®šä¹‰mariadbgèµ„æºå¹¶è®¾å®šç›‘æŽ§123456789101112131415161718192021222324# crm configure primitive MDB systemd:mariadb op start timeout=15s op stop timeout=15s op monitor interval=15s timeout=15s # crm configure group DBservice DBIP MDB# crm configure verify # crm configure commit # crm configure show node 1: node1.rj.com \ attributes standby=on node 2: node2.rj.com \ attributes standby=off node 3: node3.rj.com \ attributes standby=off primitive DBIP IPaddr \ params ip=172.16.23.23 primitive MDB systemd:mariadb \ op start timeout=15s interval=0 \ op stop timeout=15s interval=0 \ op monitor interval=15s timeout=15s group DBservice DBIP MDB property cib-bootstrap-options: \ have-watchdog=false \ dc-version=1.1.13-10.el7-44eb2dd \ cluster-infrastructure=corosync \ stonith-enabled=false \ no-quorum-policy=ignore ä¸ºmariadbæœåŠ¡åŠ å…¥æ•°æ®åº“èµ„æºï¼Œå¹¶é…ç½®è¿œç¨‹ç”¨æˆ·è¿œç¨‹æŽ¥å…¥è¿›è¡Œæµ‹è¯• æ³¨ï¼šæ­¤æ—¶æœ‰ä¸€ä¸ªèµ„æºå·²ç»å¯åŠ¨ï¼Œä½†å…¶å®ƒçš„ä¸¤ä¸ªmariadbæœåŠ¡å¯åŠ¨ä¹‹åŽæ‰èƒ½è¿›è¡Œå¯¹æ•°æ®åº“çš„æ›´æ”¹ ä½†æ›´æ”¹å®ŒåŽæ—‹å¾—å†å°†é‚£ä¸¤ä¸ªç»“ç‚¹çš„æ•°æ®åº“åœæ­¢è°ƒ node1 node2 node3ä¸Šæ‰§è¡Œ: # mysql -e &quot;GRANT ALL ON *.* TO &apos;root&apos;@&apos;%.%.%.%&apos; IDENTIFIED BY &apos;centos.123&apos;;&quot; node1 # mysql -e &quot;CREATE DATABASE NODE1&quot; node2 # mysql -e &quot;CREATE DATABASE NODE2&quot; node3 # mysql -e &quot;CREATE DATABASE NODE3&quot; å¯ç”¨ä¸€å°æµ‹è¯•æœºè¿›è¡Œæµ‹è¯• node1 12# systemctl stop corosync.service pacemaker.service # å½“node1çš„æœåŠ¡åœæ­¢æ—¶ 12# systemctl stop corosync.service pacemaker.service # å½“node2çš„æœåŠ¡åœæ­¢æ—¶]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS 7 tomcat 7.0.54 çš„åŠŸèƒ½å®žçŽ°åŠè¯¦è§£]]></title>
    <url>%2F2018%2F02%2F07%2FCentOS-7-tomcat-7-0-54-%E7%9A%84%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E5%8F%8A%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ä¸€ã€ jdk å®‰è£…é…ç½®123456789101112131415161718# yum install java-1.8.0-openjdk-devel (ä¾èµ–çš„java-1.8.0-openjdk,java-1.8.0-openjdk,headlessä¹Ÿä¼šè¢«å®‰è£… )# alternatives -h# vim /etc/profile.d/java.sh # åŠ å…¥ export JAVA_HOME=/usr# . /etc/profile.d/java.sh # printenv æŸ¥çœ‹çŽ¯å¢ƒå˜é‡#ç”¨rpmåŒ…å®‰è£… # wget ftp://172.16.0.1/pub/Sources/7.x86_64/jdk/jdk-8u25-linux-x64.rpm# rpm -ivh jdk-8u25-linux-x64.rpm# rpm -ql jdk1.8.0_25-1.8.0_25-fcs# cd /usr/java/default# vim /etc/profile.d/javad.shJAVA_HOME=/usr/java/latestPATH=$JAVA_HOME/bin:$PATHexport JAVA_HOME PATH# . /etc/profile.d/javad.sh # java -version tomcat:è¿è¡ŒäºŽJDKä¹‹ä¸Šï¼Œè¡¨çŽ°ä¸ºä¸€ä¸ªç‹¬ç«‹è€Œå®Œæ•´çš„javaè¿›ç¨‹ï¼Œå¯ä¸Žç”¨æˆ·äº¤äº’çš„webæœåŠ¡å™¨ä½¿ç”¨Javaè¯­è¨€ç¼–å†™Tomcatçš„æ ¸å¿ƒç»„ä»¶:server.xmlï¼Œå…¶é…ç½®çš„æ ¼å¼ä¸º 1234567891011121314151617&lt;Server&gt;&lt;Serivce&gt;&lt;connector/&gt;&lt;connecotr/&gt;...&lt;Engine&gt;&lt;Host&gt;&lt;Context/&gt;&lt;Context/&gt;&lt;/Host&gt;&lt;Host&gt;...&lt;/Host&gt;...&lt;/Engine&gt;&lt;/service&gt;&lt;/Server&gt; è¯´æ˜Žï¼š é¡¶çº§ç»„ä»¶:Server æœåŠ¡ç±»ç»„ä»¶:Service ç±» è¿žæŽ¥ç±»ç»„ä»¶:http,https,ajp t å®¹å™¨ç±»:Engine,Host,Context è¢«åµŒå¥—ç±»:value,logger,realm,loader,manager é›†ç¾¤ç±»ç»„ä»¶:listener,cluster,â€¦ cluster,â€¦ äºŒã€Tomcatå®‰è£…é…ç½®1ã€å®‰è£…tomcat:aã€äºŒè¿›åˆ¶æ ¼å¼å®‰è£…1234567# tar xvf apache-tomcat-VERSION.tar.gz -C /usr/local/ # cd /usr/local/ # ln -sv apache-tomcat-VERSION tomcat #vim /etc/profile.d/tomcat.sh export CATALINA_BASE=/usr/local/tomcat export PATH=$CATALINA_BASE/bin:$PATH# . /etc/profile.d/tomcat.sh bã€yumæºå®‰è£…123# yum -y install tomcat-webapps tomcat-docs-webapp tomcat-admin-webapps tomcat tomcat-lib# å®‰è£…å®ŒåŽå¯ä»¥ä½¿ç”¨å‘½ä»¤# systemctl start tomcat &amp;&amp; ss -tnl å¯åŠ¨tomcatæœåŠ¡å¹¶ä¸”æŸ¥çœ‹8080ç«¯å£æ˜¯å¦å¯ç”¨åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæµ‹è¯• http://172.16.254.248:8080/ 2ã€tomcatç¨‹åºç›®å½•ç»“æž„ bin:è„šæœ¬åŠå¯åŠ¨æ—¶ç”¨åˆ°çš„ç±» conf:é…ç½®æ–‡ä»¶ç›®å½• lib:åº“æ–‡ä»¶ï¼Œjavaç±»åº“ logs:æ—¥å¿—æ–‡ä»¶ç›®å½• temp:ä¸´æ—¶æ–‡ä»¶ç›®å½• webapps:webappçš„é»˜è®¤ç›®å½• work:å·¥ä½œç›®å½• 3ã€tomcatçš„é…ç½®æ–‡ä»¶è¯´æ˜Ž server.xmlï¼šä¸»é…ç½®æ–‡ä»¶; web.xmlï¼šæ¯ä¸ªwebappåªæœ‰éƒ¨ç½²åŽæ‰èƒ½è¢«è®¿é—®ï¼Œå®ƒçš„éƒ¨ç½²æ–¹å¼é€šè¿‡ç”±web.xmlè¿›è¡Œå®šä¹‰ï¼Œå…¶å­˜ä½ç½®ä¸ºWEB-INF/ç›®å½•ä¸­ï¼Œæ­¤æ–‡ä»¶ä¸ºæ‰€æœ‰çš„webappsæä¾›é»˜è®¤é…ç½®; context.xml:æ¯ä¸ªwebéƒ½å¯ä¸“ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒé€šå¸¸ç”±ä¸“ç”¨çš„é…ç½®æ–‡ä»¶context.xmlæ¥å®šä¹‰ï¼Œå…¶å­˜æ”¾ä½ç½®ä¸ºWEB-INF/ç›®å½•ä¸­ï¼Œæ­¤æ–‡ä»¶ä¸ºæ‰€æœ‰çš„webappsæä¾›é»˜è®¤é…ç½®; tomcat-users.xml:ç”¨æˆ·çš„è´¦å·å’Œæ–‡ä»¶; catalina.policy:å½“ä½¿ç”¨securityé€‰é¡¹å¯åŠ¨tomcatæ—¶ï¼Œç”¨äºŽä¸ºtomcatè®¾ç½®å®‰å…¨ç­–ç•¥ï¼› catalina.propreteis:javaç‰©å®šä¹‰æ–‡ä»¶ï¼Œç”¨äºŽè®¾å®šç±»åŠ è½½å™¨è·¯å¾„ï¼Œä»¥åŠä¸€äº›ä¸ŽJVMé«˜ä¼°ç›¸å…³å‚æ•°ï¼› logging.properties:æ—¥å¿—ç³»ç»Ÿç›¸å…³çš„é…ç½® ; 4ã€tomcat-users.xmlé…ç½®1# vim /etc/tomcat/tomcat-users.xml åœ¨æ®µä¸­åŠ å…¥ä»¥äº”å†…å®¹ 1234&lt;role rolename="manager-gui"/&gt;&lt;user username="centos" password="centos" roles="manager-gui"/&gt;&lt;role rolename="admin-gui"/&gt;&lt;user username="centos" password="centos" roles="admin-gui"/&gt; é‡å¯æœåŠ¡åŽå¹¶é‡æ–°è®¿é—®http://172.16.254.248:8080/ ç‚¹Server Statusã€Manager Appã€ Host Manageræ—¶è¾“å…¥ç”¨æˆ·åcentoså¯†ç centosè¿›è¡Œè®¿é—® 5ã€æä¾›ä¸€æµ‹è¯•ç±»åº”ç”¨ï¼Œå¹¶å†·éƒ¨ç½²ï¼›1#mkdir -pv /usr/share/tomcat/webapps/test/&#123;classes,lib,WEB-INF&#125; 12345678910111213# vim /usr/share/tomcat/webapps/test/index.jsp &lt;%@ page language="java" %&gt; &lt;%@ page import="java.util.*" %&gt; &lt;html&gt; &lt;head&gt;&lt;title&gt; Test Page &lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;% out.println("hellow world");%&gt; &lt;/body&gt; &lt;/html&gt;é‡æ–°è®¿é—®http://172.16.254.248:8080/test/æ—¶ä¼šæ˜¾ç¤ºhellow world 6ã€nginx + tomcat clusterç”¨nginx åä»£ä¸¤å°tomcatä¸»æœº ï¼Œcluster(172.16.254.248[nginx]) ,node1(172.16.251.232[Tomcat A]),node2(172.16.251.74[Tomcat B]) 1234567891011cluster# yum -y install nginx &amp;&amp; systemctl start nginx # vim /etc/nginx/nginx.conf# åœ¨httpæ®µä¸­åŠ å…¥upstream tomcat &#123;server 172.16.251.232:8080;server 172.16.251.74:8080;&#125;# vim /etc/nginx/conf.d/default.conf# åœ¨locationä¸­åŠ å…¥ proxy_pass http://tomcat/;nod1 # mkdir -pv /usr/share/tomcat/webapps/test/&#123;WEB-INF,classes,lib&#125; 1234567891011121314151617181920# vim /usr/share/tomcat/pwebapps/test/index.jsp &lt;%@ page language="java" %&gt;&lt;html&gt; &lt;head&gt;&lt;title&gt;TomcatA&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt;&lt;font color="red"&gt;TomcatA.rj.com&lt;/font&gt;&lt;/h1&gt;&lt;table align="centre" border="1"&gt; &lt;tr&gt;&lt;td&gt;Session ID&lt;/td&gt;&lt;% session.setAttribute("magedu.com","magedu.com"); %&gt;&lt;td&gt;&lt;%= session.getId() %&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt;&lt;td&gt;Created on&lt;/td&gt;&lt;td&gt;&lt;%= session.getCreationTime() %&gt;&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt; &lt;/body&gt;&lt;/html&gt;nod2 # mkdir -pv /usr/share/tomcat/webapps/test/&#123;WEB-INF,classes,lib&#125; 12345678910111213141516171819# vim /usr/share/tomcat/pwebapps/test/index.jsp &lt;%@ page language="java" %&gt;&lt;html&gt; &lt;head&gt;&lt;title&gt;TomcatA&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt;&lt;font color="red"&gt;TomcatB.rj.com&lt;/font&gt;&lt;/h1&gt;&lt;table align="centre" border="1"&gt; &lt;tr&gt;&lt;td&gt;Session ID&lt;/td&gt;&lt;% session.setAttribute("magedu.com","magedu.com"); %&gt;&lt;td&gt;&lt;%= session.getId() %&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt;&lt;td&gt;Created on&lt;/td&gt;&lt;td&gt;&lt;%= session.getCreationTime() %&gt;&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt; &lt;/body&gt;&lt;/html&gt; è®¿é—®http://172.16.254.248/test/æ—¶æ•ˆæžœå¦‚æžœä¸‹ 7ã€ httpd(proxy_http_module) + tomcat cluster12cluster#systemctl disable nginx &amp;&amp; systemctl stop nginx # yum -y install httpd 1234567891011121314151617181920# vim /etc/httpd/conf.d/tomcat.conf &lt;proxy balancer://tomcat&gt;BalancerMember http://172.16.251.232:8080BalancerMember http://172.16.251.74:8080ProxySet lbmethod=byrequests&lt;/proxy&gt;&lt;VirtualHost *:80&gt;ServerName www.rj.comProxyVia OnProxyRequests OffProxyPreserveHost On&lt;Proxy *&gt;Require all granted&lt;/Proxy&gt;ProxyPass / balancer://tomcat/ProxyPassReverse / balancer://tomcat/&lt;Location /&gt;Require all granted&lt;/Location&gt;&lt;/VirtualHost&gt; è®¿é—®http://172.16.254.248/test/æ—¶æ•ˆæžœå¦‚ä¸‹ å¯ç”¨balancerç®¡ç†æŽ¥å£ 123456cluster# vim /etc/httpd/conf.d/balancer-manager.conf &lt;Location /balancer-manager&gt;Sethandler balancer-manager ProxyPass !Require all granted &lt;/Location&gt; `è®¿é—®å…¶ç®¡ç†æŽ¥å£http://172.16.254.248/balancer-manageræ•ˆæžœå¦‚ä¸‹` 8ã€ httpd(proxy_ajp_module)+tomcat cluster1# cp /etc/httpd/conf.d/tomcat.conf /etc/httpd/conf.d/tomcat.conf.bak 1234567891011121314151617181920# vim /etc/httpd/conf.d/tomcat.conf &lt;proxy balancer://tomcat&gt;BalancerMember ajp://172.16.251.232:8009BalancerMember ajp://172.16.251.74:8009ProxySet lbmethod=byrequests&lt;/proxy&gt;&lt;VirtualHost *:80&gt;ServerName www.rj.comProxyVia On ProxyRequests Off ProxyPreserveHost On &lt;Proxy *&gt;Require all granted &lt;/Proxy&gt;ProxyPass / balancer://tomcat/ProxyPassReverse / balancer://tomcat/&lt;Location /&gt;Require all granted &lt;/Location&gt;&lt;/VirtualHost&gt; è®¿é—®http://172.16.254.248/test/æ—¶æ•ˆæžœå¦‚ä¸‹ ä¸‰ã€å¸¸ç”¨ç»„ä»¶é…ç½®Server:ä»£è¡¨tomcat instance, å³è¡¨çŽ°å‡ºä¸€ä¸ªJavaè¿›ç¨‹ï¼šç›‘å¬åœ¨8005ç«¯å£ï¼ŒåªæŽ¥æ”¶â€œSHUTDOWNâ€ï¼›å„serverç›‘å¬çš„ç«¯å£ä¸èƒ½ç›¸åŒï¼Œå› æ­¤ï¼Œåœ¨åŒä¸€ç‰©ç†ä¸»æœºå¯åŠ¨å¤šä¸ªå®žä¾‹æ—¶ï¼Œéœ€è¦ä¸ªæ”¹å…¶ç›‘å¬ç«¯å£ä¸ºä¸åŒçš„ç«¯å£ï¼› serviceï¼šç”¨äºŽå®žçŽ°å°†ä¸€ä¸ªæˆ–å¤šä¸ªconnectorç»„ä»¶å…³è”è‡³ä¸€ä¸ªengineç»„ä»¶ï¼›Connectorç»„ä»¶è´Ÿè´£æŽ¥æ”¶è¯·æ±‚ï¼Œå¸¸è§çš„æœ‰ä¸‰ç±»http/https/ajp:è¿›å…¥tomcatçš„è¯·æ±‚å¯åˆ†ä¸ºä¸¤ç±»ï¼› (1)standalone:è¯·æ±‚æ¥è‡ªäºŽå®¢æˆ·ç«¯çš„åä»£ç†æœåŠ¡å™¨ï¼š nginx â€“&gt; http connector â€“&gt; tomcat httpd(proxy_http_module) â€“&gt; http connector â€“&gt; tomcat httpd(proxy_ajp_module) â€“&gt; ajp connecetor â€“&gt; tomcat å±žæ€§ï¼š port=â€8080â€ protocol=â€HTTP/1.1â€ connectionTimeout=â€20000â€ addressï¼šç›‘å¬çš„IPåœ°å€ï¼›é»˜è®¤ä¸ºæœ¬æœºæ‰€æœ‰å¯ç”¨åœ°å€ï¼› maxThreadsï¼šæœ€å¤§å¹¶å‘è¿žæŽ¥æ•°ï¼Œé»˜è®¤ä¸º150ï¼› enableLookupsï¼šæ˜¯å¦å¯ç”¨DNSæŸ¥è¯¢åŠŸèƒ½ï¼› acceptCountï¼šç­‰å¾…é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼› secureï¼š sslProtocolï¼š Engineç»„ä»¶ï¼šServletå®žä¾‹ï¼Œå³servletå¼•æ“Žï¼Œå…¶å†…éƒ¨å¯ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªhostç»„ä»¶æ¥å®šä¹‰ç«™ç‚¹ï¼› é€šå¸¸éœ€è¦é€šè¿‡defaultHostæ¥å®šä¹‰é»˜è®¤çš„è™šæ‹Ÿä¸»æœºï¼› å±žæ€§ï¼š name= defaultHost=â€localhostâ€ jvmRoute= Hostç»„ä»¶ï¼šä½äºŽengineå†…éƒ¨ç”¨äºŽæŽ¥æ”¶è¯·æ±‚å¹¶è¿›è¡Œç›¸åº”å¤„ç†çš„ä¸»æœºæˆ–è™šæ‹Ÿä¸»æœºï¼Œç¤ºä¾‹ï¼š 123&lt;Host name="localhost" appBase="webapps"unpackWARs="true" autoDeploy="true"&gt;&lt;/Host&gt; å¸¸ç”¨å±žæ€§è¯´æ˜Žï¼š(1) appBaseï¼šæ­¤Hostçš„webappsçš„é»˜è®¤å­˜æ”¾ç›®å½•ï¼ŒæŒ‡å­˜æ”¾éžå½’æ¡£çš„webåº”ç”¨ç¨‹åºçš„ç›®å½•æˆ–å½’æ¡£çš„WARæ–‡ä»¶ç›®å½•è·¯å¾„ï¼›å¯ä»¥ä½¿ç”¨åŸºäºŽ$CATALINA_BASEå˜é‡æ‰€å®šä¹‰çš„è·¯å¾„çš„ç›¸å¯¹è·¯å¾„ï¼› (2) autoDeployï¼šåœ¨Tomcatå¤„äºŽè¿è¡ŒçŠ¶æ€æ—¶ï¼Œå°†æŸwebappæ”¾ç½®äºŽappBaseæ‰€å®šä¹‰çš„ç›®å½•ä¸­æ—¶ï¼Œæ˜¯å¦è‡ªåŠ¨å°†å…¶éƒ¨ç½²è‡³tomcatï¼› ç¤ºä¾‹ï¼š 12&lt;Host name="tc1.magedu.com" appBase="/appdata/webapps" unpackWARs="true" autoDeploy="true"&gt;&lt;/Host&gt; 12# mkdir -pv /appdata/webapps# mkdir -pv /appdata/webapps/ROOT/&#123;lib,classes,WEB-INF&#125; æä¾›ä¸€ä¸ªæµ‹è¯•é¡µå³å¯ï¼› å››ã€tomcat cluster å‡çº§ä¸ºsession clusterï¼Œä½¿ç”¨deltaManageré…ç½®node1,å’Œnode2 1node1# vim /etc/tomcat/server.xml 1234567891011121314151617181920212223242526272829303132333435 &lt;Engine name="Catalina" defaultHost="localhost" jvmRoute="TomcatA"&gt;&lt;Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster"channelSendOptions="8"&gt;&lt;Manager className="org.apache.catalina.ha.session.DeltaManager"expireSessionsOnShutdown="false"notifyListenersOnReplication="true"/&gt;&lt;Channel className="org.apache.catalina.tribes.group.GroupChannel"&gt;&lt;Membership className="org.apache.catalina.tribes.membership.McastService"address="228.0.32.4"port="45564"frequency="500"dropTime="3000"/&gt;&lt;Receiver className="org.apache.catalina.tribes.transport.nio.NioReceiver"address="192.168.254.130"port="4000"autoBind="100"selectorTimeout="5000"maxThreads="6"/&gt;&lt;Sender className="org.apache.catalina.tribes.transport.ReplicationTransmitter"&gt;&lt;Transport className="org.apache.catalina.tribes.transport.nio.PooledParallelSender"/&gt;&lt;/Sender&gt;&lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.TcpFailureDetector"/&gt;&lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor"/&gt;&lt;/Channel&gt;&lt;Valve className="org.apache.catalina.ha.tcp.ReplicationValve"filter=""/&gt;&lt;Valve className="org.apache.catalina.ha.session.JvmRouteBinderValve"/&gt;&lt;Deployer className="org.apache.catalina.ha.deploy.FarmWarDeployer"tempDir="/tmp/war-temp/"deployDir="/tmp/war-deploy/"watchDir="/tmp/war-listen/"watchEnabled="false"/&gt;&lt;ClusterListener className="org.apache.catalina.ha.session.JvmRouteSessionIDBinderListener"/&gt;&lt;ClusterListener className="org.apache.catalina.ha.session.ClusterSessionListener"/&gt;&lt;/Cluster&gt; 12# scp /etc/tomcat/server.xml 172.16.251.74:/etc/tomcat/server.xml# cp /etc/tomcat/web.xml /var/lib/tomcat/webapps/test/WEB-INF/ 12345678# vim /var/lib/tomcat/webapps/test/WEB-INF/web.xmlåœ¨ &lt;!-- listings is enabled? [true] --&gt;çš„åŽé¢åŠ å…¥&lt;distributable/&gt;# scp /var/lib/tomcat/webapps/test/WEB-INF/web.xml 172.16.251.74:/var/lib/tomcat/webapps/test/WEB-INF/ node2# vim /etc/tomcat/server.xml æ›´æ”¹ &lt;Engine name="Catalina" defaultHost="localhost" jvmRoute="TomcatB"&gt;address="172.16.251.74"node1,2 #systemctl restart tomcat è¿›å…¥é¡µæµ‹è¯•http://172.16.254.248/test/ äº”ã€clusterå°†ä¼šè¯ä¿å­˜è‡³memcachedä¸­node1,2éœ€è¦çš„æ“ä½œå°†deltaManagerçš„é…ç½®è¿˜åŽŸ 123456 # cd /usr/share/tomcat/lib/ # wget ftp://172.16.0.1/pub/Sources/7.x86_64/msm/* &amp;&amp; rm -rf memcached-session-manager-tc8-1.8.3.jar # yum -y install memcached libmemcached # systemctl start memcached # sustemctl enable memcachednode1(tomcat1,memcached1) 12345678910111213141516171819202122232425 # memcached 1é…ç½® # vim /etc/tomcat/server.xml# ä¿®æ”¹ &lt;Engine name="Catalina" defaultHost="localhost" jvmRoute="rjTomcat1"&gt;åœ¨Hostæ®µä¸­æ·»åŠ  &lt;Context path="/test" docBase="test" reloadable="true"&gt;&lt;Manager className="de.javakaffee.web.msm.MemcachedBackupSessionManager"memcachedNodes="n1:172.16.251.232:11211,n2:172.16.251.74:11211"failoverNodes="n1"requestUriIgnorePattern=".*\.(ico|png|gif|jpg|css|js)$"transcoderFactoryClass="de.javakaffee.web.msm.serializer.javolution.JavolutionTranscoderFactory"/&gt;&lt;/Context&gt;node2(tomcat,memcached2) # memcached 2é…ç½® &lt;Engine name="Catalina" defaultHost="localhost" jvmRoute="rjTomcat2"&gt;# åœ¨Hostæ®µä¸­æ·»åŠ  &lt;Context path="/test" docBase="test" reloadable="true"&gt;&lt;Manager className="de.javakaffee.web.msm.MemcachedBackupSessionManager"memcachedNodes="n1:172.16.251.232:11211,n2:172.16.251.74:11211"failoverNodes="n1"requestUriIgnorePattern=".*\.(ico|png|gif|jpg|css|js)$"transcoderFactoryClass="de.javakaffee.web.msm.serializer.javolution.JavolutionTranscoderFactory"/&gt;&lt;/Context&gt; å…³äºŽtomcat memcached sessionç»‘å®šé…ç½®è¯¦è§£åœ°å€ https://github.com/magro/memcached-session-manager/wiki/SetupAndConfiguration#configure-memcached-session-manager-as--context-manageræ­¤æ—¶clusterå°†ä¼šè¯ä¿å­˜äºŽmemcached ä¸­ è®¿é—®http://172.16.254.248/test/æ•ˆæžœå¦‚ä¸‹ å…­ã€Tomcatçš„å¸¸ç”¨ä¼˜åŒ–é…ç½®ï¼ˆ1ï¼‰å†…å­˜ç©ºé—´ï¼š12#vim /etc/sysyconfig/tomcat JAVA_OPTS="-server -Xms -Xmx -XX:NewSize= -XX:MaxNewSize= -XX:PermSize= -XX:MaxPermSize=" -server:æœåŠ¡å™¨æ¨¡åž‹ -Xms:å †å†…å­˜åˆå§‹åŒ–å¤§å°ï¼› -Xmx:å †å†…å­˜ç©ºé—´ä¸Šé™ï¼› -XX:NewSize=:æ–°ç”Ÿä»£ç©ºé—´åˆå§‹åŒ–å¤§å° ï¼› -XX:MaxNewSize=:æ–°ç”Ÿä»£ç©ºé—´æœ€å¤§å€¼ ï¼› -XX:PermSize=:æŒä¹…ä»£ç©ºé—´åˆå§‹åŒ–å¤§å°ï¼› -XX:MaxPermSize=:æŒä¹…ä»£ç©ºé—´æœ€å¤§å€¼ï¼› ï¼ˆ2ï¼‰çº¿ç¨‹æ± è®¾ç½®ï¼š1&lt;Connector port="8080" protocol="HTTP/1.1" connectionTimeout="200000" redirectPort="8443" /&gt; å¸¸ç”¨å±žæ€§ï¼š maxThreads:æœ€å¤§çº¿ç¨‹æ•°ï¼› minSpareThreads:æœ€å°ç©ºé—²çº¿ç¨‹æ•°ï¼› maxSpareThreads:æœ€å¤§ç©ºé—²çº¿ç¨‹æ•°ï¼› acceptCount:ç­‰å¾…é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼› URIEnconding:URIåœ°å€ç¼–ç æ ¼å¼ï¼Œå»ºè®®ä½¿ç”¨UTF-8ï¼› enableLookups:æ˜¯å¦å¯ç”¨dnsè§£æžï¼Œå»ºè®®ç¦ç”¨ï¼› compression:æ˜¯å¦å¯ç”¨ä¼ è¾“åŽ‹ç¼©æœºåˆ¶ï¼Œå»ºè®®â€onâ€; compressionMinSize:å¯ç”¨åŽ‹ç¼©ä¼ è¾“çš„æ•°æ®æµæœ€å°å€¼ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼› compressableMimeType:å®šä¹‰å¯ç”¨åŽ‹ç¼©åŠŸèƒ½çš„MIMEç±»åž‹;text/html,text/xml,text/css,text/javascript; ï¼ˆ3ï¼‰ç¦ç”¨8005ç«¯å£12&lt;Server port="-1" shutdown="SHUTDOWN"&gt; Server="SOME STRING" ï¼ˆ4ï¼‰éšè—ç‰ˆæœ¬ä¿¡æ¯12&lt;Connector port="8080" protocol="HTTP/1.1" connection Timeout="20000" redirectPort="8443" /&gt;Server="SOME STRING"]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[keepalivedåŒä¸»æ¨¡åž‹çš„å®žçŽ°]]></title>
    <url>%2F2018%2F02%2F07%2Fkeepalived%E5%8F%8C%E4%B8%BB%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[ä¸€ã€ç®€ä»‹ keepalived ç®€ä»‹:æ˜¯æœåŠ¡å™¨é«˜å¯ç”¨çš„ä¸€ä¸ªé‡è¦è½¯ä»¶;å®ƒçš„æ ¸å¿ƒç»„ä»¶æœ‰vrrp ï¼Œstackï¼Œ checker ï¼Œipvsï¼Œwarpperï¼Œ watch dog ; å®ƒæ˜¯vrrpåè®®çš„å®žçŽ°ï¼ŒåŽŸç”Ÿè®¾è®¡ç›®çš„ä¸ºé«˜å¯ç”¨ipvsæœåŠ¡ï¼›keepalivedèƒ½å¤Ÿé€šè¿‡é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ç”Ÿæˆipvsè§„åˆ™; å¹¶èƒ½å¤Ÿå¯¹RSçš„å¥åº·çŠ¶æ€è¿›è¡Œæ£€æµ‹ï¼›vrrp_script,vrrp_track; åŒä¸»æ¨¡åž‹çš„å®žçŽ° ç®€ä»‹:åŒæ–¹æ¨¡åž‹(ä¸»/å¤‡ï¼Œå¤‡/ä¸»)çš„è¿™é‡Œçš„æ„æ€æ˜¯ï¼Œä¸€ä¸ªkeepalivedé…ç½®ä¸­;ä¸€ä¸ªè™šæ‹ŸIPåœ°å€ä¸ºä¸»ï¼Œå¦ä¸€ä¸ªä¸ºå¤‡ã€‚è€Œåœ¨å¦ä¸€ä¸ªkeepalivedçš„é…ç½®ä¸­;ä¸Žå…¶å®ƒä¸»æœºåˆ™æ°æ°ç›¸åï¼Œä¸€ä¸ªè™šæ‹ŸIPåœ°å€ä¸ºå¤‡ï¼Œå¦ä¸€ä¸ªä¸ºä¸»; ä»¥ä¸‹ä¸ºæ­¤æ¬¡åŒä¸»æ¨¡åž‹å®žçŽ°çš„æ‹“æ‰‘ äºŒã€HA Clusteré…ç½®çš„å‰æï¼›(1)è¦ç‚¹:å„èŠ‚ç‚¹ä¹‹é—´çš„æ—¶é—´ç§˜éœ€è¦åŒæ­¥: ntpdate 172.16.0.1 (æ³¨æ­¤:å¤„å¯è‡ªå·±åœ¨ç½‘ä¸Šæ‰¾ä¸ªæ—¶é—´åŒæ­¥æœåŠ¡å™¨) (2)ç¡®ä¿iptablesåŠselinuxä¸ä¼šé˜»ç¢:1#iptables -F &amp;&amp; setenforce 0 ###(3)å„èŠ‚ç‚¹ä¹‹é—´å¯é€šè¿‡ä¸»æœºåäº’ç›¸é€šä¿¡(å¯¹keepalivedå¹¶éžå¿…é¡»): 12345# vim /etc/hosts 172.16.250.140 kpl1172.16.250.158 kpl2 ä¸¤å°keepalivedä¸»æœºéƒ½è¦ä¿®æ”¹ ###(4)å„èŠ‚ç‚¹ä¹‹é—´rootç”¨æˆ·å¯ä»¥åŸºäºŽå¯†é’¥è®¤è¯çš„sshé€šä¿¡ 123# ssh-copy-id -i 172.16.250.140# ssh-copy-id -i 172.16.250.158 ä¸‰ã€dré›†ç¾¤é…ç½®æ­¤å¤„ä½¿ç”¨dré›†ç¾¤ç±»åž‹ é¦–å…ˆå°†dræ¨¡åž‹é…ç½®å¥½ 1234567891011121314151617181920212223242526272829303132333435363738394041424344# vim setkp.sh# !/bin/bash vip=172.16.26.126vip2=172.16.26.127mask=255.255.255.255interface='lo:0'interface2='lo:1'eth='eno16777736:0' case $1 in start) echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignoreecho 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignoreecho 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announceecho 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announceifconfig $interface $vip netmask $mask broadcast $vip up ifconfig $interface2 $vip2 netmask $mask broadcast $vip2 up route add -host $vip dev $interface route add -host $vip2 dev $interface2;; dstart) ifconfig $eth $vip/32 netmask $mask broadcast $vip up;;dstop)ifconfig $eth down;;stop)ifconfig $interface down ifconfig $interface2 downecho 0 &gt; /proc/sys/net/ipv4/conf/all/arp_ignoreecho 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignoreecho 0 &gt; /proc/sys/net/ipv4/conf/all/arp_announceecho 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce;; status) ifconfig cat /proc/sys/net/ipv4/conf/all/arp_ignorecat /proc/sys/net/ipv4/conf/lo/arp_ignorecat /proc/sys/net/ipv4/conf/all/arp_announcecat /proc/sys/net/ipv4/conf/lo/arp_announce;; *)echo "Usage: $(basename $0) &#123;dstart|dstop|start|stop&#125;"exit 1 esac RS1ã€RS2ä¸»æœºä¸­éƒ½æ‰§è¡Œæ‰§è¡Œæ­¤è„šæœ¬ 123456# sh setkp.sh start # sh setkp.sh status å¯ç”¨æ¥æŸ¥çœ‹å½“å‰ç½‘ç»œçš„é…ç½®çŠ¶æ€ #RS1ã€RS2ä¸»æœºä¸­å®‰è£…httpdå¹¶å¯åŠ¨ # yum -y install httpd &amp;&amp; systemctl start httpd RS1# echo "&lt;h1&gt;RS1&lt;/h1&gt;" &gt; /usr/share/nginx/html/index.html RS2 # echo "&lt;h1&gt;RS2&lt;/h1&gt;" &gt; /usr/share/nginx/html/index.html å››ã€keepalivedé…ç½®keepalived,keepalived2 ä¸­å®‰è£…nginx(httpdå’Œnginxéƒ½å¯ä»¥,æ­¤å¤„ç”¨æ¥åšä¸ºkeepalivedçš„æœ¬èº«çš„æä¾›sorry server)å½“dré›†ç¾¤çš„ä¸¤å°èŠ‚ç‚¹éƒ½åœæ­¢æ—¶ï¼Œä¼šç”±keepalivedæœ¬èº«æ¥æä¾›ä¸€ä¸ªé¡µé¢ 123456789101112# yum -y install nginx keepalived ipvsadm &amp;&amp; systemctl start nginx # echo "&lt;h1&gt;sorry server keepalived 1 &lt;/h1&gt;" &gt; /usr/share/nginx/html/index.html # echo "&lt;h1&gt;sorry server keepalived 2 &lt;/h2&gt;" &gt; /usr/share/nginx/html/index.html ```bashåœ¨ä¸€å°keepalivedä¸»æœºä¸Šè¿›è¡Œæµ‹è¯•```bash# curl 172.16.251.232&lt;h1&gt;RS1&lt;/h2&gt;# curl 172.16.250.159&lt;h1&gt;RS2&lt;/h1&gt; keepalived,keepalived2 ä¸­åœ¨ /etc/keepalived/ç›®å½•ä¸‹ç¼–è¾‘ä¸€ä¸ªè„šæœ¬æ¥ç”¨æ¥åœ¨ä¸»å¤‡å˜åŒ–æˆ–æœåŠ¡downæŽ‰æ—¶å‘é‚®ä»¶ç»™ç³»ç»Ÿç”¨æˆ· 1234567891011121314151617181920212223# vim kmail.sh #!/bin/bashcontact='root@localhost'notify()&#123;mailsubject="$(hostname) to be $1:vip floating"mailbody="$(date +'%F %T'):vrrp transition, $(hostname) change to be $1"echo $mailbody | mail -s "$mailsubject" $contact&#125;case $1 in master )notify master;;backup )notify backup ;;fault )notify fault ;;*)echo "Usage:$(basename $0) &#123;master |backup|fault&#125;";;esac#chmod +x kmail.sh æ³¨:keepalivedçš„ä¸¤å°ä¸»æœºçš„é…ç½®åŸºæœ¬ç›¸åŒï¼Œå½“é…ç½®æ¨¡åž‹ä¸ºä¸»/å¤‡æ¨¡åž‹çš„æ—¶å€™ï¼Œä¸»å¤‡ä¹‹é—´éœ€è¦ä¿®æ”¹ä¸‰ä¸ªæŒ‡ä»¤ åˆ†åˆ«ä¸º router_id kpl1 åœ¨keepalived2ä¸Šæ—¶éœ€è¦ä¿®æ”¹ä¸º router_id kpl2state MASTER åœ¨keepalived2ä¸Šæ—¶éœ€è¦ä¿®æ”¹ä¸º state BACKUPpriority 100 åœ¨keepalived2ä¸Šæ—¶éœ€è¦ä¿®æ”¹ä¸º priority 90 (æ­¤å¤„çš„å€¼æ¯”ä¸»æœåŠ¡å™¨çš„å°ä¾¿å¯ä»¥)ä»¥ä¸‹ä¸»/å¤‡çš„é…ç½®ç¤ºä¾‹ ###å…ˆæŠŠå¤‡çš„æœåŠ¡å™¨å¯åŠ¨ 1# tcpdump -i eno33554984 -nn host 224.0.61.61 å¯ä½¿ç”¨tcpdump æŠ“å–ç»„æ’­åœ°å€ æ¥æŸ¥çœ‹å…¶é€šè¿‡ç»„æ’­æ–¹å¼ä¼ é€’çš„å¿ƒè·³ä¿¡æ¯ä»¥ä¸‹çš„é…ç½®æ–‡ä»¶ä¾¿æ˜¯keepavliedåŒä¸»æ¨¡åž‹çš„å®žçŽ°å¯¹é˜²ç«å¢™æ‰“æ ‡è®°keepalived 1 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182# iptables -t mangle -A PREROUTING -d 172.16.26.126 -p tcp --dport 80 -j MARK --set-mark 3 # iptables -t mangle -A PREROUTING -d 172.16.26.127 -p tcp --dport 80 -j MARK --set-mark 3# vim /etc/keepalived/keepalived.conf! Configuration File for keepalived global_defs &#123; notification_email &#123;root@localhost&#125; notification_email_from Alexandre.Cassen@firewall.loc smtp_server 127.0.0.1 smtp_connect_timeout 30 router_id kpl1 vrrp_mcast_group4 224.0.61.61&#125;vrrp_instance VI_1 &#123;state MASTERinterface eno33554984virtual_router_id 55priority 100advert_int 1notify_master "/etc/keepalived/kmail.sh master"notify_backup "/etc/keepalived/kmail.sh backup"notify_fault "/etc/keepalived/kmail.sh fault"authentication &#123;auth_type PASSauth_pass zE2kNsRQ&#125;virtual_ipaddress &#123;172.16.26.126 dev eno33554984 label eno33554984:0 &#125;&#125;vrrp_instance VI_2 &#123;state BACKUPinterface eno33554984virtual_router_id 66priority 90advert_int 1notify_master "/etc/keepalived/kmail.sh master"notify_backup "/etc/keepalived/kmail.sh backup"notify_fault "/etc/keepalived/kmail.sh fault"authentication &#123;auth_type PASSauth_pass zE2kfsRQ&#125;virtual_ipaddress &#123;172.16.26.127 dev eno33554984 label eno33554984:1 &#125;&#125;virtual_server fwmark 3 &#123;delay_loop 2lb_algo wrr lb_kind DRnat_mask 255.255.0.0protocol TCPsorry_server 127.0.0.1 80 real_server 172.16.251.232 80 &#123;weight 3HTTP_GET &#123;url &#123; path / status_code 200 &#125;connect_timeout 2nb_get_retry 3delay_before_retry 3&#125;&#125;real_server 172.16.250.159 80 &#123;weight 1HTTP_GET &#123;url &#123; path /status_code 200 u &#125;oconnect_timeout 2enb_get_retry ndelay_before_retry 3&#125;&#125; keepalived 2 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081# iptables -t mangle -A PREROUTING -d 172.16.26.126 -p tcp --dport 80 -j MARK --set-mark 3# iptables -t mangle -A PREROUTING -d 172.16.26.127 -p tcp --dport 80 -j MARK --set-mark 3# vim /etc/keepavlied/keepalived.conf ! Configuration File for keepalivedglobal_defs &#123; notification_email &#123;root@localhost&#125; notification_email_from Alexandre.Cassen@firewall.loc smtp_server 127.0.0.1 smtp_connect_timeout 30 router_id kpl2 vrrp_mcast_group4 224.0.61.61&#125;vrrp_instance VI_1 &#123;state BACKUPinterface eno33554984virtual_router_id 55priority 90advert_int 1notify_master "/etc/keepalived/kmail.sh master"notify_backup "/etc/keepalived/kmail.sh backup"notify_fault "/etc/keepalived/kmail.sh fault"authentication &#123;auth_type PASSauth_pass zE2kNsRQ&#125;virtual_ipaddress &#123;172.16.26.126 dev eno33554984 label eno33554984:0 &#125;&#125;vrrp_instance VI_2 &#123;state MASTERinterface eno33554984virtual_router_id 66priority 100advert_int 1notify_master "/etc/keepalived/kmail.sh master"notify_backup "/etc/keepalived/kmail.sh backup"notify_fault "/etc/keepalived/kmail.sh fault"authentication &#123;auth_type PASSauth_pass zE2kfsRQ&#125;virtual_ipaddress &#123;172.16.26.127 dev eno33554984 label eno33554984:1 &#125;&#125;virtual_server fwmark 3 &#123;delay_loop &#123;lb_algo wrrlb_kind DRnat_mask 255.255.0.0protocol TCPsorry_server 127.0.0.1 80real_server 172.16.251.232 80 &#123;weight 3HTTP_GET &#123;url &#123; path / status_code 200 &#125;connect_timeout 2nb_get_retry 3delay_before_retry 3&#125;&#125;real_server 172.16.250.159 80 &#123;weight 1HTTP_GET &#123;url &#123; path / status_code 200 &#125;connect_timeout 2nb_get_retry 3delay_before_retry 3&#125;&#125; äº”ã€æµ‹è¯•æ­¤æ—¶å¯ä»¥æµ‹è¯•å…¶è®¿é—® å½“ä¸€ä¸ªkeepavliedåœæ­¢æ—¶å½“RS2åœæ­¢æ—¶å½“RS1ï¼ŒRS2éƒ½åœæ­¢æ—¶ ##å…­ã€keepavliedé…ç½®æŒ‡ä»¤è¯´æ˜Ž è™šæ‹Ÿè·¯ç”±å™¨æ®µ 12345678910111213state MASTERï¼šå½“å‰èŠ‚ç‚¹åœ¨è™šæ‹Ÿè·¯ç”±å™¨ä¸­çš„åˆå§‹çŠ¶æ€ï¼›interface ETHERCARD: vrrpå®žé™…å·¥ä½œçš„ç½‘å¡æŽ¥å£virtual_route_id 51 :è™šæ‹Ÿè·¯ç”±å™¨IDï¼ŒèŒƒå›´0-255ï¼›priority 100 :å½“å‰ç‰©ç†èŠ‚ç‚¹åœ¨æ­¤è™šæ‹Ÿè·¯ç”±å™¨ä¸­çš„ä¼˜å…ˆçº§ï¼›advert_int 1:æ¯éš”å¤šä¹…å‘é€å¿ƒè·³(é€šè¡Œçš„æ—¶é—´é—´éš”)auth_type PASS ï¼šé€‰æ‹©è®¤è¯æœºåˆ¶ auth_pass 1111 ï¼šå¯†ç  å…«ä½æœ‰æ•ˆvirtual_ipaddress ï¼šå®šä¹‰è™šæ‹ŸIP track_interface ï¼š å®šä¹‰è¦ç›‘æŽ§çš„æŽ¥å£notify_master &lt;STRING&gt; | &lt;QUOTED-STRING&gt; ï¼šå½“å‰èŠ‚ç‚¹å˜ä¸ºä¸»èŠ‚ç‚¹æ—¶ç”¨STRINGè„šæœ¬é€šå‘Šnotfy_backup&lt;STRING&gt; | &lt;QUOTED-STRING&gt; : å½“å‰èŠ‚ç‚¹å˜ä¸ºä¸»èŠ‚æ—¶ç”¨ STRINGè„šæœ¬é€šå‘Šnotify_fault&lt;STRING&gt; | &lt;QUOTED-STRING&gt; : å½“å‰èŠ‚ç‚¹ä¸Šä¸äº†çº¿æ—¶ç”¨STRINGè„šæœ¬é€šå‘Šnotify&lt;STRING&gt; | &lt;QUOTED-STRING&gt; : å¦‚æžœä¸‰ç§çŠ¶æ€ç”¨ä¸€ä¸ªè„šæœ¬æ¥å®žçŽ°ç”¨STRINGè„šæœ¬é€šå‘Š è™šæ‹ŸæœåŠ¡æ®µ 123456789101112131415161718lb_algo rr | wrr|lc|lblc|sh|dh :å®šä¹‰è´Ÿè½½å‡è¡¡è°ƒåº¦ç®—æ³•delay_loop&lt;INT&gt;ï¼šï¼šå®šä¹‰æœåŠ¡è½®è¯¢æ—¶é—´é—´éš”bl_kind NAT |DR |TUN ï¼šé›†ç¾¤çš„ç±»åž‹persistence_time_out&lt;INT&gt; ï¼šæŒä¹…è¿žæŽ¥æ—¶é•¿protocol TCP : æœåŠ¡åè®®sorry_server&lt;IPADDR&gt;&lt;PORT&gt;ï¼šæ‰€æœ‰RSå‡æ•…éšœæ—¶ï¼Œæä¾›sorry serverçš„æœåŠ¡å™¨ï¼›real_server&lt;IPADDR&gt;&lt;PORT&gt;:weight&lt;INT&gt;ï¼šæƒé‡notify_up&lt;STRING&gt;|&lt;QUOTED-STRING&gt; ï¼š èŠ‚ç‚¹ä¸Šçº¿é€šçŸ¥è„šæœ¬notify_down &lt;STRING&gt;|&lt;QUOTED-STRNG&gt;ï¼šèŠ‚ç‚¹ç¦»çº¿é€šçŸ¥è„šæœ¬ï¼›#HTTP_GET|SSL_GET|TCP_CHECK|SMTP_CHECK|MISC_CHECK ï¼šæ”¯æŒçš„æ‰€ä»¥å¥åº·çŠ¶æ€çš„æ£€æµ‹æ–¹å¼url:å¥åº·çŠ¶æ€æ£€æµ‹æ—¶è¯·æ±‚çš„èµ„æºçš„URL delay_before_retry&lt;INT&gt; ï¼šä¸¤æ¬¡å°è¯•ä¹‹é—´çš„æ—¶é—´é—´éš” connect_timeoute&lt;STRING&gt;ï¼šè¿žæŽ¥çš„è¶…æ—¶æ—¶é•¿connect_ip&lt;IP ADDRESS&gt;ï¼šå‘æ­¤å¤„æŒ‡å®šçš„åœ°å€å‘æµ‹è¯•è¯·æ±‚connect_port&lt;PORT&gt;ï¼šå‘æ­¤å¤„æŒ‡å®šçš„PORTå‘æµ‹è¯•è¯·æ±‚bindto&lt;IP ADDRESS&gt;ï¼šæŒ‡å®šæµ‹è¯•è¯·æ±‚æŠ¥æ–‡çš„æºIP bind_port&lt;PORT&gt;ï¼š æŒ‡å®šæµ‹è¯•è¯·æ±‚æŠ¥æ–‡çš„æºPORT]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MariaDBä¹‹MHAé…ç½®]]></title>
    <url>%2F2018%2F02%2F06%2FMariaDB%E4%B9%8BMHA%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[å·¥ä½œæ‹“æ‰‘ ä¸€ã€MHAç®€æ˜Ž12345678910MHAï¼ˆMaster HAï¼‰æ˜¯ä¸€æ¬¾å¼€æºçš„MySQLçš„é«˜å¯ç”¨ç¨‹åºï¼Œå®ƒä¸ºMySQLä¸»ä»Žå¤åˆ¶æž¶æž„æä¾›äº† automating master failover åŠŸèƒ½ã€‚MHAåœ¨ç›‘æŽ§åˆ°masterèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œä¼šæå‡å…¶ä¸­ æ‹¥æœ‰æœ€æ–°æ•°æ®çš„slaveèŠ‚ç‚¹æ¥æˆä¸ºæ–°çš„masterèŠ‚ç‚¹ã€‚åœ¨æ­¤æœŸé—´ï¼ŒMHAä¼šé€šè¿‡äºŽå…¶å®ƒä»ŽèŠ‚ç‚¹ èŽ·å–é¢å¤–ä¿¡æ¯æ¥é¿å…ä¸€è‡´æ€§æ–¹é¢çš„é—®é¢˜ã€‚MHAè¿˜æä¾›äº†masterèŠ‚ç‚¹çš„åœ¨çº¿åˆ‡æ¢åŠŸèƒ½ï¼Œå³æŒ‰ éœ€åˆ‡æ¢master/slaveèŠ‚ç‚¹ã€‚MHAæœåŠ¡æœ‰ä¸¤å’±è§’è‰²ã€‚MHA Mangager(ç®¡ç†èŠ‚ç‚¹)å’ŒMHA Node(æ•°æ®èŠ‚ç‚¹)ï¼š MHA Managerï¼šé€šå¸¸å•ç‹¬éƒ¨ç½²åœ¨ä¸€å°ç‹¬ç«‹æœºå™¨ä¸Šç®¡ç†å¤šä¸ªmaster/slaveé›†ç¾¤ï¼Œæ¯ä¸ª master/slaveé›†ç¾¤ç§°ä½œä¸€ä¸ªapplication: MHA node:è¿è¡Œåœ¨æ¯å°MySQLæœåŠ¡å™¨ä¹‹ä¸Š(master/slave/manager),å®ƒé€šè¿‡ç›‘æŽ§ å…·åŠ¡è§£æžå’Œæ¸…ç†logsåŠŸèƒ½æ¥è„šæœ¬æ¥åŠ å¿«æ•…éšœè½¬ç§»ã€‚ äºŒã€MHA ç»„ä»¶12345678910111213141516171819202122232425 MHAä¼šæä¾›è¯¸å¤šå·¥å…·ç¨‹åºï¼Œå…¶å¸¸è§çš„å¦‚ä¸‹æ‰€ç¤ºã€‚ ManagerèŠ‚ç‚¹: masterha_check_ssh:MHAä¾èµ–çš„SSHçŽ¯å¢ƒæ£€æµ‹å·¥å…·ï¼› masterha_check_repl:MySQLå¤åˆ¶çŽ¯å¢ƒæ£€æµ‹å·¥å…·ï¼› masterha_mamager:MHAæœåŠ¡ä¸»ç¨‹åºï¼› masterha_check_status:MHAè¿è¡ŒçŠ¶æ€æŽ¢æµ‹å·¥å…·ï¼› masterha_master_monitor:MySQL masterèŠ‚ç‚¹å¯ç”¨æ€§ç›‘æµ‹å·¥å…·ï¼› masterha_master_swith:masterèŠ‚ç‚¹åˆ‡æ¢å·¥å…·ï¼› masterha_conf_host:æ·»åŠ æˆ–åˆ é™¤é…ç½®çš„èŠ‚ç‚¹ï¼› masterha_stop:æ–—é—­MHAæœåŠ¡çš„å·¥å…· ï¼› Node èŠ‚ç‚¹: save_binary_logs:ä¿å­˜å’Œå¤åˆ¶Masterçš„äºŒè¿›åˆ¶æ—¥å¿— ï¼› apply_diff_replay_logs:è¯†åˆ«å·®å¼‚çš„ä¸­ç»§æ—¥å¿—äº‹ä»¶å¹¶åº”ç”¨äºŽå…¶å®ƒslave; filter_mysqlbinlog:åŽ»é™¤ä¸å¿…è¦çš„ROLLBACKäº‹ä»¶(MHAå·²ä¸å†ä½¿ç”¨è¿™ä¸ªå·¥å…·)ï¼› purge_replay_logs:æ¸…é™¤ä¸­ç»§æ—¥å¿—(ä¸ä¼šé˜»å¡žSQLçº¿ç¨‹)ï¼› è‡ªå®šä¹‰æ‰©å±•: secondary_check_script:é€šè¿‡å¤šæ¡ç½‘ç»œè·¯ç”±æ£€æµ‹masterçš„å¯ç”¨æ€§ï¼› master_ip_failover_scipt:æ›´æ–°applicationä½¿ç”¨çš„masterip; shutdown_scriptï¼šå¼ºåˆ¶å…³é—­masterèŠ‚ç‚¹ï¼› report_scipt:å‘é€æŠ¥å‘Šï¼› init_conf_load_script:åŠ è½½åˆå§‹é…ç½®å‚æ•°ï¼› master_ip_online_change_scipt:æ›´æ–°masterèŠ‚ç‚¹ipåœ°å€ï¼› ä¸‰ã€å‡†å¤‡MySQL ReplicatinçŽ¯å¢ƒ123 MHAå¯¹MySQLå¤åˆ¶çŽ¯å¢ƒæœ‰ç‰¹æ®Šè¦æ±‚ï¼Œä¾‹å¦‚å„èŠ‚ç‚¹éƒ½è¦å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠä¸­ç»§æ—¥å¿—ï¼Œ å„ä»ŽèŠ‚ç‚¹ å¿…é¡»å¯ç”¨å…¶read-only skip_name_resolve innodb_file_per_table=ON å±žæ€§ï¼Œ å¹¶å…³é—­relay_log_purgeåŠŸèƒ½ç­‰ï¼Œè¿˜æœ‰ä½“é›†äº‹ç‰©æ‰€å¿…éœ€çš„åŒæ­¥ï¼› åŒæ­¥ä¸»æœº1234567891011# for i in &#123;0..3&#125; ; do ssh node$i ntpdate 172.16.0.1 ; done # æœ¬å®žéªŒå¢ƒå…±æœ‰å››ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­è§’è‰²åˆ†é…å¦‚ä¸‹ï¼›node0 :MHA Manager(172.16.23.10);node1 :MariaDB masternode2 :MariaDB slavenode3 :MariaDB slave # å„èŠ‚ç‚¹çš„/etc/hostsæ–‡ä»¶é…ç½®å†…å®¹æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼›172.16.23.10 node0 node0.rj.com172.16.23.11 node1 node1.rj.com172.16.23.12 node2 node2.rj.com172.16.23.13 node3 node3.rj.com åˆå§‹ä¸»èŠ‚ç‚¹çš„masteré…ç½®1234567node1 # vim /etc/my.cnf innodb_file_per_table=ON # æ­¤é¡¹å†…å®¹ä¸Žä¸‹é¢ä¸€é¡¹å†…å®¹ä¸€èˆ¬åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ä¾¿åŠ ä¸Š skip_name_resolve=ON server_id=1 relay_log=relay-bin log-bin=log-bin symbolic-links=0 æ‰€æœ‰slaveèŠ‚ç‚¹ä¾èµ–çš„é…ç½®12345678node(2,3)# vim /etc/my.cnf innodb_file_per_table=ON skip_name_resolve=ON server_id=2 #æ³¨ æ­¤å¤„çš„ç»“ç‚¹åˆ°äº†åˆ«çš„èŠ‚ç‚¹ä¸­ä¸€å®šè¦æ”¹ï¼Œå„èŠ‚ç‚¹çš„idå¿…éœ€å”¯ä¸€ï¼› relay-log=relay-bin log-bin=master-bin relay-log-purge=OFF read-only=ON æŒ‰ä¸Šè¿°è¦æ±‚åˆ†åˆ«é…ç½®å¥½ä¸» ä»ŽèŠ‚ç‚¹ä¹‹åŽ,æŒ‰MySQLå¤åˆ¶é…ç½®æž¶æž„çš„é…ç½®æ–¹å¼å°†å…¶é…ç½®å®Œæˆå¹¶å‚åŠ¨ masterèŠ‚ç‚¹å’Œå„slaveèŠ‚ç‚¹ï¼Œä»¥åŠå„slaveèŠ‚ç‚¹å¯åŠ¨å…¶IOå’ŒSQLçº¿ç¨‹ï¼Œç¡®ä¿ä¸»ä»Žå¤åˆ¶è¿è¡Œæ— è¯¯ 1234567node1 mysql&gt; GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO 'rj'@'172.16.%.%' IDENTIFIED BY 'centos.123' ;node(2,3) mysql&gt; CHANGE MASTER TO MASTER_HOST='172.16.23.11',MASTER_USER='rj',MASTER_PASSWORD='centos.123',MASTER_LOG_FILE='log-bin.000001',MASTER_LOG_POS=492; mysql&gt; START SLAVE; mysql&gt; SHOW SLAVE STATUS; Slave_IO_Running: Yes Slave_SQL_Running: Yes # ä»¥ä¸‹ä¸¤é¡¹æ˜¯å¦ä¸ºyes åŒæ—¶ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸»ç»“ç‚¹ä¸Šåˆ›å»ºä¸ªåº“æˆ–è¡¨ï¼ŒæŸ¥çœ‹å…¶æ˜¯å¦å¯å°å®žçŽ°ä¸»ä»ŽåŒæ­¥ï¼› è€ŒåŽï¼Œåœ¨æ‰€æœ‰MySQLèŠ‚ç‚¹æŽˆæƒæ‹¥æœ‰ç®¡ç†æƒé™çš„ç”¨æˆ·å¯åœ¨æœ¬åœ°ç½‘ç»œä¸­æœ‰å…¶å®ƒèŠ‚ç‚¹ä¸Šè¿œç¨‹æ–¹é—®ã€‚ å½“ç„¶ï¼Œæ­¤æ—¶ä»…éœ€è¦ä¸”åªèƒ½åœ¨masterèŠ‚ç‚¹è¿è¡Œç±»ä¼¼å¦‚ä¸‹SQLè¯­å¥å³å¯ã€‚ 1mysql&gt; GRANT ALL ON *.* to 'rjyy'@'172.16.%.%' IDENTIFIED BY 'centos.123'; ä¸‰ã€å®‰è£…é…ç½®MHAå‡†å¤‡åŸºäºŽsshäº’ä¿¡é€šä¿¡çŽ¯å¢ƒMHAé›†ç¾¤ä¸­çš„å„èŠ‚ç‚¹å½¼æ­¤ä¹‹é—´å‡éœ€åŸºäºŽsshäº’ä¿¡é€šä¿¡ï¼Œä»¥å®žçŽ°è¿œç¨‹æŽ§åˆ¶åŠæ•°æ®ç®¡ç†åŠŸèƒ½ã€‚ ç®€å•èµ·è§ï¼Œå¯åœ¨ManagerèŠ‚ç‚¹ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶è®¾ç½®å…¶å¯è¿œç¨‹è¿žæŽ¥æœ¬åœ°ä¸»æœºåŽï¼Œå°†ç§é’¥æ–‡ä»¶åŠauthorized_keysæ–‡ä»¶å¤åˆ¶ç»™ä½™ä¸‹çš„æ‰€æœ‰ç»“ç‚¹å³å¯ã€‚ ä¸‹é¢çš„çš„æ“ä½œåœ¨managerï¼ˆnode0ï¼‰èŠ‚ç‚¹æ“ä½œå®Œæˆã€‚ 1# for i in &#123;0..3&#125; ; do scp -p .ssh/id_rsa .ssh/authorized_keys node$i:/root/.ssh/; done å®‰è£…MHA123456789101112131415161718192021222324252627282930313233343536node0 # yum install mha4mysql-manager-0.56-0.el6.noarch.rpm mha4mysql-node-0.56-0.el6.noarch.rpm # for i in &#123;1..3&#125;; do scp mha4mysql-node-0.56-0.el6.noarch.rpm node$i:/root/ ; donenode(1,2,3) # yum -y install mha4mysql-node-0.56-0.el6.noarch.rpm [root@node0 ~]# rpm -ql mha4mysql-manager /usr/bin/masterha_check_repl /usr/bin/masterha_check_ssh /usr/bin/masterha_check_status /usr/bin/masterha_conf_host /usr/bin/masterha_manager /usr/bin/masterha_master_monitor /usr/bin/masterha_master_switch /usr/bin/masterha_secondary_check /usr/bin/masterha_stop ä»¥ä¸Šä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°±æ˜¯ä¸Šé¢æ‰€åˆ—å‡ºçš„å‘½ä»¤ /usr/share/man/man1/masterha_check_repl.1.gz /usr/share/man/man1/masterha_check_ssh.1.gz /usr/share/man/man1/masterha_check_status.1.gz /usr/share/man/man1/masterha_conf_host.1.gz /usr/share/man/man1/masterha_manager.1.gz /usr/share/man/man1/masterha_master_monitor.1.gz /usr/share/man/man1/masterha_master_switch.1.gz /usr/share/man/man1/masterha_secondary_check.1.gz /usr/share/man/man1/masterha_stop.1.gz /usr/share/perl5/vendor_perl/MHA/Config.pm /usr/share/perl5/vendor_perl/MHA/DBHelper.pm /usr/share/perl5/vendor_perl/MHA/FileStatus.pm /usr/share/perl5/vendor_perl/MHA/HealthCheck.pm /usr/share/perl5/vendor_perl/MHA/ManagerAdmin.pm /usr/share/perl5/vendor_perl/MHA/ManagerAdminWrapper.pm /usr/share/perl5/vendor_perl/MHA/ManagerConst.pm /usr/share/perl5/vendor_perl/MHA/ManagerUtil.pm /usr/share/perl5/vendor_perl/MHA/MasterFailover.pm /usr/share/perl5/vendor_perl/MHA/MasterMonitor.pm /usr/share/perl5/vendor_perl/MHA/MasterRotate.pm /usr/share/perl5/vendor_perl/MHA/SSHCheck.pm /usr/share/perl5/vendor_perl/MHA/Server.pm /usr/share/perl5/vendor_perl/MHA/ServerManager.pm ManagerèŠ‚ç‚¹éœ€è¦ä¸ºæ¯ä¸ªç›‘æŽ§çš„master/slaveé›†ç¾¤æä¾›ä¸€ä¸ªä¸“ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œè€Œæ‰€æœ‰çš„master/salveé›†ç¾¤ä¹Ÿå¯å…±äº«å…¨å±€ é…ç½®ã€‚å…¨å±€é…ç½®æ–‡ä»¶é»˜è®¤ä¸º/etc/masterha_default.cnf,å…¶ä¸ºå¯å…ˆé…ç½®ã€‚å¦‚æžœä»…ç›‘æŽ§ä¸€ç»„ master/slaveé›†ç¾¤ï¼Œä¹Ÿå¯ ç›´æŽ¥é€šè¿‡applicationçš„é…ç½®æä¾›å„æœåŠ¡å™¨çš„é»˜è®¤é…ç½®ä¿¡æ¯ã€‚è€Œæ¯ä¸ªapplicationçš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸ºè‡ªå®šä¹‰ï¼Œæœ¬ç¤ºä¾‹å°†ä½¿ç”¨ /etc/masterha/appl.cnf 12345678910111213141516171819202122# vim /etc/masterha/appl.cnf [server default] user=rjrj password=centos.123 manager_workdir=/data/masterha/app1 manager_log=/data/masterha/app1/manager.log remote_workdir=/data/masterha/app1 ssh_user=root repl_user=rjrj repl_password=centos.123 ping_interval=1 [server1] hostname=172.16.23.11 candidate_master=1 [server2] hostname=172.16.23.12 candidate_master=1 [server3] hostname=172.16.23.13 123456789101112131415161718192021[root@node0 ~]# masterha_check_ssh --conf=/etc/masterha/app1.cnfTue Feb 21 23:13:48 2017 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.Tue Feb 21 23:13:48 2017 - [info] Reading application default configuration from /etc/masterha/app1.cnf..Tue Feb 21 23:13:48 2017 - [info] Reading server configuration from /etc/masterha/app1.cnf..Tue Feb 21 23:13:48 2017 - [info] Starting SSH connection tests..Tue Feb 21 23:13:49 2017 - [debug]Tue Feb 21 23:13:48 2017 - [debug] Connecting via SSH from root@172.16.23.11(172.16.23.11:22) to root@172.16.23.12(172.16.23.12:22)..Tue Feb 21 23:13:48 2017 - [debug] ok.Tue Feb 21 23:13:48 2017 - [debug] Connecting via SSH from root@172.16.23.11(172.16.23.11:22) to root@172.16.23.13(172.16.23.13:22)..Tue Feb 21 23:13:48 2017 - [debug] ok.Tue Feb 21 23:13:49 2017 - [debug]Tue Feb 21 23:13:48 2017 - [debug] Connecting via SSH from root@172.16.23.12(172.16.23.12:22) to root@172.16.23.11(172.16.23.11:22)..Tue Feb 21 23:13:49 2017 - [debug] ok.Tue Feb 21 23:13:49 2017 - [debug] Connecting via SSH from root@172.16.23.12(172.16.23.12:22) to root@172.16.23.13(172.16.23.13:22)..Tue Feb 21 23:13:49 2017 - [debug] ok.Tue Feb 21 23:13:50 2017 - [debug]Tue Feb 21 23:13:49 2017 - [debug] Connecting via SSH from root@172.16.23.13(172.16.23.13:22) to root@172.16.23.11(172.16.23.11:22)..Tue Feb 21 23:13:49 2017 - [debug] ok.Tue Feb 21 23:13:49 2017 - [debug] Connecting via SSH from root@172.16.23.13(172.16.23.13:22) to root@172.16.23.12(172.16.23.12:22)..Tue Feb 21 23:13:50 2017 - [debug] ok.Tue Feb 21 23:13:50 2017 - [info] All SSH connection tests passed successfully. æœ€åŽæ˜¾ç¤ºä¸ºsuccessfullyè¡¨ç¤ºå·²ç»æˆåŠŸäº† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475[root@node0 ~]# masterha_check_repl --conf=/etc/masterha/app1.cnfWed Feb 22 10:18:40 2017 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.Wed Feb 22 10:18:40 2017 - [info] Reading application default configuration from /etc/masterha/app1.cnf..Wed Feb 22 10:18:40 2017 - [info] Reading server configuration from /etc/masterha/app1.cnf..Wed Feb 22 10:18:40 2017 - [info] MHA::MasterMonitor version 0.56.Wed Feb 22 10:18:41 2017 - [info] GTID failover mode = 0Wed Feb 22 10:18:41 2017 - [info] Dead Servers:Wed Feb 22 10:18:41 2017 - [info] Alive Servers:Wed Feb 22 10:18:41 2017 - [info] 172.16.23.11(172.16.23.11:3306)Wed Feb 22 10:18:41 2017 - [info] 172.16.23.12(172.16.23.12:3306)Wed Feb 22 10:18:41 2017 - [info] 172.16.23.13(172.16.23.13:3306)Wed Feb 22 10:18:41 2017 - [info] Alive Slaves:Wed Feb 22 10:18:41 2017 - [info] 172.16.23.12(172.16.23.12:3306) Version=5.5.44-MariaDB-log (oldest major version between slaves) log-bin:enabledWed Feb 22 10:18:41 2017 - [info] Replicating from 172.16.23.11(172.16.23.11:3306)Wed Feb 22 10:18:41 2017 - [info] Primary candidate for the new Master (candidate_master is set)Wed Feb 22 10:18:41 2017 - [info] 172.16.23.13(172.16.23.13:3306) Version=5.5.44-MariaDB-log (oldest major version between slaves) log-bin:enabledWed Feb 22 10:18:41 2017 - [info] Replicating from 172.16.23.11(172.16.23.11:3306)Wed Feb 22 10:18:41 2017 - [info] Current Alive Master: 172.16.23.11(172.16.23.11:3306)Wed Feb 22 10:18:41 2017 - [info] Checking slave configurations..Wed Feb 22 10:18:41 2017 - [info] Checking replication filtering settings..Wed Feb 22 10:18:41 2017 - [info] binlog_do_db= , binlog_ignore_db=Wed Feb 22 10:18:41 2017 - [info] Replication filtering check ok.Wed Feb 22 10:18:41 2017 - [info] GTID (with auto-pos) is not supportedWed Feb 22 10:18:41 2017 - [info] Starting SSH connection tests..Wed Feb 22 10:18:43 2017 - [info] All SSH connection tests passed successfully.Wed Feb 22 10:18:43 2017 - [info] Checking MHA Node version..Wed Feb 22 10:18:48 2017 - [info] Version check ok.Wed Feb 22 10:18:48 2017 - [info] Checking SSH publickey authentication settings on the current master..Wed Feb 22 10:18:48 2017 - [info] HealthCheck: SSH to 172.16.23.11 is reachable.Wed Feb 22 10:18:49 2017 - [info] Master MHA Node version is 0.56.Wed Feb 22 10:18:49 2017 - [info] Checking recovery script configurations on 172.16.23.11(172.16.23.11:3306)..Wed Feb 22 10:18:49 2017 - [info] Executing command: save_binary_logs --command=test --start_pos=4 --binlog_dir=/var/lib/mysql,/var/log/mysql --output_file=/data/masterha/app1/save_binary_logs_test --manager_version=0.56 --start_file=log-bin.000003Wed Feb 22 10:18:49 2017 - [info] Connecting to root@172.16.23.11(172.16.23.11:22).. Creating /data/masterha/app1 if not exists.. Creating directory /data/masterha/app1.. done. ok. Checking output directory is accessible or not.. ok. Binlog found at /var/lib/mysql, up to log-bin.000003Wed Feb 22 10:18:50 2017 - [info] Binlog setting check done.Wed Feb 22 10:18:50 2017 - [info] Checking SSH publickey authentication and checking recovery script configurations on all alive slave servers..Wed Feb 22 10:18:50 2017 - [info] Executing command : apply_diff_relay_logs --command=test --slave_user='rjyy' --slave_host=172.16.23.12 --slave_ip=172.16.23.12 --slave_port=3306 --workdir=/data/masterha/app1 --target_version=5.5.44-MariaDB-log --manager_version=0.56 --relay_log_info=/var/lib/mysql/relay-log.info --relay_dir=/var/lib/mysql/ --slave_pass=xxxWed Feb 22 10:18:50 2017 - [info] Connecting to root@172.16.23.12(172.16.23.12:22)..Creating directory /data/masterha/app1.. done. Checking slave recovery environment settings.. Opening /var/lib/mysql/relay-log.info ... ok. Relay log found at /var/lib/mysql, up to relay-bin.000009 Temporary relay log file is /var/lib/mysql/relay-bin.000009 Testing mysql connection and privileges.. done. Testing mysqlbinlog output.. done. Cleaning up test file(s).. done.Wed Feb 22 10:18:51 2017 - [info] Executing command : apply_diff_relay_logs --command=test --slave_user='rjyy' --slave_host=172.16.23.13 --slave_ip=172.16.23.13 --slave_port=3306 --workdir=/data/masterha/app1 --target_version=5.5.44-MariaDB-log --manager_version=0.56 --relay_log_info=/var/lib/mysql/relay-log.info --relay_dir=/var/lib/mysql/ --slave_pass=xxxWed Feb 22 10:18:51 2017 - [info] Connecting to root@172.16.23.13(172.16.23.13:22)..Creating directory /data/masterha/app1.. done. Checking slave recovery environment settings.. Opening /var/lib/mysql/relay-log.info ... ok. Relay log found at /var/lib/mysql, up to relay-bin.000007 Temporary relay log file is /var/lib/mysql/relay-bin.000007 Testing mysql connection and privileges.. done. Testing mysqlbinlog output.. done. Cleaning up test file(s).. done.Wed Feb 22 10:18:52 2017 - [info] Slaves settings check done.Wed Feb 22 10:18:52 2017 - [info]172.16.23.11(172.16.23.11:3306) (current master) +--172.16.23.12(172.16.23.12:3306) +--172.16.23.13(172.16.23.13:3306)Wed Feb 22 10:18:52 2017 - [info] Checking replication health on 172.16.23.12..Wed Feb 22 10:18:52 2017 - [info] ok.Wed Feb 22 10:18:52 2017 - [info] Checking replication health on 172.16.23.13..Wed Feb 22 10:18:52 2017 - [info] ok.Wed Feb 22 10:18:52 2017 - [warning] master_ip_failover_script is not defined.Wed Feb 22 10:18:52 2017 - [warning] shutdown_script is not defined.Wed Feb 22 10:18:52 2017 - [info] Got exit code 0 (Not master dead).MySQL Replication Health is OK. æ£€æŸ¥ç®¡ç†çš„MySQLå¤åˆ¶é›†ç¾¤çš„è¿žæŽ¥é…ç½®å‚æ•°æ˜¯æ­£å¸¸çš„ï¼› 12# nohup masterha_manager --conf=/etc/masterha/app1.cnf &gt; /data/master/app1/manager.log 2&gt;&amp;1 &amp; # è®©masterha_managerè¿›ç¨‹å·¥ä½œäºŽåŽå° å››ã€å¼€å§‹æµ‹è¯•123456789101112131415161718192021[root@node1 ~]# systemctl stop mariadb # è®©ä¸»æœåŠ¡å™¨åœæŽ‰ï¼›[root@node2 ~]# mysqlWelcome to the MariaDB monitor. Commands end with ; or \g.Your MariaDB connection id is 50Server version: 5.5.44-MariaDB-log MariaDB ServerCopyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.MariaDB [(none)]&gt; SHOW MASTER STATUS;+-------------------+----------+--------------+------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |+-------------------+----------+--------------+------------------+| master-bin.000005 | 245 | | |+-------------------+----------+--------------+------------------+1 row in set (0.00 sec)MariaDB [(none)]&gt; SHOW SLAVE STATUS\G;Empty set (0.00 sec)ERROR: No query specified æ­¤æ—¶node2è¢«æå‡ä¸ºä¸»æœåŠ¡å™¨ ,node3æ‹‰å–æ•°æ®èµ°å‘node2 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152[11:12:41root@node3~]#mysqlWelcome to the MariaDB monitor. Commands end with ; or \g.Your MariaDB connection id is 33Server version: 5.5.44-MariaDB-log MariaDB ServerCopyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.MariaDB [(none)]&gt; SHOW SLAVE STATUS\G;*************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 172.16.23.12 Master_User: rj Master_Port: 3306 Connect_Retry: 60 Master_Log_File: master-bin.000008 Read_Master_Log_Pos: 245 Relay_Log_File: relay-bin.000002 Relay_Log_Pos: 530 Relay_Master_Log_File: master-bin.000008 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 245 Relay_Log_Space: 818 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 21 row in set (0.00 sec)]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
        <tag>database</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS 7 ELK(Elasticsearch Logstash Kibana) æ­å»º]]></title>
    <url>%2F2018%2F01%2F30%2FCentOS-7-ELK-Elasticsearch-Logstash-Kibana-%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[CentOS 7 ELK(Elasticsearch Logstash Kibana) æ­å»º ä¸ç®¡æ˜¯ç”¨äºŽè®°å½•ï¼Œç›‘æŽ§æˆ–è€…ç¨‹åºçš„Debugï¼Œæ—¥å¿—ï¼Œå¯¹äºŽä»»ä½•ç³»ç»Ÿæ¥è¯´éƒ½æ˜¯ä¸€ä¸ªåŠå…¶é‡è¦çš„éƒ¨åˆ†;ä½†ä¸€èˆ¬æ—¥å¿—çš„æ•°æ®é‡ä¼šæ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”åˆ†æ•£åœ¨å„ä¸ªåœ°æ–¹ã€‚å¦‚æžœç®¡ç†çš„æœåŠ¡å™¨æˆ–è€…ç¨‹åºæ¯”è¾ƒå°‘çš„æƒ…å†µ;æˆ‘ä»¬è¿˜å¯ä»¥é€ä¸€ç™»å½•åˆ°å„ä¸ªæœåŠ¡å™¨åŽ»æŸ¥çœ‹ï¼Œåˆ†æžã€‚ä½†å¦‚æžœæœåŠ¡å™¨æˆ–è€…ç¨‹åºçš„æ•°é‡æ¯”è¾ƒå¤šäº†;ä¹‹åŽè¿™ç§æ–¹æ³•å°±æ˜¾å¾—åŠ›ä¸ä»Žå¿ƒã€‚åŸºäºŽæ­¤ï¼Œä¸€äº›é›†ä¸­å¼çš„æ—¥å¿—ç³»ç»Ÿä¹Ÿå°±åº”ç”¨è€Œç”Ÿ;ç›®å‰æ¯”è¾ƒæœ‰åæˆç†Ÿçš„æœ‰ï¼ŒSentryã€Splunk(å•†ä¸š)ã€FaceBook çš„Scribeã€Apache çš„ Chukwa;Cloudera çš„ Fluentdã€è¿˜æœ‰ELK ç­‰ç­‰; Sentry ä¸Ž ELKçš„å¯¹æ¯”1ã€ sentry sentry æ˜¯ç”±pythonå¼€å‘ä¸”å¼€æºçš„æ—¥å¿—å­˜å‚¨å·¥å…·ï¼Œå ç”¨å†…å­˜è¾ƒå°ï¼Œæ‰§è¡Œé€Ÿåº¦è¾ƒæ…¢ï¼Œé€‚åˆå°‘é‡æ—¥å¿—å­˜å‚¨;php pythonç­‰ç¨‹åºå¯ä»¥ç›´æŽ¥è°ƒç”¨sentry url å°†æ—¥å¿—å†™å…¥ï¼Œä¸æ”¯æŒsentryä¸»åŠ¨åŽ»é¢å¤–çš„æ”¶é›†æ—¥å¿—;ä¸æ”¯æŒåˆ†å¸ƒå¼ä¸Žæ¨ªå‘æ‰©å±•;åªèƒ½æŸ¥æ‰¾é”™è¯¯æ—¥å¿—ï¼Œä¸æ”¯æŒå…¨å±€æœç´¢;ä¸€èˆ¬è¿è¡Œåœ¨dockerä¸­ï¼Œéƒ¨ç½²æ–¹ä¾¿ã€‚å‡ºçŽ°é—®é¢˜æŽ’æŸ¥è´¹åŠ²;æœ€åº•é…ç½®1æ ¸1G; 2ã€ ELK ELKå³(Elasticsearch[æœç´¢å¼•æ“Ž]ï¼ŒLogstash[æ—¥å¿—æ”¶é›†]ï¼ŒKibana [å®¢æˆ·ç«¯æŽ¥å…¥çš„webå¹³å°]);ELK æ˜¯ç”±JAVAå¼€å‘ä¸”å¼€æºçš„æ—¥å¿—å­˜å‚¨å¥—ä»¶ï¼Œå ç”¨å†…å­˜è¾ƒå¤§ï¼Œæ‰§è¡Œé€Ÿåº¦è¾ƒå¿«ï¼Œé€‚åˆå¤§é‡å¿—æ—¥å¿—é«˜å¹¶å‘å­˜å‚¨;æ”¯æŒåˆ†å­˜å¼ä¸Žæ¨ªå‘æ‰©å±•;æ”¯æŒå…¨å±€æœç´¢ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æœç´¢ï¼Œæ”¯æŒå›¾å½¢ç»Ÿè®¡, æ”¯æŒæ—¥å¿—jsonã€è¡¨æ ¼å½¢å¼;ä¸€èˆ¬è¿è¡Œåœ¨ç³»ç»Ÿå±‚é¢ï¼Œéƒ¨ç½²è´¹åŠ²ã€‚å‡ºçŽ°é—®é¢˜æ˜“äºŽæ‹†åˆ†ï¼ŒæŽ’æŸ¥;æœ€åº•é…ç½®2æ ¸4G; æ­¤æ¬¡éƒ¨ç½²è¿‡ç¨‹ æ³¨: äºŒè¿›åˆ¶åŒ…Elasticsearch ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨æœåŠ¡ JDK 8 çš„å®‰è£…ä¸Žé…ç½®123456789101112131415# useradd elasticsearch# passwd elasticsearch# vim /etc/profile #åœ¨æœ€åŽåŠ å…¥ä»¥ä¸‹å†…å®¹ export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64export JRE_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jreexport PATH=/usr/share/logstash/bin/:$PATH# source /etc/profile # yum -y install yum -y install java[root@iz8vbap8o8nj8n6yoc05n6z logstash-5.3.0]# java -versionopenjdk version "1.8.0_161"OpenJDK Runtime Environment (build 1.8.0_161-b14)OpenJDK 64-Bit Server VM (build 25.161-b14, mixed mode)[root@iz8vbap8o8nj8n6yoc05n6z logstash-5.3.0]# echo $JAVA_HOME /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64 ElasticSearch å®‰è£…ä¸Žé…ç½®1ã€å®‰è£… ElasticSearch 123456789101112131415# wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.3.0.zip# unzip elasticsearch-5.3.0.zip# mv elasticsearch-5.3.0 /usr/local/# chown elasticsearch.elasticsearch /usr/local/elasticsearch-5.3.0/ -R# vim /usr/local/elasticsearch-5.3.0/config/elasticsearch.yml #å¯ç”¨å˜æ›´ä»¥ä¸‹é…ç½®cluster.name: transfereasy-elknode.master: truenode.data: truepath.data: /data/elasticDatapath.logs: /data/logsnetwork.host: 0.0.0.0http.port: 9200 2ã€å®‰è£…x-packæ’ä»¶ 1# /usr/local/elasticsearch-5.3.0/bin/elasticsearch-plugin install x-pack 3ã€å¯åŠ¨ ElasticSearch 12345678# su - elasticsearch $ /usr/local/elasticsearch-5.3.0/bin/elasticsearch -d$ exit # æœåŠ¡å¯åŠ¨éªŒè¯# netstat -tnlup | egrep "9200|9300"tcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 14459/java tcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 14459/java 4ã€api éªŒè¯ 123456789101112131415# curl http://localhost:9200 -u elastic# é»˜è®¤ç”¨æˆ· elastic é»˜è®¤å¯†ç :changeme&#123; "name" : "RXHIrkw", "cluster_name" : "ssjinyao-elk", "cluster_uuid" : "xxxxxxxxxxxxxxxxxx", "version" : &#123; "number" : "5.3.0", "build_hash" : "3adb13b", "build_date" : "2017-03-23T03:31:50.652Z", "build_snapshot" : false, "lucene_version" : "6.4.1" &#125;, "tagline" : "You Know, for Search"&#125; 5ã€æ·»åŠ å¼€æœºå¯åŠ¨ 1echo "/usr/local/elasticsearch-5.3.0/bin/elasticsearch -d" &gt; /etc/rc.local 6ã€é—®é¢˜è§£å†³ 12345678910aã€can not run elasticsearch as root # éœ€æ–°å»ºå¯åŠ¨ElasticSearchçš„ç”¨æˆ·bã€max file descriptors [65535] for elasticsearch process is too low, increase to at least [65536]# vim /etc/sercurity/limits.conf* soft nofile 655350* hard nofile 655350$ su - elasticsearch # å†æ¬¡åˆå¯¹æ˜¯å¦å¯ä»¥æ‰“å¼€655350ä¸ªæ–‡ä»¶ cã€max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] # vim /etc/sysctl.conf æ·»åŠ ä»¥ä¸‹å†…å®¹vm.max_map_count=655300# sysctl -p Kibanaçš„å®‰è£…ä¸Žé…ç½®1ã€ å®‰è£… 123456# wget https://artifacts.elastic.co/downloads/kibana/kibana-5.3.0-linux-x86_64.tar.gz # tar -zxf kibana-5.3.0-linux-x86_64.tar.gz# mv kibana-5.3.0-linux-x86_64 /usr/local/# chown elasticsearch.elasticsearch /usr/local/kibana-5.3.0-linux-x86_64/ -R# cd /usr/local/kibana-5.3.0-linux-x86_64/# bin/kibana-plugin install x-pack 2ã€ é…ç½® 12345678# vim /usr/local/kibana-5.3.0-linux-x86_64/config/kibana.yml # å˜æ›´ä»¥ä¸‹é…ç½®elasticsearch.url: "http://localhost:9200"# su - elasticsearch$ nohup /usr/local/kibana-5.3.0-linux-x86_64/bin/kibana &amp;# exit # netstat -tnlup | grep 5601tcp 0 0 127.0.0.1:5601 0.0.0.0:* LISTEN 14132/node Nginx çš„å®‰è£…ä¸Žé…ç½®12345678910111213141516171819202122232425262728293031323334353637383940# yum install nginx -y # nginx -t # vim /etc/nginx/conf.d/kibana.confserver &#123; listen 80 default_server; listen [::]:80 default_server; server_name _; location / &#123; proxy_pass http://127.0.0.1:5601; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection 'upgrade'; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; &#125;&#125;# vim /etc/nginx/nginx.conf æ³¨é‡Šé»˜è®¤è™šæ‹Ÿä¸»æœº# server &#123;# listen 80 default_server;# listen [::]:80 default_server;# server_name _;# root /usr/share/nginx/html;## # Load configuration files for the default server block.# include /etc/nginx/default.d/*.conf;## location / &#123;# &#125;## error_page 404 /404.html;# location = /40x.html &#123;# &#125;## error_page 500 502 503 504 /50x.html;# location = /50x.html &#123;# &#125;# &#125;# nginx -t # systemctl restart nginx æµè§ˆå™¨è®¿é—® http://xxx.ssjinyao.com/ Logstash çš„å®‰è£…ä¸Žé…ç½® æ³¨:ç”±äºŽlogstash-5.3çš„äºŒè¿›åˆ¶åŒ…æ— æ³•å®žåˆ«ç³»ç»ŸçŽ¯å¢ƒPASHå˜é‡ï¼Œæ‰€ä»¥è¿™é‡Œç”¨rpmåŒ…ï¼Œyumå®‰è£… 1ã€ ä¸‹è½½å¹¶å®‰è£…Logstash rpm åŒ… 12# wget https://artifacts.elastic.co/downloads/logstash/logstash-6.1.2.rpm# yum -y install logstash-6.1.2.rpm 2ã€ é…ç½®Logstash æ”¶é›†è¿œç¨‹æ—¥å¿— 123456789101112131415161718192021222324# vim first-pipeline.confinput &#123; udp &#123; port =&gt; 5959 codec =&gt; json &#125;&#125;filter &#123; grok &#123; match =&gt; &#123; "message" =&gt; "%&#123;COMBINEDAPACHELOG&#125;"&#125; &#125; geoip &#123; source =&gt; "clientip" &#125;&#125;output &#123; #stdout &#123; codec =&gt; rubydebug &#125; elasticsearch &#123; hosts =&gt; ["127.0.0.1:9200"] user =&gt; "elastic" password =&gt; "xxxxxxxxx" &#125;&#125;# logstash -f first-pipeline.conf --path.settings=/etc/logstash/ --config.reload.automatic &amp; beats çš„å®‰è£…ä¸Žé…ç½® Beatsæ˜¯ä½œä¸ºä»£ç†åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…çš„å¼€æºçš„ data shippersï¼Œèƒ½å°†å„ç§ä¸åŒç±»åž‹çš„æ“ä½œæ•°æ®;ï¼ˆå¦‚ï¼Œ wireDataã€LogFilesã€Metricsã€WinEventï¼‰ç›´æŽ¥å‘é€åˆ° Elasticsearch;æˆ–è€…é€šè¿‡Logstashå°†å…¶å‘é€åˆ°Elasticsearchã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è§£æžå’Œè½¬æ¢æˆ‘ä»¬éœ€è¦æ”¶é›†çš„å„ç§æ•°æ®; 1ã€ å®‰è£… 12# wget https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-5.3.1-x86_64.rpm# yum -y install metricbeat-5.3.1-x86_64.rpm 2ã€ é…ç½® 1234567891011121314151617181920212223242526272829303132# vim /etc/metricbeat/metricbeat.ymlmetricbeat.modules:- module: system metricsets: - cpu - load - core - diskio - filesystem - fsstat - memory - network - process - socket enabled: true period: 10s processes: ['.*']- module: nginx metricsets: ["stubstatus"] enabled: true period: 10s hosts: ["http://127.0.0.1"] server_status_path: "NginxStatus"output.elasticsearch: hosts: ["127.0.0.1:9200"] username: "elastic" password: "changeme"logging.level: debugoutput.elasticsearch: hosts: ["localhost:9200"]# metricbeat.sh -c metricbeat.yml -configtestConfig OK ç™»å½•æŸ¥è¯¢æ—¥å¿—1ã€ ç›¸çœ‹æ—¥å¿—æºipåŒºåŸŸåˆ†å¸ƒ 2ã€ Nginx æ—¥å¿—æ ¼å¼å¦‚ä¸‹ 3ã€ ä½¿ç”¨æ­£åˆ™æœç´¢ 4ã€ ç›´æŽ¥å†™å…¥Logstashçš„pythonæ—¥å¿—è¡¨æ ¼å¼ 5ã€ ç›´æŽ¥å†™å…¥Logstashçš„pythonæ—¥å¿—jsonæ ¼å¼ è¿œç¨‹æ—¥å¿—æ”¶é›†1ã€ filebeat çš„å®‰è£… 1234567891011121314151617181920$ curl -L -O https://download.elastic.co/beats/filebeat/filebeat_1.3.0_amd64.deb$ sudo dpkg -i filebeat_1.3.0_amd64.deb$ sudo vim /etc/filebeat/filebeat.yml filebeat: prospectors: - paths: - /var/log/nginx/*.log - /var/log/cashier/logs/*.log - /var/log/topen/logs/*.log - /var/log/xbasement/logs/*log input_type: log document_type: nginx-access-testapi.transfereasy.com registry_file: /var/lib/filebeat/registryoutput: logstash: hosts: [&quot;xxx.xx.xxx.xx:5959&quot;]shipper:logging: files: 2ã€ å°†æ•°æ®åŒæ­¥åˆ°elk 12$ sudo /etc/init.d/filebeat start$ sudo /etc/init.d/filebeat status]]></content>
      <tags>
        <tag>rhca</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python ä¹‹ä¸šåŠ¡æœåŠ¡ç›‘æŽ§è¯¦è§£(å››)]]></title>
    <url>%2F2018%2F01%2F23%2Fpython-%E4%B9%8B%E4%B8%9A%E5%8A%A1%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E8%AF%A6%E8%A7%A3-%E5%9B%9B%2F</url>
    <content type="text"><![CDATA[å®žçŽ°å›¾æ–‡æ ¼å¼çš„æœåŠ¡å™¨æ€§èƒ½æŠ¥è¡¨é‚®ä»¶é€šè¿‡MIMEText ä¸Ž MIMEImageç±»çš„ç»„åˆï¼Œå®žçŽ°å›¾æ–‡é‚®ä»¶æ ¼å¼ã€‚å¦é€šè¿‡MIMETextç±»å†å®šä¹‰Content-Disposition å±žæ€§æ¥å®žçŽ°é™„ä»¶çš„é‚®ä»¶ã€‚å¯ä»¥åˆ©ç”¨è¿™äº›ç‰¹æ€§æ¥å®šè´¨æœåŠ¡å™¨å‘¨æŠ¥ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960âžœ test cat email_open.py #!/usr/bin/env python# -*- coding: utf-8 -*-import smtplibfrom email.mime.multipart import MIMEMultipart # å¯¼å…¥MIMEMultipartç±» from email.mime.text import MIMEText # å¯¼å…¥MIMETextç±» from email.mime.image import MIMEImage # å¯¼å…¥MIMEImae ç±»HOST = "smtp.139.com" # å®šä¹‰é‚®ä»¶ stmp ä¸»æœºSUBJECT = u"ä¸šåŠ¡æ€§èƒ½æ•°æ®æŠ¥è¡¨" # å®šä¹‰é‚®ä»¶ä¸»é¢˜TO = "1922006891@qq.com" # å®šä¹‰é‚®ä»¶æ”¶ä»¶äººFROM = "15822097176@139.com" # å®šä¹‰é‚®ä»¶å‘ä»¶äººdef addimg(src,imgid): # æ·»åŠ ç‰‡å‡½æ•°ï¼Œå‚æ•°1:å›¾ç‰‡è·¯å¾„,å‚æ•°2: å›¾ç‰‡id fp = open(src, 'rb') # æ‰“å¼€æ–‡ä»¶ msgImage = MIMEImage(fp.read()) # åˆ›å»ºMIMEImageå¯¹è±¡ï¼Œè¯»å–å›¾ç‰‡å†…å®¹å¹¶ä½œä¸ºå‚æ•° fp.close() # å…³é—­æ–‡ä»¶ msgImage.add_header('Content-ID', imgid) # æŒ‡å®šå›¾ç‰‡æ–‡ä»¶çš„Content-ID,&lt;img&gt; æ ‡ç­¾srcç”¨åˆ° return msgImage # è¿”å›žmsgImage å¯¹è±¡msg = MIMEMultipart('related') # åˆ›å»ºMIMEMultipartå¯¹è±¡ï¼Œé‡‡ç”¨relatedå®šä¹‰å†…åµŒèµ„æºçš„é‚®ä»¶ä½“#åˆ›å»ºMIMETextå¯¹è±¡ï¼ŒHTMLå…ƒç´ åŒ…æ‹¬è¡¨æ ¼&lt;stable&gt;åŠå›¾ç‰‡&lt;img&gt;msgtext = MIMEText(""" &lt;table width="600" border="0" cellspacing="0" cellpadding="4"&gt; &lt;tr bgcolor="#CECFAD" height="20" style="font-size:14px"&gt; &lt;td colspan=2&gt; * å®˜ç½‘æ€§èƒ½æ•°æ® &lt;a href="www.ssinyao.com"&gt; æ›´å¤š&gt;&gt; &lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr bgcolor="#EFEBDE" height="100" style="font-size:13px"&gt; &lt;td&gt; &lt;img src="cid:systemload"&lt;/td&gt;&lt;td&gt; &lt;img src="cid:cpu"&lt;td&gt; &lt;/tr&gt; &lt;tr bgcolor="#EFEBDE" height="100" sytle="font-size:13px"&gt; &lt;td&gt; &lt;img src="cid:eth0"&gt;&lt;/td&gt;&lt;td&gt; &lt;img src="cid:eth1"&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt;""", "html","utf-8") #&lt;img&gt; æ ‡ç­¾çš„srcå±žæ€§æ˜¯é€šè¿‡Content-ID æ¥å¼•ç”¨çš„msg.attach(msgtext) msg.attach(addimg("./systemload.png", "systemload")) msg.attach(addimg("./cpu.png", "cpu")) msg.attach(addimg("./eth0.png", "eth0")) msg.attach(addimg("./eth1.png", "eth1")) msg['Subject'] = SUBJECT # é‚®ä»¶ä¸»é¢˜msg['From'] = FROM # é‚®ä»¶å‘é€äººï¼Œé‚®ä»¶å¤´éƒ¨å¯è§msg['TO'] = TO # é‚®ä»¶æ”¶ä»¶äººï¼Œé‚®ä»¶å¤´éƒ¨å¯è§try: server = smtplib.SMTP() # åˆ›å»ºä¸€ä¸ªSMTP()å¯¹è±¡ server.connect(HOST, "25") # é€šè¿‡connectæ–¹æ³•è¿žæŽ¥smtpä¸»æœº server.starttls() #å¯åŠ¨å®‰å…¨ä¼ è¾“æ¨¡å¼ server.login("15822097176@139.com","xxxxxxxx") # é‚®ç®±å¸å·ç™»å½•æ ¡éªŒ server.sendmail(FROM, TO, msg.as_string()) #é‚®ä»¶å‘é€ server.quit() # æ–­å¼€stmpè¿žæŽ¥ print "é‚®ä»¶å‘é€æˆåŠŸ"except Exception, e: print "å¤±è´¥:" +str(e)âžœ test ./email_open.py é‚®ä»¶å‘é€æˆåŠŸ å®žçŽ°çš„åŠŸèƒ½å¦‚ä¸‹ åŒæ ·åŠŸèƒ½çš„å®žçŽ° muttrc + msmtp å‘é€é‚®ä»¶12345678910111213141516171819# yum -y install msmtp mutt # cat /etc/muttrc et sendmail=&quot;/usr/bin/msmtp&quot;set use_from=yesset realname=&quot;15822097176@139.com&quot;set editor=&quot;vim&quot;# cat /etc/msmtprcaccount defaulthost smtp.139.comport 25from 15822097176@139.comauth logintls offuser 15822097176@139.compassword xxxxxxxx# echo &quot;test&quot; | mutt -s &quot;test&quot; -a /path/to/file]]></content>
      <tags>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python ä¹‹ä¸šåŠ¡æœåŠ¡ç›‘æŽ§è¯¦è§£(ä¸‰)]]></title>
    <url>%2F2018%2F01%2F22%2Fpython-%E4%B9%8B%E4%B8%9A%E5%8A%A1%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E8%AF%A6%E8%A7%A3-%E4%B8%89%2F</url>
    <content type="text"><![CDATA[DNSå¤„ç†æ¨¡å—dnspython dnspython(https://www.dnspython.org/)æ˜¯Pythonå®žçŽ°çš„ä¸€ä¸ªDNSå¼å…·åŒ…ï¼Œå®ƒæ”¯æŒå‡ ä¹Žæ‰€æœ‰çš„è®°å½•ç±»åž‹ ï¼Œå¯ä»¥ç”¨äºŽæŸ¥è¯¢ã€ä¼ è¾“å¹¶åŠ¨æ€æ›´æ–°ZONEä¿¡æ¯ï¼Œ åŒæ—¶æ”¯æŒTSIG(äº‹åŠ¡ç­¾å)éªŒè¯æ¶ˆæ¯å’ŒEDNS0(æ‰©å±•DNS)ã€‚åœ¨ç³»ç»Ÿç®¡ç†æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶æŸ¥è¯¢åŠŸèƒ½æ¥å®žçŽ°DNSæœåŠ¡ç›‘æŽ§ä»¥åŠè§£æžç»“æžœçš„æ ¡éªŒï¼Œå¯ä»¥ä»£æ›¿nslookupåŠdigç­‰ï¼Œè½»æ¾åšåˆ°ä¸ŽçŽ°æœ‰å¹³å°çš„æ•´åˆ 123456# pip install dnspython # easy_install dnspython # wget http://www.dnspython.org/kits/1.9.4/dnspython-1.9.4.tar.gz# tar -zxvf dnspython-1.9.4.tar.gz# cd dnspython-1.9.4# python setuppy install æ¨¡å—åŸŸåè§£æžæ–¹æ³•è¯¦è§£ dnspython æ¨¡å—æä¾›äº†å¤§é‡çš„DNSå¤„ç†æ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯åŸŸåæŸ¥è¯¢ã€‚dnspythonæä¾›äº†ä¸€ä¸ªDNSè§£æžå™¨ç±»â€“resolverï¼Œä½¿ç”¨å®ƒçš„uqueryæ–¹æ³•æ¥å®žçŽ°åŸŸåçš„æŸ¥è¯¢åŠŸèƒ½ã€‚queryæ–¹æ³•å®šä¹‰å¦‚ä¸‹; 12query(self, qname, rdtype=1, rdclass=1, tcp=False, source=None, raise_on_no_answer=True, source_port=0) å…¶ä¸­ï¼Œqnaeå‚æ•°ä¸ºæŸ¥è¯¢çš„åŸŸåã€‚rdtypeå‚æ•°ç”¨æ¥æŒ‡å®šRRèµ„æºçš„ç±»åž‹ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§: 123456# A è®°å½•ï¼Œå°†ä¸»æœºåè½¬æ¢æˆIPåœ°å€: # MX è®°å½•ï¼Œé‚®ä»¶äº¤æ¢è®°å½•ï¼Œå®šä¹‰é‚®ä»¶æœåŠ¡å™¨çš„åŸŸåï¼› # CNAMEè®°å½•ï¼ŒæŒ‡åˆ«åè®°å½•ï¼Œå®žçŽ°åŸŸåé—´çš„æ˜ å°„; # NSè®°å½•ï¼Œæ ‡è®°åŒºåŸŸçš„åŸŸåæœåŠ¡å™¨åŠæŽˆæƒå­åŸŸ; # PTRè®°å½•ï¼Œåå‘è§£æžï¼Œä¸ŽAè®°å½•ç›¸åï¼Œå°†IPè½¬æ¢æˆä¸»æœºå; # SOAè®°å½•ï¼ŒSOAæ ‡è®°ï¼Œä¸€ä¸ªèµ·å¦ˆæŽˆæƒåŒºçš„å®šä¹‰; rdclasså‚æ•°ç”¨äºŽæŒ‡å®šç½‘ç»œç±»åž‹ï¼Œå¯é€‰çš„å€¼æœ‰INã€CHä¸ŽHSã€å…¶ä¸­INä¸ºé»˜è®¤ï¼Œä½¿ç”¨æœ€å¹¿æ³›;tcpå‚æ•°ç”¨äºŽæŒ‡å®šæŸ¥è¯¢æ˜¯å¦å¯ç”¨TCPåè®®ï¼Œé»˜è®¤ä¸ºFalse(ä¸å¯ç”¨);source ä¸Žsource_port å‚æ•°ä½œä¸ºæŒ‡å®šæŸ¥è¯¢æºåœ°å€ä¸Žç«¯å£;é»˜è®¤å€¼ä¸ºæŸ¥è¯¢è®¾å¤‡IPåœ°å€å’Œ0ã€‚raise_on_no_answer;å‚å½“ç”¨äºŽæŒ‡å®šå½“æŸ¥è¯¢æ— åº”ç­”æ—¶æ˜¯å¦è§¦å‘å¼‚å¸¸ã€‚é»˜è®¤ä¸ºTrue; å¸¸è§è§£æžç±»åž‹ å¸¸è§çš„DNSè§£æžç±»åž‹åŒ…æ‹¬Aã€MXã€NSã€CNAMEç­‰ã€‚åˆ©ç”¨dnspythonå’Œdns.resolver.queryæ–¹æ³•å¯ä»¥ç®€å•å®žçŽ°è¿™äº›DNSç±»åž‹çš„æŸ¥è¯¢ï¼Œä¸ºåŽé¢è¦å®žçŽ°çš„åŠŸèƒ½æä¾›æ•°æ®æ¥æºï¼Œæ¯”å¦‚å¯¹ä¸€ä¸ªä½¿ç”¨DNSè½®å¾ªä¸šåŠ¡çš„åŸŸåè¿›è¡Œå¯ç”¨æ€§å¯ç”¨æ€§ï¼Œéœ€è¦å¾—åˆ°å½“å‰çš„è§£æžç»“æžœã€‚ 1ã€å®žçŽ°Aè®°å½•æŸ¥è¯¢æ–¹æ³• 12345678910111213âžœ test cat dns_domain.py #!/usr/bin/env python2.7# -*- coding: utf-8 -*-#from dns import resolverimport dns.resolverdomain = raw_input("Please input an domain: ") # è¾“å…¥åŸŸååœ°å€A = dns.resolver.query(domain, 'A') # æŒ‡å®šæŸ¥è¯¢ç±»åž‹ä¸ºAè®°å½• for i in A.response.answer: # é€šè¿‡ response.answer æ–¹æ³•èŽ·å–æŸ¥è¯¢å›žåº”ä¿¡æ¯ for j in i.items: # éåŽ†å›žåº”ä¿¡æ¯ print j.addressâžœ test ./dns_domain.py Please input an domain: www.ssjinyao.com47.94.3.76 2ã€å®žçŽ°MXè®°å½•æŸ¥è¯¢æ–¹æ³• 12345678910111213141516171819âžœ test ./dns_mx.pyPlease input an domain: ^CTraceback (most recent call last): File "./dns_mx.py", line 4, in &lt;module&gt; domain = raw_input("Please input an domain: ")KeyboardInterruptâžœ test cat ./dns_mx.py#!/usr/bin/env python2.7# -*- coding: utf-8 -*-import dns.resolver domain = raw_input("Please input an domain: ")MX = dns.resolver.query(domain, 'MX') # æŒ‡å®šæŸ¥è¯¢ç±»åž‹ä¸ºMXè®°å½•for i in MX: # éåŽ†å›žåº”ç»“æžœï¼Œè¾“å‡ºMXè®°å½•çš„preference åŠexchangerä¿¡æ¯ print 'MX preference =' , i.preference, 'mail exchanger=' , i.exchangeâžœ test ./dns_mx.pyPlease input an domain: 139.comMX preference = 10 mail exchanger= mx2.mail.139.com.MX preference = 20 mail exchanger= mx3.mail.139.com.MX preference = 5 mail exchanger= mx1.mail.139.com. 3ã€ å®žçŽ° NS è®°å½•æŸ¥è¯¢æ–¹æ³•æºç  1234567891011121314151617181920âžœ test cat dns_ns.py #!/usr/bin/env python2.7# -*- coding: utf-8 -*-import dns.resolver domain = raw_input('Please input an domain: ')ns = dns.resolver.query(domain, 'NS') # æŒ‡å®šæŸ¥è¯¢ç±»åž‹ä¸ºNSè®°å½•for i in ns.response.answer: for j in i.items: print j.to_text()âžœ test ./dns_ns.py Please input an domain: ssjinyao.comdns30.hichina.com.dns29.hichina.com.âžœ test ./dns_ns.pyPlease input an domain: baidu.comns2.baidu.com.ns7.baidu.com.dns.baidu.com.ns3.baidu.com.ns4.baidu.com. 4ã€ å®žçŽ°CNAMEè®°å½•æŸ¥è¯¢æ–¹æ³• 123456789101112131415âžœ test cat dns_cname.py #!/usr/bin/env python2.7# -*- coding: utf-8 -*-import dns.resolver domain = raw_input("Please input an domain: ")cname = dns.resolver.query(domain, 'CNAME') # æŒ‡å®šæŸ¥è¯¢ç±»åž‹ä¸ºCNAMEè®°å½•for i in cname.response.answer: # ç»“æžœå°†å›žåº” cname åŽçš„ç›®æ ‡åŸŸå for j in i.items: print j.to_text()âžœ test ./dns_cname.py Please input an domain: mail.ssjinyao.commail.mxhichina.com.âžœ test ./dns_cname.pyPlease input an domain: ll.ssjinyao.comwww.leleol.com. 5ã€ DNSåŸŸåè½®å¾ªä¸šåŠ¡ç›‘æŽ§ å¤§éƒ¨åˆ†çš„DNSè§£æžéƒ½æ˜¯ä¸€ä¸ªåŸŸåå¯¹åº”ä¸€ä¸ªIPåœ°å€ï¼Œä½†æ˜¯é€šè¿‡DNSè½®å¾ªå¯ä»¥åšåˆ°ä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ªIPä»Žè€Œå®žçŽ°æœ€ç®€å•ä¸”æœ€é«˜æ•ˆçš„è´Ÿè½½å‡è¡¡ï¼Œä¸è¿‡æ­¤æ–¹æ¡ˆæœ€å¤§çš„å¼Šç«¯æ˜¯ç›®æ ‡ä¸»æœºä¸å¯ä»¥ç”¨æ—¶ï¼Œæ— æ³•è¢«è‡ªåŠ¨å‰”é™¤ï¼Œå› æ­¤åšå¥½ä¸šåŠ¡ä¸»æœºçš„æœåŠ¡å¯ç”¨ç›‘æŽ§æ˜¯è‡³å…³é‡è¦çš„ï¼Œé€šè¿‡åˆ†æžå½“å‰åŸŸåçš„è§£æžIPå†ç»“åˆæœåŠ¡ç«¯å£æŽ¢æµ‹æ¥å®žçŽ°è‡ªåŠ¨ç›‘æŽ§ï¼Œåœ¨åŸŸåè§£æžä¸­æ·»åŠ ã€åˆ é™¤IPæ—¶æ— é¡»å¯¹ç›‘æŽ§è„šæœ¬è¿›è¡Œæ›´æ”¹ aã€ æ­¥éª¤ 12# å®žçŽ°å¯¹åŸŸåçš„è§£æžï¼ŒèŽ·å–åŸŸå æ‰€æœ‰çš„Aè®°å½•è§£æžIPåˆ—è¡¨; # å¯¹IP åˆ—è¡¨è¿›è¡ŒHTTPçº§åˆ«çš„æŽ¢æµ‹; bã€ å®žçŽ°æ‹“æ‰‘å›¾ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#!/usr/bin/env python2.7# -*- coding: utf-8 -*-import dns.resolver import os import httplibiplist = [] # å®šä¹‰åŸŸåIPåˆ—è¡¨å˜é‡appdomain = "www.qqlilin.com" # å®šä¹‰ä¸šåŠ¡åŸŸådef get_iplist(domain=""): # åŸŸåè§£æžå‡½æ•°ï¼Œè§£æžæˆåŠŸIPå°†è¢«è¿½åŠ åˆ°iplist try: A = dns.resolver.query(domain, 'A') # è§£æžAè®°å½•ç±»åž‹ except Exception, e: print "dns resolver error:" + str(e) return for i in A.response.answer: for j in i.items: iplist.append(j.address) # è¿½åŠ åˆ°iplist return Truedef checkip(ip): checkurl=ip+":80" getcontent="" httplib.socket.setdefaulttimeout(5) # å®šä¹‰httpè¿žæŽ¥è¶…æ—¶é—´ä¸º5ç§’ conn=httplib.HTTPConnection(checkurl) # åˆ›å»ºhttpè¿žæŽ¥å¯¹è±¡ try: conn.request("GET", "/", headers = &#123;"Host": appdomain&#125;) # å‘èµ·URLè¯·æ±‚ï¼Œæ·»åŠ host ä¸»æœºå¤´ r=conn.getresponse() getcontent = r.read(15) # èŽ·å–URLé¡µé¢å‰15ä¸ªå­—ç¬¦ï¼Œä»¥ä¾¿åšå¯ç”¨æ€§æ ¡éªŒ finally: if getcontent=="&lt;!doctype html&gt;": # ç›‘æŽ§URLé¡µçš„å†…å®¹ä¸€èˆ¬æ˜¯äº‹å…ˆå®šä¹‰å¥½çš„ï¼Œæ¯”å¦‚ "HTTP200" ç­‰ print (getcontent) print ip + " [OK]" else: print ip + " [Error]" # æ­¤å¤„å¯æ”¾å‘Šè­¦ç¨‹åºï¼Œå¯ä»¥æ˜¯é‚®ä»¶ï¼ŒçŸ­ä¿¡é€šçŸ¥if __name__ == "__main__": if get_iplist(appdomain) and len(iplist) &gt; 0: # æ¡ä»¶:åŸŸåè§£æžæ­£ç¡®è‡³å°‘è¿”å›žä¸€ä¸ªIP for ip in iplist: checkip(ip) else: print "dns resolver error"]]></content>
      <tags>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python ä¹‹ä¸šåŠ¡æœåŠ¡ç›‘æŽ§è¯¦è§£(äºŒ)]]></title>
    <url>%2F2018%2F01%2F19%2Fpython-%E4%B9%8B%E4%B8%9A%E5%8A%A1%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E8%AF%A6%E8%A7%A3-%E4%BA%8C%2F</url>
    <content type="text"><![CDATA[æ–‡ä»¶/ç›®å½•å·®å¼‚å¯¹æ¯”æ³• å½“æˆ‘ä»¬è¿›è¡Œä»£ç å®¡è®¡æˆ–æ ¡éªŒå¤‡ä»½æ—¶ï¼Œå¾€å¾€éœ€è¦æ£€æŸ¥åŽŸå§‹ä¸Žç›®æ ‡ç›®å½•çš„ä¸€è‡´æ€§;Pythonçš„æ ‡å‡†åº“å·²ç»è‡ªå¸¦äº†æ»¡è¶³æ­¤éœ€æ±‚çš„æ¨¡å—filecmp;filecmpå¯ä»¥å®žçŽ°æ–‡ä»¶ã€ç›®å½•éåŽ†å­ç›®å½•çš„å·®å¼‚å¯¹æ¯”åŠŸèƒ½;æ¯”å¦‚æŠ¥å‘Šä¸­è¾“å‡ºç›®å½•ç›®å½•æ¯”åŽŸå§‹å¤šå‡ºçš„æ–‡ä»¶æˆ–å­ç›®å½•;å³ä½¿æ–‡ä»¶åŒåä¹Ÿä¼šåˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ªæ–‡ä»¶(å†…å®¹çº§æ¯”å¯¹)ç­‰;python2.3 æˆ–æ›´é«˜ç‰ˆæœ¬é»˜è®¤è‡ªå¸¦fileempæ¨¡å—,æ— éœ€é¢å¤–å®‰è£…; æ¨¡å—å¸¸ç”¨æ–¹æ³•è¯´æ˜Ž filecmp æä¾›äº†ä¸‰ä¸ªæ“ä½œæ–¹æ³•ï¼Œåˆ†åˆ«ä¸ºcmpï¼ˆå•æ–‡ä»¶å¯¹æ¯”ï¼‰ã€cmpfiles(å¤šæ–‡ä»¶å¯¹æ¯”ï¼‰dircmpï¼ˆç›®å½•å¯¹æ¯”) 1234å•æ–‡ä»¶å¯¹æ¯”ï¼Œé‡‡ç”¨filecmp.cmp(f1,f2[,shallow])æ–¹æ³•ï¼Œæ¯”è¾ƒæ–‡ä»¶åä¸ºf1å’Œf2çš„æ–‡ä»¶ ç›¸åŒåå›žTrueï¼Œä¸ç›¸åŒè¿”å›žFalse,shallowé»˜è®¤ä¸ºTrueï¼Œæ„æ€æ˜¯åªæ ¹æ®os.stat()æ–¹æ³• è¿”å›žçš„æ–‡ä»¶åŸºæœ¬ä¿¡æ¯è¿›è¡Œå¯¹æ¯”ï¼Œæ¯”å¦‚æœ€åŽè®¿é—®æ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€çŠ¶æ€æ”¹å˜æ—¶é—´ç­‰ å¿½ç•¥å¯¹æ–‡ä»¶å†…å®¹çš„å¯¹æ¯”ã€‚å½“shallowä¸ºFalseæ—¶ï¼Œåˆ™os.stat()ä¸Žæ–‡ä»¶å†…å®¹åŒæ—¶è¿›è¡Œæ ¡éªŒ 1234567891011# å¯¹æ¯”æ–‡ä»¶çš„å·®å¼‚âžœ test echo "good user" &gt; f1 âžœ test echo "good user" &gt; f3âžœ test echo "good user2" &gt; f2In [2]: import filecmpIn [3]: filecmp.cmp("/Users/macbookdzsbe/Desktop/MyPython/test/f1","/Users/macbookdzsbe/Desktop/MyPython/test/f3")Out[3]: TrueIn [4]: filecmp.cmp("/Users/macbookdzsbe/Desktop/MyPython/test/f1","/Users/macbookdzsbe/Desktop/MyPython/test/f2")Out[4]: False dir1 ä¸Ž dir2ç›®å½•ä¸­æŒ‡å®šæ–‡ä»¶æ¸…å•å¯¹æ¯” ä¸¤ç›®å½•ä¸‹æ–‡ä»¶çš„ md5 ä¿¡æ¯å¦‚ä¸‹ä¸¤ç›®å½•ä¸‹æ–‡ä»¶çš„ md5 ä¿¡æ¯å¦‚ä¸‹,å…¶ä¸­f1ã€f2åŒ¹é…; f3ä¸åŒ¹é…f4,f5å¯¹åº”çš„ç›®å½•ä¸­ä¸å­˜åœ¨æ— æ³•æ¯”è¾ƒ 123456789101112131415[root@test dir2]# md5sum ../dir1/*1a9dbd408f626389539e9feb1d234df7 ../dir1/f1235dce31eebce0213322102f698bc249 ../dir1/f21a9dbd408f626389539e9feb1d234df7 ../dir1/f3d41d8cd98f00b204e9800998ecf8427e ../dir1/f5[root@test dir2]# md5sum *1a9dbd408f626389539e9feb1d234df7 f1235dce31eebce0213322102f698bc249 f268e51baf228d447b199a75268dd5634b f3764c976782dec989b043d08714ec21a5 f4# ä½¿ç”¨cmpfiles å¯¹æ¯”çš„ç»“æžœå¦‚ä¸‹ï¼Œç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ In [4]: import filecmpIn [5]: filecmp.cmpfiles("/root/test/dir1", "/root/test/dir2",['f1','f2','f3','f4','f5'])Out[5]: (['f1', 'f2'], ['f3'], ['f4', 'f5']) ç›®å½•å¯¹æ¯”ï¼Œèƒ½è¿‡dircmp(a,b[,ingore[,hide]]) ç±»åˆ›å»ºä¸€ä¸ªç›®å½•æ¯”è¾ƒå¯¹è±¡;å…¶ä¸­aå’Œbæ˜¯å‚åŠ æ¯”è¾ƒçš„ç›®å½•åã€‚ignoreä»£è¡¨æ–‡ä»¶åå¿½ç•¥çš„åˆ—è¡¨ï¼Œå¹¶é»˜è®¤ä¸º[â€˜RCSâ€™,â€™CVSâ€™,â€™â€™tags];hideä»£è¡¨éšè—çš„åˆ—è¡¨ï¼Œé»˜è®¤ä¸º[os.curdir, os.pardir]ã€‚dircmpç±»å¯ä»¥èŽ·å¾—ç›®å½•æ¯”è¾ƒçš„è¯¦ç»†ä¿¡æ¯;å¦‚åªæœ‰åœ¨aç›®å½•ä¸­åŒ…æ‹¬çš„æ–‡ä»¶ã€aä¸Žbéƒ½å­˜åœ¨çš„å­ç›®å½•ã€åŒ¹é…çš„æ–‡ä»¶ç­‰ï¼ŒåŒæ—¶æ”¯æŒé€’å½’; dircmpæä¾›äº†ä¸‰ä¸ªè¾“å‡ºæŠ¥çš„æ–¹æ³•123456789101112131415161718# report()ï¼Œæ¯”è¾ƒå½“å‰æŒ‡å®šç›®å½•ä¸­çš„å†…å®¹; # report_partial_closure(),æ¯”è¾ƒå½“å‰æŒ‡å®šç›®å½• åŠç¬¬ä¸€çº§å­ç›®å½•ä¸­çš„å†…å®¹; # report_full_closure(),é€’å½’æ¯”è¾ƒæ‰€æœ‰æŒ‡å®šç›®å½•çš„å†…å®¹; # ä¸ºè¾“å‡ºæ›´åŠ è¯¦ç»†çš„æ¯”è¾ƒå†…å®¹ï¼Œdircmpç±»è¿˜æä¾›äº†ä»¥ä¸‹å±žæ€§; # left, å·¦ç›®å½•,å¦‚ç±»å®šä¹‰çš„a; # right, å³ç›®å½•,å¦‚ç±»å®šä¹‰ä¸­çš„b; # left_list, å·¦ç›®å½•ä¸­çš„æ–‡ä»¶åŠç›®å½•åˆ—è¡¨; # right_list, å³ç›®å½•ä¸­çš„æ–‡ä»¶åŠç›®å½•åˆ—è¡¨; # common, ä¸¤è¾¹ç›®å½•å…±åŒå­˜åœ¨çš„æ–‡ä»¶æˆ–è€…ç›®å½•; # left_only, åªåœ¨å·¦ç›®å½•ä¸­çš„æ–‡ä»¶æˆ–è€…ç›®å½•; # right_only, åªåœ¨å³ç›®å½•çš„æ–‡ä»¶æˆ–è€…ç›®å½•; # common_dirs, ä¸¤è¾¹ç›®å½•éƒ½å­˜åœ¨çš„å­ç›®å½•; # common_files, ä¸¤è¾¹ç›®å½•éƒ½å­˜åœ¨çš„å­æ–‡ä»¶; # common_funny, ä¸¤è¾¹ç›®å½•éƒ½å­˜åœ¨çš„å­ç›®å½•(ä¸åŒç›®å½•ç±»åž‹æˆ–os.stat()è®°å½•çš„é”™è¯¯); # same_files, åŒ¹é…ç›¸åŒçš„æ–‡ä»¶; # diff_files, ä¸åŒ¹é…çš„æ–‡ä»¶; # funny_files, ä¸¤è¾¹ç›®å½•ä¸­éƒ½å­˜åœ¨ï¼Œä½†æ— æ³•æ¯”è¾ƒçš„æ–‡ä»¶; # subdirs, å°†common_dirsç›®å½•åæ˜ èº«åˆ°æ–°çš„dircmpå¯¹è±¡ï¼Œæ ¼å¼ä¸ºå­—å…¸ç±»åž‹; å¯¹æ¯”dir1ä¸Ždir2ç›®å½•å·®å¼‚1234567891011121314151617181920212223242526[root@test test]# mkdir dir1/&#123;a/&#123;a1,b/&#123;b1,b2,b3&#125;&#125;,f1,f2,f3,f4&#125; -pvmkdir: å·²åˆ›å»ºç›®å½• "dir1"mkdir: å·²åˆ›å»ºç›®å½• "dir1/a"mkdir: å·²åˆ›å»ºç›®å½• "dir1/a/a1"mkdir: å·²åˆ›å»ºç›®å½• "dir1/a/b"mkdir: å·²åˆ›å»ºç›®å½• "dir1/a/b/b1"mkdir: å·²åˆ›å»ºç›®å½• "dir1/a/b/b2"mkdir: å·²åˆ›å»ºç›®å½• "dir1/a/b/b3"mkdir: å·²åˆ›å»ºç›®å½• "dir1/f1"mkdir: å·²åˆ›å»ºç›®å½• "dir1/f2"mkdir: å·²åˆ›å»ºç›®å½• "dir1/f3"mkdir: å·²åˆ›å»ºç›®å½• "dir1/f4"[root@test test]# touch dir1/test.py[root@test test]# tree dir1/dir1/â”œâ”€â”€ aâ”‚ â”œâ”€â”€ a1â”‚ â””â”€â”€ bâ”‚ â”œâ”€â”€ b1â”‚ â”œâ”€â”€ b2â”‚ â””â”€â”€ b3â”œâ”€â”€ f1â”œâ”€â”€ f2â”œâ”€â”€ f3â”œâ”€â”€ f4â””â”€â”€ test.py 123456789101112131415161718192021222324252627282930[root@tf-test test]# mkdir dir2/&#123;a/&#123;a1,b/&#123;b1,b2,b3&#125;&#125;,aa&#123;/aa1&#125;,f1,f2,f3,f5&#125; -pvmkdir: å·²åˆ›å»ºç›®å½• "dir2"mkdir: å·²åˆ›å»ºç›®å½• "dir2/a"mkdir: å·²åˆ›å»ºç›®å½• "dir2/a/a1"mkdir: å·²åˆ›å»ºç›®å½• "dir2/a/b"mkdir: å·²åˆ›å»ºç›®å½• "dir2/a/b/b1"mkdir: å·²åˆ›å»ºç›®å½• "dir2/a/b/b2"mkdir: å·²åˆ›å»ºç›®å½• "dir2/a/b/b3"mkdir: å·²åˆ›å»ºç›®å½• "dir2/aa&#123;"mkdir: å·²åˆ›å»ºç›®å½• "dir2/aa&#123;/aa1&#125;"mkdir: å·²åˆ›å»ºç›®å½• "dir2/f1"mkdir: å·²åˆ›å»ºç›®å½• "dir2/f2"mkdir: å·²åˆ›å»ºç›®å½• "dir2/f3"mkdir: å·²åˆ›å»ºç›®å½• "dir2/f5"[root@tf-test test]# touch dir2/test.py[root@tf-test test]# tree dir2/dir2/â”œâ”€â”€ aâ”‚ â”œâ”€â”€ a1â”‚ â””â”€â”€ bâ”‚ â”œâ”€â”€ b1â”‚ â”œâ”€â”€ b2â”‚ â””â”€â”€ b3â”œâ”€â”€ aa&#123;â”‚ â””â”€â”€ aa1&#125;â”œâ”€â”€ f1â”œâ”€â”€ f2â”œâ”€â”€ f3â”œâ”€â”€ f5â””â”€â”€ test.py 1234567891011121314151617181920212223242526[root@test test]# cat cmpy.py #!/usr/bin/env python # -*- coding:utf-8 -*- import filecmpa = "/root/test/dir1" # å®šä¹‰å·¦ç›®å½• b = "/root/test/dir2" # å®šä¹‰å³ç›®å½• dirobj=filecmp.dircmp(a,b,['test.y']) # ç›®å½•æ¯”è¾ƒï¼Œå¿½ç•¥test.pyæ–‡ä»¶ #è¾“å‡ºå¯¹æ¯”ç»“æžœæ•°æ®æŠ¥è¡¨dirobj.report()dirobj.report_partial_closure()dirobj.report_full_closure() print "left_list:" + str(dirobj.left_list)print "right_list" + str(dirobj.right_list)print "common:" + str(dirobj.common)print "left_only:" + str(dirobj.left_only)print "right_only:" + str(dirobj.right_only)print "common_dirs:" + str(dirobj.common_dirs)print "common_files:" + str(dirobj.common_files)print "common_funny:" + str(dirobj.common_funny)print "same_file:" + str(dirobj.same_files)print "diff_files:" + str(dirobj.diff_files)print "funny_files:" + str(dirobj.funny_files) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455diff /root/test/dir1 /root/test/dir2Only in /root/test/dir1 : ['f4']Only in /root/test/dir2 : ['aa&#123;', 'f5']Identical files : ['test.py']Common subdirectories : ['a', 'f1', 'f2', 'f3']diff /root/test/dir1 /root/test/dir2Only in /root/test/dir1 : ['f4']Only in /root/test/dir2 : ['aa&#123;', 'f5']Identical files : ['test.py']Common subdirectories : ['a', 'f1', 'f2', 'f3']diff /root/test/dir1/a /root/test/dir2/aCommon subdirectories : ['a1', 'b']diff /root/test/dir1/f1 /root/test/dir2/f1diff /root/test/dir1/f2 /root/test/dir2/f2diff /root/test/dir1/f3 /root/test/dir2/f3diff /root/test/dir1 /root/test/dir2Only in /root/test/dir1 : ['f4']Only in /root/test/dir2 : ['aa&#123;', 'f5']Identical files : ['test.py']Common subdirectories : ['a', 'f1', 'f2', 'f3']diff /root/test/dir1/a /root/test/dir2/aCommon subdirectories : ['a1', 'b']diff /root/test/dir1/a/a1 /root/test/dir2/a/a1diff /root/test/dir1/a/b /root/test/dir2/a/bCommon subdirectories : ['b1', 'b2', 'b3']diff /root/test/dir1/a/b/b1 /root/test/dir2/a/b/b1diff /root/test/dir1/a/b/b2 /root/test/dir2/a/b/b2diff /root/test/dir1/a/b/b3 /root/test/dir2/a/b/b3diff /root/test/dir1/f1 /root/test/dir2/f1diff /root/test/dir1/f2 /root/test/dir2/f2diff /root/test/dir1/f3 /root/test/dir2/f3left_list:['a', 'f1', 'f2', 'f3', 'f4', 'test.py']right_list['a', 'aa&#123;', 'f1', 'f2', 'f3', 'f5', 'test.py']common:['a', 'f1', 'f2', 'f3', 'test.py']left_only:['f4']right_only:['aa&#123;', 'f5']common_dirs:['a', 'f1', 'f2', 'f3']common_files:['test.py']common_funny:[]same_file:['test.py']diff_files:[]funny_files:[] æ ¡éªŒæºä¸Žå¤‡ä»½ç›®å½•å·®å¼‚ æœ‰æ—¶å€™æˆ‘ä»¬æ— æ³•ç¡®è®¤å¤‡ä»½ç›®å½•ä¸Žæºç›®å½•æ–‡ä»¶æ˜¯å¦ä¿æŒä¸€è‡´ï¼ŒåŒ…æ‹¬æºç›®å½•ä¸­çš„æ–°æ–‡ä»¶æˆ–ç›®å½•;æ›´æ–°æ–‡ä»¶æˆ–ç›®å½• æœ‰æ— æˆåŠŸåŒæ­¥ï¼Œå®šæœŸè¿›è¡Œæ ¡éªŒï¼Œæ²¡æœ‰æˆåŠŸåˆ™å¸Œæœ›æœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œè¡¥å¤‡ä»½;æœ¬æœªä¾‹ä½¿ç”¨äº†filecmpæ¨¡å—çš„left_onlyã€diff_filesæ–¹æ³•é€’å½’èŽ·å–ç›®å½•çš„æ›´æ–°é¡¹;å†é€šè¿‡shuti.copyfileã€ os.makedirs æ–¹æ³•å¯¹æ›´æ–°é¡¹è¿›è¡Œå¤åˆ¶ï¼Œæœ€ç»ˆä¿æŒä¸€è‡´çŠ¶æ€; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566âžœ test cat dir_contrast.py #!/usr/bin/env python# -*- coding: utf-8 -*-import os, sys import filecmpimport re import shutil import difflibholderlist = []def compareme(dir1,dir2): # é€’å½’èŽ·å–æ›´æ–°é¡¹å‡½æ•° dircomp=filecmp.dircmp(dir1,dir2) only_in_one=dircomp.left_only # æºç›®å½•æ–°æ–‡ä»¶æˆ–ç›®å½• diff_in_one=dircomp.diff_files # ä¸åŒ¹é…æ–‡ä»¶ï¼Œæºç›®å½•æ–‡ä»¶å·²å‘ç”Ÿå˜åŒ– dirath=os.path.abspath(dir1) # å®šä¹‰æºç›®å½•ç»å¯¹è·¯å¾„ #å°†æ›´æ–°æ–‡ä»¶åæˆ–ç›®å½•è¿½å›žåˆ°holderlist [holderlist.append(os.path.abspath(os.path.join(dir1,x))) for x in only_in_one] [holderlist.append(os.path.abspath(os.path.join(dir1,x))) for x in diff_in_one] if len (dircomp.common_dirs) &gt; 0: # åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åŒå­ç›®å½•ï¼Œä»¥ä¾¿é€’å½’ for item in dircomp.common_dirs: #é€’å½’å­ç›®å½• compareme(os.path.abspath(os.path.join(dir1, item)), \ os.path.abspath(os.path.join(dir2,item))) return holderlist def main(): if len(sys.argv) &gt;2: # è¦æ±‚è¾“å…¥æºç›®å½•ä¸Žå¤‡ä»½ç›®å½• dir1 = sys.argv[1] dir2 = sys.argv[2] else: print "Usage:", sys.argv[0], "datadir backupdir" sys.exit() source_files = compareme(dir1,dir2) dir1 = os.path.abspath(dir1) if not dir2.endswith('/'): dir2=dir2+'/' #å¤‡ä»½ç›®å½•è·¯å¾„åŠ "/"ç¬¦ dir2=os.path.abspath(dir2) destination_files=[] createdir_bool = False for item in source_files: # éåŽ†è¿”å›žçš„å·®å¼‚æ–‡ä»¶æˆ–ç›®å½•æ¸…å• destination_dir= re.sub(dir1,dir2, item) # å°†æºç›®å½•å·®å¼‚è·¯å¾„æ¸…å•å¯¹åº”æ›¿æ¢æˆå¤‡ä»½ç›®å½• destination_files.append(destination_dir) if os.path.isdir(item): # å¦‚æžœå·®å¼‚è·¯å¾„ ä¸ºç›®å½•ä¸”ä¸å­˜åœ¨,åˆ™åœ¨å¤‡ä»½ç›®å½•ä¸­åˆ›å»º if not os.path.exists(destination_dir): os.makedirs(destination_dir) createdir_bool = True #å†æ¬¡è°ƒç”¨compareme å‡½æ•°æ ‡è®° if createdir_bool: #é‡æ–°è°ƒç”¨comparemeå‡½æ•°,é‡æ–°éåŽ†æ–°åˆ›å»ºç›®å½•çš„å†…å®¹ destination_files = [] source_files=[] source_files=compareme(dir1,dir2) # è°ƒç”¨comparemeå‡½æ•° for item in source_files: #èŽ·å–ç›®å½•å·®å¼‚è·¯å¾„æ¸…å•ï¼Œå¯¹åº”æ›¿æ¢æˆå¤‡åˆ†ç›®å½• destination_dir = re.sub(dir1,dir2, item) destination_files.append(destination_dir) print "update item:" print source_files #è¾“å‡ºæ›´æ–°é¡¹åˆ—è¡¨æ¸…å• copy_pair = zip(source_files,destination_files) #å°†æºç›®å½•ä¸Žå¤‡ä»½ç›®å½•æ–‡ä»¶æ‹†åˆ†æˆæ— ç»„ for item in copy_pair: if os.path.isfile(item[0]): shutil.copyfile(item[0], item[1])if __name__ == '__main__': main()]]></content>
      <tags>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python ä¹‹ä¸šåŠ¡æœåŠ¡ç›‘æŽ§è¯¦è§£(ä¸€)]]></title>
    <url>%2F2018%2F01%2F18%2Fpython-%E4%B9%8B%E4%B8%9A%E5%8A%A1%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E8%AF%A6%E8%A7%A3-%E4%B8%80%2F</url>
    <content type="text"><![CDATA[ä¸šåŠ¡æœåŠ¡ç›‘æŽ§è¯¦è§£ ä¸šåŠ¡æœåŠ¡ç›‘æŽ§æ˜¯è¿ç»´ä½“ç³»ä¸­æœ€é‡è¦çš„çŽ¯èŠ‚ï¼Œæ˜¯ä¿è¯ä¸šåŠ¡æœåŠ¡è´¨é‡çš„å…³é”®æ‰‹æ®µã€‚å¦‚ä½•æ›´æœ‰æ•ˆåœ°å®žçŽ°ä¸šåŠ¡æœåŠ¡æ˜¯æ¯ä¸ªè¿ç»´äººå‘˜åº”è¯¥æ€è€ƒçš„é—®é¢˜ï¼Œä¸åŒä¸šåŠ¡åœºæ™¯éœ€å®šåˆ¶ä¸åŒçš„ç›‘æŽ§ç­–ç•¥ã€‚Pythonåœ¨ç›‘æŽ§æ–¹é¢æä¾›äº†å¤§é‡çš„ç¬¬ä¸‰æ–¹å¼å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿã€æœ‰æ•ˆåœ°å¼€å‘ä¼ä¸šçº§æœåŠ¡ç›‘æŽ§å¹³å°ï¼Œä¸ºæˆ‘ä»¬çš„ä¸šåŠ¡ä¿é©¾æŠ¤èˆªã€‚ æ–‡ä»¶å†…å®¹å·®å¼‚å¯¹æ¯”æ–¹æ³• é€šè¿‡difflibæ¨¡å—å®žçŽ°æ–‡ä»¶å†…å®¹å·®å¼‚æ¯”å¯¹ã€‚difflibä½œä¸ºPythonçš„æ ‡å‡†åº“æ¨¡å—ï¼Œæ— éœ€å®‰è£…ï¼Œä½œç”¨æ˜¯å¯¹æ¯”æ–‡æœ¬ä¹‹é—´çš„å·®å¼‚ï¼Œä¸”æ”¯æŒè¾“å‡ºå¯è¯»æ€§è¾ƒå¼ºçš„HTMLæ¡£ï¼Œä¸Žlinuxä¸‹çš„diffå‘½ä»¤ç›¸ä¼¼ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨difflibå¯¹æ¯”ä»£ç ã€é…ç½®æ–‡ä»¶çš„å·®åˆ«ï¼Œåœ¨ç‰ˆæœ¬æŽ§åˆ¶æ–¹åœ¨æ˜¯éžå¸¸æœ‰ç”¨çš„ã€‚python2.3æˆ–è€…æ›´é«˜ç‰ˆæœ¬é»˜è®¤è‡ªå¸¦difflibæ¨¡å— ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å·®å¼‚å¯¹æ¯” é€šè¿‡ä½¿ç”¨difflibæ¨¡å—å®žçŽ°ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å·®å¼‚å¯¹æ¯”ï¼Œç„¶åŽä»¥ç‰ˆæœ¬æŽ§åˆ¶é£Žæ ¼è¿›è¡Œè¾“å‡º 123456789101112131415161718192021222324252627282930313233343536373839404142434445âžœ test cat diff.py #!/usr/bin/env python# -*- coding: utf-8 -*-import difflibtext1 = """text1: This module provides classes and funcitons for compring sequences.including HTML and context and unified diffs. difflib document v7.4add sring """text1_lines = text1.splitlines() #ä»¥è¡Œè¿›è¡Œåˆ†éš”ï¼Œä»¥ä¾¿è¿›è¡Œå¯¹æ¯” text2 = """text2This module provides classes and functions for Comparing sequences. including HTML and context and unified diffs. difflib document v7.5"""text2_lines = text2.splitlines() d = difflib.Differ()diff = d.compare(text1_lines, text2_lines) # é‡‡ç”¨compareæ–¹æ³•å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒprint '\n' .join(list(diff))# ç¤ºä¾‹ç»“æžœâžœ test python diff.py - text1: + text2- This module provides classes and funcitons for compring sequences.? - ^+ This module provides classes and functions for Comparing sequences. ? + ^ + + including HTML and context and unified diffs. - difflib document v7.4? ^+ difflib document v7.5? ^- add sring âžœ test ``` ## ç¬¦å·è¯´æ˜Ž â€˜_â€™ â€˜åŒ…å«åœ¨ç¬¬ä¸€ä¸ªåºåˆ—è¡Œä¸­ï¼Œä½†ä¸åŒ…å«åœ¨ç¬¬äºŒä¸ªåºåˆ—è¡Œâ€™â€˜+â€™ â€˜åŒ…å«åœ¨ç¬¬äºŒä¸ªåºåˆ—è¡Œä¸­ï¼Œä½†ä¸åŒ…å«åœ¨ç¬¬ä¸€ä¸ªåºåˆ—è¡Œâ€™â€˜â€™ â€˜ä¸¤ä¸ªåºåˆ—è¡Œä¸€è‡´â€™â€˜?â€™ â€˜æ ‡å¿—ä¸¤ä¸ªåºåˆ—è¡Œå­˜åœ¨å¢žé‡å·®å¼‚â€™â€˜^â€™ â€˜æ ‡å¿—å‡ºä¸¤ä¸ªåºåˆ—è¡Œå­˜åœ¨çš„å·®å¼‚å­—ç¬¦â€™1234567891011121314## ç”Ÿæˆç¾Žè§‚çš„å¯¹æ¯”HTMLæ ¼å¼æ–‡æ¡£&gt; é‡‡ç”¨HtmlDiff()ç±»çš„make_file() æ–¹æ³•å°±å¯ä»¥ç”Ÿæˆç¾Žè§‚çš„HTMLæ–‡æ¡£ ```pythond = difflib.Differ()diff = d.compare(text1_lines, text2_lines)print &apos;\n&apos; .join(list(diff))æ›¿æ¢æˆ:d = difflib.HtmlDiff()print d.make_file(text1_lines, text2_lines) å¯¹æ¯”Nginxé…ç½®æ–‡ä»¶å·®å¼‚ å½“æˆ‘ä»¬ç»´æŠ¤å¤šä¸ªNginxé…ç½®æ—¶ï¼Œæ—¶å¸¸ä¼šå¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶çš„å·®å¼‚ï¼Œä½¿ç”¨è¿ç»´äººå‘˜æ›´åŠ æ¸…æ™°åœ°äº†è§£ä¸åŒç‰ˆæœ¬è¿­ä»£çš„æ›´æ–°é¡¹ï¼Œå®žçŽ°çš„æ€è·¯æ˜¯è¯»å–ä¸¤ä¸ªéœ€å¯¹æ¯”çš„é…ç½®æ–‡ä»¶ï¼Œå†ä»¥æ¢è¡Œç¬¦ä½œä¸ºåˆ†éš”ç¬¦è°ƒç”¨ difflib.HtmlDiff() ç”ŸæˆHTMLæ ¼å¼çš„å·®å¼‚æ–‡æ¡£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546scp diff_nginx.py root@www.ssjinyao.com:/root/diff_nginx.py 100% 1035 1.0KB/s 00:00 âžœ test ssh root@www.ssjinyao.com Last failed login: Thu Jan 18 15:55:31 CST 2018 from 140.205.201.39 on ssh:nottyThere were 48 failed login attempts since the last successful login.Last login: Tue Jan 16 10:06:45 2018 from 111.198.29.81Welcome to Alibaba Cloud Elastic Compute Service ![root@iz2zearhdmowvugecyh820z ~]# vim diff_nginx.py [root@iz2zearhdmowvugecyh820z ~]# python diff_nginx.py /etc/nginx/conf.d/leleol.conf /etc/nginx/conf.d/hexo.conf &gt; /var/www/ssjinyao/diff_nginx.html[root@iz2zearhdmowvugecyh820z ~]# cat diff_nginx.py #!/bin/bash/env python # -*- coding: utf-8 -*-import difflibimport sys try: textfile1 = sys.argv[1] #ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶è·¯å¾„å‚æ•° textfile2 = sys.argv[2] #ç¬¬äºŒä¸ªé…ç½®æ–‡ä»¶è·¯å¾„å‚æ•°except Exception, e: print "Error:" + str(e) print "Usage: diff_nginx.py filename1 filename2" sys.exit()def readfile(filename): # æ–‡ä»¶è¯»å–åˆ†éš”å‡½æ•° try: fileHandle = open (filename, 'rb' ) text=fileHandle.read() .splitlines() #è¯»å–åŽä»¥è¡Œè¿›è¡Œåˆ†éš” fileHandle.close() return text except IOError as error: print ('Read file Error:' +str(error)) sys.exit() if textfile1 == "" or textfile2 == "": print "Usage: diff_nginx.py filename1 filename2 " sys.exit()text1_lines = readfile(textfile1) #è°ƒç”¨readfileå‡½æ•°ï¼ŒèŽ·å–åˆ†éš”åŽçš„å­—ç¬¦ä¸²text2_lines = readfile(textfile2) d = difflib.HtmlDiff() #åˆ›å»ºHtmlDiff()ç±»å¯¹è±¡print d.make_file(text1_lines,text2_lines) #é€šè¿‡make_fileæ–¹æ³•è¾“å‡ºHTMLçš„å¯¹æ¯”ç»“æžœhttps://www.ssjinyao.com/diff_nginx.html]]></content>
      <tags>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python wxpy æ¨¡å—å®žçŽ°å¾®ä¿¡é€šçŸ¥ä¸Žå‘Šè­¦]]></title>
    <url>%2F2018%2F01%2F16%2Fpython-wxpy-%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E4%B8%8E%E5%91%8A%E8%AD%A6%2F</url>
    <content type="text"><![CDATA[python wxpy æ¨¡å—å®žçŽ°å¾®ä¿¡é€šçŸ¥ä¸Žå‘Šè­¦1ã€python wxpyçš„å®‰è£… 12# pip install wxpy -i "https://pypi.doubanio.com/simple/"# pip install wechat_sender -i "https://pypi.doubanio.com/simple/" 2ã€ wxpyç™»å½•åŽå‘æ–‡ä»¶åŠ©æ‰‹å‘é€ä¸€æ¡ä¿¡æ¯ 1234567âžœ test cat wechat.py #!/usr/bin/env python2.7# -*- coding: utf-8 -*-from wxpy import *bot = Bot()bot.file_helper.send('hello world')print("ending") 3ã€wxpyç™»å½•åŽå®žçŽ°ä¸Žå¥½å‹/ç¾¤èŠ 1234567891011121314151617181920212223242526272829303132333435363738394041424344âžœ test cat wechat_friends.py #!/usr/bin/env python2.7# -*- coding: utf-8 -*-import sysimport time reload (sys)sys.setdefaultencoding("utf-8")# è¿™é‡Œè¦æ³¨æ„ä¸­æ–‡ç¼–ç çš„é—®é¢˜from wxpy import *bot = Bot()# èŽ·å–æ‰€æœ‰å¥½å‹friends = bot.friends()# éåŽ†è¾“å‡ºå¥½å‹åç§°for friend in friends: print(friend)# æ‰¾åˆ°å¥½å‹ friend = bot.friends() .search(unicode('æœ‰ä½ '))[0]print(friend)friend.send('ä½ åœ¨å¹²å˜›äº†?')# èŽ·å–æ‰€æœ‰èŠå¤©ç¾¤ groups = bot.groups()# éåŽ†è¾“å‡ºæ‰€æœ‰èŠå¤©ç¾¤for group in groups: print(group)# æ‰¾åˆ°ç›®æ ‡ç¾¤# æœç´¢èŠå¤©ç¾¤æ—¶ï¼Œè¦ç¡®ä¿å°†è¦æœç´¢çš„ç¾¤ç»„ä¿å­˜åœ¨é€šè®¯å½•ä¸­group = bot.groups() .search(unicode("an"))[0]i = 0while i&lt;= 999: group.send("This is bug ï¼ï¼ï¼") i +=1 time.sleep(0.5) 4ã€ å®žçŽ°è‡ªåŠ¨å¯¹æ¶ˆæ¯å¤„ç† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950âžœ test cat wechat_message.py #!/usr/bin/env python2.7 # -*- coding: utf-8 -*-from wxpy import *import sysreload (sys)sys.setdefaultencoding("utf-8")bot = Bot()# èŽ·å–å¥½å‹ my_friend = bot.friends() .search(unicode('æœ‰ä½ çœŸå¥½'))[0]# æœç´¢ä¿¡æ¯messages = bot.messages.search(keywords='æµ‹è¯•', sender=bot.self)for message in messages: print(message)# å‘é€æ–‡æœ¬my_friend.send('hello,yangyang!')# å‘é€å›¾ç‰‡my_friend.send_image('yangyang.png')# å‘é€è§†é¢‘#my_friend.send_video('yangyang.mov')# å‘ç£…æ–‡ä»¶my_friend.send_file('yangyang.zip')# ä»¥åŠ¨æ€çš„æ–¹å¼å‘é€å›¾ç‰‡my_friend.send('yangyang.png')# å‘é€å…¬ä¼—å·my_friend.send_raw_msg( #åç‰‡åŽŸå§‹æ¶ˆæ¯ç±»åž‹ raw_type=42, # æ³¨æ„`ussername` è¿™é‡Œåº”ä¸ºå¾®ä¿¡IDï¼Œä¸”è¢«å‘é€çš„åç‰‡å¿…é¡»ä¸ºè‡ªå·±çš„å¥½å‹ raw_content = '&lt;msg username="wxpy_bot" nickname="wxpy æœºå™¨äºº"/&gt;')# æ¶ˆæ¯æŽ¥æ”¶ç›‘å¬å™¨@bot.register()def print_others(msg): # è¾“å‡ºç›‘å¬åˆ°çš„æ¶ˆæ¯ print(msg) #å›žå¤æ¶ˆæ¯ msg.reply("hello world")embed() 5ã€ wxpyå›¾çµæœºå™¨äºº 123456789101112131415161718192021222324âžœ test cat wechat_tulin.py #!/usr/bin/env python2.7# -*- coding: utf-8 -*-from wxpy import *import sysimport timereload (sys)sys.setdefaultencoding("utf-8")bot = Bot() # èŽ·å–å¥½å‹ dear = bot.friends() .search(unicode('æœ‰ä½ çœŸå¥½'))[0]# æ³¨å†ŒèŽ·å¾—ä¸ªäººçš„å›¾å½•æœºå™¨äººkeyå¡«å…¥ tuling = Tuling(api_key='45a3c4xxxxxxxxx043a126a7119363d9fe')# ä½¿ç”¨å›¾çµæœºå™¨äººè‡ªåŠ¨ä¸ŽæŒ‡å®šå¥½å‹èŠå¤©@bot.register(dear)def reply_my_friend(msg): print(msg) tuling.do_reply(msg)embed()]]></content>
  </entry>
  <entry>
    <title><![CDATA[python è‡ªåŠ¨åŒ–ä¹‹paramiko]]></title>
    <url>%2F2018%2F01%2F12%2Fpython-%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B9%8Bparamiko%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹ paramiko æ˜¯åŸºäºŽPythonå®žçŽ°çš„SSH2è¿œç¨‹å®‰å…¨è¿žæŽ¥ï¼Œæ”¯æ”¯è®¤è¯åŠå¯†é’¥æ–¹å¼ ã€‚å¯ä»¥å®žçŽ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ;æ–‡ä»¶ä¼ è¾“ã€ä¸­é—´SSHä»£ç†ç­‰åŠŸèƒ½ï¼Œç›¸å¯¹äºŽPexpectï¼Œå°è£…çš„å±‚æ¬¡æ›´é«˜ï¼Œæ›´è´´è¿‘SSHåè®®çš„åŠŸèƒ½; paramiko çš„å®‰è£…1ã€ paramiko æ”¯æŒpipã€ easy_install æˆ–è€…æºå®‰è£…æ–¹å¼ï¼Œå¾ˆæ–¹ä¾¿è§£å†³ä¾èµ–çš„é—®é¢˜ï¼Œå…·ä½“å®‰è£…å‘½ä»¤å¦‚ä¸‹; 12# pip easy_install paramiko# easy_install paramiko 2ã€ paramiko ä¾èµ–ç¬¬ä¸‰æ–¹çš„Cryptoã€EcdsaåŒ…åŠPythonå¼€å‘åŒ…python-develçš„æ”¯æŒï¼Œæºç å¦‚ä¸‹; 1234567891011121314# yum -y install python-devel # wget http://ftp.dlitz.net/pub/dlitz/crypto/pycrypto/pycrypto-2.6.tar.gz# tar -zxvf pycrypto-2.6.tar.gz# cd pycrypto-2.6# python setup.py install# cd ..# wget https://pypi.python.org/packages/source/e/ecdsa/ecdsa-0.10.tar.gz --no-check-certificate # tar -zxvf ecdsa-0.10.tar.gz# cd ecdsa-0.10# python setup.py install # cd ..# git clone https://github.com/paramiko/paramiko.git# cd paramiko# python setup.py install 3ã€ æ ¡éªŒå®‰è£…ç»“æžœï¼Œå¯¼å…¥æ¨¡å— æ²¡æœ‰æç¤ºå¼‚å¸¸ï¼Œåˆ™è¯´æ˜Žè¯¥åŒ…å®‰è£…æˆåŠŸ; 12345678910111213âžœ ~ ipythonPython 2.7.14 (default, Sep 25 2017, 09:53:22) Type "copyright", "credits" or "license" for more information.IPython 5.5.0 -- An enhanced Interactive Python.? -&gt; Introduction and overview of IPython's features.%quickref -&gt; Quick reference.help -&gt; Python's own help system.object? -&gt; Details about 'object', use 'object??' for extra details.In [1]: import paramiko In [2]: 4ã€ä½¿ç”¨å¯†ç è®¤è¯æ–¹å¼ï¼Œé€šè¿‡exec_command()æ–¹æ³•æ‰§è¡Œå‘½ä»¤; 1234567891011121314151617181920212223242526272829303132333435âžœ test cat paramiko_ssh.py #!/usr/bin/env python # -*- coding: utf-8 -*-import paramikohostname = '192.168.0.78'username = 'root'password = 'paramiko_test*5'paramiko.util.log_to_file('syslogin.log') # å‘é€paramiko æ—¥å¿—åˆ°syslog æ–‡ä»¶ssh=paramiko.SSHClient() # åˆ›å»ºä¸€ä¸ªsshå®¢æˆ·ç«¯ clientå¯¹è±¡ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())ssh.load_system_host_keys()# èŽ·å–å®¢æˆ·ç«¯host_keysï¼Œé»˜è®¤ ~/.ssh/known_hosts#ssh.load_system_host_keys(filname='/Users/macbookdzsbe/.ssh/known_hosts') # èŽ·å–å®¢æˆ·ç«¯host_keysï¼Œé»˜è®¤ ~/.ssh/known_hosts# ssh.load_host_keys(filename='/root/.ssh/known_hosts')ssh.connect(hostname=hostname,username=username,password=password)# åˆ›å»ºsshè¿žæŽ¥stdin,stdout,stderr=ssh.exec_command('netstat -tnlup') #è°ƒç”¨è¿œç¨‹æ‰§è¡Œå‘½ä»¤æ–¹æ³•exec_command# æ‰“å°å‘½ä»¤æ‰§è¡Œç»“æžœï¼Œå¾—åˆ°Pyhtonåˆ—è¡¨å½¢ï¼Œå¯ä»¥ä½¿ç”¨stdout.readlines()print stdout.read()stdin,stdout,stderr=ssh.exec_command('date')print stdout.readlines()ssh.close # å…³é—­ ssh è¿žæŽ¥âžœ test python paramiko_ssh.py Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 885/sshd tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 1341/master tcp 0 0 127.0.0.1:27017 0.0.0.0:* LISTEN 18341/mongod tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN 1266/mysqld tcp6 0 0 :::22 :::* LISTEN 885/sshd tcp6 0 0 ::1:25 :::* LISTEN 1341/master udp 0 0 127.0.0.1:323 0.0.0.0:* 624/chronyd udp6 0 0 ::1:323 :::* 624/chronyd [u'2018\u5e74 01\u6708 12\u65e5 \u661f\u671f\u4e94 16:50:33 CST\n'] 5ã€ paramiko çš„æ ¸ç»„ä»¶ paramiko åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œä¸€ä¸ªä¸ºSSHClientç±»ï¼Œå¦ä¸€ä¸ªä¸ºSFTPClientç±» 6ã€ SSHClientç±» SSHClientç±»æ˜¯SSHæœåŠ¡ä¼šè¯çš„é«˜çº§è¡¨ç¤ºï¼Œè¯¥ç±»å°è£…äº†ä¼ è¾“(transport)ã€é€šé“(channel)åŠSFTPClientçš„æ£€éªŒã€å»ºç«‹çš„æ–¹æ³•ï¼Œé€šå¸¸ç”¨äºŽæ‰§è¡Œè¿œç¨‹å‘½ä»¤ 12345# ä¾‹ client = SSHClient() client.load_system_host_keys()client.connect('ssh.example.com')stdin, stdout, stderr = client.exec_command('ls -l') SSHClientç±»æ–¹æ³•ä½¿ç”¨1ã€ connect æ–¹æ³• connect æ–¹æ³•å®žçŽ°äº†è¿œç¨‹SSHè¿žæŽ¥å¹¶æ£€éªŒ 1234567891011121314# æ–¹æ³•å®šä¹‰connect(self, hostname, port=22, username=None, password=None, pkey=None,key_filename=None, timeout=None, allow_agent=True, look_for_keys=True, compress=False)# å‚æ•°è¯´æ˜Ž# hostname (strç±»åž‹)ï¼Œè¿žæŽ¥çš„ç›®æ ‡ä¸»æœºåœ°å€ï¼›# prot (int ç±»åž‹)ï¼Œè¿žæŽ¥ç›®å½•ä¸»æœºçš„ç«¯å£ï¼Œé»˜è®¤ä¸º22; # username (str ç±»åž‹), æ ¡éªŒçš„ç”¨æˆ·å (é»˜è®¤ä¸ºå½“å‰çš„æœ¬åœ°ç”¨æˆ·å); # password (str ç±»åž‹), å¯†ç ç”¨äºŽèº«ä»½æ£€éªŒæˆ–è§£é”ç§é’¥; # pkey (PKey ç±»åž‹), ç§é’¥æ–¹å¼ç”¨äºŽèº«ä»½éš¾; # key_filename(str or list(str) ç±»åž‹),ä¸€ä¸ªæ–‡ä»¶åæˆ–è€…æ–‡ä»¶åçš„åˆ—è¡¨ï¼Œç”¨äºŽç§é’¥çš„èº«ä»½éªŒè¯;# timeout (float ç±»åž‹),ä¸€ä¸ªå¯é€‰ çš„è¶…æ—¶æ—¶é—´(ä»¥ç§’ä¸ºå•ä½)çš„TCPè¿žæŽ¥;# allow_agent (bool ç±»åž‹)ï¼Œè®¾ç½®ä¸ºFalseæ—¶ç”¨äºŽç¦ç”¨è¿žæŽ¥åˆ°SSHä»£ç†; # look_for_keys (bool ç±»åž‹)ï¼Œè®¾ç½®Falseæ—¶ç”¨æ¥ç¦ç”¨åœ¨~/.sshä¸­æœç´¢ç§é’¥æ–‡ä»¶; # compress (bool ç±»åž‹), è®¾ç½®ä¸ºTrueæ—¶æ‰“å¼€åŽ‹ç¼© 2ã€ exec_command æ–¹æ³• è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ–¹æ³•ï¼Œè¯¥å‘½ä»¤çš„è¾“å…¥ä¸Žè¾“å‡ºæµä¸ºæ ‡å‡†è¾“å…¥(stdin)ã€è¾“å‡º(stdout)ã€é”™è¯¯(stderr) 12345# æ–¹æ³•å®šä¹‰ exec_command(self, command, bufsize=-1)# å‚æ•°è¯´æ˜Ž# command (str ç±»åž‹), æ‰§è¡Œçš„å‘½ä»¤ä¸²;# bufsize (int ç±»åž‹), æ–‡ä»¶ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤ä¸º-1ï¼ˆä¸å±€é™ï¼‰; 3ã€loa_syste_host_keys æ–¹æ³• åŠ è½½æœ¬åœ°å…¬é’¥æ ¡éªŒæ–‡ä»¶ï¼Œé»˜è®¤ä¸º~/.ssh/known_hostsï¼Œéžé»˜è®¤è·¯å¾„éœ€è¦æ‰‹å·¥æŒ‡å®š; 1234load_system_host_keys(self, filename=None)# å‚æ•°è¯´æ˜Žfiename(strç±»åž‹ ),æŒ‡å®šè¿œç¨‹ä¸»æœºå…¬é’¥è®°å½•æ–‡ä»¶; 4ã€ set_missing_host_key_policy æ–¹æ³• è®¾ç½®è¿žæŽ¥çš„è¿œç¨‹ä¸»æœºæ²¡æœ‰æœ¬åœ°ä¸»æœºå¯†é’¥æˆ–HostKeyså¯¹è±¡æ—¶çš„ç­–ç•¥ï¼Œç›®å‰æ”¯æŒä¸‰ç§åˆ†åˆ«æ˜¯ AutoAddPolicyã€RejectPolicy(é»˜è®¤),WarnningPolicyï¼Œä»…é™äºŽSSHClientç±» 123456789# ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ssh=paramiko.SSHClient() ssh.set_missing_host_keypolicy(paramiko.AutoAddPolicy)# AutoAddPolicy,è‡ªåŠ¨æ·»åŠ ä¸»æœºååŠä¸»æœºå¯†é’¥åˆ°æœ¬åœ°HostKeyså¯¹è±¡ï¼Œå¹¶å°†å…¶ä¿å­˜# ä¸ä¾èµ–load_system_host_keys()çš„é…ç½®ï¼Œå³ä½¿ ~/.ssh/known_hostsä¸å­˜åœ¨ä¹Ÿä¸äº§ç”Ÿå½±å“ # RejectPolicy,è‡ªåŠ¨æ‹’ç»æœªçŸ¥çš„ä¸»æœºåå’Œå¯†é’¥ï¼Œä¾èµ–load_system_host_keys()çš„é…ç½®# WarningPolicy,ç”¨äºŽè®°å½•ä¸€ä¸ªæœªçŸ¥çš„ä¸»æœºå¯†é’¥çš„Pythonè­¦å‘Šå¹¶æŽ¥å—å®ƒï¼ŒåŠŸèƒ½ä¸Šä¸ŽAutoAddPolicyç›¸ä¼¼# ä½†åŒºåˆ«åœ¨äºŽï¼ŒæœªçŸ¥çš„ä¸»æœºä¼šæœ‰è­¦å‘Š SFTPClientç±» SFTPClient ä½œä¸ºä¸€ä¸ªSFTPå®¢æˆ·ç«¯å¯¹è±¡,æ ¹æ®SSHä¼ è¾“åè®®çš„sftpä¼šè¯ï¼Œå®žçŽ°è¿œå®¢ç¨‹æ–‡ä»¶æ“ä½œæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€æƒé™ã€çŠ¶æ€ç­‰æ“ä½œ; 1ã€ from_transport æ–¹æ³• åˆ›å»ºä¸€ä¸ªå·²è¿žæŽ¥é€šçš„SFTPå®¢æˆ·ç«¯é€šé“; 1234567# æ–¹æ³•å®šä¹‰ from_transport(cls, t)# å‚æ•°è¯´æ˜Žt(Transport),ä¸€ä¸ªå·²ç»é€šè¿‡éªŒè¯çš„ä¼ è¾“å¯¹è±¡ã€‚t = paramiko.Transport(("192.168.0.78", 22))t.connect(username="root",password="paramiko_test*5")sftp =paramiko.SFTPClient.from_transport(t) 2ã€ put æ–¹æ³• ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹SFTPæœåŠ¡ç«¯; 123456789put(self, localpath, remotepath, callback=None, confirm=True)# å‚æ•°è¯´æ˜Ž# localpath (str ç±»åž‹)ï¼Œéœ€ä¸Šä¼ çš„æœ¬åœ°æ–‡ä»¶(æº);# remotepath (str ç±»åž‹),è¿œç¨‹è·¯å¾„(ç›®æ ‡); # collback(functioin(int,int))ï¼ŒèŽ·å–å·²æŽ¥æ”¶çš„å­—å­—æ•°åŠæ€»ä¼ è¾“å­—èŠ‚æ•°ï¼Œä»¥ä¾¿å›žè°ƒå‡½æ•°é«˜ç”¨,é»˜è®¤ä¸ºNone; # connfirm (boolç±»åž‹),æ–‡ä»¶ä¸Šä¼ å®Œæ¯•åŽæ˜¯å¦è°ƒç”¨ stat()æ–¹æ³•ï¼Œä»¥ä¾¿ç¡®è®¤æ–‡ä»¶çš„å¤§å°ã€‚ localpath='/var/log/httpd/access.log'remotepath='/data/bak/log/httpd/access.log'sftp.put(localpath,remotepath) 3ã€ getæ–¹æ³• ä»Žè¿œç¨‹SFTPæœåŠ¡ç«¯ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°; 12345678get(self, remotepth, localpath, callbak=None)# å‚æ•°è¯´æ˜Ž# remotepath (strç±»åž‹)ï¼Œéœ€ä¸‹è½½çš„è¿œç¨‹æ–‡ä»¶ (æºæ–‡ä»¶); # localpath (strç±»åž‹)ï¼Œæœ¬åœ°è·¯å¾„(ç›®æ ‡);# callback(function(int, int)),èŽ·å–å·²æŽ¥æ”¶çš„å­—èŠ‚æ•°åŠæ€»ä¼ è¾“å­—èŠ‚æ•°ï¼Œä»¥ä¾¿å›žè°ƒå‡½æ•°åŠè°ƒç”¨ï¼Œé»˜è®¤ä¸ºNoneremotepath='/var/log/httpd/access.og'localpath='/data/bak/log/httpd/access.log'sftp.get(remotepath,localpath) 4ã€å…¶ä»–æ–¹æ³• 12345mkdirï¼Œåœ¨SFTPæœåŠ¡å™¨ç«¯åˆ›å»ºç›®å½•ï¼Œå¦‚sftp.mkdir("/home/testdir",0700)remove, åˆ é™¤SFTPæœåŠ¡ç«¯åˆ›æŒ‡å®šç›®å½•ï¼Œå¦‚sftp.remove("/home/testdir")rename, é‡å‘½åSFTPæœåŠ¡å™¨ç«¯æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚sftp.rename("/home/testdir","/home/test")state, èŽ·å–è¿œç¨‹SFTPæœåŠ¡å™¨æŒ‡å®šæ–‡ä»¶ä¿¡æ¯ï¼Œå¦‚sftp.stat("/home/test") listdir, èŽ·å–è¿œç¨‹SFTPæœåŠ¡å™¨ç«¯æŒ‡å®šç›®å½•åˆ—è¡¨, ä»¥Pythonçš„(List)å½¢å¼è¿”å›ž, å¦‚sftp.listdir("/home") 5ã€SFTPClientç±»åº”ç”¨ç¤ºä¾‹ 123456789101112131415161718192021222324#!/usr/bin/env python # -*- coding: utf-8 -*-import paramikoimport osusername = "root"password = "paramiko_test*5"hostname = "10.180.55.118"port = 22try: t = paramiko.Transport((hostname, port)) t.connect(username=username, password=password) sftp =paramiko.SFTPClient.from_transport(t) sftp.put("/tmp/next.vim.log", "/home/root/next.vim.log") #ä¸Šä¼ æ–‡ä»¶ sftp.get("/etc/hosts", "/tmp/hosts") #ä¸‹è½½æ–‡ä»¶ sftp.mkdir("/home/testdir",0700) #åˆ›å»ºæ–‡ä»¶ sftp.rmdir("/home/root/test5.sql") #åˆ é™¤ç›®å½• sftp.rename("/home/root/test1.sql", "/home/root/test5.sql") #æ–‡ä»¶é‡å‘½å print sftp.stat("/home/root/test5.sql") #æ‰“å°æ–‡ä»¶ä¿¡æ¯ print sftp.listdir("/home/root") # æ‰“å°ç›®å½•åˆ—è¡¨ t.close();except Exception, e: print str(e)]]></content>
  </entry>
  <entry>
    <title><![CDATA[è‡ªä¹ ä¹‹pythonåŸºç¡€è¯­æ³•]]></title>
    <url>%2F2018%2F01%2F07%2F%E8%87%AA%E4%B9%A0%E4%B9%8Bpython%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%2F</url>
    <content type="text"><![CDATA[åŸºç¡€è¯­æ³•å¸¸é‡ï¼å˜é‡ å­—é¢å¸¸é‡ å˜é‡å˜é‡ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€å—å†…å­˜ï¼› 1v = 1 è¿™æ ·å°±å®šä¹‰äº†vè¿™ä¸ªå˜é‡ 1v2 = v å˜é‡çš„å‘½åè§„åˆ™1 åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿2 åªèƒ½ä»¥å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å¼€å¤´3 ä¸èƒ½æ˜¯Pythonè§£é‡Šå™¨çš„ä¿ç•™å­— ä¸èƒ½ä»¥ç±»ä¼¼ for if in æ¥åšå˜é‡åï¼ŒåŠ ä¸ªåŽç¼€ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ä½†ä¸å»ºè®®è¿™æ ·ä½¿ç”¨ï¼› è¿ç®—ç¬¦è·Ÿè¡¨è¾¾å¼ ç®—æœ¯ç¬¦1 ç®—æœ¯è¿ç®—ç¬¦2 é€»è¾‘è¿ç®—ç¬¦3 æ¯”è¾ƒè¿ç®—ç¬¦4 å…¶å®ƒè¿ç®—ç¬¦ ï¼ˆèµ‹å€¼ã€æˆå‘˜è¿ç®—ç¬¦ã€èº«ä»½è¿ç®—ç¬¦ï¼‰ ç®—æœ¯è¿ç®—ç¬¦1 ç®—æœ¯è¿ç®—ç¬¦é€šå¸¸åªé’ˆå¯¹æ•°å€¼ç±»åž‹1+1 3 5 3/5 3//5 5%3 2*4 æ¯”è¾ƒè¿ç®—ç¬¦1 == ç›¸ç­‰2 != ä¸ç­‰äºŽ3 &gt; å¤§äºŽ4 &gt;= å¤§äºŽç­‰äºŽ5 &lt; å°äºŽ6 &lt;= å°äºŽç­‰äºŽ æ¯”è¾ƒè¿ç®—ï¼Œæœ€å¥½æ˜¯è®©ä»–çš„ç±»åž‹æ˜¯ç›¸åŒçš„é™¤äº† == å’Œ !=æœ€å¥½ç±»åž‹ç›¸åŒ 1float (3)/5 # python2 é€»è¾‘è¿ç®—ç¬¦ ï¼ˆå‚ä¸Žè¿ç®—çš„æˆå‘˜åªèƒ½æ˜¯boolç±»åž‹ï¼Œæˆ–è€…å¯ä»¥éšå¼è½¬åŒ–ä¸ºboolä¸ºç±»åž‹çš„ç±»åž‹ï¼‰True False 123In [1]: True and TrueOut[1]: True# and éœ€è¦è¿ç®—ç¬¦ä¸¤è¾¹éƒ½æ˜¯Trueç»“æžœæ‰ä¸ºTrue 123In [2]: True or FalseOut[2]: True# or åªè¦è¿ç®—ç¬¦ä¸¤è¾¹ä»»æ„ä¸€ä¸ªä¸ºTrue,ç»“æžœå°±æ˜¯True 123In [3]: not TrueOut[3]: False# not ç±»ä¼¼çŸ­è·¯çš„ 1234567891011121314151617181920212223In [4]: def add(x,y): ...: print("&#123;0&#125; + &#123;1&#125;".format(x,y)) ...: return x + y ...: In [5]: In [5]: add(1,3)1 + 3Out[5]: 4In [6]: add(1,3) &gt; add(1,2) and add(2,4) &lt; add(3,4)1 + 31 + 22 + 43 + 4Out[6]: TrueIn [7]: add(1,3) &lt; add(1,2) and add(2,4) &lt; add(3,4)1 + 31 + 2Out[7]: False# æ€»æ˜¯ä»Žå·¦åˆ°å³çš„è®¡ç®—ï¼Œä¸€æ—¦èƒ½å¤Ÿæ–›å†³å®šè¡¨è¾¾å¼çš„æœ€ç»ˆçš„å€¼ï¼Œå°†ç«‹åˆ»åœæ­¢è®¡ç®— 1234567891011In [8]: add(1,3) &gt; add(1,2) or add(2,4) &lt; add(3,4)1 + 31 + 2Out[8]: TrueIn [9]: add(1,3) &lt; add(1,2) or add(2,4) &lt; add(3,4)1 + 31 + 22 + 43 + 4Out[9]: True 12345678910In [10]: left = add(1,3) &lt; add(1,2)1 + 31 + 2In [11]: right = add(2,4) &lt; add(3,4)2 + 43 + 4In [12]: left or rightOut[12]: True ä½è¿ç®—ç¬¦ 12345In [12]: bin(60)Out[12]: '0b111100'In [13]: bin(12)Out[13]: '0b1100' 12345In [14]: 60 &amp; 12Out[14]: 12# 0011 1100# 0000 1100# 0000 1100 12345In [15]: 60 | 12Out[15]: 60# 0011 1100# 0000 1100# 0011 1100 12345In [16]: 60 ^ 12Out[16]: 48# 0011 1100# 0000 1100# 0011 0000 12In [18]: int('0b110000',2)Out[18]: 48 12In [19]: ~60Out[19]: -61 12345In [20]: 60 &gt;&gt;2 Out[20]: 15In [21]: 60 &lt;&lt;2Out[21]: 240 12345678910In [22]: a = 1In [23]: aOut[23]: 1# å·¦è¾¹æ˜¯ä¸€ä¸ªæ ‡å®žç¬¦ å³è¾¹æ˜¯ä¸€ä¸ªå€¼ï¼ˆæˆ–è€…å¯ä»¥è®¡ç®—ä¸ºä¸€ä¸ªå€¼ï¼‰# è®©è¿™ä¸ªæ ‡å®žç¬¦æŒ‡å‘è¿™ä¸ªå€¼æ‰€åœ¨çš„å†…å­˜In [24]: a = 3+4In [25]: aOut[25]: 7 è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ 123456789In [26]: 1+2*3Out[26]: 7In [27]: 2 * 3 **2Out[27]: 18In [28]: 2 * 3 &gt; 1+2Out[28]: True# ç®—æœ¯è¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äºŽæ¯”è¾ƒè¿ç®—ç¬¦ 123In [29]: 2* 3 &gt; 1+2 and TrueOut[29]: True# æ¯”è¾ƒè¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜äºŽé€»è¾‘è¿ç®—ç¬¦ 123In [30]: (2 * 3 &gt; 1+2) and True Out[30]: True# æ‹¿ä¸å‡†çš„æ—¶å€™åŠ æ‹¬å·ï¼Œæˆ–è€…æˆ‘ä»¬çš„ä»£ç è¡¨çŽ°åŠ›æ›´æ¸…æ™°çš„æ—¶å€™ 123In [32]: ((2*3) &gt; (1+2)) and TrueOut[32]: True# è¡¨è¾¾å¼ç”±å˜é‡/å¸¸é‡ å’Œè¿ç®—ç¬¦ç»„æˆ ç¨‹åºæŽ§åˆ¶ç»“æž„ é¡ºåºåˆ†æ”¯å¾ªçŽ¯ é¡ºåºç»“æž„ 1234In [33]: a = 0In [34]: a = a+1In [35]: print(a)1 åˆ†æ”¯ç»“æž„ å•åˆ†æ”¯12if cond: block 12345678In [36]: if 1 &lt; 2: ...: print ('1 less 2')1 less 2In [37]: if 1 &lt; 2: ...: print ('1 less 2') ...: print ('main block')1 less 2main block 123456789101112131415161718In [39]: bool(0)Out[39]: FalseIn [40]: bool(-0)Out[40]: FalseIn [41]: bool(1)Out[41]: TrueIn [42]: bool(None)Out[42]: FalseIn [43]: bool([])Out[43]: FalseIn [44]: bool('')Out[44]: False# 0\ç©ºçš„å†…ç½®ç»“æž„\None boolçš„ç»“æž„éƒ½æ˜¯False,éž0éžç©ºçš„å†…ç½®ç»“æž„éƒ½æ˜¯True åŒåˆ†æ”¯ 12345678910111213141516171819202122232425262728293031323334353637383940if cond: true_blockelse: false_blockIn [45]: if 1&lt;2: ...: print ('1&lt;2') ...: else: ...: print ('2&lt;1') ...: 1&lt;2if cond: true_blockelif cond: true_blockelif cond: true_blockelif cond: true_blockelse: false_block In [5]: a = 5In [6]: if a &lt; 0: ...: print ('less 0') ...: elif a &lt; 3: ...: print ('less 3') ...: elif a &lt; 5: ...: print ('less 5') ...: elif a &lt; 7: ...: print ('less 7') ...: else: ...: print ('oops') ...: less 7# åˆ†æ”¯ç»“æž„æ°¸è¿œåªæœ‰ä¸€ä¸ªåˆ†æ”¯å¯æ‰§è¡Œï¼› å¾ªçŽ¯æœ‰while for ä¸¤ç§è¯­å¥ 123456789101112131415161718192021222324252627while cond: block In [8]: while a &lt; 10: ...: print(a) ...: a +=1 # a = a + 1 ...: 0123456789# é€šå¸¸åœ¨whileå¾ªçŽ¯ä¸­ï¼Œå¾ªçŽ¯ä½“åªéœ€è¦ä¿®æ”¹æ¡ä»¶ï¼Œä»¥ä½¿å¾—æ¡ä»¶ä¸ºå‡In [34]: i = 1 In [35]: s =0In [36]: while i &lt;= 100: ...: s +=i ...: i +=1 ...: print (s) ...: 1234567891011121314151617181920212223242526272829303132333435363738394041424344for element in itrator: blockIn [26]: for i in range(5): ...: print (i) ...: 01234In [38]: for i in range(10): ...: if i % 2 == 0: ...: print (i) ...: 02468In [1]: for i in range(10): ...: if i &gt; 3: ...: break ...: print (i) ...: 0123# break ç”¨äºŽæå‰ç»“æŸå¾ªçŽ¯ï¼›In [3]: for i in range(10): ...: if i == 3: ...: continue ...: print (i) ...: 012456789# continue ç”¨äºŽè·³è¿‡ä¹‹åŽçš„è¯­å¥]]></content>
  </entry>
  <entry>
    <title><![CDATA[è‡ªä¹ ä¹‹pythonçŽ¯å¢ƒåˆå‡†å¤‡]]></title>
    <url>%2F2018%2F01%2F07%2F%E8%87%AA%E4%B9%A0%E4%B9%8Bpython%E7%8E%AF%E5%A2%83%E5%88%9D%E5%87%86%E5%A4%87%2F</url>
    <content type="text"><![CDATA[çŽ¯å¢ƒå‡†å¤‡pyenv å®‰è£…Pythonè§£é‡Šå™¨ ç®¡ç†Pythonç‰ˆæœ¬ ç®¡ç†Pythonè™šæ‹ŸçŽ¯å¢ƒç›¸å½“äºŽä¸€ä¸ªç‹¬ç«‹çš„ç‰ˆæœ¬,æ˜¯bashå†™çš„ä¸€ä¸ªç¨‹åºï¼Œæ‰€ä»¥æ²¡æœ‰ä¾èµ–ï¼› pyenv githubåœ°å€ 1https://github.com/yyuu/pyenv-installer è‹¹æžœç³»ç»Ÿå®‰è£…pyenv 123456# curl -L https://raw.githubusercontent.com/pyenv/pyenv-installer/master/bin/pyenv-installer | bash# sudo vim /etc/bashrcexport PATH="/Users/ssjinyao/.pyenv/bin:$PATH"eval "$(pyenv init -)"eval "$(pyenv virtualenv-init -)"# source /etc/bashrc linuxç³»ç»Ÿå®‰è£…pyenv 12345# curl -L https://raw.githubusercontent.com/pyenv/pyenv-installer/master/bin/pyenv-installer | bash# vim /etc/profile.d/pyenv.shexport PATH="/Users/ssjinyao/.pyenv/bin:$PATH"eval "$(pyenv init -)"eval "$(pyenv virtualenv-init -)" å®‰è£…ä¸€ä¸ªpythonçš„ä¾èµ–ï¼ˆCentOSï¼‰ 12# yum -y install. gcc make patch gdbm-devel openssl-devel sqlite-devel zlib-devel bzip2-devel readline-devel# æ³¨ï¼šåœ¨ä¸åŒçš„linuxç³»ç»Ÿä¸Šå®‰è£…åŒ…çš„åå­—ä¸ä¸€æ · pyenvå®‰è£…ä¸€ä¸ªpythonç‰ˆæœ¬ 12# pyenv update #ç”¨æ¥æ›´æ–°pyenv# pyenv install 3.5.2 åˆ‡æ¢python 3.5.3 12345bogon:~ ssjinyao$ pyenv local 3.5.2bogon:~ ssjinyao$ pyenv version3.5.2 (set by /Users/ssjinyao/.python-version)bogon:~ ssjinyao$ cat .python-version 3.5.2 åˆ‡æ¢pythonåˆ°ç³»ç»Ÿç‰ˆæœ¬ 123bogon:~ ssjinyao$ pyenv local systembogon:~ ssjinyao$ pyenv versionsystem (set by /Users/ssjinyao/.python-version) åˆ‡æ¢å…¨å±€pythonå˜é‡ï¼ˆå¸Œæœ›æ°¸è¿œä¸è¦æ‰§è¡Œï¼‰ 1# pyenv global x.x.x ä½¿ç”¨pyenv local å‘½ä»¤local å‘½ä»¤åˆ‡æ¢å½“å‰ç›®å½•åŠå…¶å­ç›®å½•çš„Pythonç‰ˆæœ¬å¦‚ä½•æ¢å¤ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤ â€˜.python-versionâ€™æ¢å¤é»˜è®¤çš„Pythonç‰ˆæœ¬ global å‘½ä»¤globalå‘½ä»¤åˆ‡æ¢å…¨å±€é»˜è®¤pythonç‰ˆæœ¬ 12345678910111213141516171819202122232425262728293031323334353637bogon:~ ssjinyao$ pyenv commands--versionactivatecommandscompletionsdeactivatedoctorexecglobalhelphooksinitinstallinstallerlocaloffline-installerprefixrehashrootshellshimsuninstallupdateversionversion-fileversion-file-readversion-file-writeversion-nameversion-originversionsvirtualenvvirtualenv-deletevirtualenv-initvirtualenv-prefixvirtualenvswhencewhich 123456789101112bogon:~ ssjinyao$ pyenv virtualenv 3.5.2 mageduIgnoring indexes: https://pypi.python.org/simpleRequirement already satisfied (use --upgrade to upgrade): setuptools in /Users/ssjinyao/.pyenv/versions/3.5.2/envs/magedu/lib/python3.5/site-packagesRequirement already satisfied (use --upgrade to upgrade): pip in /Users/ssjinyao/.pyenv/versions/3.5.2/envs/magedu/lib/python3.5/site-packages bogon:~ ssjinyao$ pyenv local 3.5.2/envs/magedu (3.5.2/envs/magedu) bogon:~ ssjinyao$ (3.5.2/envs/magedu) bogon:~ ssjinyao$ pyenv local 3.5.2bogon:~ ssjinyao$ bogon:~ ssjinyao$ ls -l ~/.pyenv/versions/ total 8drwxr-xr-x 7 ssjinyao staff 238 11 19 10:30 3.5.2lrwxr-xr-x 1 ssjinyao staff 49 11 19 10:35 magedu -&gt; /Users/ssjinyao/.pyenv/versions/3.5.2/envs/magedu 12345678910bogon:~ ssjinyao$ pyenv versions system* 3.5.2 (set by /Users/ssjinyao/.python-version) 3.5.2/envs/magedu magedubogon:~ ssjinyao$ pyenv uninstall magedupyenv-virtualenv: remove /Users/ssjinyao/.pyenv/versions/3.5.2/envs/magedu? ybogon:~ ssjinyao$ pyenv versions system* 3.5.2 (set by /Users/ssjinyao/.python-version) virtualenv å‘½ä»¤åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ pyenv virtualenv $bash_version $name uninstall å‘½ä»¤å¸è½½æŸä¸ªç‰ˆæœ¬ï¼ŒåŒ…æ‹¬è™šæ‹ŸçŽ¯å¢ƒï¼› é€‰æ‹©pythonç‰ˆæœ¬æ—¶ï¼Œå¯ä»¥è¿™æ ·é€‰æ‹©12bogon:~ ssjinyao$ ls ~/.pyenv/versions/3.5.2/envs/magedu/bin/python/Users/ssjinyao/.pyenv/versions/3.5.2/envs/magedu/bin/python vim pythonæ’ä»¶ï¼ˆjediï¼‰vim pythonæ’ä»¶åŒ… ï¼ˆmaximum-awesomeï¼‰%]]></content>
  </entry>
  <entry>
    <title><![CDATA[è‡ªä¹ ä¹‹ Linux HA Cluster 2]]></title>
    <url>%2F2018%2F01%2F03%2FLinux-HA-Cluster-2%2F</url>
    <content type="text"><![CDATA[æ¸©æ•…è€ŒçŸ¥æ–°123456789101112131415161718192021222324252627282930313233Messaaging Layer: heartbaet v1,v2,v3 corosync v1, v2(votequorum) OpenAISCRM: pacemaker éœ€è¦ä¸€ä¸ªé…ç½®æŽ¥å£ é…ç½®æŽ¥å£:crmsh (ç”±SUSEç ”å‘çš„),ç”±psshç®¡ç†å·¥å…·æ¥å®žçŽ° pcs (agent c/s ),pcsdæ¥å®žçŽ° conga(ricciè¿è¡Œåœ¨å„ç»“ç‚¹ä¸Šçš„è¿›ç¨‹/luciå‘é€æŒ‡ä»¤åˆ°å„èŠ‚ç‚¹)ç»„æˆ group,constraint(åŸºäºŽçº¦æŸ) rgmanager(cman) resouce group(èµ„æºç»„): failover domainRA: LSB: /etc/rc.d/init.d systemd: /etc/systemd/system/multi-user.wants æœåŠ¡å¼€æœºå¤„äºŽenableçŠ¶æ€; OCF:[provider] heartbeat pacemaker linbit åŸºäºŽå†…æ ¸è·¨èŠ‚ç‚¹çš„å—è®¾å¤‡ service stonith é«˜å¯ç”¨é›†ç¾¤çš„å¯ç”¨æ–¹æ¡ˆ: heartbeat v1 heartbeat v2 heartbeat v3 + pacemaker X corosync + pacemaker cman + rgmanager corosync + cman + pacemaker keepalived Linux-HA-Cluster 2 Heartbeaté›†ç¾¤ä¹‹é—´ä¼ é€’å¿ƒè·³çš„æ–¹æ³•1ã€ä½¿ç”¨ä¸²åž‹çº¿ç¼†2ã€ä½¿ç”¨ä»¥å¤ªç½‘é€šä¿¡3ã€Unicast å•æ’­ï¼Œä½¿ç”¨udpuï¼Œä¸€èˆ¬åœ¨ä¸æ”¯æŒå¤šæ’­çš„ç½‘ç»œä¸­ä½¿ç”¨çš„4ã€Mutlicast å¤šæ’­/ç»„æ’­, ä½¿ç”¨udp5ã€Broadcast å¹¿æ’­ï¼Œå ç”¨è¿‡é«˜çš„ç½‘ç»œèµ„æº 1ã€ç»„æ’­åœ°å€: 1234ç”¨äºŽæ ‡è¯†ä¸€ä¸ªIPç»„æ’­åŸŸ:IANAæŠŠDç±»åœ°å€ç•™ç»™ç»„æ’­ä½¿ç”¨:224.0.0.0-239.255.255.255 æ°¸ä¹…ç»„æ’­åœ°å€:224.0.0.0-224.0.0.255ä¸´æ—¶ç»„æ’­åœ°å€:224.0.1.0-238.255.255.255 å»ºè®®ä½¿ç”¨ä¸´æ—¶ç»„æ’­åœ°å€æœ¬åœ°ç»„æ’­åœ°å€:239.0.0.0-239.255.255.255 2ã€é…ç½®ä»¥ç»„æ’­æ–¹å¼è¿›è¡Œé«˜å¯ç”¨é›†ç¾¤é€šä¿¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889# åœ¨Node1 å’Œ Node2ä¸­æ‰§è¡Œ# yum -y install corosync pacemaker# rpm -ql corosync #æŸ¥çœ‹corosyncå®‰è£…å®Œä¹‹åŽæ‰€ç”Ÿæˆçš„é…ç½®æ–‡ä»¶;/etc/corosync/etc/corosync/corosync.conf.example/etc/corosync/corosync.conf.example.udpu/etc/corosync/corosync.xml.example/etc/corosync/uidgid.d/etc/dbus-1/system.d/corosync-signals.conf/etc/logrotate.d/corosync/etc/sysconfig/corosync/etc/sysconfig/corosync-notifyd/usr/bin/corosync-blackbox/usr/bin/corosync-xmlproc/usr/lib/systemd/system/corosync-notifyd.service/usr/lib/systemd/system/corosync.service/usr/sbin/corosync/usr/sbin/corosync-cfgtool/usr/sbin/corosync-cmapctl/usr/sbin/corosync-cpgtool/usr/sbin/corosync-keygen/usr/sbin/corosync-notifyd/usr/sbin/corosync-quorumtool/usr/share/corosync/usr/share/corosync/corosync/usr/share/corosync/corosync-notifyd/usr/share/corosync/xml2conf.xsl/usr/share/doc/corosync-2.4.0/usr/share/doc/corosync-2.4.0/LICENSE/usr/share/doc/corosync-2.4.0/SECURITY/usr/share/man/man5/corosync.conf.5.gz/usr/share/man/man5/corosync.xml.5.gz/usr/share/man/man5/votequorum.5.gz/usr/share/man/man8/cmap_keys.8.gz/usr/share/man/man8/corosync-blackbox.8.gz/usr/share/man/man8/corosync-cfgtool.8.gz/usr/share/man/man8/corosync-cmapctl.8.gz/usr/share/man/man8/corosync-cpgtool.8.gz/usr/share/man/man8/corosync-keygen.8.gz/usr/share/man/man8/corosync-notifyd.8.gz/usr/share/man/man8/corosync-quorumtool.8.gz/usr/share/man/man8/corosync-xmlproc.8.gz/usr/share/man/man8/corosync.8.gz/usr/share/man/man8/corosync_overview.8.gz/usr/share/snmp/mibs/COROSYNC-MIB.txt/var/lib/corosync/var/log/cluster# rpm -ql pacemaker #æŸ¥çœ‹pacemakeræ‰€ç”Ÿæˆçš„é…ç½®æ–‡ä»¶;/etc/sysconfig/pacemaker/usr/lib/ocf/resource.d/.isolation/usr/lib/ocf/resource.d/.isolation/docker-wrapper/usr/lib/ocf/resource.d/pacemaker/controld/usr/lib/ocf/resource.d/pacemaker/remote/usr/lib/systemd/system/pacemaker.service/usr/libexec/pacemaker/attrd/usr/libexec/pacemaker/cib/usr/libexec/pacemaker/cibmon/usr/libexec/pacemaker/crmd/usr/libexec/pacemaker/lrmd/usr/libexec/pacemaker/lrmd_internal_ctl/usr/libexec/pacemaker/pengine/usr/libexec/pacemaker/stonith-test/usr/libexec/pacemaker/stonithd/usr/sbin/crm_attribute/usr/sbin/crm_master/usr/sbin/crm_node/usr/sbin/pacemakerd/usr/sbin/stonith_admin/usr/share/doc/pacemaker-1.1.16/usr/share/doc/pacemaker-1.1.16/COPYING/usr/share/doc/pacemaker-1.1.16/ChangeLog/usr/share/licenses/pacemaker-1.1.16/usr/share/licenses/pacemaker-1.1.16/GPLv2/usr/share/man/man7/crmd.7.gz/usr/share/man/man7/ocf_pacemaker_controld.7.gz/usr/share/man/man7/ocf_pacemaker_remote.7.gz/usr/share/man/man7/pengine.7.gz/usr/share/man/man7/stonithd.7.gz/usr/share/man/man8/crm_attribute.8.gz/usr/share/man/man8/crm_master.8.gz/usr/share/man/man8/crm_node.8.gz/usr/share/man/man8/pacemakerd.8.gz/usr/share/man/man8/stonith_admin.8.gz/usr/share/pacemaker/alerts/usr/share/pacemaker/alerts/alert_file.sh.sample/usr/share/pacemaker/alerts/alert_smtp.sh.sample/usr/share/pacemaker/alerts/alert_snmp.sh.sample/var/lib/pacemaker/cib/var/lib/pacemaker/pengine 2ã€é…ç½®corosync 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152# cd /etc/corosync/# cp corosync.conf.example # cp corosync.conf.example corosync.conf# æŸäº›çŽ¯å¢ƒä¸­å¯èƒ½ä¸æ”¯æŒç»„æ’­ã€‚è¿™æ—¶åº”è¯¥é…ç½®Corosyncä½¿ç”¨å•æ’­; # ä¸‹é¢æ˜¯ä½¿ç”¨å•æ’­çš„Corosync é…ç½®æ–‡ä»¶çš„ä¸€éƒ¨åˆ†;totem &#123; #... interface &#123; ringnumber: 0 bindnetaddr: 10.180.22.0 broadcast: yes (1) mcastport: 5405 &#125; interface &#123; ringnumber: 1 bindnetaddr: 10.180.22.0 brodcast: yes mcastport: 5405 &#125; transport: udpu (2)&#125;nodelist&#123; (3) node &#123; ring0_addr: 10.180.22.166 ring1_addr:10.180.55.1 nodedid: 1 &#125; node &#123; ring0_addr: 10.180.22.167 ring1_addr: 10.180.55.2 nodeid: 2 &#125;# å¦‚æžœå°† broadcast è®¾ç½®ä¸ºyes,é›†ç¾¤å¿ƒè·³å°†é€šè¿‡å¹¿æ’­å®žçŽ°ã€‚è®¾ç½®è¯¥å‚æ•°æ—¶,ä¸èƒ½è®¾ç½®mcastaddr;# transport é…ç½®é¡¹å†³å®šé›†ç¾¤é€šä¿¡æ–¹å¼ï¼Œè¦å®Œå…¨ç¦ç”¨ç»„æ’­ï¼Œåº”è¯¥é…ç½®å•æ’­ä¼ è¾“å‚æ•° udpu;# è¿™è¦æ±‚å°†æ‰€æœ‰çš„èŠ‚ç‚¹æœåŠ¡å™¨ä¿¡æ¯å†™å…¥nodelist;# ä¹Ÿå°±æ˜¯éœ€è¦åœ¨é…ç½®HA é›†ç¾¤ä¹‹å‰ç¡®å®šèŠ‚ç‚¹ç»„æˆã€‚é»˜è®¤é…ç½®æ˜¯udpã€‚ é€šä¿¡æ–¹å¼ç±»åž‹è¿˜æ”¯æŒudpuå’Œiba;# åœ¨nodelist ä¹‹ä¸‹å¯ä»¥ä¸ºæ ½ä¸€èŠ‚ç‚¹è®¾ç½®åªä¸Žè¯¥èŠ‚ç‚¹ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™äº›è®¾ç½®é¡¹åªèƒ½åŒ…å«åœ¨nodeä¹‹ä¸­;# å³åªèƒ½å¯¹å±žäºŽé›†ç¾¤çš„èŠ‚ç‚¹æœåŠ¡å™¨è¿›è¡Œè®¾ç½®ï¼Œè€Œä¸”åªåº”åŒ…æ‹¬é‚£äº›ä¸Žé»˜è®¤è®¾ç½®ä¸åŒçš„å‚æ•°;# æ¯å°æœåŠ¡å™¨éƒ½å¿…éœ€é…ç½® ring0_addr; # å®žéªŒä¸­é…ç½®ä¿¡æ¯å¦‚ä¸‹# Please read the corosync.conf.5 manual pagetotem &#123; version: 2 # crypto_cipher and crypto_hash: Used for mutual node authentication. # If you choose to enable this, then do remember to create a shared # secret with "corosync-keygen". # enabling crypto_cipher, requires also enabling of crypto_hash. crypto_cipher: aes128 crypto_hash: sha1 secauth: on # interface: define at least one interface to communicate # over. If you define more than one interface stanza, you must # also set rrp_mode. interface &#123; # Rings must be consecutively numbered, starting at 0. ringnumber: 0 # This is normally the *network* address of the # interface to bind to. This ensures that you can use # identical instances of this configuration file # across all your cluster nodes, without having to # modify this option. bindnetaddr: 10.180.0.0 # However, if you have multiple physical network # interfaces configured for the same subnet, then the # network address alone is not sufficient to identify # the interface Corosync should bind to. In that case, # configure the *host* address of the interface # instead: # bindnetaddr: 192.168.1.1 # When selecting a multicast address, consider RFC # 2365 (which, among other things, specifies that # 239.255.x.x addresses are left to the discretion of # the network administrator). Do not reuse multicast # addresses across multiple Corosync clusters sharing # the same network. mcastaddr: 239.185.1.31 # Corosync uses the port you specify here for UDP # messaging, and also the immediately preceding # port. Thus if you set this to 5405, Corosync sends # messages over UDP ports 5405 and 5404. mcastport: 5405 # Time-to-live for cluster communication packets. The # number of hops (routers) that this ring will allow # itself to pass. Note that multicast routing must be # specifically enabled on most network routers. ttl: 1 &#125;&#125;nodelist&#123; node &#123; ring0_addr: 10.180.22.166 nodedid: 1 &#125; node &#123; ring0_addr: 10.180.22.167 nodeid: 2 &#125; node &#123; ring0_addr: 10.180.22.168 nodeid: 3 &#125; &#125;logging &#123; # Log the source file and line where messages are being # generated. When in doubt, leave off. Potentially useful for # debugging. fileline: off # Log to standard error. When in doubt, set to no. Useful when # running in the foreground (when invoking "corosync -f") to_stderr: no # Log to a log file. When set to "no", the "logfile" option # must not be set. to_logfile: yes logfile: /var/log/cluster/corosync.log # Log to the system log daemon. When in doubt, set to yes. to_syslog: no # Log debug messages (very verbose). When in doubt, leave off. debug: off # Log messages with time stamps. When in doubt, set to on # (unless you are only logging to syslog, where double # timestamps can be annoying). timestamp: on logger_subsys &#123; subsys: QUORUM debug: off &#125;&#125;quorum &#123; # Enable and configure quorum subsystem (default: off) # see also corosync.conf.5 and votequorum.5 provider: corosync_votequorum&#125;# ç”Ÿæˆå¯†é’¥æ–‡ä»¶ # corosync-keygen# scp -p authkey coronsync.conf root@node2.ssjinyao.com:/etc/corosync# corosync å¯åŠ¨é›†ç¾¤æŠ•ç¥¨ç³»ç»Ÿé»˜è®¤å¿…éœ€éœ€è¦ä¸‰äººç»“ç‚¹;# systemctl start corosync.serivce #è¿™ä¸ªæ—¶å€™å¯åŠ¨æ˜¯å¤±è´¥çš„;# systemctl status corosync.serivce #æŸ¥çœ‹corosyncçš„çŠ¶æ€ä¿¡æ¯;# æ­¤æ—¶éœ€è¦å¼€å¯å¦ä¸€ä¸ªç»“ç‚¹# yum -y install corosync pacemaker # Node1 ä¸­æ‰§è¡Œ# scp -p /etc/coronsync.conf /etc/authkey root@node2.ssjinyao.com:/etc/corosync 3ã€éªŒè¯ç»“ç‚¹ 123# corosync-cfgtool -s # éªŒè¯ç»“ç‚¹# corosync-cmapctl #æŸ¥çœ‹ç»“ç‚¹é—´çš„ä¿¡æ¯;# grep -v &apos;^[[:space:]]*#&apos; /etc/corosync.conf # ä¿å­˜å®žç”¨çš„é…ç½®ç¤ºä¾‹ 4ã€ç¼–è¾‘pacemaker 12345# vim /etc/sysconfig/pacemakerPCMK_logfile= /var/log/pacemaker.log# å„ä¸ªèŠ‚ç‚¹é—´éœ€è¦å¯åŠ¨pacemaker# systemctl start pacemaker.service# crm_mon # è¿›è¡ŒéªŒè¯ 5ã€ crm å·¥å…·çš„ä½¿ç”¨ç®€æ˜Ž 12345# crm_node -n # æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ä¿¡æ¯# crm_node -l # ä¾‹å‡ºé›†ç¾¤æ‰€æœ‰çš„èŠ‚ç‚¹ä¿¡æ¯# crm_verify -L -V # ä½†çœ‹æŠ¥é”™ä¿¡æ¯# crm shell çš„å®‰è£…ä¸Žä½¿ç”¨ï¼Œè‹¥æ— rpmåŒ…ï¼Œå¯åœ¨ç½‘ä¸Šæ‰¾ç›¸å…³çš„rpmåŒ…# yum -y install crmsh pssh python-pssh HA Web Service1234567 vip: 10.180.xx.xxx, ocf:hearbeat:IPaddr httpd: systemd nfs shared storage: ocf:heartbeat:FilesystemHa Cluster å·¥ä½œæ¨¡åž‹: A/P: ä¸¤èŠ‚ç‚¹é›†ç¾¤; active/apsslve; without-quorum-policy=(stop|ignore|suicide|freeze) A/A: 12345678# node0 # mkdir -pv /www/htdocs # echo &quot;&lt;h1&gt; Test Page on NFS Server&lt;/h1&gt;&quot; &gt; /www/htdocs/index.html# vim /etc/exports /www/htdocs 10.180.xx.xxx/16(rw)# iptables -L -n # æŸ¥çœ‹æ˜¯å¦æœ‰é˜²ç«å¢™è§„åˆ™# checkconfig nfs on # systemctl start nfs 123456# node 1 # showmount -e 10.180.xx.xxx# mount -t nfs 10.180.xx.xxx:/www/htdocs /var/www/html # æŒ‚è½½ç½‘ç»œå­˜å‚¨NFS # systemctl start httpd # systemctl enable httpd# æ­¤æ—¶ä¾¿å¯ä»¥æŸ¥çœ‹èƒ½å¦å¯ä»¥èƒ½å¦è®¿é—®åˆ°ä»¥ä¸Šçš„æµ‹è¯•ä¿¡æ¯ 123# node 2 # systemctl start httpd # systemctl enabl httpd 123456789101112131415161718192021222324252627282930313233# crm configure crm(live)configure# showcrm(live)# configure property crm(live)# configure property stonith-enabled=falsecrm(live)# configrue verify crm(live)# show crm(live)# configure commitcrm(live)# configure crm(live)configure# primitive webip ocf:heartbeat:IPaddr2 params ip=&quot;10.180.xx.xxx&quot; op monitor interval=30s timeout=20scrm(live)# configure show crm(live)# configure commitcrm(live)# configure edit # å¯ä»¥æ‰“å¼€vimç¼–è¾‘é…ç½®æ–‡ä»¶ crm(live)# configure verifycrm(live)# configure primitive webstore ocf:heartbat:Filesystem params device=&quot;10.180.xx.xxx:/www/htdocs&quot; directory=&quot;/var/www/html&quot; fstype=&quot;nfs&quot; op start timeout=60s op stop timeout=60s op monitor interval=20s timeout=40s crm(live)# configure verifycrm(live)configure# colocation webserver_with_webstore_and_webip inf: webserver ( webip webstore )crm(live)# show xmls # æŸ¥çœ‹xmlæ ¼å¼çš„é…ç½®crm(live)configure# order webstore_afer_webip Mandatory: webip webstorecrm(live)configure# order webserver_after_webstore Manadatory: webstore webserver crm(live)configure# verify crm(live)configure# commit crm(live)configure# location webservice_perf_node1 webip 100: node1.ssjinao.comcrm(live)configure# verify crm(live)configure# commitcrom(live)configure# property default-resource-sticklines = 50# systemctl stop httpd.service # systemctl enable httpd.service # crm_verify -V -L# crm node standby # crm onde online]]></content>
  </entry>
  <entry>
    <title><![CDATA[è‡ªä¹ ä¹‹Linux HA Cluster]]></title>
    <url>%2F2018%2F01%2F01%2FLinux-HA-Cluster%2F</url>
    <content type="text"><![CDATA[Linux HA Clusterä¸€ã€ç†è®ºä»‹ç» LB,HA,HP,hadoop 1ã€LBï¼ˆè´Ÿè½½å‡è¡¡ï¼‰: ä¼ è¾“å±‚:lvsåº”ç”¨å±‚:nginx,haproxy,httpd,perlbal,ats,varnish 2ã€HA(é«˜å¯ç”¨ï¼‰: vrrp: keepalivedHA Cluster: heartbeat,OpenAIS corosync/pacemaker,cman,RHCSï¼ˆçº¢å¸½é›†ç¾¤å¥—ä»¶ï¼‰corosync/pacemaker,cman æ˜¯ä»Ž OpenAISä¸­ç‹¬ç«‹å‡ºæ¥çš„ 3ã€HA: 123456789æ•…éšœåœºæ™¯: ç¡¬ä»¶æ•…éšœ:è®¾è®¡ç¼ºé™·ï¼Œä½¿ç”¨è¿‡ä¹…è‡ªç„¶æŸåï¼Œäººä¸ºæ•…éšœ è½¯ä»¶æ•…éšœ:è®¾è®¡ç¼ºé™·ï¼Œbug,äººä¸ºè¯¯æ“ä½œ A(å¯ç”¨æ€§)=MTBF[å¹³å‡æ— æ•…éšœæ—¶é—´]/(MTBF[å¹³å‡æ— æ•…éšœæ—¶é—´]+MTTR[å¹³å‡ä¿®å¤æ—¶é—´]) MTBF:Mean Time Between FailreMTTR:Mean Time To Repair å¯ç”¨æ€§åŒºé—´:0&lt;A&lt;1 ç™¾åˆ†æ¯”:90%,95%,99% é€šå¸¸ä¼šç”¨å‡ ä¸ª9æ¥è¡¡é‡å¯ç”¨æ€§ 12345æä¾›å†—ä½™: Messaging Layer (åŒå¯ç”¨ç»“æž„é—´çš„ä¿¡æ¯ä¼ é€’å±‚) Resource Manager (åœ¨Messaging Layerä¹‹ä¸Šï¼Œç®¡ç†å¤šä¸ªèµ„æº) Local Resource Manager (åœ¨Resource Messaging Layerä¹‹ä¸Šï¼Œå†³å®šåœ¨å“ªä¸ªç»“ç‚¹ä¸Šå¯åŠ¨æœåŠ¡) local Resource agent: å››ç§åŸºæœ¬åŠŸèƒ½(start,stop,restart,status) 12345network partition: å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒº éš”ç¦»ï¼š STONITH: shoot the other node on the head (èŠ‚ç‚¹çº§åˆ«çš„éš”ç¦») Fence:èµ„æºçº§åˆ«çš„éš”ç¦» é€šè¿‡äº¤æ¢æœºæ–­æŽ‰ç½‘ç»œï¼Œæˆ–è€…é€šè¿‡ç”µæºäº¤æ¢æœºï¼ŒæŠŠæœåŠ¡å™¨çš„ç”µæºåœä¸¢ 1234é›†ç¾¤èŠ‚ç‚¹å¿…é¡»å¤§äºŽåŠæ•°ï¼Œè€Œéžç­‰äºŽ æˆ–è€…åŠ ä¸€ä¸ªä»²è£è®¾å¤‡ é«˜å¯ç”¨èŠ‚ç‚¹ï¼Œåªèƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å·¥ä½œçš„çŠ¶æ€ ä½†å¯ä»¥åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œé…ç½®å‡ºæ¥å¤šä¸ªæœåŠ¡ï¼ŒN-Mæ¨¡åž‹ 123456failover domain: æ•…éšœè½¬ç§»åŸŸ fda: node1,node5 fdb: node2,node5 fdc: node3,node5 fdd: node4,node5 1234èµ„æºçš„çº¦æŸæ€§: ä½ç½®çº¦æŸï¼Œèµ„æºå¯¹èŠ‚ç‚¹çš„å€¾å‘æ€§; æŽ’åˆ—çº¦æŸï¼Œèµ„æºå½¼æ­¤é—´æ˜¯å¦èƒ½è¿è¡ŒäºŽåŒä¸€èŠ‚ç‚¹çš„å€¾å‘æ€§ï¼› é¡ºåºçº¦æŸï¼Œå¤šä¸ªèµ„æºå¯åŠ¨é¡ºåºä¾èµ–å…³ç³»ï¼› 123456789vote system: å°‘æ•°æœä»Žå¤šæ•°:quorum with quorum:æ‹¥æœ‰æ³•å®šç¥¨æ•°ï¼Œ( &gt; total/2 ) without quorum:ä¸æ‹¥æœ‰æ³•å®šç¥¨æ•° ä¸¤ä¸ªèŠ‚ç‚¹(å¶æ•°ä¸ªèŠ‚ç‚¹): Ping node qdisk failover (èµ„æºå°†è¦è½¬ç§»å‡ºåŽ») failback (èµ„æºå°†è¦è½¬ç§»å›žæ¥) 4ã€Messaging Layer: 12345heartbeat, v1 v2 v3corosync,cman 5ã€Cluster Resource Manager (CRM): 1234heartbeat v1 haresources (é…ç½®æŽ¥å£:é…ç½®æ–‡ä»¶[haresources])heartbeat v2 crmï¼ˆåœ¨æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªcrmdå®ˆæŠ¤è¿›ç¨‹ï¼ˆ5560/tcpï¼‰ï¼Œæœ‰å‘½ä»¤è¡ŒæŽ¥å£[crmsh],å¾ˆå¤§ç¨‹åº¦ä¸Šéœ€è¦ç¼–è¾‘xmlçš„é…ç½®æ–‡ä»¶ï¼‰; GUI;hb_guiheartbeat v3 pacemaker (å¿ƒè·³å¯è¯»å™¨) ï¼ˆé…ç½®æŽ¥å£:crmsh,pcs;GUI: hawk(suse),LCMC,pacemaker-gui)rgmanager ï¼ˆé…ç½®æ–‡ä»¶:cluster.conf,system-config-cluster,congaï¼ˆwebguiï¼‰, cman_tool, clustat,ï¼‰ 6ã€ç»„åˆæ–¹å¼: 12345678910111213141516heartbeat v1 (haresources)heartbeat v2 (crm)heartbeat v3 + pacemaker heartbeat + pacemakercorosync + pacemaker corosync v1 + pacemaker (plugin) corosync v2 + pacemaker (standalone service)cman + rgmanger CentOS 6 cman + pacemaker CentOS 6 (corosync v1 + cman +pacemaker) RHCS: Red Hat Cluster Suite RHEL5: cman + rgmanager + conga (ricci/luci) RHEL6: cman + rgmanager + conga (ricci/luci) corosync + pacemaker corosync + cman + pacemaker RHEL7: corosync + pacemaker 7ã€èµ„æºä»£ç†: 1234567Resource Agent: hearteat legacy: /etc/ha.d/haresources.d/ç›®å½•ä¸‹çš„è„šæœ¬ï¼› LSB: /etc/rc.d/init.d/ ç›®å½•ä¸‹çš„è„šæœ¬ï¼› OCF: Open Cluster Framework; provider: STONITHè®¾å¤‡: Systemctl: 8ã€èµ„æºç±»åž‹: 12345678910111213141516171819202122232425primitive: ä¸»èµ„æºï¼ŒåŽŸå§‹èµ„æº:åœ¨é›†ç¾¤ä¸­åªèƒ½è¿è¡Œä¸€ä¸ªå®žä¾‹;clone:å…‹éš†èµ„æºï¼Œåœ¨é›†ç¾¤ä¸­å¯ä»¥è¿è¡Œå¤šä¸ªå®žä¾‹: åŒ¿åå…‹éš†ï¼Œå…¨å±€æƒŸä¸€å…‹éš†ã€çŠ¶æ€å…‹éš†(ä¸»åŠ¨ã€è¢«åŠ¨)multi-state(master/slave);å…‹éš†èµ„æºçš„ç‰¹æ®Šå®žçŽ°;å¤šçŠ¶æ€èµ„æº:group: ç»„èµ„æº: å¯åŠ¨æˆ–åœæ­¢: èµ„æºç›‘è§†; ç›¸å…³æ€§;èµ„æºå±žæ€§: priority:ä¼˜å…ˆçº§; target-role:started,stopped,master ç›®æ ‡è§’è‰²; is-managed:æ˜¯å¦å…è®¸ç¾¤é›†ç®¡ç†æ­¤èµ„æº; resource-stickiness: èµ„æºç²˜æ€§; allow-migrate:æ˜¯å¦å…è®¸èµ„æºè¿ç§»;çº¦æŸ:score ä½ç½®çº¦æŸ:èµ„æºå¯¹èŠ‚ç‚¹çš„å€¾å‘æ€§ï¼› (-oo,+oo) ä»»ä½•å€¼+æ— ç©·å¤§=æ— ç©·å¤§ ä»»ä½•å€¼+è´Ÿæ— ç©·å¤§=è´Ÿæ— ç©·å¤§ æ— ç©·å¤§+è´Ÿæ— ç©·å¤§=è´Ÿæ— ç©·å¤§ æŽ’åˆ—çº¦æŸ:èµ„æºå½¼æ­¤é—´æ˜¯å¦èƒ½è¿è¡ŒåŒä¸€èŠ‚ç‚¹çš„å€¾å‘æ€§; (-oo,+oo) é¡ºåºçš„çº¦æŸ:å¤šä¸ªèµ„æºå¯åŠ¨é¡ºåºä¾èµ–å…³ç³»; (-oo,+oo) Mandatory äºŒã€å®‰è£…é…ç½®1ã€ CentOS 7: corosync v2 + pacemaker corosync v2: vote system pacemaker:ç‹¬ç«‹æœåŠ¡ é›†ç¾¤çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å·¥å…·: pcs: agent(pcsd) crmsh : agentless (pssh) 1# yum info pcs 2ã€é›†ç¾¤é…ç½®å‰æ 1234aã€æ—¶é—´åŒæ­¥;bã€åŸºäºŽå½“å‰æ­£åœ¨ä½¿ç”¨çš„ä¸»æœºåäº’ç›¸è®¿é—®; cã€æ˜¯å¦ä¼šç”¨åˆ°ä»²è£è®¾å¤‡; eã€åŒæœºäº’ä¿¡ 3.1å®‰è£…å¹¶å¯åŠ¨pcsd 123456789101112# vim /etc/hosts xx.xxx.xx.xxx node1.ssjinyao.comxx.xxx.xx.xxx node2.ssjinyao.com# scp /etc/hosts root@node2.ssjinyao.com:/etc/# date ; ssh root@node2.ssjinyao.com 'date' #æŸ¥çœ‹ä¸¤ä¸ªèŠ‚ç‚¹æœåŠ¡å™¨æ—¶é—´æ˜¯å¦ä¸€è‡´# ntpdate date.xxx.com #è‹¥æœåŠ¡å™¨æ—¶é—´ä¸åŒæ­¥ï¼Œåˆ™åŒæ­¥æœåŠ¡å™¨çš„æ—¶é—´Node1 AND Node2# yum install -y pacemaker pcs psmisc policycoreutils-python# ä¹Ÿå¯ä»¥ yum insetall -y pcs # systemctl start pcsd.service # systemctl enable pcsd.service 3.2 å„èŠ‚ç‚¹ç»Ÿä¸€æ‰§è¡Œ 1234# vim /etc/ansible[ha]node1.ssjinyao.comnode2.ssjinyao.com 1234Node1 AND Node2# ansible ha -m service -a "name=pcsd state=started enabled=yes"# systemctl status pcsd # ansible ha -m shell -a 'echo "xxxxxx" | passwd --stdin hacluster' 1234567891011121314151617# pcs help # pcs cluster --help # pcs cluster auth node1.ssjinyao.com node2.ssjinyao.com -u hacluster # pcsè®¤è¯é€šè¿‡# pcs cluster setup --name jycluster node1.ssjinyao.com node2.ssjinyao.com# cd /etc/corosync/# cat corosync.conf # æ³¨ totemæ˜¯ä¸“é—¨ä¼ é€’é›†ç¾¤é—´çš„å¿ƒè·³ä¿¡æ¯; nodelist é›†ç¾¤ä¸­ç›®å‰å­˜çš„èŠ‚ç‚¹; quorum æ³•å®šç¥¨æ•°çš„æŠ•ç¥¨æœºåˆ¶; corosync_votequorum; # cd /etc/corosync/ &amp;&amp; cat corosync.conf.example.udpu # é†’çœ‹é›†ç¾¤é…ç½®å®žä¾‹; # vim corosync.conf ä¿®æ”¹ logginlogging &#123;to_logfile:yes logfile: /var/log/cluster/corosync.log &#125;# scp corosync.conf node2.ssjinyao.com:/etc/corosync/ 3.3 å¯åŠ¨é›†ç¾¤ 12345678910111213141516171819202122Node1 Or Node2 # pcs cluster start --all # corosync-cfgtool --help æ£€æŸ¥å„èŠ‚ç‚¹é€šä¿¡çŠ¶æ€(æ˜¾ç¤ºä¸ºno faultså³ä¸ºOK):# corosync-cfgtool -s Printing ring status.Local node ID 1 RING ID 0 id = xx.xxx.xx.xxx status = ring 0 active with no faults såŒæ—¶ä¹Ÿå¯ä»¥åœ¨node2.ssjinyao.comä¸ŠæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ æ£€æŸ¥é›†ç¾¤æˆå‘˜å…³åŠQuorum API:# corosync-cmapctl | grep members # pcs staus corosync # pcs staus æŸ¥çœ‹pcsèµ„æºå¯é…ç½®é€‰é¡¹æœ‰å“ªäº›# pcs property list --allæŸ¥çœ‹pcsé…ç½®æ˜¯å¦å­˜åœ¨é—®é¢˜# crm_verify -L -V # pcs property se stonith-enabled=false # pcs property list # crm_verify -L -V 3.4 crmsh ä¸‹è½½å¹¶å®‰è£… 123456# wget crmsh-2.1.4.x86_64.rpm # wget pssh-2.3.1-4.2.x86_64.rpm# wget python-pssh-2.3.1-4.2.x86_64.rpm# yum install -y *rpm æ³¨ crmsh æ‰¾ä¸€ä¸ªç»“ç‚¹å®‰è£…å°±å¯ä»¥ï¼Œå½“ç„¶ä¸¤ä¸ªèŠ‚ç‚¹å¯ä»¥éƒ½å®‰è£… pssh æ˜¯å¹¶è¡Œæ‰§è¡Œsshå‘½ä»¤ 12345678# crm help # crm status # crm å¯ä»¥ç›´æŽ¥è¿›å…¥äº¤äº’å¼æŽ¥å£ # help start &gt;crm(live)node# configure &gt;crm(live)configure# help &gt;crm(live)configure# show&gt;crm(live)configure# edit 3.5 åˆ©ç”¨crmshé…ç½®ä¸€ä¸ªweb serice: vip:10.180.xxx.xx httpd 123456789101112Node1 AND Node2# yum -y install httpd Node1# echo "&lt;h1&gt;node1.ssjinyao.com&lt;/h1&gt;" &gt; /var/www/html/index.html# systemctl enabled httpd æ³¨:å¯¹äºŽCentOS 6 æ¥è¯´å¿…éœ€è¦ç¦ç”¨ # systemctl stop httpd Node2 # echo "&lt;h1&gt;nodd2.ssjinyao.com&lt;/h1&gt;" &gt; /var/www/html/index.html# systemctl enabled httpd # systemctl stop httpd æµ‹è¯•æœåŠ¡å™¨å¯ä»¥è®¿é—®åŽï¼Œå†å°†httpdæœåŠ¡åœæ­¢ 12345678910111213141516171819202122232425# crm æˆ–è€… # crm ra &gt;crm(live)# ra&gt;crm(live)ra# list systemd&gt;crm(live)ra# list ocf heartbeat &gt;crm(live)ra# info ocf:heartbeat:IPaddr &gt;crm(live)ra# info ocf:heartbeat:IPaddr &gt;crm(live)ra# cd ..&gt;crm(live)# configure &gt;crm(live)configure# primitive webip ocf:heartbeat:IPaddr params ip=10.xxx.xx.xxx&gt;crm(live)# status # ifconfig å¯ä»¥çœ‹åˆ°èµ„æºå·²ç»é…ç½®å¥½äº† æŠŠå½“å‰ç»“ç‚¹å˜æˆå¤‡ç”¨æ¨¡å¼&gt;crm(live)node# standby # è½¯ä¸‹çº¿&gt;crm(live)node# status&gt;crm(live)# node only&gt;crm(live)# configure &gt;crm(live)configure # primitive webserver systemd:httpd&gt;crm(live)configure # verify&gt;crm(live)configure # commit &gt;crm(live)configure # group&gt;crm(live)configure # grouop webservice webip webserivce &gt;crm(live)configure # verfy&gt;crm(live)configure # commit # crm node standby æ³¨:å¯ä»¥æŸ¥çœ‹webè¯·æ±‚çš„åå›žå†…å®¹ï¼Œä¸Žèµ„æºå®šä¹‰æƒ…å†µ; 12345678910# crm node onlie # crm &gt;crm(live) # configure&gt;crm(live)configure # verify# crm status # systemctl stop pacemaker.service corosync.serivce # crm status åœ¨CentOS 6çš„æƒ…å†µä¸‹ï¼Œå‡å¦‚å°†æœåŠ¡å™¨ç›´æŽ¥å…³æœºåŽï¼Œä¼šé€ æˆ partition with quorum # crm configure &gt;crm(live)configure # property no-quorum-policy=ignore]]></content>
  </entry>
  <entry>
    <title><![CDATA[pythonè‡ªåŠ¨åŒ–ä¹‹adminè‡ªåŠ¨åˆ‡æ¢root]]></title>
    <url>%2F2017%2F12%2F07%2Fpython%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B9%8Badmin%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2root%2F</url>
    <content type="text"><![CDATA[pythonè‡ªåŠ¨åŒ–ä¹‹adminè‡ªåŠ¨åˆ‡æ¢root sshç™»å½•ç³»ç»Ÿï¼Œå¦‚æžœæ˜¯éžrootå¸å·(æ™®é€šå¸å·)ç™»å½•é‡‡å–è¡ŒåŠ¨ï¼Œåˆ™suåˆ‡æ¢åˆ°root 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172#!/usr/env/bin python# -*- coding:utf-8 -*-# des:sshç™»å½•ç³»ç»Ÿï¼Œå¦‚æžœæ˜¯éžrootå¸å·(æ™®é€šå¸å·)ç™»å½•é‡‡å–è¡ŒåŠ¨ï¼Œåˆ™suåˆ‡æ¢åˆ°root# python çš„SSHV2 protocolåè®®å®žçŽ°ï¼Œç”¨äºŽpythonè°ƒç”¨å„ç§sshåŠŸèƒ½;import paramiko # pythonå†…ç½®æ—¶é—´æ¨¡å—import time #æ ¹æ®ç”¨æˆ·åå¯†ç ä»Žæ™®é€šç”¨æˆ·æ½æƒåˆ°rootç”¨è®°æ‰§è¡Œç»™å®šå‘½ä»¤def ssh_su_root(ip,username,password,root_pwd,cmd):#å»ºç«‹SSHClientå¯¹è±¡ myssh = paramiko.SSHClient()#è®¾ç½®è‡ªåŠ¨æŽ¥æ”¶å…¬é’¥ myssh.set_missing_host_key_policy(paramiko.AutoAddPolicy()) try:#ä½¿ç”¨ç»™å®šç”¨æˆ·åå¯†ç å°è¯•è¿žæŽ¥æœåŠ¡å™¨ myssh.connect(ip, 22, username=username, password=password, timeout=4) except Exception, ex: print str(ex) return # å¦‚æžœé»˜è®¤rootä¸å…è®¸è¿œç¨‹ç™»å½•ï¼Œæä¾›çš„æ˜¯æ™®é€šç”¨æˆ·å¸å·+rootå¸å·, #åˆ™è°ƒç”¨invoke_shell,ä½¿ç”¨äº¤äº’å¼shellæ–¹å¼åˆ‡æ¢åŒåˆ°rootå¸å·ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤ã€‚ if username != 'root': print "I am NOT root" ssh = myssh.invoke_shell() time.sleep(0.2) ssh.send('su -\n') buff = '' #å¾ªçŽ¯æ£€æµ‹å¯†ç è¾“å…¥æç¤ºï¼Œå‡ºçŽ°åŽå‘é€rootå£ä»¤ï¼Œ while not (buff.endswith('Password:') or buff.endswith('å¯†ç : ')): #ä»ŽæŽ¥æ”¶ç¼“å­˜ä¸­è¯»å…¥æœ€å¤š9999bytesæ•°æ®ã€‚ resp = ssh.recv(9999) buff += resp ssh.send(root_pwd) ssh.send('\n') buff = '' #å¾ªçŽ¯æ£€æµ‹#æç¤ºç¬¦ï¼Œå‡ºçŽ°åŽæ‰§è¡Œä¼ å…¥çš„å‘½ä»¤ã€‚ while not buff.endwith('# '): resp = ssh.recv(9999) buff += resp ssh.send[cmd] ssh.send('\n') buff ='' #å¾ªçŽ¯æ£€æµ‹#æç¤ºç¬¦ï¼Œæ„å‘³ç€å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œå‡ºçŽ°åŽå…³é—­sshè¿žæŽ¥å¹¶è¾“å‡ºç»“æžœã€‚ while not buff.endswith('# '): resp = ssh.recv(9999) buff += resp myssh.close() result = buff print "su root result ---&gt;",result myssh.close() else: #å¦‚æžœæä¾›çš„æ˜¯rootå¸å·ï¼Œåˆ™ç›´æŽ¥è°ƒç”¨paramiko exec_command æ–¹æ³•ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚ print "I am root" stdin, stdout, stderr = myssh.exec_command(cmd) stdin,write("Y") print "stdout.readlines() ---&gt;", stdout.readlines() myssh.close()if __name__ == "__main__": cmd = 'date' ip = 'xx.xxx.xx.xxx' username = 'admin' password = 'xxxxxxxxxx' ssh_su_root(ip, username, password, 'xxxxxxxxxxxx', cmd) username = 'root' ssh_su_root(ip, username, password, 'xxxxxxxxxxxx', cmd)]]></content>
      <tags>
        <tag>linux</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®‰å…¨åŠ å›º]]></title>
    <url>%2F2017%2F12%2F03%2F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%2F</url>
    <content type="text"><![CDATA[å®‰å…¨åŠ å›ºå®‰å…¨åŠ å›ºè„šæœ¬V1 ç”¨æ¥åšiptables sshåœ°å€ç™½åå•é™åˆ¶ openssh-server sshç”¨æˆ·ç™½åå•é™åˆ¶ æ›´æ”¹ç™»å½•æ¬¢è¿Žä¿¡æ¯ä¸ºè­¦å‘Šä¿¡æ¯ åº”ç”¨æ ¹ç›®å½•æƒé™æœ€å°åŒ– zabbix agentå®‰è£…é…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970#!/bin/bash#å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç¨‹åºç”±å‰å¾€åŽæ‰§è¡Œï¼Œæ¬¡é¡ºåºéžå¸¸é‡è¦ï¼Œä¸€ä¸å°å¿ƒä¼šå°†è‡ªå·±æ‹’åœ¨å¤–é¢ï¼Œé‡åˆ°è¿™ç§æƒ…å†µè®©è§„åˆ™å¤±æ•ˆçš„å¤„ç†æ–¹å¼æ˜¯é‡å¯æœå™¨ï¼Œæˆ–è€…ä»Žé˜¿é‡Œäº‘æŽ¥æŽ¥å£æŽ¥å…¥æ¸…ç©ºè§„åˆ™ï¼Œå¯é€‰åŽè€…ï¼›#æ³¨zabbix(xxx.xx.xxx.xx)\xx.xx.xx.xxxä¸»æœºä¸åŠ å…¥iptablesè§„åˆ™ IP_TABLES () &#123; /sbin/iptables -A INPUT -p tcp --dport 22 -s xxx.xxx.xx.xx -j ACCEPT #é¦–å…ˆæ”¾è¡Œ xxx.xxx.xxx.xxx æˆ‘ä»¬å†…ç½‘è·¯ç”±åœ°å€ /sbin/iptables -A INPUT -p tcp --dport 22 -s xxx.xxx.xx.xx -j ACCEPT #æ”¾è¡Œå¤‡ç”¨åœ°å€ xxx.xxx.xx.xxx åŒæ—¶ä¹Ÿæ˜¯æˆ‘ä»¬çš„zabbixåœ°å€ /sbin/iptables -A INPUT -p tcp --dport 22 -s xxx.xxx.xx.xx -j ACCEPT #æ­¤æœåŠ¡å™¨ä¸ºæˆ‘ä»¬é—²ç½®çš„ä¸€å°æœåŠ¡å™¨ /sbin/iptables -A INPUT -p tcp --dport 22 -j DROP #ä¸¢å¼ƒæ‰€æœ‰å¯¹22å·ç«¯å£çš„è¯·æ±‚ iptables -vnL #æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®&#125;#æ·»åŠ å”¯ä¸€å¯ä»¥ç™»å½•æœåŠ¡å™¨çš„ç”¨æˆ·SSH_INIT () &#123; useradd xxxxxxxx #æ·»åŠ ç”¨æˆ· cp -a /etc/skel /home/xxxxxxxx chown -R xxxxxxxx.xxxxxxxx /home/TransferEasyd0--01 usermod -s /bin/bash xxxxxxxx PASS='xxxxxxxxxx' echo "xxxxxxxx:$PASS" | chpasswd #ç»™ç”¨æˆ·è®¾ç½®å¯†ç  echo "AllowUsers xxxxxxxx" &gt;&gt; /etc/ssh/sshd_config #æ·»åŠ ç™½åå•åˆ°sshd_configä¸­ service ssh restart #é‡å¯æœåŠ¡å™¨&#125;#Webæ ¹ç›®å½•æƒé™æœ€å°åŒ–PY_INIT () &#123;chmod 700 /home/admin/&#125;WEB_INIT () &#123; chown www-data.www-data /var/www/html &amp;&amp; chmod 700 /var/www/html #è®¾ç½®å¯åŠ¨ç”¨æˆ·å’Œç”¨å¯åŠ¨ç»„éƒ½ä¸ºwww-dataç”¨æˆ·ï¼Œè®¾ç½®æ‰€æœ‰è€…æƒé™è¯»\å†™\æ‰§è¡Œ; æ‰€å±žç»„0; å…¶å®ƒäºº0; usermod -s /sbin/nologin www-data #å®Œå…¨ç¦æ­¢www-dataç”¨æˆ·ç™»å½• cat /etc/passwd | grep --color www-data #æŸ¥çœ‹ä¿®æ”¹ç™»å½• ls -ld /var/www/html #æŸ¥çœ‹ä¿®æ”¹æƒé™&#125;#æ›´æ”¹æ¬¢è¿Žä¿¡æ¯ä¸ºè­¦å‘Šä¿¡æ¯MO_TD () &#123; [ -e /etc/.motd.bak ] || cp /etc/motd /etc/.motd.bak cat &lt;&lt;EOF &gt; /etc/motdéžxxxxxxxxç®¡ç†äººå‘˜è¯·å‹¿ç™»å½•ç³»ç»Ÿï¼Œå¦åˆ™åŽæžœè‡ªè´Ÿéžxxxxxxxxç®¡ç†äººå‘˜è¯·å‹¿ç™»å½•ç³»ç»Ÿï¼Œå¦åˆ™åŽæžœè‡ªè´ŸNon xxxxxxxx administrators are not allowed to log on to the system, otherwise they may be affectedEOF [ -e /etc/update-motd.d/.00-header.bak ] || cp /etc/update-motd.d/00-header /etc/update-motd.d/.00-header.bakcat &lt;&lt;EOF &gt; /etc/update-motd.d/00-header#!/bin/sh[ -r /etc/lsb-release ] &amp;&amp; . /etc/lsb-releaseif [ -z "$DISTRIB_DESCRIPTION" ] &amp;&amp; [ -x /usr/bin/lsb_release ]; then# Fall back to using the very slow lsb_release utilityDISTRIB_DESCRIPTION=$(lsb_release -s -d)fiprintf "xxxxxxxx %s (%s %s %s)\n" "$DISTRIB_DESCRIPTION" "$(uname -o)" "$(uname -r)" "$(uname -m)"EOF [ -e /etc/.lsb-release.bak ] || cp /etc/lsb-release /etc/.lsb-release.bakcat &lt;&lt;EOF &gt; /etc/lsb-release DISTRIB_ID=CentOSDISTRIB_RELEASE=10000DISTRIB_CODENAME=trustyDISTRIB_DESCRIPTION="CentOS 1000"EOF&#125;ZAB_BBIX () &#123; apt-get install zabbix-agent mv /etc/zabbix/zabbix_agentd.conf /etc/zabbix/zabbix_agentd.conf.bak cp /home/admin/zabbix_agentd.conf /etc/zabbix/ cp /home/admin/zabbix_agentd.conf /tmp service zabbix-agent restart &#125;IP_TABLESSSH_INITPY_INITWEB_INITMO_TDZAB_BBIX å¯¹åº”å›žæ»šè„šæœ¬1234567891011121314151617181920212223242526272829303132333435363738#!/bin/bash#å®‰å…¨åŠ å›ºåŽï¼ŒæœåŠ¡å™¨å¦‚æœ‰é—®é¢˜æ—¶çš„å›žæ»šæ–¹æ¡ˆï¼›IP_TABLES_F () &#123; iptables -F&#125;SSH_INIT_F () &#123; sed -i 's/AllowUsers xxxxxxxx//g' /etc/ssh/sshd_config userdel xxxxxxxx service ssh restart&#125;WEB_INIT_F () &#123; chmod 700 /var/www/html chown admin.admin /var/www/html usermod -s /sbin/false www-data&#125;PY_INIT_F () &#123; chmod 700 /home/admin&#125;MO_TD_F() &#123; rm -rf /etc/motd mv /etc/.motd.bak /etc/motd rm -rf /etc/update-motd.d/00-header mv /etc/update-motd.d/.00-header.bak /etc/update-motd.d/00-header rm -rf /etc/lsb-release mv /etc/.lsb-release.bak /etc/lsb-release&#125;ZA_BBIX_F () &#123; service zabbix-agent stop apt-get remove zabbix-agent rm -rf /etc/zabbix/&#125;IP_TABLES_FSSH_INIT_FWEB_INIT_FMO_TD_FZA_BBIX_FPY_INIT_F å¯¹æ— agentæŽ¢é’ˆçš„RDSç½‘ç»œç›‘æŽ§1234567891011121314151617181920212223242526#!/bin/bash#ç”¨æˆ·RDSé€šçŸ¥åŠæŠ¥è­¦#ä½œè€…ï¼šä»»é”¦#RDS_IP="localhost"RDS_IP="www.xxxxxxxx.com"TOOL_S () &#123; rpm -qa nc &amp;&gt; /dev/null || yum -y install nc&#125;ON_LINE () &#123; DATE=`date | awk '&#123;print $4&#125;' | cut -d":" -f3` echo -e "\n\n" |nc -w 5 $RDS_IP 3306 &amp;&gt; /dev/null || STATP="RDS æœåŠ¡å™¨å·²ç»åœæ­¢äº†è¿è¡Œï¼Œè¯·æ‚¨å°½å¿«æ¥å¤„ç† ðŸ˜° ðŸ˜° ðŸ˜° ðŸ˜° ðŸ˜° ðŸ˜° " #echo $STATP&#125;WEI_XIN () &#123;/bin/weixin --corpid=xxxxxxxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="$STATP" --user=xxx@xxxxxxxxxxx.com --agentid=xxxxxx02 &amp;&gt; /dev/null /bin/weixin --corpid=xxxxxxxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="$STATP" --user=xxx2@xxxxxxxxxxx.com --agentid=xxxxxx02 &amp;&gt; /dev/null /bin/weixin --corpid=xxxxxxxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="$STATP" --user=xxx3@xxxxxxxxxxx.com --agentid=xxxxxx02 &amp;&gt; /dev/null /bin/weixin --corpid=xxxxxxxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="$STATP" --user=xxx4@xxxxxxxxxxx.com --agentid=xxxxxx02 &amp;&gt; /dev/null while sleep 60 ; do TOOL_SON_LINEWEI_XIN done é™¤çº¿ä¸Šzabbixå¤šè§’åº¦çš„ç›‘æŽ§ç½‘ç»œçŠ¶æ€12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576#!/bin/bashHOSTS () &#123; CN='xxx.xxx.xxx.xxx xxx.xxx.xx.xx.xxx xxx.xxx.xxx.xxx.xxx xxx.xxx.xxx.xxx' HK='xxx.xxx.xxx.xxx xxx.xxx.xx.xx.xxx xxx.xxx.xxx.xxx.xxx xxx.xxx.xxx.xxx' XN='xxx.xxx.xxx.xxx xxx.xxx.xx.xx.xxx xxx.xxx.xxx.xxx.xxx xxx.xxx.xxx.xxx'&#125;MESSAGES () &#123; OK_MESSAGES_CN='é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œæ­£å¸¸' OK_MESSAGES_HK='é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œæ­£å¸¸' OK_MESSAGES_XN='é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œæ­£å¸¸' CN_MES='é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œä¸é€šï¼' HK_MES='é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œä¸é€šï¼' XN_MES='é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œä¸é€šï¼' CN_MES_TIME="é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œè¶…æ—¶è¾ƒé«˜ï¼Œè¶…æ—¶æ—¶é—´åŠä¸¢åŒ…çŽ‡ä¸º" HK_MES_TIME="é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œè¶…æ—¶è¾ƒé«˜ï¼Œè¶…æ—¶æ—¶é—´åŠä¸¢åŒ…çŽ‡ä¸º" XN_MES_TIME="é˜¿é‡Œäº‘xxåŒºåŸŸECSä¸»æœºç½‘ç»œè¶…æ—¶è¾ƒé«˜ï¼Œè¶…æ—¶æ—¶é—´åŠä¸¢åŒ…çŽ‡ä¸º"&#125;WEIXIN_E-MAIL_API () &#123;# echo "$1# $2" | mutt -s "Zabbix æŠ¥è­¦" xxx@xxxxxxxxxxx.com xxx2.xxxxxxxxxxxx.com xxx3@xxxxxxxxxxx.com/bin/weixin --corpid=xxxxxxxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="$1$2" --user=xxx@xxxxxxxxxxx.com --agentid=xxxxxx02 &amp;&gt; /dev/null /bin/weixin --corpid=xxxxxxxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="$1$2" --user=xxx2@xxxxxxxxxxx.com --agentid=xxxxxx02 &amp;&gt; /dev/null /bin/weixin --corpid=xxxxxxxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="$1$2" --user=xxx3@xxxxxxxxxxx.com --agentid=xxxxxx02 &amp;&gt; /dev/null /bin/weixin --corpid=xxxxxxxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="$1$2" --user=xxx4@xxxxxxxxxxx.com --agentid=xxxxxx02 &amp;&gt; /dev/null &#125;HOSTSMESSAGESfor HOSTS_NET_CN in $CN do STATE_CN=`ping -c 2 -W 1 -S 1 $HOSTS_NET_CN | tail -n 2 | head -n 1 | awk &#123;'print $6'&#125;` TIME_CN=`ping -c 2 -W 1 -S 1 $HOSTS_NET_CN | head -n 3 | tail -n2 | awk &#123;'print $7,$8'&#125;` if ping -c 2 -W 1 -S 1 $HOSTS_NET_CN &amp;&gt; /dev/null ;then echo "$OK_MESSAGES_CN `date` $HOSTS_NET_CN OK" &amp;&gt;&gt; /tmp/$HOSTS_NET_CN else WEIXIN_E-MAIL_API "$CN_MES `date` $HOSTS_NET_CN $CN_MES_TIME $STATE_CN $TIME_CN" "PROBLEM" fi donefor HOSTS_NET_HK in $HK do STATE_HK=`ping -c 2 -W 1 -S 1 $HOSTS_NET_HK | tail -n 2 | head -n 1 | awk &#123;'print $6'&#125;` TIME_HK=`ping -c 2 -W 1 -S 1 $HOSTS_NET_HK | head -n 3 | tail -n2 | awk &#123;'print $7,$8'&#125;` if ping -c 2 -W 1 -S 1 $HOSTS_NET_HK &amp;&gt; /dev/null ; then echo "$OK_MESSAGES_HK `date` $HOSTS_NET_HK OK" &amp;&gt;&gt; /tmp/$HOSTS_NET_HK else WEIXIN_E-MAIL_API "$HK_MES `date` $HOSTS_NET_HK $HK_MES_TIME $STATE_HK $TIME_HK" "PROBLEM" fi donefor HOSTS_NET_XN in $XN do STATE_XN=`ping -c 2 -W 1 -S 1 $HOSTS_NET_XN | tail -n 2 | head -n 1 | awk &#123;'print $6'&#125;` TIME_XN=`ping -c 2 -W 1 -S 1 $HOSTS_NET_XN | head -n 3 | tail -n2 | awk &#123;'print $7,$8'&#125;` if ping -c 2 -W 1 -S 1 $HOSTS_NET_XN &amp;&gt; /dev/null ; then echo "$OK_MESSAGES_XN `date` $HOSTS_NET_XN OK" &amp;&gt;&gt; /tmp/$HOSTS_NET_XN else WEIXIN_E-MAIL_API "$XN_MES `date` $HOSTS_NET_XN $XN_MES_TIME $STATE_XN $TIME_XN" "PROBLEM" fi done å°†å¯¹åº”çš„è„šæœ¬åŠ å…¥å®šæ—¶è®¡åˆ’12crontab -e*/3 * * * * /bin/bash /root/bin/ds.sh å…³äºŽ/bin/weixin123é“¾æŽ¥:http://pan.baidu.com/s/1slcAlTb å¯†ç :f3gzweixinæŽ¥å£çš„è°ƒç”¨å¯ä»¥åˆ›å»ºä¸€ä¸ªä¼ä¸šå¾®ä¿¡æ¥é…ç½®ä¸€ä¸ªæŽ¥å£muttå‘çŸ­ä¿¡ï¼Œmutt+msmtpé…ç½®ä½¿ç”¨ åˆ é™¤mongoè¡¨ä¸­çš„æŸä¸€å­—æ®µ1db.screening_sections.remove(&#123;'no':'5a279c19756a7'&#125;)]]></content>
      <tags>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[gitlabå¤‡ä»½ä¸Žè¿ç§»]]></title>
    <url>%2F2017%2F11%2F22%2Fgitlab%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%81%E7%A7%BB%2F</url>
    <content type="text"><![CDATA[gitlabçš„å¤‡ä»½ä¸ŽåŒæ­¥gitlabå¤‡ä»½12# sudo gitlab-rake gitlab:backup:create# sudo scp -r /var/opt/gitlab/backups/ root@xx.xxx.xx.xxx:/root ç”±äºŽç‰ˆæœ¬é—®é¢˜ï¼Œåœ¨è¿ç§»ç›®æ ‡ä¸»æœºå®‰è£…åŒæ ·ç‰ˆæœ¬123# scp gitlab-ci-multi-runner_1.4.2_amd64.deb gitlab-ce_8.6.2-ce.0_amd64.deb root@xx.xxx.xx.xxx:/root# è‹¥æ— æ­¤ç‰ˆæœ¬çš„å¤‡ä»½åŒ…æ—¶é€‰æ‹©ä»¥ä¸‹æ–¹å¼ä¸‹è½½é“¾æŽ¥:http://pan.baidu.com/s/1eS4H6NK å¯†ç :e7i6 è¿ç§»ç›®æ ‡ä¸»æœºå®‰è£…ä¸Žæ¢å¤12345678910# dpkg -i /root/gitlab-ci-multi-runner_1.4.2_amd64.deb# dpkg -i /root/gitlab-ce_8.6.2-ce.0_amd64.deb # mv /root/1510889754_gitlab_backup.tar /var/opt/gitlab/backups/# gitlab-rake gitlab:backup:restore BACKUP=1510889754# gitlab-ctl start# vim /etc/gitlab/gitlab.rb unicorn['listen'] = '0.0.0.0' unicorn['port'] = 8080# gitlab-ctl reconfigure# gitlab-ctl start æ£€æŸ¥8080ç«¯å£æ˜¯å¦å¯åŠ¨12# netstat -tnlup | grep 8080tcp 0 0 0.0.0.0:8080 0.0.0.0:* LISTEN 3290/config.ru æºä¸»æœºåˆ©ç”¨bashè„šæœ¬+å®šæ—¶ä»»åŠ¡è‡ªåŠ¨å¤‡ä»½ä¸ŽåŒæ­¥å¤‡ä»½12# æ•°æ®åŒæ­¥ï¼Œé¦–è¦åšçš„å°±æ˜¯åŒæœºäº’ä¿¡ï¼›# ssh-copy-id -i ~/.ssh/id_rsa.pub root@xx.xxx.xx.xxx 123456789101112131415161718192021222324#!/bin/bash#Can Bakup gitlab to xx.xxx.xx.xxxFileBack () &#123; [ -d /var/opt/gitlab/backups/.bak ] || mkdir /var/opt/gitlab/backups/.bak -p mv /var/opt/gitlab/backups/*tar /var/opt/gitlab/backups/.bak/ find /var/opt/gitlab/backups/.bak/ -type f -mtime +7 -exec rm -rf &#123;&#125; \; /usr/bin/gitlab-rake gitlab:backup:create &amp;&gt; /dev/null sleep 240 ssh root@xx.xxx.xx.xxx "[ -d /var/opt/gitlab/backups/.bak ] || mkdir /var/opt/gitlab/backups/.bak -p" ssh root@xx.xxx.xx.xxx "mv /var/opt/gitlab/backups/*tar /var/opt/gitlab/backups/.bak/" ssh root@xx.xxx.xx.xxx "find /var/opt/gitlab/backups/.bak/ -type f -mtime +7 -exec rm -rf &#123;&#125; \;" scp /var/opt/gitlab/backups/*tar root@xx.xxx.xx.xxx:/var/opt/gitlab/backups/&#125;Message () &#123; MESSAGE="gitlab å·²å¤‡ä»½æˆåŠŸ `ls -l /var/opt/gitlab/backups/` &amp;&amp; `ls -ld /var/opt/gitlab/backups/` gitlabå½“å‰ä¸»æœåŠ¡å™¨xx.xxx.xx.xxx" MESSAGE_2=`ssh root@xx.xxx.xx.xxx "ls -l /var/opt/gitlab/backups/;ls -ld /var/opt/gitlab/backups/; ifconfig | sed -n '/inet addr/s/^[^:]*:\([0-9.]\&#123;7,15\&#125;\) .*/\1/p' | head -1"` /bin/weixin --corpid=xxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx. --msg="$MESSAGE gitlabå½“å‰ä»ŽæœåŠ¡å™¨$MESSAGE_2" --user=15822097176@139.com --agentid=100000x&#125;FileBack &amp;&amp; Message 12345678910111213141516171819202122#!/bin/bash#Can rolebak gitlabFILE_BAK () &#123;scp /var/opt/gitlab/backups/*tar root@xx.xxx.xx.xxx:/volume1/skill-operation/bakup/gitlab/ssh root@xx.xxx.xx.xxx "find /volume1/skill-operation/bakup/gitlab/ -type f -mtime +7 -exec rm -rf &#123;&#125; \;"&#125;GIT_ROLBAK () &#123;BAKID=`cd /var/opt/gitlab/backups/ &amp;&amp; ls | tr -dc "[:digit:]"`cd /var/opt/gitlab/backups/ &amp;&amp; chmod 666 */usr/bin/gitlab-rake gitlab:backup:restore BACKUP=$BAKID &lt;&lt;EOF &amp;&gt; /dev/nullyesyesEOF&#125;MESSAGE () &#123;/bin/weixin --corpid=xxxxxxxxxxxxx --corpsecret=xxxxxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --msg="ID ä¸º $BAKID çš„gitlabåŽ‹ç¼©åŒ…æ¢å¤å®Œæ¯•" --user=15822097176@139.com --agentid=100000x&#125;FILE_BAKGIT_ROLBAK &amp;&amp; MESSAGE 1234# å®šæ—¶ä»»åŠ¡è¿›è¡Œå®žæ—¶å¤‡ä»½ä¸ŽåŒæ­¥su - rootcrontab -e10 22 * * * /bin/bash /bin/GITLAB_BAK.sh 123su - rootcrontab -e30 22 * * * /bin/bash /bin/GIT_ROL.sh]]></content>
      <tags>
        <tag>database</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonè‡ªåŠ¨åŒ–ä¹‹fabric]]></title>
    <url>%2F2017%2F11%2F21%2Fpython%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B9%8Bfabric-lnmp%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96%2F</url>
    <content type="text"><![CDATA[#lnmpçŽ¯å¢ƒçš„å»ºç«‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445#!/usr/bin/env pythonfrom fabric.colors import *from fabric.api import *env.user='root'env.roledefs = &#123; #å®šä¹‰ä¸šåŠ¡è§’è‰²åˆ†ç»„ 'webservers': [ 'xx.xxx.xx.xxx' ], 'dbservers': ['xx.xxx.xx.xxx']&#125;env.passwords = &#123; 'root@xxx.xx.xx.xxx:22' : 'passwd', 'root@xxx.xx.xx.xxx:22' : 'passwd'&#125;@roles('webservers') #webtaskä»»åŠ¡å‡½æ•°å¼•ç”¨'webservers'è§’è‰²ä¿®é¥°ç¬¦def webtask(): print yellow("Install webtask packages class ! ") with settings(warn_only=True): run("yum -y install nginx") run("yum -y install php-fpm php-mysql php-mbstring php-xml php-mcrypt php-gd") run("chkconfig --levels 235 php-fpm on") run("chkconfig --levels 235 nginx on") run("systemctl start php-fpm") run("systemctl start nginx")@roles('dbservers') # dbtaskä»»åŠ¡å‡½å¼•ç”¨'dbservers'è§’è‰²ä¿®é¥°ç¬¦def dbtask(): #éƒ¨ç½²mysqlçŽ¯å¢ƒ print green("Install mariadb server !") with settings(warn_only=True): run("yum -y install mariadb mariadb-server") run("chkconfig --levels 235 mariadb on") run("systemctl start mariadb")@roles('webservers','dbservers') # publictaskä»»åŠ¡å‡½æ•°åŒæ—¶å¼•ç”¨ä¸¤ä¸ªè§’è‰²ä¿®é¥°ç¬¦def publictask(): # éƒ¨ç½²å…¬å…±çŽ¯å¢ƒï¼Œå¦‚epelã€ntpç­‰ print blue("Install epel ntp !") with settings(warn_only=True): run("rpm -Uvh http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm") run("rpm -y install ntp ntpdate")def deploy(): execute(publictask) execute(webtask) execute(dbtask) 12#vim åº•è¡Œæ¨¡å¼çš„æ‰§è¡Œ: ! fab -f NGINX_DPL.py deploy è‡ªåŠ¨éƒ¨ç½²æ³¨:ç›®å‰ä»£ç è¿˜æœ‰äº›é—®é¢˜ï¼Œå°å¿ƒå‚è€ƒ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273#!/usr/bin/env python# -*- coding: utf-8 -*-from fabric.api import *from fabric.colors import *from fabric.context_managers import *from fabric.contrib.console import confirmimport time env.user = 'root'env.hosts = ['xx.xxx.xx.xxx','xx.xxx.xx.xxx']env.password = 'test.......'env.project_dev_source = '/var/www/html' #å¼€å‘æœºé¡¹ç›®ä¸»ç›®å½•env.project_tar_source = '/var/www/releases' #å¼€å‘æœºé¡¹ç›®åŽ‹ç¼©åŒ…å­˜å‚¨ç›®å½•env.project_pack_name = 'release' # é¡¹ç›®åŽ‹ç¼©åŒ…å‰ç¼€ï¼Œæ–‡ä»¶åä¸º release.tar.gzenv.deploy_project_root = '/var/www/data' #é¡¹ç›®ç”Ÿäº§çŽ¯å¢ƒä¸»ç›®å½•env.deploy_release_dir = 'release' #é¡¹ç›®å‘å¸ƒç›®å½•ï¼Œä½äºŽä¸»ç›®å½•ä¸‹é¢env.deploy_current_dir = 'current' #å¯¹å¤–æœåŠ¡çš„å½“å‰ç‰ˆæœ¬è½¯é“¾æŽ¥env.deploy_version = time.strftime ("%Y%m%d") +"V2" #ç‰ˆæœ¬å·@runs_once #ç›¸å½“äºŽä¸€ä¸ªæ¨¡å—def input_versionid(): return prompt ("please input project rollbak version ID:",default="")@task@runs_oncedef tar_source(): print yellow("Creating source package...") with lcd(env.project_dev_source): local("tar -czf %s.tar.gz." % (env.project_tar_source + env.project_pack_name)) print green("Creating source package success!")@taskdef put_packages(): #ä¸Šä¼ ä»»åŠ¡å‡½æ•° print yellow("Start put package...") with settings(warn_only=True): with cd(env.deploy_project_root+env.deploy_release_dir): run("mkdir %s" % (env.deploy_version)) env.deploy_full_path = env.deploy_project_root + env.deploy_release_dir + "/" + env.deploy_version with setting(warn_only=True): result = put(env.project_tar_source + env.project_pack_name + ".tar.gz", env.deploy_full_path) if result.failed and not("put file failed, Continue[Y/N]?"): abort("Aborting file put task!") with cd(env.deploy_full_path): run("tar -zxvf %s.tar.gz" % (env.project_pack_name)) run("rm -rf %s.tar.gz" % (env.project_pack_name)) print green("Put &amp; untar packages success!")@taskdef make_symlink(): #ä¸ºå½“å‰ç‰ˆæœ¬ç›®å½•åšè½¯é“¾æŽ¥ print yellow("update current sylink") env.deploy_full_path = env.deploy_project_root + env.deploy_release_dir + "/" +env.deploy_version with settings(warn_only=True): #åˆ é™¤è½¯é“¾æŽ¥ï¼Œé‡æ–°åˆ›å»ºå¹¶æŒ‡å®šè½¯é“¾æŽ¥æºç›®å½•ï¼Œæ–°ç‰ˆæœ¬ç”Ÿæ•ˆ run("rm -rf %s" % (env.deploy_project_root + env.deploy_current_dir)) run("ls -s %s %s" % (env.deploy_full_path, env.deploy_project_root + env.deploy_current_dir)) print green("make symlink success!")@task def rollback(): #ç‰ˆæœ¬å›žæ»šä»»åŠ¡å‡½æ•° print yellow("rollback project version") versionid= input_versionid() if versionod=='': abort("Project version ID error,abort!") env.deploy_full_path=env.deploy_project_root + env.deploy_release_dir + "/" +versionid run("rm -f %s" % env.deploy_project_root +env.deploy_current_dir) run("ln -s %s %s" % (env.deploy_full_path, env.deploy_project_root + env.deploy_current_dir))#åˆ é™¤è½¯é“¾æŽ¥,é‡æ–°åˆ›å»ºå¹¶æŒ‡å®šè½¯é“¾æŽ¥æºç›®å½•ï¼Œæ–°ç‰ˆæœ¬ç”Ÿæ•ˆ print green("rollback success!")@taskdef go(): tar_source() put_packages() make_symlink()]]></content>
      <tags>
        <tag>linux</tag>
        <tag>program</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å½“æˆ‘å¹´è½»çš„æ—¶å€™]]></title>
    <url>%2F2017%2F11%2F20%2F%E5%BD%93%E6%88%91%E5%B9%B4%E8%BD%BB%E7%9A%84%E6%97%B6%E5%80%99%2F</url>
    <content type="text"><![CDATA[å½“æˆ‘å¹´è½»çš„æ—¶å€™ å½“æˆ‘å¹´è½»çš„æ—¶å€™ï¼Œæˆ‘çš„æƒ³è±¡åŠ›ä»Žæ²¡æœ‰å—è¿‡é™åˆ¶ï¼Œæˆ‘æ¢¦æƒ³æ”¹å˜è¿™ä¸ªä¸–ç•Œ;å½“æˆ‘æˆç†Ÿä¹‹åŽï¼Œæˆ‘å‘çŽ°æˆ‘ä¸èƒ½å¤Ÿæ”¹å˜è¿™ä¸ªä¸–ç•Œï¼Œæˆ‘å°†ç›®å…‰ç¼©çŸ­äº†äº›ï¼Œå†³å®šåªæ”¹å˜æˆ‘çš„å›½å®¶;å½“æˆ‘è¿›å…¥æš®å¹´ä»¥åŽï¼Œæˆ‘å‘çŽ°æˆ‘ä¸èƒ½å¤Ÿæ”¹å˜æˆ‘çš„å›½å®¶ï¼Œæˆ‘æœ€åŽæ„¿æœ›ä»…ä»…æ˜¯æ”¹å˜ä¸€ä¸‹æˆ‘çš„å®¶åº­ã€‚ä½†æ˜¯è¿™ä¹Ÿä¸å¯èƒ½;å½“æˆ‘çŽ°åœ¨èººåœ¨åºŠä¸Šï¼Œè¡Œå°†å°±æœ¨æ—¶ï¼Œæˆ‘çªç„¶æ„è¯†åˆ°: å¦‚æžœä¸€å¼€å§‹æˆ‘ä»…ä»…åŽ»æ”¹å˜æˆ‘è‡ªå·±ï¼Œç„¶åŽä½œä¸ºä¸€ä¸ªæ¦œæ ·;æˆ‘å¯èƒ½æ”¹å˜æˆ‘çš„å®¶åº­;åœ¨å®¶äººçš„å¸®åŠ©å’Œé¼“åŠ±ä¸‹ï¼Œæˆ‘å¯èƒ½ä¸ºå›½å®¶åšä¸€äº›äº‹æƒ…;ç„¶è€Œï¼Œè°çŸ¥é“å‘¢ ï¼Ÿ æˆ‘ç”šè‡³å¯èƒ½æ”¹å˜è¿™ä¸ªä¸–ç•Œ; ä»–ä»¬çš„å¥½ èŽŽèŽŽå§: å¼•é¢†è‡ªå·±è¿›å…¥ITè¡Œä¸šï¼Œæä¾›æœ€æ–°çš„ä¿¡æ¯èµ„æ–™è®©è‡ªå·±åœ¨å¤§å­¦å­¦ä¹ ï¼Œæä¾›åˆåˆ°åŒ—äº¬ç»æµŽä¸Šçš„æ”¯æŒã€‚å¼•å¯¼å°±ä¸šä¸Žå­¦ä¹ æ–¹å‘ã€‚ æµ·ç”Ÿéƒ­: æŽ¨èå°±ä¸šï¼Œå¸®åŠ©å­¦ä¹ æŠ€æœ¯çŸ¥è¯†ã€‚ æ´‹æ´‹: å›°éš¾æ—¶æœŸçš„é¼“åŠ±ä¸Žæ”¯æŒã€‚ å¨œå¨œ: å¸®ç€å­¦ä¹ é«˜æ•°ï¼Œé¼“åŠ±Linux å‘å±•ä¹‹è·¯ ï¼Œå¸®ç€è‡ªå·±æŽ’å¿§è§£éš¾ã€‚ é˜¿ç‹—: æœ€ç¾Žçš„å¹´åŽé¼“åŠ±ä¸Žç›¸ä¼´ã€‚ å°èƒ–éƒ­: å¼•é¢†è¿ç»´å…¥é—¨ï¼Œç›¸é‡ç›´çŽ‡ã€‚ çº¢å…µå“¥: å¸®ç€çœ‹æˆ¿ï¼Œä¸€èµ·å­¦ä¹ ä¸“ä¸šçŸ¥è¯†ã€‚ ä¸å¯å¤šå¾—çš„æŒšå‹æ¨ä¸­xinã€ æ¢hao ã€ è‘£san ã€ç‹—jiang ã€å‹‡gangã€ æµ·tuan ã€ èŠ³mei ã€ æŒ¯xin ç«è½¦è·‘çš„å¿«ï¼Œå…¨é è½¦å¤´å¸¦è®¸ç«‹å®½ã€ çŽ‹æ˜¥å…°ã€å´”å¿˜åã€é›·ä¸½ç´ã€é©¬æ°¸äº®ã€çŽ‹æ™“æ˜¥ åŠ±å¿—è¯­ æœ‰æ™ºè€Œæ€§ç¼“è€…æ€å¤§æ™ºã€æœ‰æ‰è€Œæ°”å’Œè€…ä¸ºå¤§æ‰; æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªä¸–ç•Œè®©ç»™æˆ‘æ‰€é„™è§†çš„äººï¼Œå†¬ä¸¥å¯’ã€å¤é…·æš‘ã€æ˜¥ç§‹äº¦ä¸æ­»å¾å¿ƒï¼Œå¿ƒæœ‰æ‰€å‘ï¼Œå°†æœ‰æ‰€æˆ; ä¸ç®¡èµ°åˆ°å“ªé‡Œï¼Œéƒ½è¦ç›¸ä¿¡è‡ªå·±çš„å‹‡æ•¢å’Œæ¯…åŠ›ï¼Œä¸ç®¡é‡åˆ°ä»€ä¹ˆäº‹æƒ…éƒ½ä¸è¦å‡»åž®è‡ªå·±çš„å¿ƒæ€; é«˜ä¸­è¯­å½•12345678çƒˆ ç« é€æ°´é”¦é¥èµ›è€…å¥”äºŽé“ä¸­å¤®ï¼Œåªä¸ºå°–å³°ç”Ÿçƒˆç«ã€‚è§‚è€…ç«‹äºŽè·¯ä¸¤å‚ï¼Œæ±‚å¾—ä¸ºæ­¤æ¥é¼“æŽŒã€‚é£Žå¹çƒˆç«ç«ä¼¼ç®­ï¼Œå¼ºåŽ‹çƒˆç«ç«å†²å¤©ã€‚çƒ­è¡€é’æ˜¥åº¦æ— æ‚”ï¼Œè°äººæ­¤ç”Ÿå¦‚çƒˆç«ï¼Ÿä¸è§†å‰æ–¹æ¸ºæˆ‘è€…ï¼Œæ— é¡»å†å“äººç”Ÿå‘³ã€‚çƒˆç«æ€’å†²äººç”Ÿè·¯ï¼Œå¤®è‰ç•™äºŽæˆ‘èŠ³é¦™ã€‚ 12345678 å ‚ å¼Ÿ é€æ°´é”¦é¥åŒå ‚å åœ°è¿‡ä¸ƒç§‹ï¼Œä¼´æˆ‘åŒåº¦åƒç™¾æ—¥ã€‚å ‚å¼Ÿä¹±å…¥æ¸¸æˆç½‘ï¼Œæ‚”äºŽå½“åˆæˆ‘æ²‰æ²¦ã€‚èµ›é“å¿™äºŽçž„å³°æ ‡ï¼Œä¸“äºŽæŠ€è‰ºç»ˆä¸å›žã€‚æ¸¸æˆäººç”ŸæŠ›æ¶¯åº•ï¼Œå ‚å¼ŸåŸºçŸ³å¿™æ‰“ç´§ã€‚ä¸Žå…¶ç›¸éš”è™½é¥è¿œï¼Œå›žä¹¡ä¹‹æ—¥æŒ¤æ—¶é—´ã€‚æ–­è½å„è¡Œåƒç™¾äº‹ï¼Œå¸¸ç«‹å¤©åœ°æ°¸ä¸è¡°ã€‚ 12345678 æ·¡éœžè¿½å¿†é€æ°´é”¦é¥æ˜Ÿåˆ’ä¸€é¢—æ³„ä¸‡é‡Œï¼Œå…‰æ´’æš—å¤œæš–ä¸€å¿ƒã€‚åŒäº²ä¼¼æœ‰ç¦»åˆ«æ„ï¼Œå­è‹¥å¿ƒå¼¦å¼¦æ‹‰ç´§ã€‚ä»Šæ—¥å®¶å’Œä¸‡äº‹å…´ï¼Œå¤©é—´ç©ºç•™æ·¡éœžå¿†ã€‚é™è§‚åº­å°èŠ±è½åŽ»ï¼ŒåŠ¨å¬æ³ªé›¨çŒç§‹ç”°ã€‚é¥æœ›å‰ç¨‹èŠ±ä¸Žé”¦ï¼Œè¿½å¿†æ·¡éœžç•™æˆ‘æƒ…ã€‚ç¬‘çœ‹ä¸–é—´è·¯é™©ä¹‰ï¼Œç—›ç»æ­¤ç”Ÿå†¬çœ äººã€‚ 12345678910111213141516171819202122232425262728é”¦é¥æ±‚ä½³å­£ é€æ°´é”¦é¥åˆæ˜¯ä¸€å¹´å†¬å­£ æ„¿åŒåº¦é’æ˜¥çš„æœ‹å‹ä»¬å¤–ç¾Žå¦‚èŠ±ï¼Œå†…ç§€å¦‚ç«¹è®©æˆ‘ä»¬çš„å¿ƒçµå±±é«˜æ°´é˜”ï¼Œå¤©åœ°æ¾„æ˜ŽçœŸæ­£çš„è‡ªå·±æ²¡æœ‰å·¦å³å¤©æ°”çš„èƒ½åŠ›æ²¡æœ‰åŠ›æŒ½ç‹‚æ¾œçš„é­„åŠ›æ²¡æœ‰ä¸¤è‚‹æ’åˆ€çš„å‹‡æ°”ä½†å´æœ‰ä¸€é¢—å¿ƒæœ‰æƒ…æœ‰ä¹‰åœ¨è¿™ä¸ªå¯’å†·çš„å†¬å­£é‡Œæ„¿åŒåº¦é’æ˜¥çš„æœ‹å‹ä»¬å¦‚åœ¨æ˜¥å¤©è¿‡çš„ç¾Žä¸½å¦‚åœ¨å¤å¤©è¿‡çš„æ¸©æš–å¦‚åœ¨ç§‹å¤©è¿‡çš„å……å®žåŒåœ¨å†¬å¤©è¿‡çš„è¿·äººæˆ‘æœ‰æˆ‘çš„è‡ªæˆ‘èŠ¬èŠ³æˆ‘æœ‰æˆ‘çš„çƒ­è¡€å†…å¿ƒä¸Žæœ‹å‹åŒäº«å†¬å­£æœ‰å¯’è€Œé™ä¸çŸ¥å¯’å†·æœ‰éš¾åŒåº¦ä¸æ„Ÿç—›è‹¦æœ‰æ³ªå¯è½ä¸è§‰æ‚²å‡‰æ„¿åŒåº¦é’æ˜¥çš„æœ‹å‹ä¸€åˆ‡éƒ½å¥½ä¸€åˆ‡éƒ½å¥½ï¼ 1234567891011121314151617181920212223242526272829303132333435èµ¤å­ä½³äººé€æ°´é”¦é¥çœ‹å¤§åœ°å±±æ²³ä¹‹ç§€ å“é”¦ç‘Ÿå¹´åŽä¹‹ç››æ„¿ä¸Žå°”åŒåº¦å››å­£æ˜¥èµèŠ±å¤è§‚ç€‘ç§‹é‡‡çº¢å¶å†¬è¸é›ªé—²é€‚çš„è‡ªå·±æµªæ¼«çš„ä½³äººä¸€é—ªä¸€æ˜Ÿå…‰ä¸€é”¦ä¸€äººç”Ÿæœ›å‰ç¨‹å¦‚æµ·ä¹‹èŒ«å®šå³°æ ‡åŠ›æ±‚çŒ›è¿›æ„¿ä¸Žå°”åŒåº¦é’æ˜¥å–œå¬æ­Œæ€’ç»½æ”¾å“€é¸£é¸Ÿä¹ä¹å¼€æ€€æ¿€æ‰¬çš„çƒ­è¡€èˆžåŠ¨çš„é’æ˜¥æ»¡æœˆæ»¡æ–œé˜³è½åœ°è½èŠ¬èŠ³è§†å¤©é•¿åœ°ä¹…ä¹‹äººç•™ä½™ç”Ÿä½™ä¸–ä¹‹çˆ±æ„¿ä¸Žå°”åŒåº¦ä½™ç”Ÿé’å­¦ä¹ é•¿ç§¯è“„å¹´ç«‹äº‹ä¸šè€æ‰¶å­èšé›†çš„çƒ¦æ¼æ— å°½çš„å¿§æ„å…±è‹¦å…±æ¬¢ä¹å…±æ¶¯å…±æ­¤ç”Ÿ 123456789101112131415161718192021é€æ°´äººç”Ÿå½•é€æ°´é”¦é¥æ›¾å¿†æ—§æ—¶å…‰ï¼Œåƒç™¾æ›²æ‚²æ­Œå”±å“ï¼›æ—¶äººå¤šæ€è‹¦æ¥šï¼Œæ— å¥ˆå“€ä¼¤é—­åŒç›®ã€‚å›žè¡äººç”Ÿè·¯ï¼Œå¤šå°‘æ¬¡äº‰é”‹æ•Œå¯¹ï¼›æœé˜³å†·äºŽå¯’å…‰ï¼Œå¿ äºŽä»ä¹‰å­˜å–„è‰¯ã€‚åŠ›æŒ½å®¶å¹¸ç¦ï¼Œæ— æ•°å°æ—¥å¤œéš¾çœ ï¼›åŒå­æå¿§çˆ¶æ¯ï¼Œæœ‰å®¶ä¸å’Œå¤©åœ°ä¹±ã€‚åœç•™ä»–äººè¨€ï¼Œå¬ä¸å°½ä¸‘é—»è¯½è¯­ï¼›å…³é—¨æžåŠ›å‡€å¿ƒï¼Œç©ºç•™é”¦é¥æœ‰æƒ…äººã€‚å¤©ä¸äºˆä»¥æˆ‘å®¶å’Œï¼Œç‹¬ç«‹å…¶èº«ä¿®è‡ªå¼ºã€‚è‡ªå¹¼è‡³ä»Šæ— å¥ä½“ï¼Œå”¯æœ‰ä¸€é¢—å‚²éª¨å¿ƒã€‚å®¶ä¹¡å¦‚å†°æ— æ¸©æƒ…ï¼Œæ˜Ÿå…‰ç…§æˆ‘ç•™æš–å¿†ã€‚çˆ±æ„å—å†·å†°æˆ‘å¿ƒï¼Œå­¤å‹ä¹…æ’­å…³çˆ±ç§ã€‚å­¦ä¹ ä¸è¿›æŠ€ä¸æˆï¼Œä¿¡å¿ƒç™¾æˆå‰©ä¸¤æˆã€‚æ„¿å¯»å¤§å­¦å¿ƒè¿½æ±‚ï¼ŒæŸ”æƒ…é‡è¿”äººä¸–é—´ã€‚å‹¿å¿˜æœ‹å‹æƒ…ï¼Œå…³æ€€è§£éš¾é›ªé€ç¢³ã€‚å‹¿å¿˜æ©å¸ˆè‚²ï¼Œç«‹å®½æ˜¥å…°å´”å¿˜åã€‚å‹¿å¿˜æ¯äº²æ³ªï¼Œå¸çƒŸå–é…’ä¸äº‰æ°”ã€‚å‹¿å¿˜é”¦é¥é­‚ï¼Œåˆšæ¯…å€”å¼ºæ‰¬æ–—å¿—ã€‚ 1234567é†‰æ— æ¸©æ„é€æ°´é”¦é¥å“ªè®¤å¹æ¥å¸ƒè°·é¸Ÿï¼Œæ— æ„ç‰µèµ·å®¶ä¹¡æƒ…ã€‚ä¸ºå¾—è·¯äººä¸€å›žçœ¸ï¼Œæ— åŠ›æ¶ˆæˆ‘å®¶ä¹¡æ„ã€‚æ™¨é™ªèŠ±ç“£ç“£ç•™éœ²ï¼Œæš—å¤œæ— æ˜Ÿæ˜Ÿç‚¹ç¼€ã€‚æŠ±è´Ÿå­˜å¿ƒå¿—åœ¨å¤©ï¼Œæˆ˜åœºä¸€æˆ˜ç‚®æ‰“å“ã€‚ç©¿è‚ çƒˆé…’æ— æ¸©æ„ï¼Œä¸½äººå¦‚èŠ±é…’ä¸ºæ„ã€‚ ç¦»åˆ«åŽ1234567891011121314151617181920é€æ°´äººç”Ÿå½• é€æ°´é”¦é¥ æ›¾å¿µæ—§ç›¸è¯†ï¼Œä¸€é¢æ¬¢å¿«ä¸€é¢æ„ã€‚æ—¶äººæœ‰æ¢¦ç«‹å¤§å¿—ï¼Œå„å¥”å‰ç¨‹è‡ªæ‹¼æã€‚å›žè¡äººç”Ÿè·¯ï¼Œå¤šå°‘æ¬¡æ—¥å¤œç›¸ä¼´ã€‚èº«è´Ÿä½ æˆ‘æœªæ¥æ¢¦ï¼Œæ‹¾èµ·åšå¼ºä¸æ€•ç—›ã€‚è½»æ‹‚å¿ƒä¸­ä¼¤ï¼Œæ‹¥æŠ±ä¸€æ—¶ä¸å“­æ³£ã€‚çˆ±å¿§æ¨å¿§ä¸æŒ‚å¿ƒï¼Œç‰µæ‰‹ç›¸ä¼´é£Žé›¨ä¸­ã€‚ç¾Žå¥½ç»ˆé€å¾€ï¼ŒåŠ³ç‡•åˆ†é£žå¯å›žé¦–ï¼Ÿç›¸ä¿¡æŠ€è‰ºä¸ç›¸è¿œï¼Œä½•å¿…æ€¥äºŽå·¥ä½œå¿™ã€‚é‡é‡æ€ç»ªç»•æ¢¦è¦ï¼Œæ‚„ç„¶é’»å…¥æ²‰å¯‚é‡Œã€‚åŒ†åŒ†æ—¶å…‰å°½é€æ°´ï¼Œä¸€æ—¶ä½Žè½æ€è¿‡å¾€ã€‚åµåµé—¹é—¹ä¸€ä¸‰ä¹ï¼Œå¿«ä¹å’Œå¥½ä¸‹ä¸€ç§’ã€‚å½±å½±ç›¸ä¼´ä¸æ›¾æ€•ï¼Œä¿¡ä»°ä¸æ­»ç«‹å¿ƒå¤´ã€‚è¨€è¨€ç›¸éšå¥½çˆ±äººï¼Œæ‚å¿µåœç•™ä¹±æˆ‘å¿ƒã€‚è‹¥è‹¥æ¬£é˜³ç¬‘å½’æ¥ï¼Œæ— è§£æ— æ€å¤§ç¥žåœ¨ã€‚å‹¿å¿˜å¾€æ—¥æ¸¸ï¼Œæ•…å®«åŽé—¨ä¼¼ç¥žé¾Ÿã€‚å‹¿å¿˜æ·¡å¼€æ”¾ï¼Œä¸æ™“å¿ƒæ€æ²³è¾¹ä¹±ã€‚å‹¿å¿˜æœæ—¥ä¼´ï¼Œèª“è¨€æ¢¦æƒ³ä¿±ç—´ç‹‚ã€‚å‹¿å¿˜åˆ«æ—¶ç—›ï¼Œä½ æˆ‘æ³ªåˆ«åŒ—äº¬å—ã€‚]]></content>
      <tags>
        <tag>renjin</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kvmä¹‹å¿«ç…§ç®¡ç†]]></title>
    <url>%2F2017%2F10%2F30%2Fkvm%E4%B9%8B%E5%BF%AB%E7%85%A7%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[kvmä¹‹å¿«ç…§ç®¡ç†ä½¿ç”¨kvmå¿«ç…§ï¼Œç£ç›˜åˆ™å¿…éœ€è¦ä½¿ç”¨qcow2çš„æ ¼å¼123456# qemu-img info centos6.test-x86_64.raw image: centos6.test-x86_64.rawfile format: rawvirtual size: 80G (85899345920 bytes)disk size: 1.2G# å…³é—­è™šæ‹Ÿæœºå¹¶æ”¹å˜ç£ç›˜çš„æ ¼å¼12345678910111213141516171819202122232425262728# virsh list Id åç§° çŠ¶æ€---------------------------------------------------- 2 ubuntu-14.4-n1 running 14 ubuntu-14.4-113-pycharm running 16 ubuntu-14.4-n2 running 20 centos-6.8-grafana running 22 centos-6.8-data running 24 centos-6.8-test running# virsh destroy centos-6.8-teståŸŸ centos-6.8-test è¢«åˆ é™¤# virsh list --all Id åç§° çŠ¶æ€---------------------------------------------------- 2 ubuntu-14.4-n1 running 14 ubuntu-14.4-113-pycharm running 16 ubuntu-14.4-n2 running 20 centos-6.8-grafana running 22 centos-6.8-data running - centos-6.8-n1 å…³é—­ - centos-6.8-test å…³é—­ - renjin-scripts å…³é—­ - ubuntu-14.4-n3 å…³é—­# qemu-img convert -f raw -O qcow2 centos6.test-x86_64.raw centos6.test-x86_64.qcow2# virsh edit centos-6.8-test &lt;disk type='file' device='disk'&gt; &lt;driver name='qemu' type='qcow2' cache='none'/&gt; &lt;source file='/media/67cbdcec-6419-4571-9632-c605b3e2b910/data/centos6.test-x86_64.qcow2'/&gt; æŸ¥çœ‹ç®¡ç†å¿«ç…§çš„å‘½ä»¤æœ‰å“ªäº›12345678910111213# virsh --help | grep snap iface-begin create a snapshot of current interfaces settings, which can be later committed (iface-commit) or restored (iface-rollback) Snapshot (help keyword 'snapshot') snapshot-create Create a snapshot from XML snapshot-create-as Create a snapshot from a set of args snapshot-current Get or set the current snapshot snapshot-delete Delete a domain snapshot snapshot-dumpxml Dump XML for a domain snapshot snapshot-edit edit XML for a snapshot snapshot-info snapshot information snapshot-list List snapshots for a domain snapshot-parent Get the name of the parent of a snapshot snapshot-revert Revert a domain to a snapshot åˆ›å»ºå¿«ç…§123456# virsh snapshot-create centos-6.8-test# virsh snapshot-list centos-6.8-test åç§° Creation Time çŠ¶æ€------------------------------------------------------------ 1509359245 2017-10-30 18:27:25 +0800 shutoff# å…¶ä¸­å¿«ç…§é…ç½®æ–‡ä»¶æ”¾åˆ°äº†/var/lib/libvirt/qemu/snapshot/ å¿«ç…§æ¢å¤æŸ¥çœ‹å“ªäº›å¿«ç…§éœ€è¦æ¢å¤123456789101112# virsh list --all Id åç§° çŠ¶æ€---------------------------------------------------- 2 ubuntu-14.4-n1 running 14 ubuntu-14.4-113-pycharm running 16 ubuntu-14.4-n2 running 20 centos-6.8-grafana running 22 centos-6.8-data running 25 centos-6.8-test running - centos-6.8-n1 å…³é—­ - renjin-scripts å…³é—­ - ubuntu-14.4-n3 å…³é—­ 12345678910# virsh snapshot-list centos-6.8-test åç§° Creation Time çŠ¶æ€------------------------------------------------------------ 1509359245 2017-10-30 18:27:25 +0800 shutoff # virsh destroy centos-6.8-teståŸŸ centos-6.8-test è¢«åˆ é™¤# virsh snapshot-revert centos-6.8-test 1509359245# virsh snapshot-current centos-6.8-test# virsh start centos-6.8-test#è‡³æ­¤ï¼Œå·²ç»æ¢å¤å®Œæˆ å¿«ç…§çš„åˆ é™¤123456# virsh snapshot-list centos-6.8-test åç§° Creation Time çŠ¶æ€------------------------------------------------------------ 1509359245 2017-10-30 18:27:25 +0800 shutoff# virsh snapshot-delete centos-6.8-test 1509359245 è¡¥å……:åœ¨å®¿ä¸»æœºå…³æœºåŽï¼Œå¯åŠ¨kvmé‡ä»¥ä¸‹é—®é¢˜:123456# virsh start centos-7.2-xxxxxxxxé”™è¯¯ï¼šå¼€å§‹åŸŸ centos-7.2-xxxxxxxå¤±è´¥é”™è¯¯ï¼šUnable to read from monitor: Connection reset by peer# virsh managedsave-remove centos-6.8-grafana# virsh start centos-7.2-xxxxxxxxx åŸŸ centos-7.2-xxxxxxxxx å·²å¼€å§‹]]></content>
  </entry>
  <entry>
    <title><![CDATA[linux ç³»ç»Ÿä¼˜åŒ–]]></title>
    <url>%2F2017%2F10%2F29%2Flinux-%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[è¿›ç¨‹è°ƒåº¦123456789101112131415161718192021222324252627282930313233343536OS:ç¡¬ä»¶æŠ½è±¡ï¼Œè™šæ‹Ÿè®¡ç®—æœº system call CPU: time slice èŽ·å¾—CPUæƒé™çš„ä¼˜å…ˆçº§ï¼Œæœ‰äº›è¿›ç¨‹çš„ä¼˜å…ˆçº§æ˜¯å¯ä»¥è¢«æé«˜çš„è°ƒåº¦å™¨(æœ¬èº«ä¹Ÿæ˜¯ä¸ªç¨‹åº): CFS Big O O(1) ä¸€ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ 0-139 0-99 100-139: niceMemory: è™šæ‹Ÿåœ°å€ç©ºé—´ PAEï¼šç‰©ç†åœ°å€æ‰© 32bitsï¼Œå¯»å€çš„ç‰©ç†ç©ºé—´æ˜¯4Gï¼Œ4bitsæ˜¯é¢å¤–å¼•å…¥çš„ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºPAEæŠ€æœ¯(64G) ä¹Ÿå°±æ˜¯è¯´å®ƒçš„çº¿æ€§åœ°å€ç©ºé—´ä¾ç„¶ä¸º4G MySQL:å•è¿›ç¨‹å¤šçº¿ç¨‹ å¯ä»¥ä½¿ç”¨2.7Gå·¦å³ï¼Œå› æ­¤ä½¿ç”¨PAEæŠ€æœ¯å¯¹MySQLæ²¡æœ‰æŠ€æœ¯ï¼Œå› æ­¤ä½¿ç”¨MySQLæœåŠ¡æ—¶ï¼Œå»ºè®®ä½¿ç”¨64ä½çš„ page frame: åˆ†é¡µæŠ€æœ¯ ç‰©ç†åœ°å€ä¸­çš„å†…å­˜ç©ºé—´ï¼Œè¢«åˆ’åˆ†æˆäº†å¤šä¸ªé¡µé¢ç©ºé—´ï¼Œéƒ½è¢«ç»„ç»‡æˆä¸ºå¤šä¸ªé¡µé¢å½¢åŠ¿ ä»Žé¡µé¢åˆ°é¡µæ¡†å®Œæˆæ˜ å°„çš„ ä¸€ä¸ªè¿›ç¨‹è¯»å–æ•°æ®æ—¶ï¼Œé¦–å…ˆéœ€è¦æŠŠæ•°æ®è½½å…¥åˆ°å†…å­˜ä¸­ã€‚é‡åˆ°ç»å¸¸è¢«è°ƒç”¨çš„æ•°æ®æ—¶ï¼Œå¯ä»¥é…ç½®ç¼“å­˜ å¦‚æžœç¼“å­˜ä¸æ–­çš„å‘½ä¸­ï¼Œåˆ™è¯´æ˜Žæ€§èƒ½å¯ä»¥ä¸æ–­çš„æé«˜ï¼Œå°†é¢‘ç¹è¢«è®¿é—®æ•°æ®æ”¾åˆ°CPUç¼“å­˜ä¸­ å¯¹äºŽCPUæ¥è¯´ï¼ŒCPUçš„ç¼“å­˜å¯¹æé«˜CPUçš„æ€§èƒ½æ˜¯è‡³å…³é‡è¦çš„ ç¼“å­˜ç©ºé—´é€šå¸¸æ˜¯æŒ‰å€ç›¸å·®çš„ TLB è½¬æ¢åŽå…ƒç¼“å­˜å™¨ page frame: huge page: ä½¿ç”¨å¤§é¡µï¼Œæ¥æå‡TLBçš„å‘½ä¸­çŽ‡ 0000 0001 0101 1111 cpu 1,3 ä¸¤ä¸­æ‹†ä¸­æ–¹æ³•ï¼Œæ‹¿æ—¶é—´æ¢ç©ºé—´ï¼Œæ‹¿ç©ºé—´æ¢æ—¶é—´ è¾ƒä¸“ä¸šçš„æœåŠ¡å™¨ä¸Šä¼šæœ‰NUMAçš„ç»“æž„ï¼Œéžä¸€è‡´å†…å­˜è®¿é—®ï¼ŒNUMAç»“æž„çš„å‰é¢˜æ˜¯ï¼Œè¦æœ‰å¤šé¢—CPU å°†è¿›ç¨‹å’ŒCPUå®Œæˆäº²å’Œæ€§ç»‘å®šï¼Œè¿›ç¨‹å‘½ä¸­CPUç¼“å­˜çš„å‘½ä¸­çŽ‡ï¼Œå°†ä¼šå˜çš„å¾ˆé«˜ CPUè°ƒä¼˜æ“ä½œ123456789101112131415161718# æŸ¥çœ‹å½“å‰è¿›å’Œè¿è¡Œåœ¨å“ªé¢—CPU# ps axo psr,comm,pid# cat /proc/cpuinfo# å®šä¹‰è¿›ç¨‹å·ä¸º 11215çš„è¿›ç¨‹ç»‘å®šåœ¨ç¬¬å››é¢—CPUä¸Š# taskset -p -c 3 11215 (ä¸ºä¸ªå‘½ä»¤çš„æ ¼å¼æ¯”è¾ƒè¯¡å¼‚) # taskset -p cpu1,cpu2,... pid # vim /boot/grup/grub.conf kernel è¡ŒåŠ ä¸Š isol = 2,3# cat /proc/interrupts # é€šå¸¸åº”è¯¥æŠŠ0å·éš”ç¦»å‡ºæ¥ï¼Œç¦»ç»™å†…æ ¸ä½¿ç”¨# ls /proc/irq/0/# cat /proc/irq/0/smp_affinity ffffffff,ffffffff è¡¨ç¤ºä»»æ„CPU# echo 1 &gt; /proc/irq/32/smp_affinity# cat /proc/irq/32/smp_affinity# cat # å¯¹äºŽç”Ÿäº§æ¥è¯´ï¼Œè¶Šç®€å•ï¼Œè¶Šæ ‡å‡†ä¼šå¥½# åŽ‹æ¦¨ç³»ç»Ÿèµ„æºï¼Œä¼šé€ æˆç³»ç»Ÿä¸ç¨³å®šçš„ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œä¸å»ºè®®è¿™æ ·åšçš„# nice, renice ç»å¸¸ç”¨åˆ°çš„è¿›ç¨‹ä¼˜å…ˆçº§çš„è°ƒæ•´ å®šä¹‰ä¸­æ–­ smp affinityy:1234# echo cpunumber ,.. &gt; /proc/irq/#/smp_affinity# è¿™é‡Œä½¿ç”¨çš„cpuåº”è¯¥ä¸ºisoicpusä¸­å®šä¹‰CPUé›†åˆä¹‹å¤–çš„å…¶å®ƒCPU# numa,numactl,numad å°½å¯èƒ½æŠŠè¿›ç¨‹ç»‘å®šåœ¨å•é¢—CPUä¸Š# å¯¹åŒä¸€ä¸ªè¿›ç¨‹æ¥è®²ï¼Œå¯èƒ½é€‚ç”¨çš„è°ƒåº¦å™¨æœ‰å¤šä¸ªï¼Œæœ‰å…¶ä¼˜å…ˆçº§è¾ƒé«˜çš„è°ƒåº¦æ¥å™¨æ¥è°ƒåº¦ 12345678910111213141516171819202122232425262728293031# SCHED_FIFO [1-99] chrt -f [1-99] /path/to/program arguments# SCHED_RR chrt -f [1-99] /path/to/program arguments# SCHED_NORMAL (100-139)è¿›ç¨‹çš„è°ƒåº¦ç±»åˆ«: SCHEd_FIFO, SCHED_RR:real-time SCHED_NORMAL, SCHED_OTHER: 100-139 nice,renice (å¯¹äºŽå·²å¯åŠ¨çš„è¿›ç¨‹ä½¿ç”¨reniceå¯åŠ¨)å»ºè®®ä½¿ç”¨CPU Utilizationå·¥å…·: htop,dstat,glances,sar w,uptime, vmstat 1 5 # sar -P all 1# iostat -c 1 2 # sysdig/proc,/sysDMA: ç›´æŽ¥å†…å­˜è®¿é—®CPUè·Ÿå¤–éƒ¨IOè®¾å¤‡äº¤äº’çš„æ–¹å¼: poll:è½®è¯¢ï¼Œå¿™ç­‰å¾… ä¸­æ–­:CPU: è°ƒä¼˜ cpu affinity ä¼˜å…ˆçº§è°ƒæ•´ cgroups,å†…å­˜: overcommit_memory msg shm è¡¥å……nginx ä¼˜åŒ–åŠ é€Ÿ ç»™Nginxä¸Š ngx_http_gzip_module è¿™ä¸ªæ¨¡å—;ç”¨ nginx -V å‘½ä»¤æŸ¥çœ‹ configure arguments æ˜¯å¦æœ‰æ²¡æœ‰çš„è¯éœ€è¦ç¼–è¯‘åŠ è½½è¿™ä¸ªæ¨¡å— 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# vim /usr/local/nginx/nginx.conf# åœ¨ httpd æ®µä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹gzip on;#è¯¥æŒ‡ä»¤ç”¨äºŽå¼€å¯æˆ–å…³é—­gzipæ¨¡å—(on/off)gzip_buffers 16 8k;#è®¾ç½®ç³»ç»ŸèŽ·å–å‡ ä¸ªå•ä½çš„ç¼“å­˜ç”¨äºŽå­˜å‚¨gzipçš„åŽ‹ç¼©ç»“æžœæ•°æ®æµã€‚16 8kä»£è¡¨ä»¥8kä¸ºå•ä½ï¼Œå®‰è£…åŽŸå§‹æ•°æ®å¤§å°ä»¥8kä¸ºå•ä½çš„16å€ç”³è¯·å†…å­˜gzip_comp_level 6;#gzipåŽ‹ç¼©æ¯”ï¼Œæ•°å€¼èŒƒå›´æ˜¯1-9ï¼Œ1åŽ‹ç¼©æ¯”æœ€å°ä½†å¤„ç†é€Ÿåº¦æœ€å¿«ï¼Œ9åŽ‹ç¼©æ¯”æœ€å¤§ä½†å¤„ç†é€Ÿåº¦æœ€æ…¢gzip_http_version 1.1;#è¯†åˆ«httpçš„åè®®ç‰ˆæœ¬gzip_min_length 256;#è®¾ç½®å…è®¸åŽ‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°ï¼Œé¡µé¢å­—èŠ‚æ•°ä»Žheaderå¤´å¾—content-lengthä¸­è¿›è¡ŒèŽ·å–ã€‚é»˜è®¤å€¼æ˜¯0ï¼Œä¸ç®¡é¡µé¢å¤šå¤§éƒ½åŽ‹ç¼©ã€‚è¿™é‡Œæˆ‘è®¾ç½®äº†ä¸º256gzip_proxied any;#è¿™é‡Œè®¾ç½®æ— è®ºheaderå¤´æ˜¯æ€Žä¹ˆæ ·ï¼Œéƒ½æ˜¯æ— æ¡ä»¶å¯ç”¨åŽ‹ç¼©gzip_vary on;#åœ¨http headerä¸­æ·»åŠ Vary: Accept-Encoding ,ç»™ä»£ç†æœåŠ¡å™¨ç”¨çš„gzip_types text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml text/javascript application/javascript application/x-javascript text/x-json application/json application/x-web-app-manifest+json text/css text/plain text/x-component font/opentype font/ttf application/x-font-ttf application/vnd.ms-fontobject image/x-icon;#è¿›è¡ŒåŽ‹ç¼©çš„æ–‡ä»¶ç±»åž‹,è¿™é‡Œç‰¹åˆ«æ·»åŠ äº†å¯¹å­—ä½“çš„æ–‡ä»¶ç±»åž‹gzip_disable "MSIE [1-6]\.(?!.*SV1)";#ç¦ç”¨IE 6 gzip# vim /etc/nginx/conf.d/ssjinyao.conf # åœ¨è™šæ‹Ÿä¸»æœºserver æ®µä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|flv|ico)$ &#123; expires 30d; access_log off;&#125;location ~ .*\.(eot|ttf|otf|woff|svg)$ &#123; expires 30d; access_log off;&#125;location ~ .*\.(js|css)?$ &#123; expires 7d; access_log off;&#125;]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[dockeråˆæ­¥ä½¿ç”¨]]></title>
    <url>%2F2017%2F10%2F27%2Fdocker%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Dockeråˆæ­¥ä½¿ç”¨ä¸€ã€è¯´æ˜Ž lxc linux container,openvz;å®¹å™¨ä¸­å„è™šæ‹Ÿæœºåªæœ‰ä¸€ä¸ªå†…æ ¸ï¼Œè€Œæ˜¯å¤šä¸ªç”¨æˆ·ç©ºé—´;åœ¨åº“ä¸­å®Œæˆè™šæ‹ŸåŒ–ï¼Œæ¯”å¦‚wine æˆ–è€…åœ¨windowsä¸­è¿è¡Œbash;åœ¨åº”ç”¨ç¨‹åºçš„è¿è¡Œçº§åˆ«æä¾›è™šæ‹ŸåŒ–ï¼Œæ¯”å¦‚jvm;pstree , pid ä¸º1 çš„è¿›ç¨‹ è¿™ä¸ªè¿›ç¨‹æ˜¯ç›´æŽ¥å’Œå†…æ ¸æ¥æ‰“äº¤é“çš„;å®¹å™¨ä¹‹é—´ï¼Œå’Œè™šæ‹Ÿæœºä¹‹é—´éš”ç¦»çš„æŠ€æœ¯;å®¹å™¨ä¹‹é—´çš„éš”ç¦»ç›¸å¯¹æ¯”è¾ƒå›°éš¾;NameSpace,ï¼ˆåç§°ç©ºé—´); å†…æ ¸çº§åˆ«ï¼ŒçŽ¯å¢ƒéš”ç¦» PID NameSpace: ç”¨äºŽéš”ç¦»pidå·çš„ Linux 2.6.24 PIDéš”ç¦»; Network NameSpace : Linux 2.6.29 ç½‘ç»œåç§°ç©ºé—´çš„éš”ç¦» ç½‘ç»œè®¾å¤‡ã€ç½‘ç»œæ ˆã€ç«¯å£ç­‰ç½‘ç»œè®¾å¤‡éš”ç¦»; User NameSpace: Linux ç”¨æˆ·ç©ºé—´çš„éš”ç¦» Linux 3.8 ç”šè‡³ 3.10ä¹‹åŽ ç”¨æˆ·å’Œç”¨æˆ·ç»„èµ„æºéš”ç¦»; IPC NameSpace: è¿›ç¨‹é—´é€šä¿¡æŠ€æœ¯ Linux 2.6.19 signal ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå…±äº«å†…å­˜çš„éš”ç¦»; UTS NameSpace: Linux 2.6.19 ï¼Œ ä¸»æœºåå’ŒåŸŸåçš„éš”ç¦»ï¼› Mount NameSpace: Linux 2.4.19 æŒ‚è½½ç‚¹ï¼ˆæ–‡ä»¶ç³»ç»Ÿ ï¼‰éš”ç¦»ï¼› API:clone()å®žçŽ°çº¿ç¨‹ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æ¥åˆ›å»ºæ–°çº¿ç¨‹; setns()è®¾å®šä¸€ä¸ªæ–°çš„å±žæ€§,å°†æŸ(è¿›ç¨‹|æˆ–è®¾å¤‡)åŠ å…¥åˆ°æ–°çš„NameSpaceä¸­åŽ»çš„; unshare()éžå…±äº«æœºåˆ¶ï¼Œè„±ç¦»NameSpaceï¼Œè€Œå…³è”è‡³æ–°NameSpace; å°†NameSpaceéš”ç¦»å¼€æ¥æ²¡æœ‰é—®é¢˜ï¼Œè€Œé—®é¢˜åœ¨äºŽï¼Œæ¶æ„ç”¨æˆ·å¼ºè¡Œè°ƒç”¨èµ„æºï¼Œä¸€ä¸ªç”¨æˆ·å®Œå…¨å¯ä»¥å°†ç³»ç»Ÿèµ„æºè€—å°½ï¼Œcpuå ç”¨è‡³100%; å› æ­¤å¸¦æ¥äº†å¦ä¸€ç§æœºåˆ¶çš„å‡ºçŽ°ï¼› CGroup: Linux Control Group,æŽ§åˆ¶ç»„ Linux 2.6.24è¢«æ”¶å…¥è¿›å†…æ ¸ å†…æ ¸çº§åˆ«ï¼Œé™åˆ¶ã€æŽ§åˆ¶ä¸Žä¸€ä¸ªè¿›ç¨‹ç»„ç¾¤çš„èµ„æºï¼› èµ„æºï¼šCPU,å†…å­˜ï¼ŒIO çº§åˆ«æ¥è¿›è¡Œå®šä¹‰ googleå·¥ç¨‹å¸ˆï¼š2006å¼€å§‹æ­¤æŠ€æœ¯ï¼Œå‘½ä»¤ä¸ºè¿›ç¨‹å®¹å™¨è€ŒåŽå‘½ä»¤ä¸ºCGroup åŠŸèƒ½ï¼š Resource limitation:èµ„æºé™åˆ¶ï¼› Prioritization:ä¼˜å…ˆçº§æŽ§åˆ¶ï¼› Accounting:å®¡è®¡å’Œç»Ÿè®¡ï¼Œä¸»è¦ä¸ºè®¡è´¹ï¼› Contorl:æŒ‚èµ·è¿›ç¨‹ï¼Œæ¢å¤è¿›ç¨‹ï¼› CGroup åŸºäºŽå•æ ¹å€’æ ‘çŠ¶ç»“æž„æ¥å®žçŽ° åœ¨CentOS7 ä¸­å¯ä»¥ç”¨mount å‘½ä»¤æ¥æŸ¥çœ‹å…¶èµ„æºç»„çš„éš”ç¦»æŠ€æœ¯å·²ç»è¢«ä½¿ç”¨ 1234567891011121314151617181920212223242526272829 /sys/fs/cgroup # mount # lssubsys -m ``` ### CGroupçš„å­ç³»ç»Ÿ:* blkio:è®¾å®šå—è®¾å¤‡çš„IOé™åˆ¶ï¼Œè€Œè®¾å®šçš„å­ç³»ç»Ÿï¼›* cpu:è®¾å®šCPUçš„é™åˆ¶ï¼›* cpuacct:æŠ¥å‘Šcgroupä¸­æ‰€ä½¿ç”¨çš„CPUèµ„æºï¼›* cpuset:ä¸ºcgroupä¸­çš„ä»»åŠ¡åˆ†é… CPUå’Œå†…å­˜èµ„æº ï¼›* memory:è®¾å®šå†…å­˜çš„ä½¿ç”¨é™åˆ¶ï¼›* devices:æŽ§åˆ¶cgroupä¸­çš„ä»»åŠ¡å¯¹è®¾å¤‡çš„è®¿é—®èƒ½åŠ¡ï¼›* freezer: æŒ‚èµ·å’Œæ¢å¤cgroupä¸­çš„ä»»åŠ¡ï¼› * net_cls:(classid) ï¼Œä½¿ç”¨ç­‰çº§çº§åˆ«æ ‡è¯†ç¬¦æ¥æ ‡è®°ç½‘ç»œæ•°æ®åŒ…ï¼›* tc: æµé‡æ•´å½¢å‘½ä»¤ ï¼›* perf_event:å¯¹ç”¨æˆ·ç©ºé—´ä¸­ä»»åŠ¡ï¼Œå¯¹ç”¨æˆ·ç©ºé—´äº§ç”Ÿçš„è¿›ç¨‹è¿›è¡Œåˆ†ç±»ï¼›* ä½¿ç”¨åŽä½¿cgrupä¸­çš„ä»»åŠ¡å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„æ€§èƒ½æµ‹è¯•ï¼› * hugetlb:è½¬æ¢åŽå…ƒç¼“å†²åŒºï¼Œå¯¹HugeTLBå­ç³»ç»Ÿè¿›è¡Œé™åˆ¶ï¼›### CGroupä¸­çš„æœ¯è¯­ï¼š* task(ä»»åŠ¡)ï¼šè¿›ç¨‹æˆ–çº¿ç¨‹ï¼›* cgroup:ä¸€ä¸ªç‹¬ç«‹çš„èµ„æºæŽ§åˆ¶å•ä½ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå­ç³»ç»Ÿï¼›* subsystem:å­ç³»ç»Ÿï¼Œ* hierarchy:å±‚çº§* AUFS:UnionFSï¼š* UnionFSï¼šæŠŠä¸åŒçš„ç‰©ç†ä½ç½®çš„ç›®å½•åˆå¹¶åˆ°åŒä¸€ä¸ªç›®å½•ä¸­ã€‚* Another UFS,Alternative UFS,Adanced UFS å‡ ä¹Žå®Œå…¨é‡å†™äº†unix FS ```bash# tc # lssubsys -m Device mapper: linux 2.6å†…æ ¸å¼•å…¥çš„æœ€é‡è¦çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œç”¨äºŽåœ¨å†…æ ¸ä¸­æ”¯æŒé€»è¾‘å·ç®¡ç†çš„é€šç”¨è®¾å¤‡æ˜ å°„æŠ€æœ¯ï¼› Mapped Device Mapping Table Target Device åœ¨å†…æ ¸ç©ºé—´åªèƒ½å¼€å¯ä¸€ä¸ªç«¯ï¼Œä½†æ˜¯å¯ä»¥æ˜ å°„è‡³å…¶å®ƒçš„ç”¨æˆ·ç©ºé—´ Device mapper: Linux2.6 å†…æ ¸å¼•å…¥çš„æœ€é‡è¦çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œç”¨äºŽåœ¨å†…æ ¸ ä¸­æ”¯æŒé€»è¾‘å·ç®¡ç†çš„é€šç”¨è®¾å¤‡æ˜ å°„æœºåˆ¶ï¼› Mapped Device Mapping Table Target Device Docker 2013,GO,Apache 2.0,dotCloudC/S: Docker Client:å‘èµ·dockerç›¸å…³çš„è¯·æ±‚ Docker Server:çª—å£è¿è¡Œçš„èŠ‚ç‚¹ï¼› Containers å®¹å™¨ images dockeræ˜ åƒæ–‡ä»¶ â€“&gt; å­˜äºŽä»“åº“ä¹‹ä¸­ å¯åŠ¨dockerå®¹å™¨éœ€è¦åŠ è½½é•œåƒæ–‡ä»¶ â€“&gt; dockerä»“åº“ä¸Šçš„é•œåƒåŠ è½½è¿›æ¥ dockerå…è®¸æˆ‘ä»¬åˆ›å»ºç§æœ‰ä»“åº“ æ¯”è¾ƒéš¾çš„ï¼Œå¦‚ä½•åˆ›å»ºæ˜ åƒæ–‡ä»¶ dockerfile: namespace cgroup è§£å†³æ–¹æ¡ˆ lxc,openvzlxc,linux containerlibcontainerHost OS â€“&gt; hypervisor â€“&gt; Guest OSHost OS â€“&gt; hpervisor â€“&gt; user spaceï¼ˆnä¸ªï¼‰ æ ¸å¿ƒç»„ä»¶ï¼š docker clientï¼šdockerçš„å®¢æˆ·ç«¯å·¥å…·ï¼Œæ˜¯ç”¨æˆ·ä½¿ç”¨dockerçš„ä¸»è¦æŽ¥å£ï¼Œdocker client ä¸Ždocker daemoné€šä¿¡å¹¶å°†ç»“æžœè¿”å›žç»™ç”¨æˆ·docker deamon:è¿è¡ŒäºŽå®¿ä¸»æœºä¸Šï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹ ï¼Œç”¨æˆ·å¯é€šè¿‡docker clientå…¶äº¤äº’image:é•œåƒæ–‡ä»¶æ˜¯åªè¯»çš„ï¼›ç”¨æ¥åˆ›å»ºcontainer,ä¸€ä¸ªé•œåƒå¯ä»¥è¿è¡Œå¤šä¸ªcontaineré•œåƒæ–‡ä»¶å¯ä»¥é€šDockerfileæ–‡ä»¶æ¥åˆ›å»ºï¼Œå¯ä»¥ä»Ždocker hub/registryä¸‹è½½ï¼› repository å…¬å…±ä»“åº“:Docker hub/registryç§æœ‰ä»“åº“:docker registryä»“åº“å¯ä»¥å­˜æœ‰:nginx image httpd image tomcat imagedocker container: dockerçš„è¿è¡Œå®žä¾‹ï¼Œå®¹å™¨æ˜¯ä¸€ä¸ªéš”ç¦»çŽ¯å¢ƒï¼› å¦å¤–ä¸¤ä¸ªé‡è¦ç»„ä»¶ï¼š docker link: å„dockerå®¹å™¨è¿™é—´èƒ½å¤Ÿé€šä¿¡ docker volume: äºŒã€Docker YUMæºçš„å®‰è£…é…ç½®å®‰è£…ä½¿ç”¨docker é€šè¿‡ä½¿ç”¨epelæºæ¥å®žçŽ°ï¼Œ CentOS7 è‡ªå¸¦çš„å°±æœ‰äº†1234567891011121314151617181920212223242526dockerfile è‡ªå®šä¹‰çš„docker æº [root@node1 ~]# vim /etc/yum.repos.d/docker.repo [dockerrepo] name=Docker Repository baseurl=https://yum.dockerproject.org/repo/main/centos/$releasever/ gpgcheck=1 gpgkey=https://yum.dockerproject.org/gpg [jin] name=renjin2 baseurl=https://mirrors.aliyun.com/centos/7/os/x86_64/ gpgcheck=0 enabled=1 [extra] name=renjin3 baseurl=https://mirrors.aliyun.com/centos/7/extras/x86_64/ gpgcheck=0 enabled=1 [epel] name=renji4 baseurl=https://mirrors.aliyun.com/epel/7Server/x86_64/ gpgcheck=0 enabled=1 æˆ–è€…å¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„æº https://mirrors.aliyun.com/centos/7.2.1511/extras/x86_64 æŸ¥çœ‹dockerç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ 1234567891011121314151617181920212223[root@node1 ~]# yum info docker-engineLoaded plugins: fastestmirror, langpacksLoading mirror speeds from cached hostfileInstalled PackagesName : docker-engineArch : x86_64Version : 17.04.0.ceRelease : 1.el7.centosSize : 63 MRepo : installedFrom repo : dockerrepoSummary : The open-source application container engineURL : https://dockerproject.orgLicense : ASL 2.0Description : Docker is an open source project to build, ship and run any application as a : lightweight container. : : Docker containers are both hardware-agnostic and platform-agnostic. This means : they can run anywhere, from your laptop to the largest EC2 compute instance and : everything in between - and they don't require you to use a particular : language, framework or packaging system. That makes them great building blocks : for deploying and scaling web apps, databases, and backend services without : depending on a particular stack or provider. 12[root@node1 ~]# yum -y install docker-engine[root@node1 ~]# systemctl start docker.service ä¸‰ã€Dcoker çš„ç®€å•æµ‹è¯•åŠä½¿ç”¨1234567891011121314151617181920212223242526272829[root@node1 ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE[root@node1 ~]# docker search centosNAME DESCRIPTION STARS OFFICIAL AUTOMATEDcentos The official build of CentOS. 3239 [OK] jdeathe/centos-ssh CentOS-6 6.8 x86_64 / CentOS-7 7.3.1611 x8... 63 [OK]jdeathe/centos-ssh-apache-php CentOS-6 6.8 x86_64 - Apache / PHP-FPM / P... 25 [OK]consol/centos-xfce-vnc Centos container with "headless" VNC sessi... 24 [OK]nimmis/java-centos This is docker images of CentOS 7 with dif... 24 [OK]gluster/gluster-centos Official GlusterFS Image [ CentOS-7 + Glu... 18 [OK]million12/centos-supervisor Base CentOS-7 with supervisord launcher, h... 15 [OK]torusware/speedus-centos Always updated official CentOS docker imag... 8 [OK]egyptianbman/docker-centos-nginx-php A simple and highly configurable docker co... 6 [OK]nathonfowlie/centos-jre Latest CentOS image with the JRE pre-insta... 5 [OK]centos/mariadb55-centos7 4 [OK]centos/redis Redis built for CentOS 2 [OK]harisekhon/centos-java Java on CentOS (OpenJDK, tags jre/jdk7-8) 2 [OK]harisekhon/centos-scala Scala + CentOS (OpenJDK tags 2.10-jre7 - 2... 2 [OK]blacklabelops/centos CentOS Base Image! Built and Updates Daily! 1 [OK]darksheer/centos Base Centos Image -- Updated hourly 1 [OK]freenas/centos Simple CentOS Linux interactive container 1 [OK]timhughes/centos Centos with systemd installed and running 1 [OK]januswel/centos yum update-ed CentOS image 0 [OK]kz8s/centos Official CentOS plus epel-release 0 [OK]grayzone/centos auto build for centos. 0 [OK]repositoryjp/centos Docker Image for CentOS. 0 [OK]otagoweb/centos Apache (with PHP7), built on CentOS 7 0 [OK]vcatechnology/centos A CentOS Image which is updated daily 0 [OK]grossws/centos CentOS 6 and 7 base images with gosu and l... 0 [OK] ä¹‹æ‰€ä»¥èƒ½æœç´¢å‡ºæ¥ï¼Œæ˜¯å› ä¸ºåˆ«äººç»™æˆ‘ä»¬åšäº†å…¬å¼€çš„ä½¿ç”¨123456789101112131415161718192021222324252627[root@node1 ~]# docker search busyboxNAME DESCRIPTION STARS OFFICIAL AUTOMATEDbusybox Busybox base image. 973 [OK] progrium/busybox 65 [OK]radial/busyboxplus Full-chain, Internet enabled, busybox made... 12 [OK]container4armhf/armhf-busybox Automated build of Busybox for armhf devic... 6 [OK]odise/busybox-python 4 [OK]multiarch/busybox multiarch ports of ubuntu-debootstrap 2 [OK]azukiapp/busybox This image is meant to be used as the base... 2 [OK]ofayau/busybox-jvm Prepare busybox to install a 32 bits JVM. 2 [OK]zanner/busybox https://github.com/sergej-kucharev/zanner-... 1 [OK]ofayau/busybox-libc32 Busybox with 32 bits (and 64 bits) libs 1 [OK]elektritter/busybox-teamspeak Leightweight teamspeak3 container based on... 1 [OK]getblank/busybox Docker container busybox for Blank 1 [OK]prom/busybox Prometheus Busybox Docker base images 1 [OK]skomma/busybox-data Docker image suitable for data volume cont... 1 [OK]odise/busybox-curl 1 [OK]jahroots/busybox Busybox containers 0 [OK]ggtools/busybox-ubuntu Busybox ubuntu version with extra goodies 0 [OK]cucy/busybox aouto build busybox 0 [OK]freenas/busybox Simple Busybox interactive Linux container 0 [OK]sdurrheimer/prom-busybox Moved to https://hub.docker.com/r/prom/bus... 0 [OK]jiangshouzhuang/busybox busybox 0 [OK]padcom/busybox-java Oracle Java on BusyBox 0 [OK]futurenda/busybox Mini busybox 0 [OK]hongtao12310/busybox for busybox image based on the gcr.io/goog... 0 [OK]ddn0/busybox fork of official busybox 0 [OK] 12345678910 [root@node1 ~]# docker pull buxybox [root@node1 ~]# docker pull busybox Using default tag: latest latest: Pulling from library/busybox 7520415ce762: Pull complete Digest: sha256:32f093055929dbc23dec4d03e09dfe971f5973a9ca5cf059cbfb644c206aa83f æ ¡éªŒç  Status: Downloaded newer image for busybox:latest[root@node1 ~]# docker pull hub.magedu.com:5000/busybox ##æŒ‡å®šåˆ°å“ªå°æœåŠ¡å™¨ä¸ŠèŽ·å–busybox [root@node1 ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE busybox latest 00f017a8c2a6 3 weeks ago 1.11MB 123456[root@node1 ~]# docker run -it busybox:latest /bin/sh ##å¯åŠ¨ä¸€å°è™šæ‹Ÿæœºçš„å®žä¾‹ / # lsbin dev etc home proc root sys tmp usr var[root@node1 ~]# docker ps ##æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ä¸»æœºCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES7090d8fd9861 busybox:latest "/bin/sh" 2 minutes ago Up 2 minutes boring_archimedes å››ã€ dockerçš„å¸¸ç”¨å‘½ä»¤æ€»ç»“çŽ¯å¢ƒä¿¡æ¯ç›¸å…³ï¼š info version 12[root@node1 ~]# docker info ##æŸ¥çœ‹dockerçš„çŽ¯å¢ƒä¿¡æ¯[root@node1 ~]# docker version ##æŸ¥çœ‹dockerçš„ç‰ˆæœ¬å· ç³»ç»Ÿç»´æŠ¤ç›¸å…³ï¼š images inspect build åˆ›å»ºæ˜ åƒæ–‡ä»¶ commint åŸºäºŽè¿è¡Œä¸­çš„å®¹å™¨åˆ›å»ºæ˜ åƒæ–‡ä»¶ pause/unpause ps rm rmi run start/stop/restart top kill æ—¥å¿—ä¿¡æ¯ç›¸å…³ï¼š events history logs Docer hubæœåŠ¡ç›¸å…³ login logout pull push search åŸºæœ¬æ“ä½œï¼š èŽ·å–æ˜ åƒ:pull å¯åŠ¨å®¹å™¨:run 1234567891011121314151617181920212223242526272829303132333435 [root@node1 ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 7090d8fd9861 busybox:latest "/bin/sh" 17 minutes ago Up 17 minutes boring_archimedes [root@node1 ~]# docker kill 7090d8fd9861 7090d8fd9861 [root@node1 ~]# docker ps #ç»“æŸä¸€ä¸ªdockerè¿›ç¨‹ CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES [root@node1 ~]# docker ps -a #ä½†ä¸ä¼šåˆ é™¤å®¹å™¨ CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 7090d8fd9861 busybox:latest "/bin/sh" 20 minutes ago Exited (137) 3 minutes ago boring_archimedes [root@node1 ~]# docker rm 7090d8fd9861 #æ­¤æ—¶ä¼šåˆ é™¤container 7090d8fd9861 [root@node1 ~]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES [root@node1 ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2bca1aa3d38d busybox:latest "/bin/sh" 4 minutes ago Up 4 minutes naughty_goldberg[root@node1 ~]# docker docker docker-containerd-ctr dockerd docker-proxy docker-containerd docker-containerd-shim docker-init docker-runc[root@node1 ~]# docker commit 2bca1aa3d38d centos:newuser sha256:08d1d05a6e490c31b0e4e3ffb9532a25bb3d9e8f588b30990338f1ae64b34286[root@node1 ~]# docker docker docker-containerd-ctr dockerd docker-proxy docker-containerd docker-containerd-shim docker-init docker-runc[root@node1 ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE centos newuser 08d1d05a6e49 9 seconds ago 1.11MB busybox latest 00f017a8c2a6 3 weeks ago 1.11MB[root@node1 ~]# docker run -it --rm centos:newuser /bin/sh / # [root@node1 ~]# docker kill fee1da85d418 fee1da85d418[root@node1 ~]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES linux Kernel â€“&gt; libcontainer â€“&gt; (execdriverã€networkdriver)â€“&gt; Docker Daemon (GraphDB) â€“&gt; API server â€“&gt; ç”¨æˆ·åœ¨docker ä¹‹å¤–æœ‰ä¸ªé‡è¦å­˜å‚¨è¿˜éœ€è¦GraphDB GraphDBä¹Ÿç§°ä¸ºå›¾å¼æ•°æ®åº“ Dockeråº”ç”¨ï¼š é•œåƒï¼šåŒ…å«äº†å¯åŠ¨Dockerå®¹å™¨æ‰€éœ€è¦çš„æ–‡ä»¶ç³»ç»Ÿå±‚ç»™åŠå…¶å†…å®¹ï¼› åŸºäºŽUninFSé‡‡ç”¨åˆ†å±‚ç»“æž„å®žçŽ°; bootfs,rootfs; registry:ç”¨äºŽä¿å­˜é•œåƒçš„å…ƒæ•°æ®,ä¿å­˜dockeré•œåƒå±‚æ¬¡ç»“æž„å’Œå…ƒæ•°æ®ï¼› reposistory:ç”±å…·æœ‰æŸä¸ªåŠŸèƒ½çš„é•œåƒçš„æ‰€æœ‰ç›¸å…³ç‰ˆæœ¬æž„å»ºæˆçš„é›†åˆï¼› index:ç®¡ç†ç”¨æˆ·çš„è´¦å·ã€è®¿é—®æƒé™ã€é•œåƒåŠé•œåƒæ ‡ç­¾ç­‰ç­‰ç›¸å…³çš„; graph:ä»Žregistryä¸­ä¸‹è½½çš„Dockeré•œåƒéœ€è¦ä¿å­˜åœ¨æœ¬åœ°ï¼Œæ­¤åŠŸèƒ½å³ç”±graphå®Œæˆï¼› /var/lib/docker/graph; ##ä¸Žé•œåƒç›¸å…³çš„å‘½ä»¤ï¼š docker images åˆ—å‡ºæœ¬åœ°çš„é•œåƒ docker search æœç´¢ docker pull ä¸‹è½½é•œåƒ docker push ä¸Šä¼ é•œåƒ docker login ç™»å½• docker logout ç™»å‡º åˆ›å»ºé•œåƒï¼šcommint,build åˆ é™¤æœ¬åœ°é•œåƒ: rmi å®¹å™¨ï¼šä¹Ÿå¯ä»¥æƒ³è±¡æˆä¸€ä¸ªè™šæ‹Ÿæœº ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ï¼Œä»¥åŠå®ƒä»¬è¿è¡Œçš„çŽ¯å¢ƒ å‘½ä»¤ï¼š run,kill,stop,start,restart ,log,export,import å¯åŠ¨æ–¹æ³•: é€šè¿‡é•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨: run å¯åŠ¨ä¸€ä¸ªå¤„äºŽåœæ­¢çŠ¶æ€çš„å®¹å™¨: start å®¹å™¨æœ¬æ¥å°±æ˜¯åº”ç”¨çš„ï¼Œå½“åº”ç”¨ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿä¼šç»“æŸçš„ï¼›123456[root@node1 ~]# docker run busybox:latest /bin/echo "hello world" hello world[root@node1 ~]# docker run -it --name=busybox busybox:latest /bin/sh[root@node1 ~]# docker stop busybox ##æ­£å¸¸åœæ­¢ä¸€ä¸ªå®¹å™¨ï¼Œç›¸å½“äºŽæ­£å¸¸å…³æœº busybox runå‘½ä»¤: â€“name= Assign a name to the container-i,â€“interactive=false Keep STDIN open even if not attachedit,-tty=false Alocate a pseudo-TTYâ€“net=default Set the Network for the container æ­¥éª¤ï¼š æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨åˆ™ä»Žregistryä¸‹è½½ï¼›åˆ©ç”¨é•œåƒå¯åŠ¨å®¹å™¨åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”åœ¨åªè¯»çš„é•œåƒå±‚ä¹‹å¤–ï¼ŒæŒ‚è½½ä¸€ä¸ªå¯è¯»å†™å±‚ï¼›ä»Žå®¿ä¸»æœºé…ç½®çš„ç½‘æ¡¥å£ä¸­ï¼Œæ¡¥æŽ¥ä¸€ä¸ªè™šæ‹ŸæŽ¥å£ç»™æ­¤å®¹å™¨;ä»Žåœ°å€æ± ä¸­åˆ†é…ä¸€ä¸ªåœ°å€å®¹å™¨ï¼›æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åºï¼›ç¨‹åºæ‰§è¡Œå®ŒæˆåŽï¼Œå®¹å™¨å³ç»ˆæ­¢ï¼›logså‘½ä»¤:èŽ·å–ä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—ï¼ŒèŽ·å–å…¶è¾“å‡ºä¿¡æ¯;å¯¹äºŽäº¤äº’å¼æ¨¡å¼å¯åŠ¨çš„å®¹å™¨ï¼Œç»ˆæ­¢å¯ä»¥ä½¿ç”¨exit å‘½ä»¤æˆ–ctrl+dç»„åˆé”®; attach é™„åŠ è‡³ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ï¼›123456789101112[root@node1 ~]# docker start 31a67d66b2c2[root@node1 ~]# docker attach busybox[root@node1 ~]# docker run busybox:latest /bin/echo "hello world"[root@node1 ~]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES d35a2673722e busybox:latest "/bin/echo 'hello ..." 13 seconds ago Exited (0) 12 seconds [root@node1 ~]# docker start d35a2673722e d35a2673722e[root@node1 ~]# docker logs cabd0e52f8f8 ##å¯ä»¥æŸ¥çœ‹æ‰§è¡Œå‘½ä»¤åŽçš„è¾“å‡ºä¿¡æ¯ hello world hello world hello world 12345678910111213141516171819202122232425262728293031 / # exit ç»ˆæ­¢å½“å‰å®¹å™¨ æˆ–è€…ctrl +d attach [root@node1 ~]# docker start -i busybox ##å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ä¸€ä¸ªæŽ¥å£ [root@node1 ~]# docker start busybox [root@node1 ~]# docker attach busybox ##é™„åŠ è‡³ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ï¼› / # ``` ## Docker Hub * registryæœ‰ä¸¤ç§* docker hub* private registry```bash # docker login # docker push busybox:latest [root@node2 yum.repos.d]# yum -y install docker-registry ä¸Šæ¡å‘½ä»¤å®žè´¨ä¸Šå®‰è£…çš„æ˜¯å¦å¤–çš„ä¸€ä¸ªåŒ… [root@node2 yum.repos.d]# yum -y installdocker-distribution-2.6.0-1.el7.x86_64 [root@node1 yum.repos.d]# systemctl start docker-distribution.service [root@node1 yum.repos.d]# ss -tnl | grep 5000 LISTEN 0 128 :::5000 :::* [root@node1 yum.repos.d]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE centos newuser 08d1d05a6e49 2 weeks ago 1.11MB centos latest 98d35105a391 5 weeks ago 192MB busybox latest 00f017a8c2a6 6 weeks ago 1.11MB [root@node1 yum.repos.d]# [root@node1 yum.repos.d]# docker tag 08d1d05a6e49 192.168.99.15:5000/centos:1.2.1 ç»™ä¸€ä¸ªé•œåƒæ‰“æ ‡ç­¾ [root@node1 yum.repos.d]# docker push 192.168.99.15:5000/centos:1.2.1]]></content>
  </entry>
  <entry>
    <title><![CDATA[ldirectord+ipvsadmä¹‹nat/dræ¨¡åž‹çš„å®žçŽ°]]></title>
    <url>%2F2017%2F10%2F26%2Fldirectord-ipvsadm%E4%B9%8Bnat-dr%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[ldirectord ç»“åˆipvsadm é…ç½®nat,dræ¨¡åž‹ä¸€ã€natæ¨¡åž‹ drector 1234# wget ftp://172.16.0.1/pub/Sources/7.x86_64/crmsh/ldirectord-3.9.6-0rc1.1.1.x86_64.rpm# yum -y install nginx (åŒæ—¶ç”¨äºŽåšä¸ºsorryä¸»æœº)# yum -y install ldirectord-3.9.6-0rc1.1.1.x86_64.rpm# echo â€œsorry, the service is down for maintenance, is recoveringâ€ &gt; /usr/share/nginx/html/index.html ä¸»æœºä¸ºä¸¤å—ç½‘å¡ï¼Œ ä¸€ä¸ªæ˜¯æ¡¥æŽ¥ï¼Œä¸€ä¸ªä»…ä¸»æœº (å…¶ä¸­ä»…ä¸»æœºçš„é…ç½®é™æ€åœ°å€ä¸º192.16.0.5) å¼€å¯æ ¸å¿ƒè½¬å‘åŠŸèƒ½ 1234# echo 1 &gt; /proc/sys/net/ipv4/ip_forward nodeff1# yum -y install httpd # echo â€œ&lt;h1&gt;RS1&lt;/h1&gt;â€ &gt; /var/www/html/index.html ä¸»æœºä¸ºä¸€å—ç½‘å¡ï¼Œä»…ä¸»æœºï¼ˆé…ç½®é™æ€åœ°å€ä¸º192.16.0.2ï¼‰ç½‘å…³æŒ‡å‘ 192.16.0.51234# route add default gw 192.16.0.5 node2 # yum -y install nginx # echo â€œ&lt;h1&gt;RS2&lt;/h1&gt;â€ &gt; /var/www/html/index.html ä¸»æœºä¸ºä¸€å—ç½‘å¡ï¼Œä»…ä¸»æœºï¼ˆé…ç½®é™æ€åœ°å€ä¸º192.16.0.3ï¼‰ç½‘å…³æŒ‡å‘ 192.16.0.51# route add default gw 192.16.0.5 directory æ­¤æ—¶:å¯ä»¥åœ¨drectorä¸»æœºä¸Šè¿›è¡Œæµ‹è¯•ï¼Œ12# curl 192.16.0.2 è¿”å›žRS1 # curl 192.16.0.3 è¿”å›žRS2 directory ä½¿ç”¨ipvsadmæŒ‡å®šè°ƒåº¦ç®—æ³•åŠè°ƒåº¦ä¸»æœºï¼›123# ipvsadm -A -t 172.16.250.89:80 -wrr # ipvsadm -a -t 172.16.250.89:80 -r 192.16.0.2:80 -m -w 3 # ipvsadm -a -t 172.16.250.89:80 -r 192.16.0.3:80 -m -w 1 åœ¨åˆ«çš„ä¸»æœºä¸­æµ‹è¯•ç»“æžœ123456# for i in &#123;1..4&#125; ; do curl 172.16.250.89; done &lt;h1&gt;RS1&lt;/h1&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h1&gt;&lt;h1&gt;RS1&lt;/h1&gt;# å°†è§„åˆ™ä¿å­˜ ipvsadm -S &gt; /etc/sysconfig/ipvsadm directory é…ç½®ldirectord 1234567891011121314151617# cp /usr/share/doc/ldirectord-3.9.6/ldirectord.cf /etc/ha.d/ldirectord.cf # vim /etc/ha.d/ldirectord.cf checktimeout=3checkinterval=1fallback=127.0.0.1:80autoreload=yeslogfile=â€/var/log/ldirectord.logâ€quiescent=novirtual=172.16.250.89:80 real=192.16.0.2:80 masq 1real=192.16.0.3:80 masq 3fallback=127.0.0.1:80 masqservice=httpscheduler=wrrprotocol=tcpchecktype=negotiatecheckport=80 æ³¨ï¼švirtual:172.16.250.89:80 ï¼ŒåŽé¢éœ€è¦æŒ‡å®šç«¯å£ï¼Œå¦åˆ™protocol=tcpæŒ‡å®šå¯åŠ¨æ—¶ä¼šæŠ¥é”™real=192.16.0.2:80 masq å› ä¸ºä¸Šé¢é…ç½®çš„ä¸ºnatæ¨¡åž‹ï¼Œæ‰€ä»¥æ­¤å¤„ä½¿ç”¨masqfallback=172.0.0.1:80 æ­¤å¤„ä¾¿æ˜¯nginxçš„sorry server,ä½†æ‰€æœ‰ç»“ç‚¹éƒ½åœæŽ‰æ—¶ï¼Œä¼šå‘ç”¨æˆ·æä¾›ä¸€ä¸ªsorry server12345678910# systemctl start ldirectord # ipvsadm -Ln æŸ¥çœ‹ç»“ç‚¹ åœ¨åˆ«çš„ä¸»æœºä¸­æµ‹è¯• #for i in &#123;1..4&#125; ; do curl 172.16.250.89; done &lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h1&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;node1,node2 å°†ä¸¤ä¸ªç»“ç‚¹æ‰‹åŠ¨åœæŽ‰# systemctl stop httpd åœ¨æµ‹è¯•ä¸»æœºä¸­ä¼šè¿”å›žsorryä¿¡æ¯ äºŒã€dr æ¨¡åž‹ directory ,node1 ,node2 ä¸‰å°ä¸»æœºéƒ½æ˜¯ä¸€å—ç½‘å—ï¼Œ å¹¶ä¸”ç½‘å¡éƒ½ä¸ºæ¡¥æŽ¥ï¼Œä¸”node1,nod2ï¼Œä¸éœ€è¦æŒ‡å®šç½‘å…³ç¼–å†™è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839#vim setkp.sh #!/bin/bash vip=172.16.252.166mask=255.255.255.255interface=â€™lo:0â€²eth=â€™eno16777736:0â€² case $1 in start) echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignoreecho 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignoreecho 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announceecho 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announceifconfig $interface $vip netmask $mask broadcast $vip up route add -host $vip dev $interface ;; dstart) ifconfig $eth $vip/32 netmask $mask broadcast $vip up;;dstop)ifconfig $eth down;;stop)ifconfig $interface down echo 0 &gt; /proc/sys/net/ipv4/conf/all/arp_ignoreecho 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignoreecho 0 &gt; /proc/sys/net/ipv4/conf/all/arp_announceecho 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce;; status) ifconfig cat /proc/sys/net/ipv4/conf/all/arp_ignorecat /proc/sys/net/ipv4/conf/lo/arp_ignorecat /proc/sys/net/ipv4/conf/all/arp_announcecat /proc/sys/net/ipv4/conf/lo/arp_announce;; *)echo â€œUsage: $(basename $0) &#123;dstart|dstop|start|stop&#125;â€exit 1 esac åœ¨directorä¸»æœºä¸­æ‰§è¡Œ123456789# sh setkp.sh dstart # sh setkp.sh status æŸ¥çœ‹çŠ¶æ€# scp setkp.sh 172.16.251.232:/root# scp setkp.sh 172.16.251.191:/root # ipvsadm -A -t 172.16.252.166:http -s wrr# ipvsadm -a -t 172.16.252.166:http -r 172.16.251.232:http -g -w 1# ipvsadm -a -t 172.16.252.166:http -r 172.16.251.191:http -g -w 3# systemctl start nginx # echo â€œSorry Pageâ€ &gt; /usr/share/nginx/html/index.html åœ¨node1ä¸»æœºä¸­æ‰§è¡Œ1234# sh setkp.sh start # sh setkp.sh status # systemctl start httpd echo â€œ&lt;h1&gt;NODE1&lt;/h1&gt;â€ &gt; /var/www/html/index.html åœ¨node2ä¸»æœºä¸­æ‰§è¡Œ1234# sh setkp.sh start# sh setkp.sh status # systemctl start httpd echo â€œ&lt;h2&gt;NODE2&lt;/h2&gt;â€ &gt; /var/www/html/index.html åœ¨å…¶å®ƒä¸»æœºä¸­è¿›è¡Œæµ‹è¯•12345#for i in &#123;1..4&#125; ; do curl 172.16.252.166; done &lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt; ldirectordé…ç½® 123456789101112131415161718# cat /etc/ha.d/ldirectord.cf | grep -v â€œ^[[:space:]]*#â€ | grep -v â€œ^[[:space:]]*$â€ # vim /etc/ha.d/ldirectord.cf checktimeout=3checkinterval=1fallback=127.0.0.1:80autoreload=yeslogfile=â€/var/log/ldirectord.logâ€quiescent=novirtual=172.16.252.166:80real=172.16.251.191:80 gate 1real=172.16.251.232:80 gate 3fallback=127.0.0.1:80 gateservice=httpscheduler=wrrprotocol=tcpchecktype=negotiatecheckport=80# systemctl start ldirectord åœ¨å…¶å®ƒä¸»æœºä¸­è¿›è¡Œæµ‹è¯•123456789101112# for i in &#123;1..4&#125; ; do curl 172.16.252.166; done &lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;å½“ä¸»æœºæ‰€æœ‰ç»“ç‚¹éƒ½åœæ­¢æœåŠ¡æ—¶ ï¼ˆnode1,node2ï¼‰# systemctl stop httpd # for i in &#123;1..4&#125; ; do curl 172.16.252.166; done Sorry PageSorry PageSorry PageSorry Page å€ŸåŠ©é˜²ç«å¢™æ ‡è®°æ¥åˆ†ç±»æŠ¥æ–‡,è€ŒåŽæ ‡è®°å®šä¹‰é›†ç¾¤æœåŠ¡ï¼Œè¿™æ ·ä¸åŒçš„æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé›†ç¾¤è¿›è¡Œè°ƒåº¦,å¹¶å¯ç”¨æŒä¹…è¿žæŽ¥ å°†ä¸¤å°nodeç»“ç‚¹å¯åŠ¨ 1# systemctl start httpd åœ¨directorä¸»æœºä¸­é…ç½®1234# iptables -t mangle -A PREROUTING -d 172.16.252.166 -p tcp -m multiport â€“dport 80,443 -j MARK â€“set-mark 10 ä¸ºç«¯å£æ‰“æ ‡è®° # ipvsadm -A -f 10 -s rr -p 360# ipvsadm -a -f 10 -r 172.16.251.191:0 -g -w 1# ipvsadm -a -f 10 -r 172.16.251.232:0 -g -w 1 åœ¨å…¶å®ƒä¸»æœºä¸­è¿›è¡Œæµ‹è¯•123456# for i in &#123;1..5&#125; ; do curl 172.16.252.166; done &lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt; åœ¨ä¸¤å°nodeç»“ç‚¹ä¸Šå»ºç«‹httpsæœåŠ¡123456nod1 # mkdir /etc/httpd/cacert # cd /etc/httpd/cacert # (umask 066;openssl genrsa -out httpd.key 1024)# openssl req -new -key httpd.key -out httpd.crt -days 7200# scp httpd.csr 172.16.252.162:/root åœ¨directorä¸»æœºä¸­ç”Ÿæˆè‡ªç­¾è¯ä¹¦12345678# echo 01 &gt; /etc/pki/CA/serial# touch /etc/pki/CA/index.txt # cd /etc/pki/CA/# (umask 077; openssl genrsa -out /etc/pki/CA/private/cakey.pem 2048)# openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -days 7300 -out /etc/pki/CA/cacert.pem# openssl ca -in /root/httpd.csr -out /tmp/httpd.crt# scp /tmp/httpd.crt 172.16.251.232:/root# scp /etc/pki/CA/cacert.pem 172.16.250.69:/root 123456789node2 # mkdir /etc/httpd/cacertnode1 # cd /etc/httpd/cacert/ &amp;&amp; scp * 172.16.251.191:/etc/httpd/cacert/ nod1,node1 # vim /etc/httpd/conf.d/ssl.conf ä¿®æ”¹ : SSLCertificateFile /etc/httpd/cacert/httpd.crtSSLCertificateKeyFile /etc/httpd/cacert/httpd.key # systemctl restart httpd åœ¨å…¶å®ƒä¸»æœºä¸­è¿›è¡Œæµ‹è¯•:12# vim /etc/hosts åŠ å…¥ : 172.16.252.166 www.rj.com æµ‹è¯•httpsä¸Žhttpçš„æŒä¹…è¿žæŽ¥123456789# for i in &#123;1..4&#125; ;do curl â€“cacert /root/cacert.pem https://www.rj.com &amp;&amp; curl http://www.rj.com ; done &lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt; åœ¨ ldirectord ä¸­å®žçŽ°123456789101112131415161718driector # vim /etc/ha.d/ldirectord.cf checktimeout=3checkinterval=1fallback=127.0.0.1:80autoreload=yeslogfile=â€/var/log/ldirectord.logâ€quiescent=novirtual=10real=172.16.251.191:80 gate 1real=172.16.251.232:80 gate 3fallback=127.0.0.1:80 gateservice=httpscheduler=wrrchecktype=negotiatecheckport=80# systemctl start ldirectord# ipvsadm -Ln åœ¨å…¶å®ƒä¸»æœºä¸­è¿›è¡Œæµ‹è¯•123456789# for i in &#123;1..4&#125; ;do curl â€“cacert /root/cacert.pem https://www.rj.com &amp;&amp; curl http://www.rj.com ; done &lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS2&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;&lt;h1&gt;RS1&lt;/h2&gt;]]></content>
  </entry>
  <entry>
    <title><![CDATA[ç¬”è®°ä¹‹--bashåŸºç¡€ç‰¹æ€§]]></title>
    <url>%2F2017%2F10%2F19%2F%E7%AC%94%E8%AE%B0%E4%B9%8B-bash%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7%2F</url>
    <content type="text"><![CDATA[bash åŸºç¡€ç‰¹æ€§å‘½ä»¤æ¨¡å¼systemctl set-default multi-user.target å›¾å½¢æ¨¡å¼systemctl set-default graphical.target ipythonå®‰è£…ä½¿ç”¨12345678910111213# python ipython # tar -xvf pip-8.1.2.tar.gz# tar -xvf setuptools-28.2.0.tar.gz# tar -xvf ipython-5.1.0# cd åˆ°å…¶å„ä¸ªç›®å½•ä¸­ python setup.py build &amp;&amp; pyton setup.py install # pip install traitlets# pip install pygments# pip install simplegeneric# pip install --upgrade setuptools pi# pip unistall ipython# pip uninstall ipython# pip install ipython# pip install jupyter 123jupyter-notebook --ip 0.0.0.0 --port 46 å¯åŠ¨jupyter jupyter-nbconvert --to html filename.ipynbipython nbconvert --to python &lt;YourNotebook&gt;.ipynb åŽ†å²è®°å½•çš„ä½¿ç”¨æ ¼å¼ 1export HISTTIMEFORMAT=&quot;`whoami`:%F%T&quot; å®šä¹‰åŽ†å²å‘½ä»¤çš„æ ¼å¼ HISTSIZE=1000000 å®šä¹‰å‘½ä»¤çš„æ•°é‡ 12345678# rmdir [OPTION]...DIRECTORY... -p:åˆ é™¤æŸå½•åŽï¼Œå¦‚æžœå…¶çˆ¶ç›®å½•ä¸ºç©ºï¼Œåˆ™ä¸€å¹¶åˆ é™¤ä¹‹ -v:æ˜¾ç¤ºè¿‡ç¨‹# mkdir -pv /tmp/x&#123;y1/&#123;a,b&#125;,y2&#125;# mkdir -v &#123;a,b&#125;_&#123;c,d&#125;# mkdir -pv /tmp/mysysroot/&#123;bin,sbin,etc/sysconfig/network-scripts,usr/ &#123;bin,sbin,local/&#123;bin,sbin,etc,lib&#125;,lib,lib64&#125;,var/&#123;cache,log,run&#125;&#125;# tree -L levelæŒ‡å®šæ˜¾ç¤ºå±‚çº§ bashçš„åŸºç¡€ç‰¹æ€§ï¼šå‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€ç»“æžœ å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ç»“æžœ bashé€šè¿‡çŠ¶æ€è¿”å›žå€¼æ¥è¾“å‡ºæ­¤ç»“æžœ æˆåŠŸ0 å¤±è´¥1-255 å‘½ä»¤æ‰§è¡Œå®Œæˆä¹‹åŽï¼Œå…¶çŠ¶æ€è¿”å›žå€¼ä¿å­˜åœ¨bashçš„ç‰¹æ®Šå˜é‡$?ä¸­ å‘½ä»¤æ­£å¸¸æ‰§è¡Œæ—¶ï¼Œæœ‰çš„è¿˜å›žæœ‰å‘½ä»¤è¿”å›žå€¼ æ ¹æ®å‘½ä»¤åŠå…¶åŠŸèƒ½ä¸åŒï¼Œç»“æžœå„ä¸ç›¸åŒ å¼•ç”¨å‘½ä»¤çš„æ‰§è¡Œç»“æžœï¼›$(COMMAND)æˆ–COMMAND 1mkdir $(date +%H-%M-%S) bash å¿«æ·é”® 12345ctrl +a ï¼šè·³è½¬åˆ°å‘½ä»¤è¡Œé¦–ctrl +e ï¼šè·³è½¬åˆ°å‘½ä»¤è¡Œå°¾ctrl +u ï¼šåˆ é™¤è¡Œé¦–åˆ°å…‰æ ‡æ‰€åœ¨å¤„ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦ctrl +k ï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨å¤„åˆ°è¡Œå°¾çš„æ‰€æœ‰å­—ç¬¦ctrl +l ï¼šæ¸…å±ï¼Œç›¸å½“äºŽclear æ–‡ä»¶æŸ¥çœ‹ç±»å‘½ä»¤ï¼šcat,tac,head,tail,more,less åˆ†å±æŸ¥çœ‹å‘½ä»¤ï¼šmore less moreå‘½ä»¤ more FILE ç‰¹ç‚¹ï¼šç¿»å±è‡³æ–‡ä»¶å°¾åŽè‡ªåŠ¨é€€å‡º lesså‘½ä»¤ less FILE headå‘½ä»¤ æŸ¥çœ‹æ–‡ä»¶çš„å‰nè¡Œï¼š head [options] FILE -n # or -# tailå‘½ä»¤ï¼š æŸ¥çœ‹æ–‡ä»¶çš„åŽnè¡Œï¼štail [options] FILE -n # or -# æ³¨ -f ï¼šoutput appended data as the file grows æŸ¥çœ‹å†…å®¹åŽä¸é€€å‡ºï¼Œç”¨æ¥æŸ¥çœ‹æ–‡ä»¶å†…çš„æ–°å¢žå†…å®¹ stat /tmp/functions ç”¨æ¥æ˜¾ç¤ºæ–‡ä»¶çš„çŠ¶æ€stat FILEâ€¦ æ–‡ä»¶ï¼šä¸¤ç±»æ•°æ® å…ƒæ•°æ‰€ï¼šmetadata æ®æ•°ï¼šdataæ—¶é—´æˆ³ access time modify time change time touch æ‘¸ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶æ—¶ï¼Œä¼šåˆ›å»ºç©ºæ–‡ä»¶ touch - change file timestamps touch [OPTION]â€¦FILEâ€¦ -c:æŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¸äºˆåˆ›å»ºï¼› -a:ä»…ä¿®æ”¹access time; -m:ä»…ä¿®æ”¹modify time; -t STAMP [[CC]YY]MMDDhhmm[-ss]. bashåŸºç¡€ç‰¹æ€§ globbing:æ–‡ä»¶åé€šé…(æ•´ä½“æ–‡ä»¶ååŒ¹é…ï¼Œè€Œéžéƒ¨åˆ†) *ï¼šåŒ¹é…ä»»æ„é•¿åº¦çš„ä»»æ„å­—ç¬¦ pa*æ‰€æœ‰ä»¥paå¼€å¤´çš„æ–‡ä»¶ pa pa pa ?ï¼šåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ pa? paa ??pa p?a p?a? []:åŒ¹é…æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„å•ä¸ªå­—ç¬¦ æœ‰å‡ ç§ç‰¹æ®Šæ ¼å¼ [ a-z],[A-Z],[a-z,0-9] pa[0-9][0-9],2[0-9][0-9] nmtui NetworkManager rootç”¨æˆ·ä¸ä¸€ç›´æ˜¯ç®¡ç†å‘˜ï¼ŒåŽŸå› ï¼šç®¡ç†å‘˜æ˜¯å¯ä»¥æ›´æ”¹çš„ ttyå‘½ä»¤æŸ¥çœ‹ç»ˆç«¯ç±»åž‹ï¼šç‰©ç†ç»ˆç«¯ï¼Œä¼ªç»ˆç«¯ï¼Œpts è™šæ‹Ÿç»ˆç«¯tty å›¾å½¢ç»ˆç«¯ 1234567891011# echo $SHELL# cat /etc/shells# type pwd builtin(å†…ç½®) å†…ç½®å‘½ä»¤åœ¨/bin/bash ä¸­# type ls åˆ«å# hashed(å¤–ç½®å‘½ä»¤)# hash æ˜¾ç¤ºå‘½ä»¤ç¼“å­˜ï¼Œä½œç”¨æé«˜ç³»ç»ŸæŸ¥æ‰¾å‘½ä»¤çš„é€Ÿåº¦# hash -d tty æŒ‡å®šåˆ é™¤ ï¼ˆæ³¨ï¼šæŒ‡å®šåˆ«åæ—¶ç›´æŽ¥åˆ é™¤åˆ«åï¼‰# hash -r å…¨æ¸…ç©º# hash -l æ˜¾ç¤ºç¼“å­˜# hash -p /usr/bin/tty newtty ç»™ç¼“å­˜çš„å‘½ä»¤èµ·ä¸€ä¸ªåˆ«å# hash -t æŸ¥çœ‹å‘½ä»¤å¯¹åº”è·¯å¾„ alias eg ce7 grep æœ‰åˆ«å alias grep=â€™grep â€“color=autoâ€™ è€Œce6çš„grepæ²¡æœ‰alias åˆ«åè¦æƒ³ç”Ÿæ•ˆè¦å®šä¹‰åˆ° .bashrcä¸­åˆ«åæ¯”å†…éƒ¨ä¼˜å…ˆçº§é«˜ï¼Œå†…éƒ¨å‘½ä»¤æ¯”å¤–éƒ¨å‘½ä»¤ä¼˜å…ˆçº§é«˜alias å†…éƒ¨ å¤–éƒ¨ hashed æ¯”PATHä¸­å®šä¹‰çš„è¦é«˜ which -a cat å¼ºç½®æœç´¢catæ‰€åœ¨çš„æ‰€æœ‰ç›®å½•ï¼ˆæ³¨ï¼Œå¦‚æžœå‘½ä»¤æœ‰å¤šä¸ªçš„è¯ï¼‰ which â€“skip-alias ls æŸ¥æ‰¾lsæ‰€åœ¨ç›®å½•æ—¶ï¼Œè·³è¿‡åˆ«å unalias å–æ¶ˆåˆ«å -a å–æ¶ˆæ‰€æœ‰åˆ«å åŒæ ·åªå¯¹å½“å‰ç»ˆç«¯ç”Ÿæ•ˆ æ³¨ï¼šbashè‡ªèº«æ˜¯ä¸€ä¸ªå¤–éƒ¨çš„å‘½ä»¤ æŸ¥æ‰¾å†…éƒ¨å‘½ä»¤çš„æ—¶å€™man æ–‡æ¡£æ‰“å¼€çš„ç›¸å½“äºŽ man bash æ³¨ï¼šç›´æŽ¥é”®å…¥helpæ—¶å€™ï¼Œå¯ä»¥ç›´æŽ¥åˆ—å‡ºæ‰€æœ‰çš„å†…éƒ¨å‘½ä»¤ enalbe -n pwd ä¸´æ—¶ç¦ç”¨pwdå‘½ä»¤ -a å¯ç”¨ echo $[RANDOMM%80] éšæœºæ•°çš„ç”Ÿæˆ æ³¨pwd æœ‰å¤–éƒ¨å‘½ä»¤ æ³¨åªè¦æ˜¯èƒ½åªæŽ¥manæŸ¥åˆ°çš„å‘½ä»¤ï¼Œå®ƒéƒ½æœ‰å¤–éƒ¨å‘½ä»¤ æ³¨PS1=\e[31m \e[0mç”¨æ¥æˆªæ­¢é¢œè‰² PS1=â€™\033[31m[\u@\h\W]\$\033[0mâ€™ ascii 7 ä½ 2^7=128å­—ç¬¦ unicodeï¼ˆä»–å¯ä»¥æŠŠä¸–ç•Œå…¨éƒ¨çš„æ–‡å­—éƒ½å½•å…¥è¿›æ¥ï¼‰ è¡¨ utf-8å°±æ˜¯å…¶ä¸­çš„ä¸€ç§ bcè®¡ç®—å™¨ ibase=8 æŒ‡å®šè¿›åˆ¶ä¸ºå…« ibase=16 æŒ‡å®šè¿›åˆ¶ä¸º16 obase=8 æŒ‡å®šè¾“å‡ºä¸ºå…«è¿›åˆ¶ æ€»ç»“ï¼šalias nano bc enable (ç®¡ç†å†…éƒ¨å‘½ä»¤) -n hash -d -r -l type help which man unalias whereis æŸ¥çœ‹å‘½ä»¤æ¯”which æ›´è¯¦ç»† hostname æŸ¥çœ‹ä¸»æœºå ä»…å¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼š ~/.bashrc å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿäº¤ï¼š /etc/bashrcä¸­ ä½¿ç”¨vmare å‰æœŸè¦æœ‰å¿«ç…§ å¯å°†vmware ä¸‹çš„æ–‡ä»¶å¤åˆ¶å‡ºæ¥ source å’Œ . æ˜¯ç­‰ä»·çš„ eg source .bashrc . .bashrc (æ³¨ä¸­é—´æœ‰ç©ºæ ¼) 123å‡å¦‚æœ‰åˆ«åä¹‹åŽï¼Œè¦ç”¨å®ƒçš„çœŸå®žå /bin/grep root /etc/passwd\grep root /etc/passwd&apos;grep&apos; root /etc/passwd å‘½ä»¤ é€‰é¡¹ å‚æ•°ls -la çŸ­æ ¼å¼ â€“allçŸ­æ ¼å¼åŒºåˆ«ï¼šçŸ­æ ¼å¼å¯ä»¥ç®€å†™è¿žåœ¨ä¸€èµ·è€ŒçŸ­çš„ä¸èƒ½è¿˜æœ‰çš„ä¸é¡»è¦ - eg : ps apwd;ls;hostname å¤šä¸ªå‘½ä»¤å¯ä»¥ç”¨;éš”å¼€å‘½ä»¤å¤ªè¿‡é•¿æ—¶å¯åŠ \ls -l (æ„æ€ä¸ºlist)-rwâ€”â€”-. 1 root root 1537 Oct 4 01:52 anaconda-ks.cfgä»€ä¹ˆæ—¶å€™ä¿®æ”¹çš„ d b(block) l s(sock) cï¼ˆchararterï¼‰-p (pip) æ³¨åœ¨æœ¬æœºå†…éƒ¨çš„ä¸¤ä¸ªç¨‹åºé€šä¿¡æ—¶å€ŸåŠ©äºŽsocketæ–‡ä»¶ ç¡¬ç›˜IDE SCSI SATA SAS (ç”¨äºŽæœåŠ¡å™¨é¢)/dev/hd(IDE) /dev/sd(é™¤IDEä¹‹å¤–çš„) /dev/vd(è™šæ‹Ÿçš„)lsblk æ˜¾ç¤ºå—æ–‡ä»¶éšæœºè®¿é—®ï¼šå¯ä»¥ç›´æŽ¥åŽ»è®¿é—®é‚£ä¸ªæ–‡ä»¶c (câ€¦â€¦â€¦â€¦â€¦â€¦hararter) é¡»è¦é¡ºåºè®¿é—® ll /dev/zerodf å¯æŸ¥çœ‹åˆ†åŒºçš„åˆ©ç”¨çŽ‡mount æŒ‚è½½ï¼Œæ˜ å°„/dev/sda1 ==mount==&gt; (æ˜ å°„åˆ°) /boot (C:) æŒ‚è½½ç‚¹æŠŠä¸€ä¸ªè®¾å¤‡mount dir(æŒ‚è½½ç‚¹)dd ifï¼ˆè¾“å…¥æ–‡ä»¶ï¼‰=/dev/zero of=f1 count=1hexdump -v -C f1 å¯æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶od ä¹Ÿå¯ä»¥cat ç”¨äºŽçœ‹æ–‡æœ¬/dev/nullï¼ˆç©ºï¼‰ç³»ç»Ÿé»‘æ´ždd if=/dev/sda of=/dev/nullnano /etc/DIR_COLORS å¯æ›´æ”¹ç³»ç»Ÿæ–‡ä»¶çš„é¢œè‰²ctrl +D æ­£å¸¸é€€å‡ºï¼ˆé€€å‡ºå½“å‰è¿›ç¨‹ï¼‰ ctrl +C å¼ºè¡Œé€€å‡ºdate -u å…¶å®ƒåŒºçš„æ—¶é—´ 123456[11:54:27root@clu~]# cal 9 1752 September 1752 Su Mo Tu We Th Fr Sa 1 2 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 æ³¨ï¼šcd /misc/cd df ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿscreen -S ï¼ˆsessionï¼‰renjin åˆ›å»ºä¼šè¯ screen -x åŠ å…¥ä¼šè¯ exit é€€å‡º ctrl +a,d å‰¥ç¦»å½“å‰ä¼šè¯screen -lsæ˜¾ç¤ºå½“å‰ä¼šè¯ screen -r è¿˜åŽŸä¼šè¯è¡¥screen -S some_name -X quitmount /dev/sr0 /mnt/yum mount /dev/cdrom /mnt/yumæ­¥éª¤ å½“å‰æœºå™¨ screen -S renjin å¦ä¸€å°æœºå™¨screen -x renjinecho -n ä¸æ¢è¡Œ-e å¯å¼€å¯\ç‰¹æ€§ï¼ˆ\aå‘å£°\cä¸æ¢è¡Œ\nå¼ºåˆ¶å†æ¢è¡Œ\t tab \bé€€æ ¼x\rå…‰æ ‡ç§»åˆ°è¡Œé¦–ï¼Œä½†ä¸æ¢è¡Œ\033[43(èƒŒæ™¯è‰²);33m \033[0m \HH åå…­è¿›æŠ•å½± \e â€œ\x#â€æ‰“å°ascii \onnnå…«è¿›åˆ¶asciic &lt; echo â€˜åªä»»å­—ç¬¦ä¸²ï¼ˆå¼ºï¼‰â€™ eg echo -e â€œa\nbâ€echo å‘½ä»¤å’Œå¼•ç”¨éƒ½èƒ½å®žåˆ«echo â€œå¤„äºŽä¸­é—´çŠ¶æ€ï¼ˆå¼±ï¼‰â€å‘½ä»¤è°ƒç”¨å¦ä¸€ä¸ªå‘½ä»¤ï¼Œè¢«è°ƒç”¨çš„å‘½ä»¤ç”¨çš„åå‘å•å¼•å·touch `date +%F`.log touch `hostname`.txt $() ä¸Žæ˜¯ç­‰ä»·çš„linux ls åˆ—å‡ºçš„é¡ºåºå°Šé‡asciiç çš„é¡ºåº å¤§å†™å­—æ¯åœ¨å°å†™å­—æ¯å‰ Aa Bbtouch f{a,b,c}.{txt,log} touch f{a,b,c}.{txt,log}echo {000ï¼ˆåˆå§‹æ•°ï¼Œå®šä¹‰äº†ä½çš„0ï¼‰..30ï¼ˆ0åˆ°30ï¼‰..2(æ¯æ¬¡é€’å¢ž2)}echo {a-z}]]></content>
  </entry>
  <entry>
    <title><![CDATA[GITç®€å•ä½¿ç”¨åŠæœåŠ¡å™¨æ—¥å¸¸é”™è¯¯å¤„ç†]]></title>
    <url>%2F2017%2F10%2F18%2FGIT%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[git ç®€å•ä½¿ç”¨ gitlab æ–°å»ºé¡¹ç›®gitlab æœ¬åœ°æ–°å»ºåœ°å€ http://10.180.55.111:8088/dashboard/projects/ ç‚¹å‡» New Project â€”&gt; RenJin / You project name â€”&gt; Create Project ç»ˆç«¯ä¸­çš„é…ç½® 1234# git config --global user.name &quot;Jin.Ren&quot;# git config --global user.emal &quot;renjin@transfereasy.com&quot;æŸ¥çœ‹æœ¬æœºçš„å¯†é’¥ï¼Œæ·»åŠ è‡³gitlabä¸­# cat ~/.ssh/id_rsa.pub å¤åˆ¶å¯†é’¥è‡³ gitlab ç‚¹å‡»å·¦ä¸‹è„šçš„ç”¨æˆ·å â€”&gt; Profile Settings â€“&gt;SSH Keys â€”&gt; (key) â€”&gt; Add key gitæœ¬åœ°æ–°é¡¹ç›®ä¸Šä¼  12345678# mkdir deplay-test# git init # vim secruity.sh# vim rolbask.sh # chmod +x *.sh# git commit -m &quot;security scripts&quot;# git remote add origin git@10.180.55.111:Jin.Ren/deplay-test.git# git push -u origin master gitä¸Šä¼ å·²ç»å­˜åœ¨çš„repository 123# cd old-deplay # git remote add origin git@10.180.55.111:Jin.Ren/deplay-test.git# git push -u origin master git ä¸Šä¼ å·²ç»å­˜åœ¨çš„repository 1234# git checkout -b seq# git branch # git checkout master å¯ä»¥åˆ‡æ¢å›žmasteråˆ†æ”¯ è¡¥å……mysqlæ•°æ®çš„å¯¼å…¥å¯¼å‡º 1# mysqldump -uuser -ppasswd -hhost --databases data &gt; /tmp/database.sql mongoç”Ÿäº§æŠ¥é”™æ€»ç»“ python è®°å…¥mongoæ—¶ä¼šæŠ¥é”™ 2.x ä¸Ž 3.x ä½¿ç”¨çš„åŠ å¯†æ–¹å¼ä¸åŒubuntuå‡çº§mongo2.xåˆ°3.x 1234567891011121314151617181920212223242526272829# sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10# echo &quot;deb http://repo.mongodb.org/apt/ubuntu &quot;$(lsb_release -sc)&quot;/mongodb-org/3.0 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list# sudo apt-get update# sudo apt-get install -y mongodb-org=3.0.1 mongodb-org-server=3.0.1 mongodb-org-shell=3.0.1 mongodb-org-mongos=3.0.1 mongodb-org-tools=3.0.1# su - root -c &quot;echo &apos;never&apos; &gt; /sys/kernel/mm/transparent_hugepage/enabled&quot;# su - root -c &quot;echo &apos;never&apos; &gt; /sys/kernel/mm/transparent_hugepage/defrag&quot;# sudo /etc/init.d/mongodb start# mogon #æ­¤å¤„ä¾¿å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬å·äº†# mogodbé»˜è®¤æ˜¯æ²¡æœ‰å¯†ç çš„ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å°†è®¤è¯å¼€å¯ï¼ˆä½†åœ¨æ­¤ä¹‹å‰é…ç½®å¥½ç”¨æˆ·æœ‰åå’Œå¯†ç ï¼‰# mogon&#123; user: &quot;&lt;name&gt;&quot;, pwd: &quot;&lt;cleartext password&gt;&quot;, customData: &#123; &lt;any information&gt; &#125;, # ä»»æ„çš„æ•°æ®,ä¸€èˆ¬æ˜¯ç”¨äºŽæè¿°ç”¨æˆ·ç®¡ç†å‘˜çš„ä¿¡æ¯ roles: [ &#123; role: &quot;&lt;role&gt;&quot;, db: &quot;&lt;database&gt;&quot; &#125; | &quot;&lt;role&gt;&quot;, # å¦‚æžœæ˜¯roleå°±æ˜¯ç›´æŽ¥æŒ‡å®šäº†è§’è‰²,å¹¶ä½œç”¨äºŽå½“å‰çš„æ•°æ®åº“ ... ] # rolesæ˜¯å¿…ä¼ é¡¹,ä½†æ˜¯å¯ä»¥æŒ‡å®šç©ºæ•°ç»„,ä¸ºç©ºå°±æ˜¯ä¸æŒ‡å®šä»»ä½•æƒé™&#125;use products # mongoDBçš„æƒé™è®¾ç½®æ˜¯ä»¥åº“ä¸ºå•ä½çš„,å¿…é€‰è¦å…ˆé€‰æ‹©åº“db.createUser( &#123; &quot;user&quot; : &quot;accountAdmin01&quot;, &quot;pwd&quot;: &quot;cleartext password&quot;, &quot;customData&quot; : &#123; employeeId: 12345 &#125;, &quot;roles&quot; : [ &#123; role: &quot;clusterAdmin&quot;, db: &quot;admin&quot; &#125;, &#123; role: &quot;readAnyDatabase&quot;, db: &quot;admin&quot; &#125;, &quot;readWrite&quot; ] &#125;,&#123; w: &quot;majority&quot; , wtimeout: 5000 &#125; ) # readWrite é€‚ç”¨äºŽproductsåº“,clusterAdminä¸ŽreadAnyDatabaseè§’è‰²é€‚ç”¨äºŽadminåº“ macæµ‹è¯•çŽ¯å¢ƒå¤šç‰ˆæœ¬phpæ·»åŠ mongoæŠ¥é”™ php.h file not fond12# cp -r /Library/Developer/Command LineTools/SDKs/MacOSX10.12.sdk/usr/i nclude /Applications/MAMP/bin/php/ph p5.6.10/ # brew install pcre # sudo ./pecl install mongodb nginx é‡å†™443å…¨å±€ç”Ÿæ•ˆçš„ä¸¤ç§æ–¹å¼åœ¨serverä¸­æ–°å¼€èµ·ä¸€ä¸ª000-http2https.confè™šæ‹Ÿä¸»æœº123456789101112server &#123; listen 80; server_name _; return 301 https://$HOST$request_uri;&#125;#server &#123;# listen 80;# server_name test.com;# rewrite ^(.*)$ https://$host$1 permanent; # #&#125; nginx ä¸´æ—¶è¿”å›žä¸€ä¸ªå€¼æˆ–ä¸€ä¸ªåœ°å€123456789 location /rjyy &#123; return &apos;https://rjyy.ssjinyao.com&apos; ;&#125; location /nene &#123; return &apos;https://nene.ssjinyao.com&apos; ;&#125; location /sange.html &#123; return 200 &apos;&lt;h1&gt;mei tou nao a&lt;/h1&gt;&apos; ;&#125; sshä¸èƒ½keyç™»å½•123æŸ¥çœ‹.ssh ä¸Ž authorized_keysçš„æƒé™æŸ¥çœ‹/etc/sshé…ç½®é—®é¢˜AuthorizedKeysFile %h/.ssh/authorized_keys å…è®¸HTTPä¸Šä¼ æ–‡ä»¶ï¼Œå¹¶è®¾å®šå¤§å°12345vim /etc/php.inifile_uploads = on; æ˜¯å¦å…è®¸é€šè¿‡HTTPä¸Šä¼ æ–‡ä»¶çš„å¼€å…³ã€‚é»˜è®¤ä¸ºONå³æ˜¯å¼€;upload_tmp_dir; æ–‡ä»¶ä¸Šä¼ è‡³æœåŠ¡å™¨ä¸Šå­˜å‚¨ä¸´æ—¶æ–‡ä»¶çš„åœ°æ–¹ï¼Œå¦‚æžœæ²¡æŒ‡å®šå°±ä¼šç”¨ç³»ç»Ÿé»˜è®¤çš„ä¸´æ—¶æ–‡ä»¶å¤¹;post_max_filesize = 8m; å…è®¸ä¸Šä¼ æ–‡ä»¶å¤§å°çš„æœ€å¤§å€¼ã€‚é»˜è®¤ä¸º2M; post_max_size 8m; æŒ‡é€šè¿‡è¡¨å•POSTç»™PHPçš„æ‰€èƒ½æŽ¥æ”¶çš„æœ€å¤§å€¼ï¼ŒåŒ…æ‹¬è¡¨å•é‡Œçš„æ‰€æœ‰å€¼ã€‚é»˜è®¤ä¸º8M; gitlab-ci æŒç»­åŒ–å‘å¸ƒå¹³å°123456789# gitlab-ci è®¤è¯æ˜¯ä¸€å‘ï¼Œç‰ˆæœ¬ä¸å…¼å®¹çš„è¯ä¸€ç›´ä¼šè®¤è¯å¤±è´¥çš„,gitlab-ci ä¸Žgilab å¯ä»¥ä¸åœ¨åŒä¸€å°æœåŠ¡å™¨; # ä½†æ˜¯å¯ä»¥å ¡åž’æœºæ”¾åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Š;# apt-get install gitlab-ci-multi-runner=1.10.2# gitlab-ci-multi-runner registerhttp://xxx.xx.xxx.xxx:8080/ciå¦‚æžœæ˜¯å»ºç«‹å…¬å…±runnerï¼Œåˆ™éœ€è¦ä»¥rootç™»å½•gitlab --&gt; root --&gt; Admin Area --&gt; Ruuners -&gt; å¯ä»¥æŸ¥çœ‹åˆ°å˜çº¢çš„koen deployshellshell ä¾¿å¯ä»¥æ·»åŠ ä¸Šäº† åœ¨æŒ‡å®šåˆ†æ”¯ä¸­æ·»åŠ .gitlab-ci.yml ï¼Œå¦‚teståˆ†æ”¯ 123456789before_script: - cd /xxxxx/xxxx/deploy_cijob: only: - test tags: - inner script: - /usr/bin/fab -f xx-deploy.py xxxxxx:test,0 å…³äºŽpython éƒ¨ç½²çš„å‘12345678910# é¡¹ç›®ç›®å½• /root/text/# éœ€è¦æ‰§è¡Œçš„ä»£ç  /root/text/poor/fober.py# config é…ç½®æ–‡ä»¶ /root/text/config/config.pyå…±ä¸¤ç§è§£å†³æ–¹å¼1. æ·»åŠ v.pth åœ¨ENVä¸­ # virtualenv /root/text/ENV# vim /root/text/ENV/lib/python2.7/site-packages/v.pth/root/text2. åœ¨è°ƒç”¨configå‰ï¼Œå®šä¹‰å¥½ç›®å½•# sys.path.append(&apos;/root/text/&apos;)]]></content>
  </entry>
</search>
