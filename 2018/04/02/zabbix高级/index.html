<!DOCTYPE html>
<html lang="zh-Hans">
<head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/4.1.6'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>zabbix使用进阶 - 逝水锦遥</title>
  
    <meta name="keywords" content="rhca,linux">
  

  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="逝水锦遥" type="application/atom+xml">
  

  <!-- import meta -->
  

  <!-- link -->
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/first.css">

  

  
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  

  <script id="loadcss"></script>
</head>


<body>
	  <canvas id="canvas" width="1440" height="900" ></canvas>
	  <script type="text/javascript" src="/js/DigitalRain.js"></script>
  

<header id="l_header" class="l_header always floatable "  >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='/images/head.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fab fa-linux fa-fw'></i>所有文章
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/program
                  
                  
                  
                    id="tagsprogram"
                  >
                  <i class='fab fa-gitlab fa-fw'></i>运维开发
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/rhca
                  
                  
                  
                    id="tagsrhca"
                  >
                  <i class='fas fa-heartbeat fa-fw'></i>运维组件
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/cloud
                  
                  
                  
                    id="tagscloud"
                  >
                  <i class='fas fa-cloud fa-fw'></i>云计算
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/zikao
                  
                  
                  
                    id="tagszikao"
                  >
                  <i class='fab fa-drupal fa-fw'></i>剑锋直指
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/renjin
                  
                  
                  
                    id="tagsrenjin"
                  >
                  <i class='fas fa-user-circle fa-fw'></i>个人中心
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>夜间模式
                </a>
              <li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/box/
                  
                  
                  
                    id="box"
                  >
                  <i class='fas fa-flag fa-fw'></i>工具箱
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="搜索文章..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fab fa-linux fa-fw'></i>所有文章
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/program
                  
                  
                  
                    id="tagsprogram"
                  >
                  <i class='fab fa-gitlab fa-fw'></i>运维开发
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/rhca
                  
                  
                  
                    id="tagsrhca"
                  >
                  <i class='fas fa-heartbeat fa-fw'></i>运维组件
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/cloud
                  
                  
                  
                    id="tagscloud"
                  >
                  <i class='fas fa-cloud fa-fw'></i>云计算
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/zikao
                  
                  
                  
                    id="tagszikao"
                  >
                  <i class='fab fa-drupal fa-fw'></i>剑锋直指
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/renjin
                  
                  
                  
                    id="tagsrenjin"
                  >
                  <i class='fas fa-user-circle fa-fw'></i>个人中心
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>夜间模式
                </a>
              <li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/box/
                  
                  
                  
                    id="box"
                  >
                  <i class='fas fa-flag fa-fw'></i>工具箱
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  <div id="l_body">
    <div id="l_cover">
  
    
        <div id="half" class='cover-wrapper post search' style="display: ;">
          
            <div class='cover-bg lazyload placeholder' data-bg="/images/lovers.jpg"></div>
          
          <div class='cover-body'>
  <div class='top'>
    
      <img no-lazy class='logo' src='/images/ssjyai.png'/>
    
    
    
      <p class="subtitle">有智而性缓者思大智 有才而气和者为大才</p>
    
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="搜索本地文章" />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
      </div>
    </div>
  </div>
</div>

          <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>

    <div id='safearea'>
      <div class='body-wrapper' id="pjax-container">
        

<div class='l_main'>
  <article class="article post white-box reveal md floatable article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        zabbix使用进阶
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author'>
  <a class='author' href="/images/rjrt.ico" rel="nofollow">
    <img no-lazy src="/images/rjrt.ico">
    <p>任锦</p>
  </a>
</div>

          
        
          
            

          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Apr 2, 2018</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item browse busuanzi">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <p>
        <span id="busuanzi_value_page_pv">
          <i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i>
          <i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i>
        </span>
        次浏览
      </p>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  <p>[toc]</p>
<h1 id="zabbix-高级用法"><a href="#zabbix-高级用法" class="headerlink" title="zabbix 高级用法"></a>zabbix 高级用法</h1><p><img src="/images/zabbix_chatu.png" class="lazyload" data-srcset="/images/zabbix_chatu.png" srcset="data:image/png;base64,666" alt=""></p>
<h2 id="zabbix-报警媒介"><a href="#zabbix-报警媒介" class="headerlink" title="zabbix 报警媒介"></a>zabbix 报警媒介</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 对于邮件报警接口，CentOS默认邮件服务就是启动的，但是，只能服务本地到本地发邮件;  </span><br><span class="line"># 如果需要往互联网上发邮件，需要把服务器配置成邮件服务器;</span><br><span class="line"># 但一般来讲，自建邮件系统，付出的成本和技术都较高，因此，我们可以考虑网联上的邮件服务;</span><br><span class="line"># 而对于报警的内容，一般是我们在zabbix服务端配置的宏所定义的内容;</span><br><span class="line"># 没有item的配置，那么将意味着没有监控数据; </span><br></pre></td></tr></table></figure>
<h2 id="Zabbix术语与操作注意项"><a href="#Zabbix术语与操作注意项" class="headerlink" title="Zabbix术语与操作注意项"></a>Zabbix术语与操作注意项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">Item Key </span><br><span class="line">    命名求: 只能使用字母、数字、下划线、点号、连接符;</span><br><span class="line">    接受参数: system.cpu.load[&lt;cpu&gt;,&lt;mode&gt;], net.if.inbound[if,&lt;mode&gt;]</span><br><span class="line">    注意: 每一个key背后都应该有一个命令或者脚本来负责实现数据收集；命令或者脚本可以调用传递给key的参数，调用方式为$1,$2,...</span><br><span class="line">    在zabbix中定义item时调用某key，还需要额外定义数据采集频率(每30秒采集一次)、历史数据的保存时长等;</span><br><span class="line">Trigger:</span><br><span class="line">    触发器表达式: &#123;&lt;Server&gt;:&lt;key&gt;.&lt;function&gt;(&lt;parameter&gt;)&#125;&lt;operator&gt;&lt;constant&gt;</span><br><span class="line">    例: &#123;api.transfereasy.com:net.tcp.listen[9991].last()&#125;#1</span><br><span class="line">    &lt;function&gt;: 评估采集到的数据是否在合理范围内时所使用的函数，共评估过程可以根据采集到的数据、当前时间或其它因素;</span><br><span class="line">        avg:平均值;</span><br><span class="line">        count:指定时间内的统计;</span><br><span class="line">        change:返回最近返回的值，与之前一次的差值;</span><br><span class="line">        date:当天的值;</span><br><span class="line">        dayofweek:返回本周的第几天的值;</span><br><span class="line">        dayofmonth:返回本月的第几天的值;</span><br><span class="line">        delta:指定时间范围内最大值与最小值之差;</span><br><span class="line">        diff:当文件不一样时;</span><br><span class="line">        iregexp:忽略大小写它符的正则表达式;</span><br><span class="line">        last:最近一次采样;</span><br><span class="line">        max:最近采样的最大值;</span><br><span class="line">        min:最近采样的最小值;</span><br><span class="line">        nodata: 表示没有数据;</span><br><span class="line">        sum:最后一次采样数据之和;</span><br><span class="line">        regexp:检查最后一次采样的值是否能够被指定的模式所匹配: 1、表示匹配, 0表示不匹配;</span><br><span class="line">        now:返回自Unix元年至此刻经历的秒数;</span><br><span class="line">        prev:倒数第二个采样值:</span><br><span class="line">        str:从最后一次的采样中查找到此处指定的子串:</span><br><span class="line">        strlen: 做字符串的长度比较;</span><br><span class="line">        prev:倒数第二个采样值</span><br><span class="line">    &lt;operator&gt;:</span><br><span class="line">            &gt;, &lt;, &#x3D;, #(表示不等于)事实上我们可以让表达式的值直接来做算术运算的;</span><br><span class="line">            &#x2F; ,* ,- ,+</span><br><span class="line">            &amp;(与),|(或)</span><br><span class="line">    触发器之间的关系        </span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line">    message:</span><br><span class="line">    condition:</span><br><span class="line">        一般由event触发:</span><br><span class="line">            trigger</span><br><span class="line">            discover:</span><br><span class="line">                Service Up ,Srvice Down ,Host up ,Host down, Service Discovered,Service Lost,Host Discovered, Host Lost</span><br><span class="line">            auto-registration</span><br><span class="line">            </span><br><span class="line">    operation:</span><br><span class="line">        send message</span><br><span class="line">            Medis Type</span><br><span class="line">                Email (常用),SMS ,Jabber, Scripts(常用), EZ Texting</span><br><span class="line">            Usser</span><br><span class="line">        remote command(远程命令)</span><br><span class="line">            运行zabbix进程的用户是zabix用户</span><br><span class="line">            所以这里要注意，zabbix未必有权限执行</span><br><span class="line">            (1) 给zabbix 定义sudo规则:    </span><br><span class="line">                zabbix ALL&#x3D;(ALL) ALL</span><br><span class="line">            (2) 不支持active模式的agent:</span><br><span class="line">            (3) 不支持代理模式:</span><br><span class="line">            (4) 命令长度不得超过255个字符:</span><br><span class="line">            (5) 可以使用宏:</span><br><span class="line">            (6) zabbix-server仅执行命令，而不关命令是否执行成功:</span><br><span class="line">            </span><br><span class="line">            前提: zabbix-agent要配置为支持执行远程命令:</span><br><span class="line">                EanbleRemoteCommands &#x3D;1  </span><br><span class="line">                LogRemoteCammands &#x3D;1  # 启用执行远程命令后记录</span><br><span class="line">            # vim &#x2F;etc&#x2F;sudoers  或者  visudo </span><br><span class="line">                zabbix ALL&#x3D;(ALL)  NOPASSWD:ALL</span><br><span class="line">                注: 以上服务器权限的是操作是非常用风限性的; </span><br><span class="line">            Actions --&gt; Operations --&gt; New </span><br><span class="line">                --&gt; Operation type Remote Command:</span><br><span class="line">                --&gt; Host  挑远出远程主机</span><br><span class="line">                --&gt; Global script --&gt;在方框中加入远程命令 </span><br><span class="line">            Hosts --&gt; Applications --&gt; Create Applications --&gt; Http</span><br><span class="line">            Hosts --&gt; Items --&gt; Create Items</span><br><span class="line">            --&gt; Name http server </span><br><span class="line">            --&gt; Type zabbix aggent </span><br><span class="line">            --&gt; Key net.tcp.listen[80]</span><br><span class="line">            --&gt; Applications http service</span><br><span class="line">            Add Items &lt;--</span><br><span class="line">            </span><br><span class="line">            Host --&gt; Triger --&gt; Create Triger</span><br><span class="line">            --&gt; Name http service is on</span><br><span class="line">                Expresion --&gt; add </span><br><span class="line">                    --&gt;Item node2: http service </span><br><span class="line">                    --&gt; Function: Previous value is &#x3D;1 </span><br><span class="line">                    --&gt; Last of(T) 1</span><br><span class="line">                    --&gt; N 0</span><br><span class="line">                    --&gt; 严重级别先Hight </span><br><span class="line">            Configuration --&gt; Actions --&gt; Create Action --&gt;</span><br><span class="line">                Action Name http service</span><br><span class="line">                Conditions --&gt; New condition Trigger &#x3D;&#x3D; node1: httpd serivce is value</span><br><span class="line">                Operations --&gt; 定义报警升级 --&gt; 可以定义由第一步到第几步执行什么样的操作       </span><br><span class="line">                注意:</span><br><span class="line">                    (1) 如果用到以某它用户身份运行其它命令的话，要加 sudo 来运行;</span><br><span class="line">                        sudo systemctl restart httpd</span><br><span class="line">                    (2) 在各gent上的sudoers 文件中，要注释如下行，否则命令依旧无法正常运行;</span><br><span class="line">                        # Default requiretty </span><br><span class="line">        Script: Alert Script </span><br><span class="line">        </span><br><span class="line">            放置于特定目录中: AlertScriptsPath&#x3D;&#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;alertscripts</span><br><span class="line">                zabbix_server.conf配置文件中的参数:</span><br><span class="line">                脚本中使用$1,$2,$3来调用Action先项卡中的收件人地址, Default Subject , Default Massage:</span><br><span class="line">                # vim alert_message.sh</span><br><span class="line">                #!&#x2F;bin&#x2F;bash</span><br><span class="line">                to&#x3D;$1</span><br><span class="line">                subject&#x3D;&quot;$2&quot;</span><br><span class="line">                body&#x3D;&quot;$3&quot;</span><br><span class="line">                echo &quot;$body&quot; | mail -s &quot;$subject&quot; &quot;$to&quot;</span><br><span class="line">                # chmod +x alert_message.sh </span><br><span class="line">                当然这里是一个最简单的实现脚本，这里也可以使用python,bash,ruby,perl 等脚本</span><br><span class="line">                注意: 新放入此目录中的脚本，只有重启zabbix 方能被实别;</span><br><span class="line">                </span><br><span class="line">                Administration --&gt; Mdedia types --&gt; </span><br><span class="line">                            --&gt; Name AlterScript</span><br><span class="line">                            --&gt; Type Script </span><br><span class="line">                            --&gt; Script name alert_message.sh </span><br><span class="line">                Administration --&gt; Users ---&gt;</span><br><span class="line">                            --&gt; Media --&gt; add </span><br><span class="line">                            --&gt; AlterScripts root@localhost</span><br><span class="line">                这样的话，通过两种方式都能收到邮件</span><br><span class="line">Escalation </span><br><span class="line">Template</span><br><span class="line">Web Scennario</span><br></pre></td></tr></table></figure>
<h2 id="Zabbix服务器进程"><a href="#Zabbix服务器进程" class="headerlink" title="Zabbix服务器进程"></a>Zabbix服务器进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">housekeeper 用来清理过期数据的;</span><br><span class="line">alter 专门用来发送警告的进程;</span><br><span class="line">discoverer 实现主机发现的; </span><br><span class="line">httppoller 对web服务器进行监控时;</span><br><span class="line">Poller 主动去被监控节点去拉取数据;</span><br><span class="line">Pinger 基于ping命令来探测主机是否在线;</span><br><span class="line">db_config_syncer 服务器配置同步的; </span><br><span class="line">timer 计时器;</span><br><span class="line">escaltor  报警升级器;</span><br></pre></td></tr></table></figure>
<h2 id="zabbix-可视化"><a href="#zabbix-可视化" class="headerlink" title="zabbix 可视化"></a>zabbix 可视化</h2><p>自定义图形属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Name: 图形的独有名称;</span><br><span class="line">Width: 图形的宽度，单位为像素;仅适用于&quot;预览(perview)&quot; 模式、饼图或分离型饼图; </span><br><span class="line">Height: 图形的类型, 共有四种，即&quot;线状图normal&quot;、&quot;堆叠面积图&quot;、&quot;饼图(pie)&quot;、 分离型饼图(exploded);</span><br><span class="line">Show legend: 是否显示图例，即图形数据序列说明;</span><br><span class="line">Show working time: 是否高亮显示工作时间区域;选定时，非工作时间区间的背景为灰色;此功能不用于pie和exploded;</span><br><span class="line">Show Triggers: 是否显示触发器;此功能不适用于pie和exploded; </span><br></pre></td></tr></table></figure>
<p>多图形合并显示 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Configuration --&gt; Screen --&gt; Create Screen </span><br><span class="line">--&gt; Name Test Screen</span><br><span class="line">--&gt; Columns 3 # 列</span><br><span class="line">--&gt; Row 2  # 行</span><br><span class="line">        --&gt; Test Screen </span><br><span class="line">            --&gt; change 这里就可以看到一个2行3列的表格，然后往里面添加图片; </span><br><span class="line">            </span><br></pre></td></tr></table></figure>
<p>多屏翻转</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Slide shows</span><br><span class="line">Name </span><br><span class="line">Default delay(in seconds)</span><br></pre></td></tr></table></figure>
<p>可视化: graph ,screen, slide shows,map</p>
<p>宏(macros)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 宏其实说白了就是变量，类型通常为文本类型; </span><br><span class="line">#  为了更强的灵活性,zabbix还支持在全局、模板或主机级别使用用户自定义宏(user macro);</span><br><span class="line">#  用户自定义宏要使用&quot;&#123;$MACRO&#125;&quot;这种特殊的语法格式; </span><br><span class="line">#  宏可以应用在item keys 和descriptions、 trigger 名称和表达式、主机接口IP&#x2F;DNS及端口、 discovery机制的SNMP协议的相关信息等;</span><br><span class="line"># 宏的名称只能使用大写字母、数字及下划线;</span><br><span class="line"># 两类:</span><br><span class="line">    内建: &#123;MACRO_NAME&#125;</span><br><span class="line">    自定义:&#123;$MACRO_NAME&#125;</span><br><span class="line"></span><br><span class="line"># 可以在三个级别使用:</span><br><span class="line">    Global, Template, Host</span><br><span class="line"></span><br><span class="line"># 优先级: Host --&gt; Template --&gt; Global</span><br><span class="line">    在某级别找到后将直接使用: 将不再查找</span><br><span class="line">    </span><br><span class="line">    全局宏:</span><br><span class="line">        Adminstration --&gt; General --&gt; Macrios(在先项卡中)</span><br><span class="line">    </span><br><span class="line">    主机宏:</span><br><span class="line">        Configuration --&gt; Hosts --&gt; Macrios 主机级别的宏优先级最高;</span><br><span class="line">    </span><br><span class="line">    Template:</span><br><span class="line">        Configuration --&gt; Complation --&gt; Macrios</span><br></pre></td></tr></table></figure>
<h2 id="模板-Templats"><a href="#模板-Templats" class="headerlink" title="模板(Templats)"></a>模板(Templats)</h2><p>一系列配置的集合，此些配置可以通过”链接”的方式应用于指定的主机:<br>application, item, trigger, graph, scree 及发现规则; </p>
<p>添加例行惯常的维护时间; </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Configuration --&gt; maintenance --&gt; Maintenance</span><br></pre></td></tr></table></figure>
<p>User Parameters:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># zabbix 内置了许多item key:</span><br><span class="line">实现用户自定义 item key ,实现特有数据指标监控;</span><br><span class="line">语法:</span><br><span class="line">    UserParameter&#x3D;&lt;key&gt;,&lt;command&gt;</span><br><span class="line"># vim  &#x2F;etc&#x2F;zabbix&#x2F;zabbix_agentd.d&#x2F;os.conf</span><br><span class="line">UserParameter&#x3D;os.memory.used, free -m | awk &#39;&#x2F;^Mem&#x2F; &#123;print $3&#125;&#39;</span><br><span class="line">UserParameter&#x3D;os.memory.used, free -m | awk &#39;&#x2F;^Mem&#x2F; &#123;print $3&#125;&#39;</span><br><span class="line">UserParameter&#x3D;os.memory.used, free -m | awk &#39;&#x2F;^Mem&#x2F; &#123;print $3&#125;&#39;</span><br><span class="line">注: 需要重启zabbix-agent 才能使用</span><br><span class="line"># systemctl restart zabbix-agent</span><br><span class="line">这个时候定义的zabbix-agent key就可以使用了,在server web 接口中添加; </span><br><span class="line">如果找不到key  则直接输入即可 os.memory.used</span><br></pre></td></tr></table></figure>
<h2 id="监控nginx-status"><a href="#监控nginx-status" class="headerlink" title="监控nginx status"></a>监控nginx status</h2><p>nginx status 开启方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        ...</span><br><span class="line">        location &#x2F;status &#123;</span><br><span class="line">            stub_status on;</span><br><span class="line">            access_log off;</span><br><span class="line">            allow 172.16.55.123; # 允许访问的IP</span><br><span class="line">            allow 127.0.0.1;</span><br><span class="line">            deny all;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">状态页面各项数据的意义;</span><br><span class="line">active connections - 当前Nginx 正处理的活动连接数;</span><br><span class="line">serveraccepts handled requests - 总共处理了 233851个连接，成功创建 233851次握手(证明中间没有失败的)</span><br><span class="line">    总共处了 687942个请求(平均每次扬处理了  2.94 个数据请求)。</span><br><span class="line">    reading -nginx 读取到客户端的Header信息数;</span><br><span class="line">    writing -nginx 返回给客户端的Header 信息数; </span><br><span class="line">    waiting - 开启 keep-alive 的情况下，这个值等于 active- (reading +wrting) 意思就是Nginx 已经处理完正等候一次请求指令的驻留连接;</span><br><span class="line">UserParameter&#x3D;Mysql.dml[*], &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql -h$1 -u$2 -p$3 -e &#39;SHOW GLOBAL STATUS&#39; | awk &#39;&#x2F;Com_$4\&gt;&#x2F;&#123;print $$2&#125;&#39; # 在&#x2F;etc&#x2F;init.d&#x2F;zabbix_agentd.d&#x2F;xx.conf中定义了以上项后; </span><br><span class="line">在zabbix-server 终端</span><br><span class="line"></span><br><span class="line">zabbix_get -s 172.16.55.124 -p 10050 -k &quot;Mysql.dml[172.16.55.124,root,password,delete]&quot;  #注意mysql用户的授权</span><br><span class="line">zabbix_get -s 172.16.55.124 -p 10050 -k &quot;Mysql.dml[172.16.55.124]&quot;</span><br><span class="line">UserParameter&#x3D;Nginx.active[*], &#x2F;usr&#x2F;bin&#x2F;curl -s &quot;http:&#x2F;&#x2F;$1:$2&#x2F;status&quot; | awk &#39;&#x2F;^Active&#x2F; &#123;print $NF&#125;&#39;</span><br><span class="line">UserParameter&#x3D;Nginx.reading[*], &#x2F;usr&#x2F;bin&#x2F;curl -s &quot;http:&#x2F;&#x2F;$1:$2&#x2F;status&quot; | grep &#39;Reading&#39; | cut -d&quot; &quot; -f2</span><br><span class="line">UserParameter&#x3D;Nginx.writing[*], &#x2F;usr&#x2F;bin&#x2F;curl -s &quot;http:&#x2F;&#x2F;$1:$2&#x2F;status&quot; | grep &#39;Writing&#39; | cut -d&quot; &quot; -f4</span><br><span class="line">UserParameter&#x3D;Nginx.waiting[*], &#x2F;usr&#x2F;bin&#x2F;curl -s &quot;http:&#x2F;&#x2F;$1:$2&#x2F;status&quot; | grep &#39;Waiting&#39; | cut -d&quot; &quot; -f6</span><br><span class="line">UserParameter&#x3D;Nginx.accepted[*], &#x2F;usr&#x2F;bin&#x2F;curl -s &quot;http:&#x2F;&#x2F;$1:$2&#x2F;status&quot; | awk &#39;&#x2F;^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+&#x2F; &#123;print $$1&#125;&#39;</span><br><span class="line">UserParameter&#x3D;Nginx.handled[*], &#x2F;usr&#x2F;bin&#x2F;curl -s &quot;http:&#x2F;&#x2F;$1:$2&#x2F;status&quot; | awk &#39;&#x2F;^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+&#x2F; &#123;print $$2&#125;&#39;</span><br><span class="line">UserParameter&#x3D;Nginx.requests[*], &#x2F;usr&#x2F;bin&#x2F;curl -s &quot;http:&#x2F;&#x2F;$1:$2&#x2F;status&quot; | awk &#39;&#x2F;^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+&#x2F; &#123;print $$3&#125;&#39;</span><br><span class="line"></span><br><span class="line">UserParameter&#x3D;nginx.access_countaccess, &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;logcheck_nginx.accesslog totalaccess</span><br><span class="line">UserParameter&#x3D;nginx.access_count200, &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;logcheck_nginx.accesslog 200access</span><br><span class="line">UserParameter&#x3D;nginx.access_count202, &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;logcheck_nginx.accesslog 202access</span><br><span class="line">UserParameter&#x3D;nginx.access_count4xx, &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;logcheck_nginx.accesslog 4xxaccess</span><br><span class="line">UserParameter&#x3D;nginx.access_count3xx, &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;logcheck_nginx.accesslog 3xxaccess</span><br><span class="line">UserParameter&#x3D;nginx.access_count5xx, &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;logcheck_nginx.accesslog 5xxaccess</span><br><span class="line"></span><br><span class="line">UserParameter&#x3D;varnish.stat[*], &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;varnishstatus varnish_stat $1</span><br><span class="line">UserParameter&#x3D;varnish.count[*], &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;varnishstatus varnish_count $1</span><br><span class="line">UserParameter&#x3D;varnish.hitrate, &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts&#x2F;varnishstatus varnish_hitrate</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="zabbix-自动发现功能"><a href="#zabbix-自动发现功能" class="headerlink" title="zabbix 自动发现功能"></a>zabbix 自动发现功能</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">zabbix 提供网络发现功能: network discovery</span><br><span class="line">    基于HTTP、 ICMP、 SSH、 LDAP、 TCP、 SNMP、 Telnet、 Zabbix_agent扫描指定网内的主机;</span><br><span class="line">    一旦主机被发现，如何对其进行操作，将由action来决定;</span><br><span class="line">    LLD: low leverl Discovery (底级网络发现功能)</span><br><span class="line">    此二者的功能:</span><br><span class="line">        自动添加主机、链接至模板&#x2F;移除链接、自动分组、自动添加监控项、定义触发器等、执行远程脚本;</span><br><span class="line">    Discovery中的事件:</span><br><span class="line">        Service Up, Service Down, Host Up, Host Down, Service Discovered, Service Lost, Host Discovererd, Host Lost</span><br><span class="line"></span><br><span class="line">    网络发现有两个步骤:</span><br><span class="line">        discovery --&gt; action</span><br><span class="line">    actions:</span><br><span class="line">        Sending notifications</span><br><span class="line">        Adding&#x2F;removting hosts</span><br><span class="line">        Enabling&#x2F;disabling hosts</span><br><span class="line">        Adding hosts to a group</span><br><span class="line">        Removing hosts from a group </span><br><span class="line">        Linking hosts to&#x2F;unlinking from a template</span><br><span class="line">        Executing remote scripts</span><br><span class="line">        </span><br><span class="line">        自动发现功能的使用，首先要将server端和agentu端的时间自动同步;</span><br><span class="line">         # vim &#x2F;etc&#x2F;zabbix&#x2F;zabbix_agentd.conf </span><br><span class="line">         Server &#x3D; 172.16.55.124</span><br><span class="line">         ServerActive &#x3D; 172.16.55.124</span><br><span class="line">         Hostname &#x3D; test.xxxxxx.com</span><br><span class="line">         LogRemoteCommand &#x3D; 1</span><br><span class="line">         # systectl start zabbix-agent</span><br><span class="line">         </span><br><span class="line">         Configure --&gt; Discovery --&gt; Create discovery rule </span><br><span class="line">            --&gt; Name Local Linux Servers </span><br><span class="line">            --&gt; IP range 172.16.55.125-127</span><br><span class="line">            Delay(in sec)  3600</span><br><span class="line">            --&gt; Checks  Check type ICMP ping(最易于实现的方式) --&gt; Add</span><br><span class="line">            --&gt; Device uniqueness criteria IP address </span><br><span class="line">            --&gt; Enabled </span><br><span class="line">            Add &lt;--</span><br><span class="line">        # 当返回到Discovery 时，可以看到服务器已经被自动发现;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> # 创建动作</span><br><span class="line"> Configuration --&gt; Actions --&gt; Discovery(和以往action不同，在选项卡中先择)</span><br><span class="line"> 主机发现的条件</span><br><span class="line">    Conditions: New condition Host IP &#x3D;</span><br><span class="line">                        或者指定网络的发现规则来定义</span><br><span class="line">    Operations:  这里就可以定义对应的操作（添加到组中）</span><br><span class="line"> Configuration --&gt; Templates --&gt; </span><br><span class="line">    --&gt; Template name Linux Server Memory Stats</span><br><span class="line">    --&gt; Visible anme</span><br><span class="line">    --&gt; Groups In groups test group </span><br><span class="line">    Add &lt;--</span><br><span class="line"># 另外需要自己定义好一个模板</span><br><span class="line"></span><br><span class="line">Configuration --&gt; Actions  --&gt; Create Action</span><br><span class="line">--&gt; Conditions --&gt; Type of calculation And&#x2F;Or </span><br><span class="line">--&gt; Conditions --&gt; Host IP &#x3D; 172.16.55.125-128</span><br><span class="line">                            --&gt;Discovery rule &#x3D; Local Linux Servers</span><br><span class="line">                            --&gt; Discovery status &#x3D; Discovered</span><br><span class="line">--&gt; Operations --&gt; New</span><br><span class="line">        --&gt; Add  To host group  (Test group) # 添加到组中</span><br><span class="line">        --&gt; Link to template  Linux Server Memory status  add </span><br><span class="line">ADD &lt;--</span><br><span class="line"></span><br><span class="line">在网络的自动发现中，我们可以使用zabbix-agent来发现 </span><br><span class="line">在网络的主动发现中，由于是zabbix主动扫描，因此这种模型是非常消耗性能的</span><br></pre></td></tr></table></figure>
<p>在mariadb中查看支持的key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MariaDB&gt; use zabbix;</span><br><span class="line">MariaDB&gt; SELECT key_ FROM items;</span><br><span class="line">使用agent-ping 来做实现主机探测;</span><br></pre></td></tr></table></figure>
<h2 id="auto-registation-主动注册功能"><a href="#auto-registation-主动注册功能" class="headerlink" title="auto_registation 主动注册功能"></a>auto_registation 主动注册功能</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Active Agent Auto-Registration</span><br><span class="line"># 首先主机之间要时间同步; </span><br><span class="line"># 安装zabbix-agent 端;</span><br><span class="line"># vim &#x2F;etc&#x2F;zabbix&#x2F;zabbix-agent.conf</span><br><span class="line"># ServerActive&#x3D;172.16.100.6</span><br><span class="line"># Hostname&#x3D;test.xxxxx.com</span><br><span class="line"># ListenIp&#x3D;172.16.55.126</span><br><span class="line"># HostMetdata &#x3D; test4  (只用于自动注册主机的唯一标识)</span><br><span class="line"> # systemctl restart zabbix-agent </span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 添加自动注册的动作</span><br><span class="line">Configuration --&gt;  Actions --&gt; (Event source Autoregistration) --&gt; Create Action</span><br><span class="line">--&gt; Actions: auto registration </span><br><span class="line">--&gt; Condition: Hostname like node4  (比如主机名中包中包涵node4) --&gt; Add</span><br><span class="line">--&gt; Operations  Add to Host groups --&gt; Link with templates 链接至模板</span><br><span class="line"># 支持使用agent(active)类型的item key:</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 配置过程:</span><br><span class="line">    (1)定义agent端:</span><br><span class="line">        ServerActive&#x3D;</span><br><span class="line">        Server&#x3D;</span><br><span class="line">        Hostname&#x3D;</span><br><span class="line">        ListenIP&#x3D; 设置为本机某特定IP：</span><br><span class="line">        ListenPort&#x3D;</span><br><span class="line">        HostMetadata&#x3D;</span><br><span class="line">        HostMetadataItem&#x3D; item key， 一般使用system.uname</span><br><span class="line">    </span><br><span class="line">    (2) 配置action，要求其事件一源为auto-registation </span><br></pre></td></tr></table></figure>
<p>LLD: low Level Discovery </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 自动发现特定变更的名称</span><br><span class="line">    #IFNAME(接口名称) , #FSNAME(文件系统名称)</span><br><span class="line"># 主要将本地的一些特殊数据发送到服务端，比如接口类的数据;</span><br><span class="line"># 添加针对变理的Items:</span><br><span class="line"># 返回值为JSON </span><br><span class="line"></span><br><span class="line">Configurations --&gt;Templates --&gt; discovery rules --&gt; create discovery rules</span><br><span class="line">--&gt; name if lld</span><br><span class="line">--&gt; Type zabbix agent </span><br><span class="line">--&gt; Key  net.if.[#IFNAME,bytes]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 登录 zabbix数据库查询对应的key</span><br><span class="line"># use zabbix;</span><br><span class="line"># SELECT key_ FROM iem WHERE key_ LIKE &#39;%discovery%&#39;;</span><br></pre></td></tr></table></figure>
<h2 id="Web-监控"><a href="#Web-监控" class="headerlink" title="Web 监控"></a>Web 监控</h2><ul>
<li>Zabbix 还可以进行web 站点的可用性检测; </li>
<li>创建web监控需要定义一个web方案(scenarios);</li>
<li>web方案包括一个或多个HTTP请求或”步骤(step)”;</li>
<li>步骤(step)的执行过程按照预先定义的顺序进行执行;</li>
<li>通过web监控可以实时获取以下信息;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 整个web方案中所有的步骤的平均下载速度;</span><br><span class="line"># 失败的步骤号;</span><br><span class="line"># 失败的报错信息;</span><br></pre></td></tr></table></figure>
<ul>
<li>在web方案的具体步骤中，可以按需要使用如下信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 该步骤的下载速度;</span><br><span class="line"># 回应时间;</span><br><span class="line"># 回应状态码;</span><br></pre></td></tr></table></figure>
<ul>
<li>Zabbix也可以检测获取到HTML页面中是否包含预设的字符串，也可以实现登录和页面点击;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 首先需要定意一个application</span><br><span class="line"># Configuration --&gt; Hosts --&gt; Web</span><br><span class="line">    --&gt; Scenario Zabbix server</span><br><span class="line">    --&gt; google charme</span><br><span class="line">--&gt; Steps</span><br><span class="line">    --&gt; zabbix home </span><br><span class="line">    --&gt; http:&#x2F;&#x2F;172.16.55.123&#x2F;index.html</span><br><span class="line">    --&gt; Require status code 200 </span><br></pre></td></tr></table></figure>
<p>zabbix的监控方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># zabbix-web 所能够显示的且可指定为监控接口类型的监控方式:</span><br><span class="line">Agent: passive active</span><br><span class="line">SNMP: Simple Network Management Protocol</span><br><span class="line">IPMI:</span><br><span class="line">    智慧平台管理接口（Interlligent-Platform Management Interface）原本是一种Inter架构的企业系统的周边</span><br><span class="line">    设备所采用的一种工业标准;</span><br><span class="line">    IPMI亦是一开放的免费标准，使用者无需支付额外的费即可使用此标准;</span><br><span class="line">JMX: Java Manaement Extensions, 用于通过Java自己的接口对java程序进行监控;</span><br><span class="line">zabbix-java-getway用于获取监控数据:</span><br></pre></td></tr></table></figure>
<p>SNMP 监控方式 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 操作: Get, NetNext, Set , Resonse, Trap</span><br><span class="line">MIB: 是被 管理对象的集合，而且还额外定义了被管理对象的名称、访问权限、数据类型等属性;</span><br><span class="line">MIB视图: MIB的子集;</span><br><span class="line">授权:将MIB视图与Community绑定来实现;</span><br><span class="line">OID: Object ID 1.3.5.1.2.1</span><br><span class="line">    1: system </span><br><span class="line">    2: interface</span><br><span class="line">    4:ip </span><br><span class="line">    6: tcp </span><br><span class="line">    7: udp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install net-snmp  net-snmp-libs net-snmp-utils</span><br><span class="line"># vim &#x2F;etc&#x2F;snmp&#x2F;snmpd.conf </span><br><span class="line">com2sec notConfigUser default public </span><br><span class="line">group notConfigGroup v1 notConfigUser </span><br><span class="line">group notConfigGroup v2c notConfigUser </span><br><span class="line"></span><br><span class="line">view  systemview include .1.3.6.1.2.1 </span><br><span class="line">view systemview include .1.3.6.1.2.1.25.1.1</span><br><span class="line"></span><br><span class="line">access notConfigGroup &quot;&quot; any noauth exact systemview none none</span><br><span class="line"># service smpd start </span><br><span class="line"># 确定udp 的161端口已经启用;</span><br><span class="line"># 此时可以使用icmp来收集数据了;</span><br></pre></td></tr></table></figure>
<p>JMX监控方式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(1) 安装zabbix-java-gateway:</span><br><span class="line">    配置文件: &#x2F;etc&#x2F;zabbix&#x2F;zabbix_java_gateway.conf</span><br><span class="line">    Listen_IP &#x3D; </span><br><span class="line">    Listen_PORT &#x3D; 10052</span><br><span class="line"></span><br><span class="line">    zabbix server的配置文件 &#x2F;etc&#x2F;zabbix&#x2F;zabbix_server.conf</span><br><span class="line">        JavaGateWay&#x3D;</span><br><span class="line">        JavaGateWayPort&#x3D; 10052</span><br><span class="line">        </span><br><span class="line">    (2) Java应用程序开户JMX接口:</span><br><span class="line">        java -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port &#x3D;10053 -Dcom.sun.management.jmxremote.authenticate&#x3D;false -Dcom.sun.management.jmxremoe.ssl&#x3D;false</span><br><span class="line"></span><br><span class="line">监控Tomcat</span><br><span class="line">        export CATALINA_OPTS&#x3D;&quot;$CATALINA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port &#x3D;10053 -Dcom.sun.management.jmxremote.authenticate&#x3D;false -Dcom.sun.management.jmxremoe.ssl&#x3D;false&quot;</span><br></pre></td></tr></table></figure>
<h2 id="zabbix-分布式监控概述"><a href="#zabbix-分布式监控概述" class="headerlink" title="zabbix 分布式监控概述"></a>zabbix 分布式监控概述</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Zabbix能高效地监控分布式IT架构;</span><br><span class="line"># 在大型环境中Zabbix提供两种解决方案;</span><br><span class="line">    1、使用代理(proxy);</span><br><span class="line">    2、使用节点(node);</span><br><span class="line"># 代理(proxy)用于本区域数据收集，并将数据发送给server;</span><br><span class="line"># 节点(node) 提供完整的Zabbix server用以建立分布式监控中的层级;</span><br><span class="line"># Server-Node-Client特性;</span><br><span class="line">    解决host过多时单台Server面临性能瓶颈的问题;</span><br><span class="line">        使用多个instance;</span><br><span class="line">        每个instance是独立的一套zabbix，有database和Frontend(optional);</span><br><span class="line">    支持热插拔，Node和Server的连接可以随时断开，但不影响Node的正常运行;</span><br><span class="line">    Node定时给Server发送configuration, history,event;</span><br><span class="line">    Server定时给Node发送configurations</span><br><span class="line">    所有配置变更只能在Node节点操作，不能再Server操作;</span><br><span class="line">    支持树状结构，Node又可以是多个Server;</span><br><span class="line"># Proxy vs Node</span><br><span class="line">        Node本身是一台server,它有完整的web页面，完整的数据库，它将数据源源不断传送给Master;</span><br><span class="line">        Poxy是只有一个proxy的daemon进程，proxy也有自己的数据库，但它的数据库只会保存一定时间的数据;</span><br><span class="line">        它与Master通信是将一批信息打包后发送到Master， Master将这些数据merge入Mater数据库;</span><br><span class="line"># Master-Proxy 相比Master-Node的优点有以下</span><br><span class="line">        Proxy压力小，数据库只存储一定时间数据;</span><br><span class="line">        Master压力变小，数据不是源源不断获取，减小IO压力;</span><br><span class="line">        架构更清晰，易维护；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># zabbix-proxy 也需要被监控</span><br><span class="line"># yum -y install zabbix-proxy zabbix-proxy-mysql zabbix zabbix-agent</span><br><span class="line"># mysql </span><br><span class="line">CREATE DATABASE zabbix_proxy CHARACTER SET utf8;</span><br><span class="line">GRANT ALL ON zabbix_proxy.* TO zbxuser@&#39;172.16.%.%&#39; IDENTIFIED BY &#39;xxxxxx&#39;;</span><br><span class="line">FLUSH PREVILEGES; </span><br><span class="line"># vim &#x2F;etc&#x2F;zabbix&#x2F;zabbix_proxy.conf</span><br><span class="line">Server&#x3D;172.16.55.123</span><br><span class="line">Hostname&#x3D;test.xxxx.com</span><br><span class="line">DBHost&#x3D;172.16.55.123</span><br><span class="line">DBName&#x3D;zabbix_proxy</span><br><span class="line">DBUser&#x3D;zbxuser</span><br><span class="line">DBPassword&#x3D;xxxxxx</span><br><span class="line">ConfigFrequency&#x3D;600  #多久向服务器端拉取一次数据</span><br><span class="line"># server zabbix-proxy start </span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Administration --&gt; Proxies </span><br><span class="line">Proxy name test.xxxx.com</span><br><span class="line">Proxy mode Active</span><br><span class="line">Hosts Proxy hosts</span><br><span class="line"># 再添加被监控服务器时可以在创建主机时可以指明Monitored by proxy</span><br></pre></td></tr></table></figure>
<p>zabbix database需要用到的空间:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">60000&#x2F;60 &#x3D; 1000条 </span><br><span class="line">历史数据&#x3D;天数x每秒钟处理的数据是x24x3600x50Bytes</span><br><span class="line">    90x1000x8600x50Bytes</span><br><span class="line">趋势数据:</span><br><span class="line">    每一个趋势数据128Bytes,</span><br><span class="line">        大小&#x3D;天数x监控项x24x128Bytes</span><br><span class="line">事件数据:</span><br><span class="line">    每个占据130Bytes</span><br><span class="line">        大小:天数x86400x130</span><br></pre></td></tr></table></figure>

  
  
    
    <div class='footer'>
      
      
      
        <div class='copyright'>
          <blockquote>
            
              
                <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

              
            
              
                <p>本文永久链接是：<a href=https://www.asjin.com/2018/04/02/zabbix%E9%AB%98%E7%BA%A7/>https://www.asjin.com/2018/04/02/zabbix%E9%AB%98%E7%BA%A7/</a></p>
              
            
          </blockquote>
        </div>
      
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-09-29T18:55:13+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：Sep 29, 2020</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/rhca/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>rhca</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/linux/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>linux</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.asjin.com/2018/04/02/zabbix%E9%AB%98%E7%BA%A7/&title=zabbix使用进阶 - 逝水锦遥&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.asjin.com/2018/04/02/zabbix%E9%AB%98%E7%BA%A7/&title=zabbix使用进阶 - 逝水锦遥&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.asjin.com/2018/04/02/zabbix%E9%AB%98%E7%BA%A7/&title=zabbix使用进阶 - 逝水锦遥&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png">
          
        </a>
      
    
      
    
      
    
  </div>
</div>



        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/2018/04/02/zabbix%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/'>
          <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>zabbix监控实现文档</p>
          <p class='content'>[toc]
Zabbix 监控实现文档
理论知识了解123456789101112131415传感器;数据采集 --&gt; 数据存储 --&gt; 数据展示;         报警: 采集到的...</p>
        </a>
      
      
        <a class='next' href='/2018/03/21/%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84Fabric%E7%BD%91%E7%BB%9C/'>
          <p class='title'>运行一个简单的Fabric网络<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>[toc]
运行一个简单的Fabric网络设定一个简单的Fabric的网络场景,包括2个organization,每个有2个peer,并使用”solo” ordering服务;网络实体所需的加密...</p>
        </a>
      
    </div>
  
</article>


  

  <article class="post white-box reveal floatable" id="comments">
    <p ct><i class='fas fa-comments'></i> 评论</p>
    
    <div id="valine_container" class="valine_thread">
  <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
</div>

  </article>






</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper floatable desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#zabbix-%E6%8A%A5%E8%AD%A6%E5%AA%92%E4%BB%8B"><span class="toc-text">zabbix 报警媒介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zabbix%E6%9C%AF%E8%AF%AD%E4%B8%8E%E6%93%8D%E4%BD%9C%E6%B3%A8%E6%84%8F%E9%A1%B9"><span class="toc-text">Zabbix术语与操作注意项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zabbix%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E7%A8%8B"><span class="toc-text">Zabbix服务器进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zabbix-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-text">zabbix 可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF-Templats"><span class="toc-text">模板(Templats)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7nginx-status"><span class="toc-text">监控nginx status</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zabbix-%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0%E5%8A%9F%E8%83%BD"><span class="toc-text">zabbix 自动发现功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#auto-registation-%E4%B8%BB%E5%8A%A8%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-text">auto_registation 主动注册功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-%E7%9B%91%E6%8E%A7"><span class="toc-text">Web 监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zabbix-%E5%88%86%E5%B8%83%E5%BC%8F%E7%9B%91%E6%8E%A7%E6%A6%82%E8%BF%B0"><span class="toc-text">zabbix 分布式监控概述</span></a></li></ol>
    </div>
  </section>


  


</aside>



        
        
          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="zabbix使用进阶";
  pdata.commentPath="";
  pdata.commentPlaceholder="";

  var l_header=document.getElementById("l_header");
  
  l_header.classList.remove("show");
  
</script>

        
      </div>
      
  
  <footer class="footer clearfix">
    <br><br>
    
      
        <div class="aplayer-container"cn/' style="color:#f72b07"> 晋ICP备-17010575号-1 </a>
		  <a target="_blank" rel="noopener" href='https://beian.miit.gov.cn/' style="color:#f72b07"> 晋ICP备-17010575号-4 </a>
		</div>




		<div class="github-badge">
          <span class="badge-subject">Powered</span><span class="badge-value bg-blue">Hexo</span>
        </div>
        <div class="github-badge">
          <span class="badge-subject">Hosted</span><span class="badge-value bg-brightgreen">Aliyun</span>
        </div>
        <div class="github-badge">
          <span class="badge-subject">DNS</span><span class="badge-value bg-orange">Aliyun</span>
        </div>
        <div class="github-badge">
          <span class="badge-subject">Theme</span><span class="badge-value bg-pink"><a target="_blank" rel="noopener" href="https://github.com/volantis-x/hexo-theme-volantis/tree/4.1.6">Volantis</a ></span>
        </div>
        <div class="github-badge">
          <span class="badge-subject">UV</span><span class="badge-value bg-blueviolet" id="busuanzi_value_site_uv"></span>
        </div>
        <div class="github-badge">
          <span class="badge-subject">PV</span><span class="badge-value bg-blueviolet" id="busuanzi_value_site_pv"></span>
        </div>
        <div class="github-badge">
          <span class="badge-subject"><i class="fa fa-copyright"></i></span><span class="badge-value bg-pink">BY-NC-SA 4.0</span>
        </div>





<!--
        <div class='copyright'>
        <p><a href="/">Copyright © 2017-2021 asjin.com</a></p>

        </div>
-->
      
    
      
        <br>
        <div class="social-wrapper">
          
            
          
            
          
            
          
        </div>
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <div><p><a href="/">Copyright © 2017-2021 asjin.com</a></p>
</div>
        
      
    
  </footer>


      <a id="s-top" class="fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
    </div>
  </div>
  <div>
    <script>
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/********************脚本懒加载函数********************************/
function loadScript(src, cb) {
var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
var script = document.createElement('script');
script.setAttribute('type','text/javascript');
if (cb) script.onload = cb;
script.setAttribute('src', src);
HEAD.appendChild(script);
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script>
<script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  
  
</script>
<!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    setTimeout(function() {
      loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
    }, 1);
  };
  $(function () {
    SCload_fancybox();
  });
</script>


<!-- internal -->







  <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  
  
    <script async src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
  




  <script src="/js/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
		if($(".highlight .code pre").length+$(".article pre code").length==0)return;
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
</script>








  
  
<script src="https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"></script>


<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link,header'.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick', 'mail', 'link'];
  var requiredFields = 'nick,mail'.split(',').filter(function (item) {
    return REQUIRED_FIELDS.indexOf(item) > -1
  });

  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }

  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }

  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;

    let pagePlaceholder = pdata.commentPlaceholder || "快来评论吧~ 🤩 🤩 🤩";

    let path = pdata.commentPath;
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }

    var valine = new Valine();
    valine.init({
      el: '#valine_container',
      meta: meta,
      placeholder: pagePlaceholder,
      path: path,
      appId: "NkJqMpxu4QlRLhPIHipNUHF1-gzGzoHsz",
      appKey: "D2vTdueKJ8ammc2JEdje0vLW",
      pageSize: '',
      avatar: 'monsterid',
      lang: '',
      visitor: '',
      highlight: '',
      mathJax: '',
      enableQQ: 'true',
      recordIP: 'false',
      requiredFields: requiredFields,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps
    })
  }

  $(function () {
    pjax_valine();
  });
</script>




  <script defer src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js" data-pjax></script>


  
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@4.1.6/source/js/app.min.js"></script>



<!-- optional -->

  <script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );

$('.input.u-search-input').one('focus',function(){
	
		loadScript('https://cdn.jsdelivr.net/npm/hexo-theme-volantis@4.1.6/source/js/search/hexo.min.js',setSearchService);
	
})

function listenSearch(){
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
}
function setSearchService() {
	listenSearch();
	
		document.addEventListener("pjax:success", listenSearch);
	
}
</script>













  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "user-color-scheme";
const rootElementDarkModeAttributeName = "data-user-color-scheme";

const setLS = (k, v) => {
  try {
    localStorage.setItem(k, v);
  } catch (e) {
    console.log(e.message);
  }
};

const removeLS = (k) => {
  try {
    localStorage.removeItem(k);
  } catch (e) {
    console.log(e.message);
  }
};

const getLS = (k) => {
  try {
    return localStorage.getItem(k);
  } catch (e) {
    console.log(e.message);
    return null;
  }
};

const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};

const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};

const validColorModeKeys = {
  dark: true,
  light: true,
};

const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);

  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};

const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};

/**
 * get target mode
 */
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);

  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};

/**
 * bind click event for toggle button
 */
function bindToggleButton() {
	var btn=$("#wrapper .toggle-mode-btn");
    btn.on('click',(e) => {
      const mode = toggleCustomDarkMode();
      applyCustomDarkModeSettings(mode);
    });
}

applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", bindToggleButton);
document.addEventListener("pjax:success", bindToggleButton);

</script>






<script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script>

<!-- more -->




    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#l_cover",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
       

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      
	 

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
          if (typeof $.fancybox == "undefined") {
            SCload_fancybox();
          } else {
            pjax_fancybox();
          }
        
        
        
        
        
          pjax_initCopyCode();
        
        
          pjax_valine();
        
        
        
        
      } catch (e) {
        console.log(e);
      }
	  
    });

    document.addEventListener('pjax:error', function (e) {
	  
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
</body>
</html>
