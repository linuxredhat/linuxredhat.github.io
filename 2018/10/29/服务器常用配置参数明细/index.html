<!DOCTYPE html>
<html lang="zh-Hans">
<head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/4.1.6'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>服务器常用配置参数明细 - </title>
  
    <meta name="keywords" content="rhca,linux">
  

  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="null" type="application/atom+xml">
  

  <!-- import meta -->
  

  <!-- link -->
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/first.css">

  

  
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  

  <script id="loadcss"></script>
</head>


<body>
	  <canvas id="canvas" width="1440" height="900" ></canvas>
	  <script type="text/javascript" src="/js/DigitalRain.js"></script>
  

<header id="l_header" class="l_header always floatable "  >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='/images/head.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fab fa-linux fa-fw'></i>所有文章
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/program
                  
                  
                  
                    id="tagsprogram"
                  >
                  <i class='fab fa-gitlab fa-fw'></i>运维开发
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/rhca
                  
                  
                  
                    id="tagsrhca"
                  >
                  <i class='fas fa-heartbeat fa-fw'></i>运维组件
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/cloud
                  
                  
                  
                    id="tagscloud"
                  >
                  <i class='fas fa-cloud fa-fw'></i>云计算
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/zikao
                  
                  
                  
                    id="tagszikao"
                  >
                  <i class='fab fa-drupal fa-fw'></i>成自考
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/renjin
                  
                  
                  
                    id="tagsrenjin"
                  >
                  <i class='fas fa-user-circle fa-fw'></i>个人中心
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/box/
                  
                  
                  
                    id="box"
                  >
                  <i class='fas fa-flag fa-fw'></i>工具箱
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="搜索文章..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fab fa-linux fa-fw'></i>所有文章
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/program
                  
                  
                  
                    id="tagsprogram"
                  >
                  <i class='fab fa-gitlab fa-fw'></i>运维开发
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/rhca
                  
                  
                  
                    id="tagsrhca"
                  >
                  <i class='fas fa-heartbeat fa-fw'></i>运维组件
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/cloud
                  
                  
                  
                    id="tagscloud"
                  >
                  <i class='fas fa-cloud fa-fw'></i>云计算
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/zikao
                  
                  
                  
                    id="tagszikao"
                  >
                  <i class='fab fa-drupal fa-fw'></i>成自考
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/renjin
                  
                  
                  
                    id="tagsrenjin"
                  >
                  <i class='fas fa-user-circle fa-fw'></i>个人中心
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/box/
                  
                  
                  
                    id="box"
                  >
                  <i class='fas fa-flag fa-fw'></i>工具箱
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  <div id="l_body">
    <div id="l_cover">
  
    
        <div id="half" class='cover-wrapper post search' style="display: ;">
          
            <div class='cover-bg lazyload placeholder' data-bg="/images/background.jpg"></div>
          
          <div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">S  S  J  Y</p>
    
    
      <p class="subtitle">有志而性缓者思大志 有才而气和者为大才</p>
    
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="搜索本地文章" />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
      </div>
    </div>
  </div>
</div>

          <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>

    <div id='safearea'>
      <div class='body-wrapper' id="pjax-container">
        

<div class='l_main'>
  <article class="article post white-box reveal md floatable article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        服务器常用配置参数明细
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author'>
  <a class='author' href="/images/rjrt.ico" rel="nofollow">
    <img no-lazy src="/images/rjrt.ico">
    <p>任锦</p>
  </a>
</div>

          
        
          
            

          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Oct 29, 2018</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item browse busuanzi">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <p>
        <span id="busuanzi_value_page_pv">
          <i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i>
        </span>
        次浏览
      </p>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  <p>[toc]</p>
<h1 id="线上服务配置参数明细"><a href="#线上服务配置参数明细" class="headerlink" title="线上服务配置参数明细"></a>线上服务配置参数明细</h1><p><img src="/images/ops.png" class="lazyload" data-srcset="/images/ops.png" srcset="data:image/png;base64,666" alt=""></p>
<ul>
<li><p>问答nginx 反向代理的作用<br>1、使用反向代理可以理解为7层应用层的负载均衡，使用负载均衡之后可以非常便捷的横向扩展服务器集群，实现集群整体并发能力、抗压能力的提高。<br>2、通常反向代理服务器会带有本地 Cache 功能，通过静态资源的 Cache，有效的减少后端服务器所承载的压力，从而提高性能。</p>
</li>
<li><p>磨刀意识</p>
</li>
</ul>
<p>1、关于任何操作配置，最好先搞明白操作或配置的原理，然后再去操作。应一句话叫做“磨刀不误砍柴功”，而且对于类似的操作可以举一反三。</p>
<h2 id="nginx服务配置项"><a href="#nginx服务配置项" class="headerlink" title="nginx服务配置项"></a>nginx服务配置项</h2><p>1、 nginx 全局配置明细</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"># 默认 &#x2F;etc&#x2F;nginx&#x2F;nginx.conf 全局配置文件 </span><br><span class="line">#指定nginx worker进程运行用户以及用户组，也可以是 user www-data www-data;</span><br><span class="line">user www-data; </span><br><span class="line"># 指明nginx要开启的进程数为4，一般为CPU核心数的1到2倍;</span><br><span class="line">worker_processes 4;</span><br><span class="line"></span><br><span class="line"># nginx pid文件存放位置 </span><br><span class="line">pid &#x2F;run&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line"># events &#123;这里都是nginx的事件模块&#125;</span><br><span class="line">events &#123;</span><br><span class="line"># worker_connetctions 是指nginx最大的并发连接数;</span><br><span class="line">	worker_connections 768;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># http &#123;设定http服务&#125;</span><br><span class="line">http &#123;</span><br><span class="line"># 设置nginx上传文件最大限制</span><br><span class="line">   client_max_body_size 50m;   </span><br><span class="line">   </span><br><span class="line">#  配置可以提高 Nginx 静态资源托管效率。sendfile 是一个系统调用，直接在内核空间完成文件发送，不需要先 read 再 write，没有上下文切换开销;	</span><br><span class="line">	sendfile on;</span><br><span class="line">	</span><br><span class="line"># Nginx 里统一用 tcp_nopush 来控制它,只有在启用了 sendfile 之后才生效，启用它之后，数据包会累计到一定大小之后才会发送，减小了额外开销，提高网络效率;</span><br><span class="line">	tcp_nopush on;</span><br><span class="line">	</span><br><span class="line"># 启用后会禁用 Nagle 算法，尽快发送数据，Nginx 只会针对处于 keep-alive 状态的 TCP 连接才会启用;</span><br><span class="line">	tcp_nodelay on;</span><br><span class="line">	</span><br><span class="line"># 长连接超时时间，单位是秒,长连接请求大量小文件的时候，可以减少重建连接的开销，但假如有大文件上传  </span><br><span class="line"># 65s内没上传完成会导致失败。如果设置时间过长，用户又多，长时间保持连接会占用大量资源。</span><br><span class="line">	keepalive_timeout 65;</span><br><span class="line">	</span><br><span class="line"># types_hash_max_size 影响散列表的冲突率。types_hash_max_size越大，就会消耗更多的内存</span><br><span class="line"># 但散列key的冲突率会降低，检索速度就更快</span><br><span class="line"># types_hash_max_size越小，消耗的内存就越小，但散列key的冲突率可能上升</span><br><span class="line">	types_hash_max_size 2048;	</span><br><span class="line">	</span><br><span class="line"># 定义 mime 配置文件的文位</span><br><span class="line">	include &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line">	</span><br><span class="line"># 当用户请求的文件类型 不在服务器定义的mime类型映射时，使用DefaultType</span><br><span class="line">	default_type application&#x2F;octet-stream;</span><br><span class="line">	</span><br><span class="line"># 定义nginx正常访问日志位置 </span><br><span class="line">	access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log;</span><br><span class="line">	</span><br><span class="line"># 定义nginx错误访问日志位置 </span><br><span class="line">	error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;</span><br><span class="line">	</span><br><span class="line"># 开启nginx压缩功能，压缩的过程是个消耗CPU的过程，而压缩过后传输过程可以节省带宽;</span><br><span class="line">	gzip on;</span><br><span class="line">	</span><br><span class="line"># 对于microsoft explorer 6 不启用gzip压缩功能; </span><br><span class="line">	gzip_disable &quot;msie6&quot;;</span><br><span class="line"></span><br><span class="line"># nginx 虚拟服务器配置文件所在目录;</span><br><span class="line">	include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class="line">	</span><br><span class="line"># nginx 虚拟服务器配置文件所在目录;</span><br><span class="line">	include &#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;*.conf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2、 nginx 默认80重定向443配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 每个server代表一台虚拟主机;</span><br><span class="line">server &#123;  </span><br><span class="line"></span><br><span class="line"># listen 80 监听80端口;</span><br><span class="line">    listen  80;  </span><br><span class="line"></span><br><span class="line"># server_name  _; 定义任意域名;</span><br><span class="line">    server_name _；</span><br><span class="line"></span><br><span class="line"># 将返回301的重写到https:&#x2F;&#x2F;源服务器源uri;</span><br><span class="line">    return 301 https:&#x2F;&#x2F;$HOST$request_uri;</span><br><span class="line"></span><br><span class="line"># 将server_name 永久的将任意字符开头结尾的 重写至https:&#x2F;&#x2F;源主机源uri位置;</span><br><span class="line">#    server_name test.com;  </span><br><span class="line">#    rewrite ^(.*)$  https:&#x2F;&#x2F;$host$1 permanent;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、 nginx 线上虚拟主机配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># 每个server代表到哪虚拟主机;</span><br><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line"># 监听https传输协议的443端口，ssl为采用加密传输，并且身份证明;</span><br><span class="line">	listen 443 ssl;</span><br><span class="line"></span><br><span class="line"># ssl安全传输开启;</span><br><span class="line">	ssl on;</span><br><span class="line"></span><br><span class="line"># 注在apache中证书与加密传输还有pem是三个文件</span><br><span class="line"># ssl授权证书文件，也可以理解为身份的证明文件;</span><br><span class="line">	ssl_certificate &#x2F;home&#x2F;admin&#x2F;api_ssl&#x2F;server.crt;</span><br><span class="line"></span><br><span class="line"># ssl加密文件,数据传输过程中，通过此密钥文件将传送的数据加密码;</span><br><span class="line">	ssl_certificate_key &#x2F;home&#x2F;admin&#x2F;api_ssl&#x2F;server.key;</span><br><span class="line"></span><br><span class="line"># 设置客户端能够重复使用存储在缓存中的会话参数时间为5分钟;</span><br><span class="line">	ssl_session_timeout 5m;</span><br><span class="line"></span><br><span class="line"># 指定使用的SSL协议</span><br><span class="line">	ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line"></span><br><span class="line"># 指定许可密码的描述。密码以openssl支持的格式指定；</span><br><span class="line">	ssl_ciphers &quot;HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES&quot;;</span><br><span class="line"></span><br><span class="line"># 对SSLv3和TLSv1协议的服务器端密码需求优先级高于客户端密码;</span><br><span class="line">	ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line"># 指定虚拟主机的主机名;</span><br><span class="line">	server_name api.ssjinyao.com.com;</span><br><span class="line">	</span><br><span class="line"># location 指定匹配规则, &#x2F; 这里指默认匹配项;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">        </span><br><span class="line"># 将匹配到的location反代到至http:&#x2F;&#x2F;127.0.0.1:17777;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;127.0.0.1:17777; # 这里是指向 gunicorn host 的服务地址</span><br><span class="line"></span><br><span class="line"># 设置反向代理的请求头部host为源http的请求host;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line"></span><br><span class="line"># 设置反向代理的请求头部转发的内容为请求url的源地址;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line"># 设置将用户的IP赋值给X-Real-IP以供各应用调用;  </span><br><span class="line">	  		proxy_set_header X-Real-Ip $Remote_addr;</span><br><span class="line"></span><br><span class="line"># 设置代理缓冲大小为128k			</span><br><span class="line">			proxy_buffer_size   128k;</span><br><span class="line"></span><br><span class="line"># 设置代理缓冲区间4至 256k       </span><br><span class="line">            proxy_buffers   4 256k;</span><br><span class="line">            </span><br><span class="line"># 设置代理最大缓冲区间为256k;            </span><br><span class="line">            proxy_busy_buffers_size   256k;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、需求-负载均衡配置项:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 在http段中加入以下配置</span><br><span class="line"># 指定upstream负载均衡模块,指定将要在server中调用的调度服务名称;</span><br><span class="line">	upstream tewww &#123;</span><br><span class="line"></span><br><span class="line"># 指定web服务的第一个节点; 注:之后配置使用IP来配置，而不使用域名</span><br><span class="line">		server wwwnode1.ssjinyao.com.com:443;</span><br><span class="line">		</span><br><span class="line"># 若有性能较高的服务器，可以采用加权轮询，那么这台服务器的权重是3&#x2F;5;</span><br><span class="line">		server wwwnode2.ssjinyao.com.com:443 weight&#x3D;3;</span><br><span class="line"></span><br><span class="line"># 指定web服务的第三个节点;</span><br><span class="line">		server wwwnode3.ssjinyao.com.com:443;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 在定义一台虚拟主机；</span><br><span class="line">server &#123;</span><br><span class="line">      listen 443;</span><br><span class="line">      server_name www.ssjinyao.com.com;</span><br><span class="line"></span><br><span class="line">      ssl on;</span><br><span class="line">      ssl_certificate &#x2F;etc&#x2F;nginx&#x2F;te_ssl&#x2F;ssjinyao.com.crt;</span><br><span class="line">      ssl_certificate_key &#x2F;etc&#x2F;nginx&#x2F;te_ssl&#x2F;ssjinyao.com.key;</span><br><span class="line"></span><br><span class="line">      ssl_session_timeout 5m;</span><br><span class="line"></span><br><span class="line">      ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">      ssl_ciphers &quot;HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES&quot;;</span><br><span class="line">      ssl_prefer_server_ciphers on;</span><br><span class="line">      location &#x2F;</span><br><span class="line">      &#123;</span><br><span class="line"># 指定反代的服务器，为tewww负载均衡集群;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;tewww;</span><br><span class="line">		proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>5、nginx操作注意项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a、不影响其它服务的情况下重读配置文件, 一定要先对nginx的配置语法进行测试;</span><br><span class="line">	# sudo nginx -t </span><br><span class="line"></span><br><span class="line">b、在没有nginx监听端口变更的情况下，则不要重启服务;</span><br><span class="line">	# sudo nginx -s reload </span><br><span class="line"></span><br><span class="line">c、如上，反之，则必需重启服务器</span><br><span class="line">	# sudo nginx -s restart # sudo &#x2F;etc&#x2F;init.d&#x2F;nginx restart </span><br></pre></td></tr></table></figure>
<p>6、nginx监控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">服务端的监控，监控nginx 443端口，80端口, 最近最后一次值不为1时报警;</span><br></pre></td></tr></table></figure>
<p>7、手头存一份标准的配置文件</p>
<p>8、一次比较复杂的虚拟主机配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  jr.local.ssjinyao.com;</span><br><span class="line">        charset gb2312;</span><br><span class="line">        </span><br><span class="line"> access_log  &#x2F;Users&#x2F;zlz&#x2F;wwwroot&#x2F;logs&#x2F;jr.access.log;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">  root &#x2F;Users&#x2F;zlz&#x2F;wwwroot&#x2F;dedecms&#x2F;a&#x2F;bank;</span><br><span class="line">  index index.html index.htm index.php;</span><br><span class="line">      location ~ \.php$ &#123;</span><br><span class="line">               # default_type text&#x2F;html;</span><br><span class="line">               # add_header Content-Type &#39;text&#x2F;html; charset&#x3D;utf-8&#39;;</span><br><span class="line">               # return 200 &quot;$document_root  , $fastcgi_script_name&quot;;</span><br><span class="line">                fastcgi_split_path_info ^(.+\.php)(.*)$;</span><br><span class="line">                fastcgi_param PATH_INFO $fastcgi_path_info;</span><br><span class="line">                fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">                fastcgi_index  index.php;</span><br><span class="line">                fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">                include        fastcgi_params;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">        location &#x2F;zt &#123; </span><br><span class="line">    alias &#x2F;Users&#x2F;zlz&#x2F;wwwroot&#x2F;dedecms&#x2F;zt;</span><br><span class="line">    #default_type text&#x2F;html;</span><br><span class="line">           #add_header Content-Type &#39;text&#x2F;html; charset&#x3D;utf-8&#39;;</span><br><span class="line">           #return 200 &quot;&lt;h1&gt;十月十七&lt;&#x2F;h1&gt;&quot;;</span><br><span class="line"> </span><br><span class="line">    location ~ &#x2F;zt&#x2F;(.*)\.php(.*)$ &#123;</span><br><span class="line">               #default_type text&#x2F;html;</span><br><span class="line">               #add_header Content-Type &#39;text&#x2F;html; charset&#x3D;utf-8&#39;;</span><br><span class="line">               #return 200 &quot;$document_root  , $fastcgi_script_name&quot;;</span><br><span class="line">        alias &#x2F;Users&#x2F;zlz&#x2F;wwwroot&#x2F;dedecms;</span><br><span class="line">               fastcgi_split_path_info ^(.+\.php)(.*)$;</span><br><span class="line">               fastcgi_param PATH_INFO $fastcgi_path_info;</span><br><span class="line">               fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">               fastcgi_index  index.php;</span><br><span class="line">               fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">               include        fastcgi_params;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">        </span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">        </span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">        location ~ &#x2F;\.ht &#123;</span><br><span class="line">            deny  all;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"># proxy_pass http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;;</span><br><span class="line">#&#x2F;Users&#x2F;zlz&#x2F;wwwroot&#x2F;dedecms&#x2F;zt;</span><br><span class="line">#proxy_pass http:&#x2F;&#x2F;127.0.0.1:8089&#x2F;;</span><br></pre></td></tr></table></figure>
<p>补充一伪静态的重写，即 ww.ssjinyao.com/xxxx/xxxxx  重写至 <a target="_blank" rel="noopener" href="http://www.ssjinyao.com/xxxx/xxxx/">www.ssjinyao.com/xxxx/xxxx/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite &#x2F;(.*) https:&#x2F;&#x2F;www.ssjinyao.com&#x2F;$1&#x2F; permanent;</span><br></pre></td></tr></table></figure>
<p>rewrite 直接重写目录</p>
<p>rewrite 301</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^&#x2F;zhaokao&#x2F; &#x2F;list&#x2F;zhaokao&#x2F; permanent;</span><br><span class="line">rewrite ^&#x2F;szrd&#x2F;    &#x2F;list&#x2F;szrd&#x2F; permanent;</span><br></pre></td></tr></table></figure>
<p>rewrite 302 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^&#x2F;zhaokao&#x2F; &#x2F;list&#x2F;zhaokao&#x2F; redirect;</span><br><span class="line">rewrite ^&#x2F;szrd&#x2F;    &#x2F;list&#x2F;szrd&#x2F; redirect;</span><br></pre></td></tr></table></figure>
<p>nginx php-fpm 安全项配置 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># php-fpm.conf</span><br><span class="line">security.limit_extensions &#x3D; .php .php2 .php4 .php5 .php7 .html .htm</span><br><span class="line"># nginx vhosts</span><br><span class="line">location ~* ^&#x2F;jt&#x2F;.*.(php|php3|php4|php5)$ &#123;deny all;&#125;</span><br><span class="line"># 测试访问调度 </span><br><span class="line">location ~ \.php|\.php7|\.html|.htm$ &#123;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">        fastcgi_read_timeout 600;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="redis服务配置项"><a href="#redis服务配置项" class="headerlink" title="redis服务配置项"></a>redis服务配置项</h2><p>1、redis持久化配置</p>
<p>注: 若不需要则关闭以下配置； </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 持久化数据保存规则</span><br><span class="line"># 自己支实现一下</span><br><span class="line">#   900 秒内如果至少有 1 个 key 的值变化，则保存</span><br><span class="line">#   300 秒内如果至少有 10 个 key 的值变化，则保存</span><br><span class="line">#   60 秒内如果至少有 10000 个 key 的值变化，则保存</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"># redis持久化保存数据配置</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"># 数据保存的位置</span><br><span class="line">dir &#x2F;usr&#x2F;local&#x2F;redis&#x2F;db&#x2F;</span><br><span class="line"></span><br><span class="line"># 数据库的文件名称,另外要确定数据保存的位置redis有owner权限</span><br><span class="line">dbfilename dump.rdb</span><br></pre></td></tr></table></figure>
<p>2、redis是否需要外网连接;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 绑定的ip </span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"># port 6379 或者port 25133</span><br><span class="line"></span><br><span class="line"># 若需要外网连接，则</span><br><span class="line"># bind 0.0.0.0</span><br><span class="line"># port 6379 或者port 25133 </span><br><span class="line">注: 另外还需要在阿里云上添加对应的需要访问的地址白名单与端口白名单; </span><br></pre></td></tr></table></figure>
<p>3、目前三条业务线上的redis数据重要性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 配置未开持久化，保存的数据皆为临时数据，可以清空;</span><br><span class="line"># 配置已经开启持久化，保存的数据为数据索引;数据不可以清空;</span><br><span class="line"># 配置已经开启持久化，保存的数据为用户数据;数据不可以清空;</span><br><span class="line">注: 不论数据是否为临时数据，每次对服务器的操作都要先对数据临时保存，确保操作后不会造成数据丢失;</span><br><span class="line"># 操作过程如下</span><br><span class="line"># redis-cli </span><br><span class="line">127.0.0.1:6379&gt; AUTH Amdce0De1fxxxxx</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET dir &quot;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;db&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SAVE</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>
<p>4、掌握redis重启命令 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;redis-server stop</span><br><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;redis-server start</span><br><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;redis-server restart</span><br><span class="line"># redis-cli -h 127.0.0.1 -p 6379 shutdown </span><br><span class="line"># kill -9 REDISPID</span><br></pre></td></tr></table></figure>
<p>5、redis监控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a、监控服务redis端口 25133 或者 6379</span><br></pre></td></tr></table></figure>
<p>6、记得在/etc/redis/redis.conf中要配置密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># requirepass Amdce0De1fxxxxx</span><br></pre></td></tr></table></figure>
<p>7、注意白名单配置，让线上的服务器可以访问;</p>
<h2 id="mongo服务配置项"><a href="#mongo服务配置项" class="headerlink" title="mongo服务配置项"></a>mongo服务配置项</h2><p>1、保证有需要开机自启mongo的服务器,开机启动mongo </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 在mongo的&#x2F;etc&#x2F;rc.local中加入以下内容 </span><br><span class="line"># mongod --auth --fork -f &#x2F;etc&#x2F;mongod.conf </span><br><span class="line"># 并保证 &#x2F;etc&#x2F;rc.local有执行权限</span><br></pre></td></tr></table></figure>
<p>2、保证线上使用的mongo服务器都是3.4的 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># sudo apt-key adv --keyserver hkp:&#x2F;&#x2F;keyserver.ubuntu.com:80 --recv # 0C49F3730359A14518585931BC711F9BA15703C6  </span><br><span class="line"># echo &quot;deb [ arch&#x3D;amd64 ] http:&#x2F;&#x2F;repo.mongodb.org&#x2F;apt&#x2F;ubuntu &quot;$(lsb_release -sc)&quot;&#x2F;mongodb-org&#x2F;3.4 multiverse&quot; | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;mongodb-3.4.list&#39;  </span><br><span class="line"># sudo apt-get update  </span><br><span class="line"># sudo apt-get install mongodb-org  </span><br><span class="line"># sudo killall mongod</span><br><span class="line"># sudo echo &#39;never&#39; &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled</span><br><span class="line"># sudo echo &#39;never&#39; &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;defrag</span><br><span class="line"># sudo service mongod restart  </span><br><span class="line"># sudo chkconfig mongod on  </span><br></pre></td></tr></table></figure>
<p>3、会对用户的操作(增/删/改/查)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"># 添加admin用户</span><br><span class="line">use admin</span><br><span class="line">db.auth(&quot;admin&quot;,&quot;passwdxxxxxxxxxxx&quot;)</span><br><span class="line">use bc_ccc</span><br><span class="line"></span><br><span class="line">db.createUser(</span><br><span class="line"> &#123;</span><br><span class="line"> user:&quot;ht_eedu&quot;,</span><br><span class="line"> pwd:&#39;ht_eedom99xxx&#39;,</span><br><span class="line"> roles:[</span><br><span class="line"> &#123;role:&quot;dbOwner&quot;,db:&#39;ht_eedu&#39;&#125;</span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"> )</span><br><span class="line"> </span><br><span class="line"> db.createUser(</span><br><span class="line"> &#123;</span><br><span class="line"> user:&quot;admin&quot;,</span><br><span class="line"> pwd:&#39;passwdxxxxxxxxxxx&#39;,</span><br><span class="line"> roles:[</span><br><span class="line"> &#123;role:&quot;dbOwner&quot;,db:&#39;test&#39;&#125;</span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"> )</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line"> db.createUser(</span><br><span class="line"> &#123;</span><br><span class="line"> user:&quot;admin&quot;,</span><br><span class="line"> pwd:&#39;passwdxxxxxxxxxxx&#39;,</span><br><span class="line"> roles:[</span><br><span class="line"> &#123;role:&quot;userAdminAnyDatabase&quot;,db:&#39;admin&#39;&#125;</span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"> )</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"># 添加对应数据库的用户 </span><br><span class="line">use te_data;</span><br><span class="line">db.createUser(</span><br><span class="line"> &#123;</span><br><span class="line"> user:&quot;admin&quot;,</span><br><span class="line"> pwd:&#39;passwdxxxxxxxxxxxx&#39;,</span><br><span class="line"> roles:[</span><br><span class="line"> &#123;role:&quot;dbOwner&quot;,db:&#39;test_data&#39;&#125;</span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"> )</span><br><span class="line"># 删除用户</span><br><span class="line">db.dropUser(&quot;test_data&quot;)</span><br><span class="line"></span><br><span class="line"> db.createUser(</span><br><span class="line"> &#123;</span><br><span class="line"> user:&quot;test_data_read&quot;,</span><br><span class="line"> pwd:&#39;passwdxxxxxxxxxxx&#39;,</span><br><span class="line"> roles:[</span><br><span class="line"> &#123;role:&quot;read&quot;,db:&#39;test_data&#39;&#125;</span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"> )</span><br><span class="line"></span><br><span class="line"> db.createUser(</span><br><span class="line"> &#123;</span><br><span class="line"> user:&quot;test_read&quot;,</span><br><span class="line"> pwd:&#39;passwdxxxxxxxxxxx&#39;,</span><br><span class="line"> roles:[</span><br><span class="line"> &#123;role:&quot;read&quot;,db:&#39;test&#39;&#125;</span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"> )</span><br><span class="line"> </span><br><span class="line"># 修改用户密码</span><br><span class="line">db.changeUserPassword(&#39;admin&#39;,&#39;passwdxxxxxxxxxxxx&#39;);</span><br><span class="line"></span><br><span class="line"># 查看目前存在的用户</span><br><span class="line">&gt; show dbs</span><br><span class="line">admin         0.000GB</span><br><span class="line">bac_data      0.000GB</span><br><span class="line">kk            0.000GB</span><br><span class="line">local         0.000GB</span><br><span class="line">migrate_data  0.000GB</span><br><span class="line">te_data       0.031GB</span><br><span class="line">&gt; show users</span><br><span class="line">&#123;</span><br><span class="line">	&quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">	&quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">	&quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">	&quot;roles&quot; : [</span><br><span class="line">		&#123;</span><br><span class="line">			&quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">			&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt; use trisk_tmp</span><br><span class="line">&gt; show users;</span><br><span class="line">&gt; db.dropAllUsers()</span><br><span class="line"></span><br><span class="line"># 在库中增新建表</span><br><span class="line">use bm_kyc</span><br><span class="line">db.createCollection(&quot;ep_search&quot;)</span><br><span class="line">db.createCollection(&quot;screening_sections&quot;)</span><br><span class="line"></span><br><span class="line"># 删除字段</span><br><span class="line">db.screening_sections.remove(&#123;&#39;no&#39;:&#39;5a279xxxxxxxxx&#39;&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>4、数据的备份(导入/导出)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;tmp&#x2F;bak&#x2F;mongo</span><br><span class="line">mongodump --db test_kyc --out &#x2F;tmp&#x2F;bak&#x2F;mongo&#x2F;&#96;date +&quot;%m-%d-%y&quot;&#96;</span><br><span class="line">cd &#x2F;tmp&#x2F;bak&#x2F;mongo &amp;&amp; tar -cvf xxxx-xx-xx.tar.gz xxxx-xx-xx</span><br><span class="line">scp &#x2F;tmp&#x2F;bak&#x2F;mongo&#x2F;xxxx-xx-xx.tar.gz root@xx.xxx.xx.xxx:&#x2F;tmp&#x2F;</span><br><span class="line">crontab -e</span><br><span class="line">3 1 * * * find &#x2F;tmp&#x2F;bak&#x2F;mongo -mtime +7 -exec rm -rf &#123;&#125; \;</span><br><span class="line">mongorestore -u admin -p xxxx --db newdb --drop &#x2F;tmp&#x2F;bak&#x2F;mongo  注: --drop 要小心使用</span><br></pre></td></tr></table></figure>
<p>5、php模块编译安装3.4的支持</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">a、mac 安装php mongo模块的支持</span><br><span class="line"># brew install mongo</span><br><span class="line"># brew install mongodb</span><br><span class="line"># cd &#x2F;Library&#x2F;WebServer&#x2F;Documents</span><br><span class="line"># brew install php56-mongo</span><br><span class="line"># 以下为测试连接文件 </span><br><span class="line">➜ cat index.php </span><br><span class="line">&lt;?php</span><br><span class="line">    $m &#x3D; new MongoClient(&#39;mongodb:&#x2F;&#x2F;admin:passwdxxxxxxxxxxx@47.92.xxx.xxxx:20911&#x2F;bc_ccc&#39;);</span><br><span class="line">    echo &quot;Connection to database successfully&quot;;  </span><br><span class="line">    &#x2F;&#x2F; 选择一个数据库  </span><br><span class="line">  $db &#x3D; $m-&gt;bm_kyc;  </span><br><span class="line">   echo &quot;Database mydb selected&quot;;  </span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">➜  cat test2.php </span><br><span class="line">&lt;?php </span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line"># sudo vim &#x2F;etc&#x2F;php.ini</span><br><span class="line">    extension&#x3D;&#x2F;usr&#x2F;local&#x2F;opt&#x2F;php56-mongodb&#x2F;mongodb.so</span><br><span class="line">    extension&#x3D;&#x2F;usr&#x2F;local&#x2F;opt&#x2F;php56-mongo&#x2F;mongo.so</span><br><span class="line">    </span><br><span class="line">b、ubuntu 安装 php mongo模块的支持</span><br><span class="line"></span><br><span class="line">#  cd root &amp;&amp; wget https:&#x2F;&#x2F;github.com&#x2F;mongodb&#x2F;mongo-php-driver-legacy&#x2F;archive&#x2F;master.zip</span><br><span class="line">#  cd root &amp;&amp; unzip master.zip </span><br><span class="line">#  cd &#x2F;root&#x2F;mongo-php-driver-legacy-master&#x2F;</span><br><span class="line">#  phpize</span><br><span class="line">#  .&#x2F;configure </span><br><span class="line">#  make</span><br><span class="line">#  make install</span><br><span class="line">#  ls &#x2F;usr&#x2F;lib&#x2F;php5&#x2F;20121212&#x2F;mongo.so </span><br><span class="line"># vim &#x2F;etc&#x2F;php5&#x2F;apache2&#x2F;php.ini</span><br><span class="line">extension &#x3D; &#x2F;usr&#x2F;lib&#x2F;php5&#x2F;20121212&#x2F;mongo.so</span><br><span class="line">#  apachectl restart</span><br><span class="line">测试</span><br><span class="line"></span><br><span class="line">➜ cat index.php </span><br><span class="line">&lt;?php</span><br><span class="line">    $m &#x3D; new MongoClient(&#39;mongodb:&#x2F;&#x2F;admin:passwdxxxxxxxxxxx@47.92.162.27:20911&#x2F;bc_ccc&#39;);</span><br><span class="line">    echo &quot;Connection to database successfully&quot;;  </span><br><span class="line">    &#x2F;&#x2F; 选择一个数据库  </span><br><span class="line">  $db &#x3D; $m-&gt;bc_ccc;  </span><br><span class="line">   echo &quot;Database mydb selected&quot;;  </span><br><span class="line">?&gt;  </span><br><span class="line"></span><br><span class="line">➜  cat test2.php </span><br><span class="line">&lt;?php </span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"># 访问test2.php可以过滤到以下内容</span><br><span class="line">MONGODB-CR  enabled</span><br><span class="line">SCRAM-SHA-1 enabled</span><br><span class="line">MONGODB-X509    enabled</span><br><span class="line">GSSAPI (Kerberos)   disabled</span><br><span class="line">PLAIN   disabled</span><br></pre></td></tr></table></figure>
<p>6、注意白名单配置，让线上的服务器可以访问;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net:</span><br><span class="line">  port &#x3D;20133   # 配置mongo监听地址</span><br><span class="line">  bind_ip &#x3D;0.0.0.0  # 配置绑定的IP</span><br></pre></td></tr></table></figure>
<p>7、 注意配置文件中开启auth认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth &#x3D;true</span><br></pre></td></tr></table></figure>
<p>8、代码中不支持带有@的密码</p>
<h2 id="mysql服务配置项"><a href="#mysql服务配置项" class="headerlink" title="mysql服务配置项"></a>mysql服务配置项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 注意清空连接mysql的使用记录</span><br><span class="line"># 注意数据库的备份文件所在的服务器只能以密钥登录</span><br><span class="line"># 注意RDS的使用率</span><br></pre></td></tr></table></figure>
<h2 id="apache服务配置项"><a href="#apache服务配置项" class="headerlink" title="apache服务配置项"></a>apache服务配置项</h2><p>1、apache全局配置项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">Mutex file:$&#123;APACHE_LOCK_DIR&#125; default</span><br><span class="line">PidFile $&#123;APACHE_PID_FILE&#125;</span><br><span class="line">Timeout 300</span><br><span class="line">KeepAlive On</span><br><span class="line">MaxKeepAliveRequests 100</span><br><span class="line">KeepAliveTimeout 5</span><br><span class="line">User $&#123;APACHE_RUN_USER&#125;</span><br><span class="line">Group $&#123;APACHE_RUN_GROUP&#125;</span><br><span class="line"></span><br><span class="line"># 使得主机名能被记入日志</span><br><span class="line">HostnameLookups Off</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line"></span><br><span class="line"># 定义apache记录日志的级别为warn</span><br><span class="line">LogLevel warn</span><br><span class="line"></span><br><span class="line">#加载模块配置文件，虚拟主机配置文件，与端配置文件</span><br><span class="line">IncludeOptional mods-enabled&#x2F;*.load</span><br><span class="line">IncludeOptional mods-enabled&#x2F;*.conf</span><br><span class="line">Include ports.conf</span><br><span class="line"></span><br><span class="line"># 定义不允许访问站点根目录索引</span><br><span class="line">&lt;Directory &#x2F;&gt;</span><br><span class="line">	Options FollowSymLinks</span><br><span class="line">	AllowOverride None</span><br><span class="line">	Require all denied</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br><span class="line">&lt;Directory &#x2F;usr&#x2F;share&gt;</span><br><span class="line">	AllowOverride None</span><br><span class="line">	Require all granted</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br><span class="line"></span><br><span class="line"># 允许在&#x2F;var&#x2F;www&#x2F;中建立url</span><br><span class="line">&lt;Directory &#x2F;var&#x2F;www&#x2F;&gt;</span><br><span class="line">	AllowOverride All</span><br><span class="line">	Require all granted</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br><span class="line"></span><br><span class="line"># 定义允许访问的用户， .htaccess定义了用户名</span><br><span class="line">AccessFileName .htaccess</span><br><span class="line"></span><br><span class="line"># 拒绝所以 任意以.ht后缀结尾的文件 </span><br><span class="line">&lt;FilesMatch &quot;^\.ht&quot;&gt;</span><br><span class="line">	Require all denied</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br><span class="line"></span><br><span class="line"># 定义 vhost_combined combined comman referer的四种日志格式,供虚拟主机调用</span><br><span class="line">LogFormat &quot;%v:%p %h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot; vhost_combined</span><br><span class="line">LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot; combined</span><br><span class="line">LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O&quot; common</span><br><span class="line">LogFormat &quot;%&#123;Referer&#125;i -&gt; %U&quot; referer</span><br><span class="line">LogFormat &quot;%&#123;User-agent&#125;i&quot; agent</span><br><span class="line">IncludeOptional conf-enabled&#x2F;*.conf</span><br><span class="line">IncludeOptional sites-enabled&#x2F;*.conf</span><br></pre></td></tr></table></figure>
<p>2、apache虚拟主机配置项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 指定 VirtualHost 以端口进行定义</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:8001&gt;</span><br><span class="line"></span><br><span class="line"># 指定VirtualHost域名</span><br><span class="line">	ServerAdmin www.ssjinyao.com.com</span><br><span class="line"></span><br><span class="line"># 指定虚拟主机url根路径</span><br><span class="line">	DocumentRoot &#x2F;var&#x2F;www&#x2F;html&#x2F;tweb</span><br><span class="line"></span><br><span class="line"># 指定访问错误日志保路径</span><br><span class="line">	ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line"></span><br><span class="line"># 指定访问日志保存路径	</span><br><span class="line">	CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access.log combined</span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<p>3、同nginx一样，做完变更之后需要先测试语法再重读，或重起</p>
<p>4、端口配置文件 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 将虚拟主机中所用到的对应端口启动; </span><br><span class="line"># Listen 80</span><br><span class="line">Listen 8001</span><br><span class="line">Listen 8002</span><br><span class="line">Listen 8003</span><br><span class="line">Listen 8004</span><br><span class="line">Listen 8101</span><br></pre></td></tr></table></figure>
<h2 id="supvisord-服务配置项"><a href="#supvisord-服务配置项" class="headerlink" title="supvisord 服务配置项"></a>supvisord 服务配置项</h2><p>1、更换服务器之后，需要修改服务器的监听地址；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 部署监听端口的问题</span><br><span class="line">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class="line">port&#x3D;172.17.xxx.xxx:7558        ; (ip_address:port specifier, *:port for all iface)</span><br></pre></td></tr></table></figure>
<p>2、部署python系统时报依赖问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;admin&#x2F;xbasement&#x2F;</span><br><span class="line">source .&#x2F;ENV&#x2F;bin&#x2F;activate</span><br><span class="line">pip install -r requirements.txt </span><br><span class="line">如果安装软件包存在问题，把对应的软件包给删除; </span><br></pre></td></tr></table></figure>
<p>3、查看对应服务器启动时的报错 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">admin@iZ2zegjb9m90kxovynpkbzZ:~$ tail -f ~&#x2F;xbasement&#x2F;log&#x2F;xbasement-server-stdout.log </span><br><span class="line">  File &quot;server.py&quot;, line 3, in &lt;module&gt;</span><br><span class="line">    from tornado.wsgi import WSGIContainer</span><br><span class="line">ImportError: No module named tornado.wsgiTraceback (most recent call last):</span><br><span class="line">  File &quot;server.py&quot;, line 3, in &lt;module&gt;</span><br><span class="line">    from tornado.wsgi import WSGIContainer</span><br><span class="line">ImportError: No module named tornado.wsgi</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;server.py&quot;, line 3, in &lt;module&gt;</span><br><span class="line">    from tornado.wsgi import WSGIContainer</span><br><span class="line">ImportError: No module named tornado.wsgi</span><br></pre></td></tr></table></figure>
<p>4、python部署时缺少模块的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 问题如下</span><br><span class="line">supervisor&gt; status</span><br><span class="line">customer:customer-0              RUNNING   pid 7981, uptime 0:00:19</span><br><span class="line">customer:job-recieve-0           RUNNING   pid 7980, uptime 0:00:19</span><br><span class="line">order:api-0                      FATAL     Exited too quickly (process log may have details)</span><br><span class="line">order:forward-job-0              FATAL     Exited too quickly (process log may have details)</span><br><span class="line">order:order-job-payment-0        FATAL     Exited too quickly (process log may have details)</span><br><span class="line">order:order-risk-job-0           FATAL     Exited too quickly (process log may have details)</span><br><span class="line">supervisor&gt; staus</span><br><span class="line">*** Unknown syntax: staus</span><br><span class="line">supervisor&gt; </span><br><span class="line">admin@ssjinyao.com-007:~&#x2F;torder&#x2F;venv&#x2F;lib&#x2F;python2.7&#x2F;site-packages$ !tail</span><br><span class="line">tail -f torder&#x2F;log&#x2F;order-api-out.log </span><br><span class="line">    from api import app</span><br><span class="line">ImportError: No module named api</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;api&#x2F;server.py&quot;, line 10, in &lt;module&gt;</span><br><span class="line">    from api import app</span><br><span class="line">ImportError: No module named api</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;api&#x2F;server.py&quot;, line 10, in &lt;module&gt;</span><br><span class="line">    from api import app</span><br><span class="line">ImportError: No module named api</span><br><span class="line"># 解决方式 </span><br><span class="line">admin@ssjinyao.com-007:~&#x2F;torder&#x2F;venv&#x2F;lib&#x2F;python2.7&#x2F;site-packages$ cat v.pth </span><br><span class="line">&#x2F;home&#x2F;admin&#x2F;torder</span><br><span class="line">admin@ssjinyao.com-007:~&#x2F;torder&#x2F;venv&#x2F;lib&#x2F;python2.7&#x2F;site-packages$ pwd</span><br><span class="line">&#x2F;home&#x2F;admin&#x2F;torder&#x2F;venv&#x2F;lib&#x2F;python2.7&#x2F;site-packages</span><br><span class="line">admin@ssjinyao.com-007:~&#x2F;torder&#x2F;venv&#x2F;lib&#x2F;python2.7&#x2F;site-packages$ history | grep ln </span><br><span class="line">ln -s &#x2F;home&#x2F;admin&#x2F;torder&#x2F; .</span><br></pre></td></tr></table></figure>
<p>5、加入新工程时，要复制编辑~/opt/supervisord.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[include]</span><br><span class="line">files &#x3D; &#x2F;home&#x2F;admin&#x2F;xbasement&#x2F;config&#x2F;supervisor&#x2F;xbasement.server.ini &#x2F;home&#x2F;admin&#x2F;topen&#x2F;config&#x2F;supervisor&#x2F;*.ini &#x2F;home&#x2F;admin&#x2F;cashier&#x2F;config&#x2F;supervisor&#x2F;*.ini</span><br></pre></td></tr></table></figure>
<p>6、部署open 工程时，要把ssl也复制上<br>7、应用变动时，要注意mongo,redis白名单</p>
<h2 id="zabbix-配置"><a href="#zabbix-配置" class="headerlink" title="zabbix 配置"></a>zabbix 配置</h2><p>1、zabbix_agent 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 进程的pid保存的配置</span><br><span class="line">PidFile&#x3D;&#x2F;tmp&#x2F;zabbix_agentd.pid</span><br><span class="line"></span><br><span class="line"># zabbix_agent 端日志保存位置 </span><br><span class="line">LogFile&#x3D;&#x2F;var&#x2F;log&#x2F;zabbix-agent&#x2F;zabbix_agentd.log</span><br><span class="line"></span><br><span class="line"># 日志文件存储大小 </span><br><span class="line">LogFileSize&#x3D;33</span><br><span class="line"></span><br><span class="line"># 日志级别</span><br><span class="line">DebugLevel&#x3D;4</span><br><span class="line"></span><br><span class="line"># 注:这个是重点，需要指定zabbix_server端的ip zabbix_server端才能实别</span><br><span class="line">Server&#x3D;121.xxx.xx.xxx</span><br><span class="line"></span><br><span class="line"># 监听的端口</span><br><span class="line">ListenPort&#x3D;10050</span><br><span class="line"></span><br><span class="line"># zabbix_agent 端进程监听的地址 </span><br><span class="line">ListenIP&#x3D;0.0.0.0</span><br><span class="line"></span><br><span class="line"># zabbix_agent 主动请求服务端时的地址 与 Server配合使用</span><br><span class="line">ServerActive&#x3D;121.xxx.xx.xxx</span><br><span class="line">Hostname&#x3D;te_server</span><br></pre></td></tr></table></figure>
<p>2、 zabbix_server 端配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 指定zabbix_server 端监听的地址</span><br><span class="line">ListenPort&#x3D;10051</span><br><span class="line"></span><br><span class="line"># 指定zabbix_server 产生的日志所保存的文件位置 </span><br><span class="line">LogFile&#x3D;&#x2F;var&#x2F;log&#x2F;zabbixsrv&#x2F;zabbix_server.log</span><br><span class="line"></span><br><span class="line"># 指定日志的大小</span><br><span class="line">LogFileSize&#x3D;0</span><br><span class="line"></span><br><span class="line"># 指定zabbix_server PidFile所保存的位置</span><br><span class="line">PidFile&#x3D;&#x2F;var&#x2F;run&#x2F;zabbixsrv&#x2F;zabbix_server.pid</span><br><span class="line"></span><br><span class="line"># 指定zabbix 调用的数据库库名</span><br><span class="line">DBName&#x3D;zabbix</span><br><span class="line"></span><br><span class="line"># 指定zabbix 调用的数据库的用户名 </span><br><span class="line">DBUser&#x3D;zabbix</span><br><span class="line"></span><br><span class="line"># 指定zabbix 使用的数据库密码</span><br><span class="line">DBPassword&#x3D;centos.xxxxxxxx</span><br><span class="line"></span><br><span class="line"># 指定mysql的sock文件</span><br><span class="line">DBSocket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line"></span><br><span class="line"># 指定mysql所监听的端口，注，zabbix_server所占用的数据库不大，且只需要监听本地</span><br><span class="line">DBPort&#x3D;3306</span><br><span class="line"></span><br><span class="line"># 指定zabbix_server 所监听的地址</span><br><span class="line">ListenIP&#x3D;0.0.0.0</span><br><span class="line"></span><br><span class="line"># 指定供zabbix调用的脚本程序(bash || python || perl),目前使用的是bash</span><br><span class="line">AlertScriptsPath&#x3D;&#x2F;var&#x2F;lib&#x2F;zabbixsrv&#x2F;alertscripts</span><br><span class="line"></span><br><span class="line"># 自定义监控项时的保存位置 </span><br><span class="line">ExternalScripts&#x3D;&#x2F;var&#x2F;lib&#x2F;zabbixsrv&#x2F;externalscripts</span><br><span class="line"></span><br><span class="line"># 指定临时的脚本程序 </span><br><span class="line">TmpDir&#x3D;&#x2F;var&#x2F;lib&#x2F;zabbixsrv&#x2F;tmp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 调用接口程序</span><br><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">#export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;root&#x2F;bin</span><br><span class="line">echo &quot;$2</span><br><span class="line">$3&quot; | &#x2F;usr&#x2F;bin&#x2F;mutt -s &quot;ZABBIX 报警&quot; $1</span><br><span class="line"></span><br><span class="line">zabbix.sh </span><br><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">#Can send weixin mail </span><br><span class="line">export path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;root&#x2F;bin</span><br><span class="line">#&#x2F;bin&#x2F;weixin --corpid&#x3D;ww3bba6a2898b91e69 --corpsecret&#x3D;3GqhGNZeEYuVvr9SRSyBWCOsbGvNcc6LXAn0uCO24XM --msg&#x3D;&quot;$2         $3&quot; --user&#x3D;&quot;$1&quot; --agentid&#x3D;1000002</span><br><span class="line">&#x2F;bin&#x2F;weixin --corpid&#x3D;wwfc47b4739f369c7c --corpsecret&#x3D;hD0ITPFehD8WJm-3ydJVxWamXQYs2l64xPCx9K76doM --msg&#x3D;&quot;$2</span><br><span class="line">$3&quot; --user&#x3D;$1 --agentid&#x3D;1000003</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 安装发送邮件报警程序的依赖</span><br><span class="line"># yum -y install msmtp mutt</span><br><span class="line"></span><br><span class="line"># 邮件发是由系统用户zabbixsrv调用，所以配置文件要在公共配置目录&#x2F;etc&#x2F;中配置</span><br><span class="line"># 不可以在 admin&#x2F;root 或者其它用户下配置</span><br><span class="line"># muttrc  配置项</span><br><span class="line">&#x2F;etc&#x2F;muttrc </span><br><span class="line">set sendmail&#x3D;&quot;&#x2F;usr&#x2F;bin&#x2F;msmtp&quot;</span><br><span class="line">set use_from&#x3D;yes</span><br><span class="line">set realname&#x3D;&quot;15822097176@139.com&quot;</span><br><span class="line">set editor&#x3D;&quot;vim&quot;</span><br><span class="line"></span><br><span class="line"># msmtprc 配置项</span><br><span class="line">&#x2F;etc&#x2F;msmtprc </span><br><span class="line">account default</span><br><span class="line">host smtp.ssjinyao.com</span><br><span class="line">port 25</span><br><span class="line">from dev@ssjinyao.com</span><br><span class="line">auth login</span><br><span class="line">tls off</span><br><span class="line">user dev@ssjinyao.com</span><br><span class="line">password xxxxxxxxxx</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需求, 代码要一条条的写 </span><br><span class="line">设计, 先实现再设计优化</span><br></pre></td></tr></table></figure>
<h2 id="线上ssh服务配置项"><a href="#线上ssh服务配置项" class="headerlink" title="线上ssh服务配置项"></a>线上ssh服务配置项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"># 指定ssh默认监听的地址</span><br><span class="line">Port 22</span><br><span class="line"></span><br><span class="line"># 指定ssh使用的协议</span><br><span class="line">Protocol 2</span><br><span class="line"></span><br><span class="line"># 指定当前服务器使用的私钥</span><br><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key</span><br><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key</span><br><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_ecdsa_key</span><br><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line"># 是否让sshd通过创建非特权子进程处理接入请求的方法来进行权限分离。默认值是&quot;yes&quot;。认证成功后，将以该认证用户的身份创建另一个子进程。这样做的目的是为了防止通过有缺陷的子进程提升权限，从而使系统更加安全</span><br><span class="line">UsePrivilegeSeparation yes</span><br><span class="line"></span><br><span class="line"># 设置在多少秒之后自动重新生成服务器的密匙（如果使用密匙）。重新生成密匙是为了防止用盗用的密匙解密被截获的信息。</span><br><span class="line">KeyRegenerationInterval 3600</span><br><span class="line"></span><br><span class="line"># Server Key 的加密码强度，强度越大越安全，传输速率也越慢</span><br><span class="line">ServerKeyBits 1024</span><br><span class="line"></span><br><span class="line"># sshd 记录日志的级别 </span><br><span class="line">LogLevel INFO</span><br><span class="line"></span><br><span class="line"># 用户登录时可视界面及时间</span><br><span class="line">LoginGraceTime 120</span><br><span class="line"></span><br><span class="line"># 当使用者的 host key 改变之后，Server 就不接受联机，</span><br><span class="line">StrictModes yes</span><br><span class="line"></span><br><span class="line"># 使用纯rsa认证方式</span><br><span class="line">RSAAuthentication yes</span><br><span class="line"></span><br><span class="line"># 是否允许pubkey认证</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"></span><br><span class="line"># 是否取消使用 ~&#x2F;.ssh&#x2F;.hosts 来做为认证</span><br><span class="line">IgnoreRhosts yes</span><br><span class="line"></span><br><span class="line"># 这个选项是专门给 version 1 用的</span><br><span class="line">RhostsRSAAuthentication no</span><br><span class="line"></span><br><span class="line"># 这个项目与上面的项目类似，不过是给 version 2 使用的</span><br><span class="line">HostbasedAuthentication no</span><br><span class="line"></span><br><span class="line">#这个项目在是否允许以空的密码登入！# 此项要注意</span><br><span class="line">PermitEmptyPasswords no</span><br><span class="line"></span><br><span class="line"># 挑战任何的密码认证, 任何 login.conf都能使用 </span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"></span><br><span class="line"># x11转发功能开启，可以使用基于ssh的加密码图形工具</span><br><span class="line">X11Forwarding yes</span><br><span class="line"></span><br><span class="line"># 自适大小</span><br><span class="line">X11DisplayOffset 10</span><br><span class="line"></span><br><span class="line"># 打印Motd信息</span><br><span class="line">PrintMotd no</span><br><span class="line"></span><br><span class="line"># 登录前后输出日志</span><br><span class="line">PrintLastLog yes</span><br><span class="line"></span><br><span class="line"># 开启tcp长连接</span><br><span class="line">TCPKeepAlive yes</span><br><span class="line"></span><br><span class="line"># 设置x11的转输语言及编码</span><br><span class="line">AcceptEnv LANG LC_*</span><br><span class="line"></span><br><span class="line"># 基于ssh 的vftp服务</span><br><span class="line">Subsystem sftp &#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;sftp-server</span><br><span class="line"></span><br><span class="line">#利用 PAM 管理使用者认证</span><br><span class="line">UsePAM yes</span><br><span class="line"></span><br><span class="line">#使用dns解析 </span><br><span class="line">UseDNS no</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">AddressFamily inet</span><br><span class="line"></span><br><span class="line"># 允许root用户直接登录 </span><br><span class="line">PermitRootLogin yes</span><br><span class="line"></span><br><span class="line"># 记录系统日志</span><br><span class="line">SyslogFacility AUTHPRIV</span><br><span class="line"></span><br><span class="line"># 开启用户认证登录</span><br><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure>

  
  
    
    <div class='footer'>
      
      
      
        <div class='copyright'>
          <blockquote>
            
              
                <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

              
            
              
                <p>本文永久链接是：<a href=https://www.asjin.com/2018/10/29/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E6%98%8E%E7%BB%86/>https://www.asjin.com/2018/10/29/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E6%98%8E%E7%BB%86/</a></p>
              
            
          </blockquote>
        </div>
      
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-09-29T19:05:45+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：Sep 29, 2020</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/rhca/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>rhca</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/linux/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>linux</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.asjin.com/2018/10/29/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E6%98%8E%E7%BB%86/&title=服务器常用配置参数明细 - null&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.asjin.com/2018/10/29/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E6%98%8E%E7%BB%86/&title=服务器常用配置参数明细 - null&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.asjin.com/2018/10/29/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E6%98%8E%E7%BB%86/&title=服务器常用配置参数明细 - null&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png">
          
        </a>
      
    
      
    
      
    
  </div>
</div>



        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/2019/03/11/nginx-lua-redis%E5%AE%9E%E7%9F%AD%E9%93%BE%E6%8E%A5%E8%BD%AC%E5%8F%91%E9%95%BF%E9%93%BE%E6%8E%A5/'>
          <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>nginx+lua+redis 实现短链接转发长链接</p>
          <p class='content'>[toc]
nginx + lua + redis 实现短链接转发长链接
重新编译安装 nginx  及相关依赖安装相关依赖包
1#  yum -y install gcc zlib zlib-...</p>
        </a>
      
      
        <a class='next' href='/2018/10/04/kubernetes%20%E7%AC%94%E8%AE%B0%E4%B8%80/'>
          <p class='title'>kubernetes笔记<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>[toc]
kubernetes 笔记CI: 持续集成CD: 持续交付，DeliveryCD: 持续部署，Deployment
kubernetes的releases版本
kubernetes ...</p>
        </a>
      
    </div>
  
</article>


  

  <article class="post white-box reveal floatable" id="comments">
    <p ct><i class='fas fa-comments'></i> 评论</p>
    
    <div id="valine_container" class="valine_thread">
  <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
</div>

  </article>






</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper floatable desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">nginx服务配置项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">redis服务配置项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mongo%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">mongo服务配置项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">mysql服务配置项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#apache%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">apache服务配置项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#supvisord-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">supvisord 服务配置项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zabbix-%E9%85%8D%E7%BD%AE"><span class="toc-text">zabbix 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E4%B8%8Assh%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">线上ssh服务配置项</span></a></li></ol>
    </div>
  </section>


  


</aside>



        
        
          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="服务器常用配置参数明细";
  pdata.commentPath="";
  pdata.commentPlaceholder="";

  var l_header=document.getElementById("l_header");
  
  l_header.classList.remove("show");
  
</script>

        
      </div>
      
  
  <footer class="footer clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
          
            
          
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        
      
    
      
        本站使用
        <a href="https://github.com/volantis-x/hexo-theme-volantis/tree/4.1.6" target="_blank" class="codename">Volantis</a>
        作为主题，总访问量为
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          次
        
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © 2017-2020 asjin.com</a></p>

        </div>
      
    
  </footer>


      <a id="s-top" class="fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
    </div>
  </div>
  <div>
    <script>
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/********************脚本懒加载函数********************************/
function loadScript(src, cb) {
var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
var script = document.createElement('script');
script.setAttribute('type','text/javascript');
if (cb) script.onload = cb;
script.setAttribute('src', src);
HEAD.appendChild(script);
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script>
<script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  
  
</script>
<!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    setTimeout(function() {
      loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
    }, 1);
  };
  $(function () {
    SCload_fancybox();
  });
</script>


<!-- internal -->







  <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  
  
    <script async src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
  




  <script src="/js/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
		if($(".highlight .code pre").length+$(".article pre code").length==0)return;
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
</script>








  
  
<script src="https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"></script>


<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link,header'.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick', 'mail', 'link'];
  var requiredFields = 'nick,mail'.split(',').filter(function (item) {
    return REQUIRED_FIELDS.indexOf(item) > -1
  });

  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }

  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }

  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;

    let pagePlaceholder = pdata.commentPlaceholder || "快来评论吧~ 🤩 🤩 🤩";

    let path = pdata.commentPath;
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }

    var valine = new Valine();
    valine.init({
      el: '#valine_container',
      meta: meta,
      placeholder: pagePlaceholder,
      path: path,
      appId: "NkJqMpxu4QlRLhPIHipNUHF1-gzGzoHsz",
      appKey: "D2vTdueKJ8ammc2JEdje0vLW",
      pageSize: '',
      avatar: 'monsterid',
      lang: '',
      visitor: '',
      highlight: '',
      mathJax: '',
      enableQQ: 'true',
      recordIP: 'false',
      requiredFields: requiredFields,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps
    })
  }

  $(function () {
    pjax_valine();
  });
</script>




  <script defer src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js" data-pjax></script>


  
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@4.1.6/source/js/app.min.js"></script>



<!-- optional -->

  <script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );

$('.input.u-search-input').one('focus',function(){
	
		loadScript('https://cdn.jsdelivr.net/npm/hexo-theme-volantis@4.1.6/source/js/search/hexo.min.js',setSearchService);
	
})

function listenSearch(){
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
}
function setSearchService() {
	listenSearch();
	
		document.addEventListener("pjax:success", listenSearch);
	
}
</script>

















<script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script>

<!-- more -->




    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#l_cover",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
       

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      
	 

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
          if (typeof $.fancybox == "undefined") {
            SCload_fancybox();
          } else {
            pjax_fancybox();
          }
        
        
        
        
        
          pjax_initCopyCode();
        
        
          pjax_valine();
        
        
        
        
      } catch (e) {
        console.log(e);
      }
	  
    });

    document.addEventListener('pjax:error', function (e) {
	  
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
</body>
</html>
